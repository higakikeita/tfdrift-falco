# TFDrift-Falco v0.2.0-beta ãƒªãƒªãƒ¼ã‚¹å¾Œã®å“è³ªæ”¹å–„ä½œæ¥­ã€é–‹ç™ºæ—¥è¨˜ã€‘

## ã¯ã˜ã‚ã«

TFDrift-Falco v0.2.0-betaã‚’2025å¹´12æœˆ5æ—¥ã«ãƒªãƒªãƒ¼ã‚¹ã—ãŸç›´å¾Œã€å“è³ªã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ã•ã‚‰ã«å‘ä¸Šã•ã›ã‚‹ãŸã‚ã€è¿½åŠ ã®æ”¹å–„ä½œæ¥­ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚æœ¬è¨˜äº‹ã§ã¯ã€ãã®å®Ÿè£…ãƒ—ãƒ­ã‚»ã‚¹ã‚’é–‹ç™ºæ—¥è¨˜å½¢å¼ã§è¨˜éŒ²ã—ã¾ã™ã€‚

## èƒŒæ™¯ã¨ç›®çš„

v0.2.0-betaãƒªãƒªãƒ¼ã‚¹å¾Œã€ä»¥ä¸‹ã®èª²é¡ŒãŒæ®‹ã£ã¦ã„ã¾ã—ãŸï¼š

1. **Backendãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒ0%** - æ–°è¦è¿½åŠ ã—ãŸTerraform backendæŠ½è±¡åŒ–å±¤ãŒæœªãƒ†ã‚¹ãƒˆ
2. **ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹** - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šåŸºæº–ãŒãªã„
3. **Snykã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã®è¨­å®šä¸å‚™** - SARIFå‡ºåŠ›ãŒæ­£ã—ãç”Ÿæˆã•ã‚Œãªã„
4. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®æ¤œè¨¼ãŒä¸ååˆ†** - å…¨ä½“çš„ãªå“è³ªæŒ‡æ¨™ã®ç¢ºèªãŒå¿…è¦

ã“ã‚Œã‚‰ã‚’è§£æ±ºã—ã€OSSãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã®å®Œæˆåº¦ã‚’é«˜ã‚ã‚‹ã“ã¨ãŒä»Šå›ã®ç›®æ¨™ã§ã™ã€‚

## é–‹ç™ºæ—¥è¨˜

### Day 1: Backend ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆå®Ÿè£…

#### ç¾çŠ¶åˆ†æ

ã¾ãšã€backendãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ§‹æˆã‚’ç¢ºèªï¼š

```
pkg/terraform/backend/
â”œâ”€â”€ factory.go     # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ï¼ˆæœªãƒ†ã‚¹ãƒˆï¼‰
â”œâ”€â”€ local.go       # ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆæœªãƒ†ã‚¹ãƒˆï¼‰
â””â”€â”€ s3.go          # S3ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆæœªãƒ†ã‚¹ãƒˆï¼‰
```

ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèªï¼š
```bash
$ go test -cover ./pkg/terraform/backend
coverage: 0.0% of statements
```

å…¨ãæœªãƒ†ã‚¹ãƒˆã®çŠ¶æ…‹ã§ã—ãŸã€‚

#### ãƒ†ã‚¹ãƒˆè¨­è¨ˆ

3ã¤ã®è²¬å‹™ã«åˆ†ã‘ã¦ãƒ†ã‚¹ãƒˆã‚’è¨­è¨ˆï¼š

1. **Factory Pattern** - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é¸æŠãƒ­ã‚¸ãƒƒã‚¯
2. **Local Backend** - ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
3. **S3 Backend** - è¨­å®šæ¤œè¨¼ï¼ˆå®Ÿéš›ã®S3ã‚¢ã‚¯ã‚»ã‚¹ã¯Integration Testã§ï¼‰

#### å®Ÿè£…

**local_test.go** ã‚’ä½œæˆï¼š
- ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ãƒã‚§ãƒƒã‚¯
- ãƒ‘ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤å¾Œã®Loadï¼‰

```go
func TestNewLocalBackend(t *testing.T) {
    tests := []struct {
        name      string
        path      string
        setup     func(string) error
        wantError bool
    }{
        {
            name: "existing file",
            path: "test.tfstate",
            setup: func(path string) error {
                return os.WriteFile(path, []byte(`{"version": 4}`), 0600)
            },
            wantError: false,
        },
        // ... more test cases
    }
}
```

**s3_test.go** ã‚’ä½œæˆï¼š
- Bucket/Keyå¿…é ˆãƒã‚§ãƒƒã‚¯
- Region ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆus-east-1ï¼‰
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–

**factory_test.go** ã‚’ä½œæˆï¼š
- Local/S3ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®é¸æŠ
- æœªã‚µãƒãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### çµæœ

```bash
$ go test -cover ./pkg/terraform/backend
ok      github.com/keitahigaki/tfdrift-falco/pkg/terraform/backend     2.831s  coverage: 67.4% of statements
```

**ã‚«ãƒãƒ¬ãƒƒã‚¸: 0.0% â†’ 67.4%** ğŸ‰

æ®‹ã‚Šã®32.6%ã¯ä¸»ã«S3ã®å®Ÿéš›ã®Loadå‡¦ç†ï¼ˆAWS SDKå‘¼ã³å‡ºã—ï¼‰ã§ã€ã“ã‚Œã¯Integration Testã§ã‚«ãƒãƒ¼ã™ã‚‹æ–¹é‡ã§ã™ã€‚

---

### Day 2: ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆã®æœ‰åŠ¹åŒ–

#### å•é¡Œç™ºè¦‹

ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆã¯ `//go:build ignore` ã‚¿ã‚°ã§ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã—ãŸï¼š

```bash
$ ls tests/benchmark/
event_processing_bench_test.go  # //go:build ignore
memory_usage_test.go            # //go:build ignore
```

ã‚¿ã‚°ã‚’å‰Šé™¤ã—ã¦å®Ÿè¡Œã™ã‚‹ã¨ã€APIã®äº’æ›æ€§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿï¼š

```
det.HandleEvent undefined (but does have unexported method handleEvent)
det.GetStateManager undefined
```

#### åŸå› åˆ†æ

Detectorã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã§ã€ä»¥ä¸‹ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã—ãŸï¼š
- `HandleEvent()` â†’ `handleEvent()` ï¼ˆéå…¬é–‹åŒ–ï¼‰
- `GetStateManager()` â†’ å‰Šé™¤ï¼ˆç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã«å¤‰æ›´ï¼‰

ã—ã‹ã—ã€ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆã¯å¤ã„APIã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚

#### è§£æ±ºç­–

ãƒ†ã‚¹ãƒˆå°‚ç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½œæˆï¼š

**pkg/detector/testing.go** ã‚’æ–°è¦ä½œæˆï¼š
```go
package detector

import "github.com/keitahigaki/tfdrift-falco/pkg/types"

// HandleEventForTest is a test helper that exposes handleEvent
func (d *Detector) HandleEventForTest(event types.Event) {
    d.handleEvent(event)
}

// GetStateManagerForTest exposes the state manager for testing
func (d *Detector) GetStateManagerForTest() interface{} {
    return d.stateManager
}
```

ã“ã‚Œã«ã‚ˆã‚Šã€æœ¬ç•ªã‚³ãƒ¼ãƒ‰ã®ã‚«ãƒ—ã‚»ãƒ«åŒ–ã‚’ç¶­æŒã—ã¤ã¤ã€ãƒ†ã‚¹ãƒˆã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

#### ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆã®ä¿®æ­£

ã™ã¹ã¦ã® `HandleEvent` å‘¼ã³å‡ºã—ã‚’ `HandleEventForTest` ã«å¤‰æ›´ï¼š

```go
func BenchmarkEventProcessing_Single(b *testing.B) {
    det := setupBenchmarkDetector(b)
    event := createBenchmarkEvent()

    b.ResetTimer()
    b.ReportAllocs()

    for i := 0; i < b.N; i++ {
        det.HandleEventForTest(event)  // â† ä¿®æ­£
    }
}
```

#### ãƒ¡ãƒ¢ãƒªãƒ†ã‚¹ãƒˆã®ä¿®æ­£

ãƒ¡ãƒ¢ãƒªæ¸¬å®šã§ `uint64` ã‚¢ãƒ³ãƒ€ãƒ¼ãƒ•ãƒ­ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã¾ã—ãŸï¼š

```go
// å•é¡Œã®ã‚³ãƒ¼ãƒ‰
allocDiff := memAfter.Alloc - memBefore.Alloc  // GCã§memAfter < memBeforeã«ãªã‚‹ã¨å·¨å¤§ãªå€¤ã«
```

åŸå› ï¼š`runtime.MemStats.Alloc` ã¯GCã§æ¸›å°‘ã™ã‚‹ãŸã‚ã€å·®åˆ†ãŒè² ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

**è§£æ±ºç­–**ï¼š`TotalAlloc`ï¼ˆç´¯ç©å‰²ã‚Šå½“ã¦é‡ã€å˜èª¿å¢—åŠ ï¼‰ã‚’ä½¿ç”¨ï¼š

```go
// ä¿®æ­£å¾Œ
totalAllocDiff := memAfter.TotalAlloc - memBefore.TotalAlloc
avgPerEvent := totalAllocDiff / uint64(numEvents)
```

#### ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœ

ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸï¼ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’ç¢ºç«‹ï¼š

```
BenchmarkEventProcessing_Single-14          4344      44507 ns/op      9564 B/op     117 allocs/op
BenchmarkEventProcessing_Batch-14             30    4456894 ns/op    956465 B/op   11704 allocs/op
BenchmarkEventParsing-14               24639178         5.048 ns/op        0 B/op       0 allocs/op
BenchmarkStateComparison-14            31610491         3.912 ns/op        0 B/op       0 allocs/op
BenchmarkDriftDetection_EC2-14             4927      45019 ns/op      9494 B/op     115 allocs/op
BenchmarkDriftDetection_IAM-14             3804      42841 ns/op      9505 B/op     118 allocs/op
BenchmarkDriftDetection_S3-14              3520      44181 ns/op      9437 B/op     115 allocs/op
BenchmarkConcurrentEvents-14               3886      45974 ns/op      9622 B/op     117 allocs/op
```

**Key Insights:**
- ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†: ~44Î¼s/opï¼ˆ22,000 events/secå‡¦ç†å¯èƒ½ï¼‰
- ãƒ¡ãƒ¢ãƒªåŠ¹ç‡: ~9.5KB/opï¼ˆå¦¥å½“ãªç¯„å›²ï¼‰
- çŠ¶æ…‹æ¯”è¼ƒ: ~4ns/opï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹æœæŠœç¾¤ï¼‰

---

### Day 3: Snykã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã®æ”¹å–„

#### å•é¡Œã®ç‰¹å®š

`.github/workflows/security.yml` ã®Snykè¨­å®šã‚’ç¢ºèªï¼š

```yaml
- name: Run Snyk to check for vulnerabilities
  uses: snyk/actions/golang@master
  env:
    SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
  with:
    args: --severity-threshold=high

- name: Upload Snyk results to GitHub Code Scanning
  uses: github/codeql-action/upload-sarif@v3
  with:
    sarif_file: snyk.sarif  # â† ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¦ã„ãªã„ï¼
```

Snykã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ `snyk.sarif` ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã›ã‚“ã§ã—ãŸã€‚

#### è§£æ±ºç­–

SARIFå‡ºåŠ›ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šï¼š

```yaml
- name: Run Snyk to check for vulnerabilities
  uses: snyk/actions/golang@master
  continue-on-error: true
  env:
    SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
  with:
    args: --severity-threshold=high --sarif-file-output=snyk.sarif
    command: test

- name: Upload Snyk results to GitHub Code Scanning
  uses: github/codeql-action/upload-sarif@v3
  if: always()  # â† å¤±æ•—ã—ã¦ã‚‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  with:
    sarif_file: snyk.sarif
```

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ•´å‚™

**`.github/SECURITY.md`** ã‚’ä½œæˆï¼š
- ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ˜ç¤º
- è„†å¼±æ€§å ±å‘Šãƒ—ãƒ­ã‚»ã‚¹
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã®èª¬æ˜ï¼ˆSnykã€GoSecã€Nancyï¼‰
- Snykãƒˆãƒ¼ã‚¯ãƒ³ã®è¨­å®šæ‰‹é †

**`scripts/security-scan.sh`** ã‚’ä½œæˆï¼š
ãƒ­ãƒ¼ã‚«ãƒ«ã§3ã¤ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã‚’ä¸€æ‹¬å®Ÿè¡Œï¼š

```bash
#!/bin/bash
# Security scanning script for local development

# Run gosec
gosec -fmt=text -exclude=G104 ./...

# Run nancy
go list -json -deps ./... | nancy sleuth

# Run govulncheck
go list -json -m all | govulncheck -mode=binary ./...
```

#### READMEæ›´æ–°

é–‹ç™ºã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã‚’è¿½åŠ ï¼š

```markdown
### Security Scanning

Multiple security tools run on every commit:
- **Snyk**: Dependency vulnerability scanning
- **GoSec**: Go code security audit
- **Nancy**: OSS dependency scanner

Run local security scans:
\`\`\`bash
./scripts/security-scan.sh
\`\`\`
```

---

### Day 4: ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®æ¤œè¨¼

#### å…¨ä½“ã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç¢ºèª

```bash
$ go test -cover ./...
ok      github.com/keitahigaki/tfdrift-falco/pkg/cloudtrail    coverage: 93.9% of statements
ok      github.com/keitahigaki/tfdrift-falco/pkg/detector      coverage: 88.7% of statements
ok      github.com/keitahigaki/tfdrift-falco/pkg/diff          coverage: 98.2% of statements
ok      github.com/keitahigaki/tfdrift-falco/pkg/metrics       coverage: 100.0% of statements
ok      github.com/keitahigaki/tfdrift-falco/pkg/notifier      coverage: 95.6% of statements
ok      github.com/keitahigaki/tfdrift-falco/pkg/terraform     coverage: 97.6% of statements
ok      github.com/keitahigaki/tfdrift-falco/pkg/terraform/backend  coverage: 67.4% of statements
ok      github.com/keitahigaki/tfdrift-falco/tests/benchmark   coverage: 71.4% of statements

total: (statements) 71.9%
```

#### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆ¥åˆ†æ

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | ã‚«ãƒãƒ¬ãƒƒã‚¸ | è©•ä¾¡ |
|-----------|-----------|------|
| pkg/metrics | 100.0% | âœ… å®Œç’§ |
| pkg/diff | 98.2% | âœ… å„ªç§€ |
| pkg/terraform | 97.6% | âœ… å„ªç§€ |
| pkg/notifier | 95.6% | âœ… å„ªç§€ |
| pkg/cloudtrail | 93.9% | âœ… å„ªç§€ |
| pkg/detector | 88.7% | âœ… è‰¯å¥½ |
| tests/benchmark | 71.4% | âœ… è‰¯å¥½ |
| **pkg/terraform/backend** | **67.4%** | âœ… **æ”¹å–„ï¼** |

#### ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

```bash
$ go tool cover -func=coverage.out | tail -20
```

ä¸»ãªæœªã‚«ãƒãƒ¼ç®‡æ‰€ï¼š
- E2E/Integration ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆå®Ÿéš›ã®AWS/Falcoç’°å¢ƒãŒå¿…è¦ï¼‰
- S3Backendã®Loadå®Ÿè£…ï¼ˆAWS SDKå‘¼ã³å‡ºã—ï¼‰
- CLI ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆã§ã‚«ãƒãƒ¼ï¼‰

ã“ã‚Œã‚‰ã¯æ„å›³çš„ã«é™¤å¤–ã—ã¦ãŠã‚Šã€å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

---

### Day 5: è² è·ãƒ†ã‚¹ãƒˆã®å®Ÿè£…

#### å•é¡Œç™ºè¦‹

è² è·ãƒ†ã‚¹ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆ`tests/load/README.md`ï¼‰ã«ã¯å®Ÿè¡Œæ–¹æ³•ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ï¼ˆ`load_test.go`ï¼‰ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã§ã—ãŸï¼š

```bash
$ ls tests/load/
cloudtrail_simulator.go
terraform_state_generator.go
collect_metrics.sh
run_load_test.sh
docker-compose.load-test.yml
README.md
# load_test.go ãŒå­˜åœ¨ã—ãªã„ï¼
```

#### è¨­è¨ˆã¨å®Ÿè£…

3ã¤ã®ã‚·ãƒŠãƒªã‚ªã«å¯¾å¿œã—ãŸçµ±åˆè² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ï¼š

**1. ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆ**ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©ç¢ºèªï¼‰
- State Generator ã®å‹•ä½œç¢ºèª
- CloudTrail Simulator ã®å‹•ä½œç¢ºèª
- Docker Compose è¨­å®šã®æ¤œè¨¼
- **å®Ÿè¡Œæ™‚é–“**: ç´„15ç§’

**2. ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ**ï¼ˆæœ¬ç•ªç›¸å½“ã®è² è·ï¼‰
- Small Scale: 100 events/min, 500 resources, 1æ™‚é–“
- Medium Scale: 1,000 events/min, 5,000 resources, 4æ™‚é–“
- Large Scale: 10,000 events/min, 50,000 resources, 8æ™‚é–“

**å®Ÿè£…ã®ç‰¹å¾´**:
```go
type LoadScenario struct {
    Name               string
    EventRate          int           // events per minute
    TerraformResources int           // number of resources
    Duration           time.Duration // test duration
    ExpectedP95        time.Duration // expected latency
    MaxMemoryMB        int           // max memory
    MaxCPUPercent      int           // max CPU
}
```

**4ã¤ã®ãƒ•ã‚§ãƒ¼ã‚º**:
1. **Setup**: Terraform Stateç”Ÿæˆã€Dockerç’°å¢ƒèµ·å‹•
2. **Execution**: CloudTrailã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼å®Ÿè¡Œã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
3. **Validation**: åˆæ ¼åŸºæº–ã¨ã®æ¯”è¼ƒ
4. **Cleanup**: Dockerç’°å¢ƒåœæ­¢ã€ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤

#### ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ

```bash
$ go test -v -run=TestLoadTest_QuickSmoke -timeout=5m

=== RUN   TestLoadTest_QuickSmoke
    load_test.go:306: Running quick smoke test...
=== RUN   TestLoadTest_QuickSmoke/StateGenerator
=== RUN   TestLoadTest_QuickSmoke/CloudTrailSimulator
=== RUN   TestLoadTest_QuickSmoke/DockerCompose
    load_test.go:359: âœ… Smoke test passed
--- PASS: TestLoadTest_QuickSmoke (15.08s)
    --- PASS: TestLoadTest_QuickSmoke/StateGenerator (1.67s)
    --- PASS: TestLoadTest_QuickSmoke/CloudTrailSimulator (13.02s)
    --- PASS: TestLoadTest_QuickSmoke/DockerCompose (0.38s)
PASS
```

ã™ã¹ã¦ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼

#### åˆæ ¼åŸºæº–ã¨ã®çµ±åˆ

ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã§ç¢ºç«‹ã—ãŸæ€§èƒ½åŸºæº–ã‚’è² è·ãƒ†ã‚¹ãƒˆã®åˆæ ¼åŸºæº–ã«åæ˜ ï¼š

| æŒ‡æ¨™ | å°è¦æ¨¡ | ä¸­è¦æ¨¡ | å¤§è¦æ¨¡ | æ ¹æ‹  |
|------|--------|--------|--------|------|
| ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†æ™‚é–“ (p95) | < 100ms | < 500ms | < 1s | ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯44Î¼s |
| ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ | > 100 eps | > 1,000 eps | > 10,000 eps | ç†è«–å€¤22K eps |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ | < 512MB | < 2GB | < 4GB | 9.5KB/event |
| ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ | < 50% | < 50% | < 50% | é•·æ™‚é–“å®Ÿè¡Œ |

#### ä»Šå¾Œã®æ‹¡å¼µ

**ç¾åœ¨ã®çŠ¶æ…‹**:
- âœ… ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å®Ÿè£…
- âœ… è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- âœ… ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆå‹•ä½œç¢ºèª
- âš ï¸ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‘ãƒ¼ã‚·ãƒ³ã‚°ï¼ˆç°¡æ˜“å®Ÿè£…ï¼‰

**ä»Šå¾Œã®æ”¹å–„**:
- Prometheusãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å®Ÿéš›ã®å–å¾—ã¨è§£æ
- Lokiãƒ­ã‚°ã®é›†ç´„ã¨ã‚¨ãƒ©ãƒ¼ç‡è¨ˆç®—
- ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã®è‡ªå‹•åŒ–
- CI/CDã¸ã®çµ±åˆï¼ˆnightly buildï¼‰

---

## æˆæœã¾ã¨ã‚

### ğŸ“Š æ•°å€¤ã§ã®æˆæœ

| é …ç›® | Before | After | æ”¹å–„ |
|-----|--------|-------|------|
| Backend ã‚«ãƒãƒ¬ãƒƒã‚¸ | 0.0% | 67.4% | +67.4% |
| ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆ | ç„¡åŠ¹ | æœ‰åŠ¹ï¼ˆ8ãƒ†ã‚¹ãƒˆï¼‰ | âœ… |
| ãƒ¡ãƒ¢ãƒªãƒ†ã‚¹ãƒˆ | ã‚¨ãƒ©ãƒ¼ | æˆåŠŸï¼ˆ4ãƒ†ã‚¹ãƒˆï¼‰ | âœ… |
| è² è·ãƒ†ã‚¹ãƒˆ | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã¿ | å®Ÿè£…æ¸ˆã¿ï¼ˆ4ãƒ†ã‚¹ãƒˆï¼‰ | âœ… |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ | ä¸å®Œå…¨ | å®Œå…¨ | âœ… |
| å…¨ä½“ã‚«ãƒãƒ¬ãƒƒã‚¸ | - | 71.9% | - |

### ğŸ¯ ç¢ºç«‹ã—ãŸãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³

- **ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†**: 44Î¼s/op â†’ 22,000 events/secå‡¦ç†å¯èƒ½
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: 9.5KB/event â†’ 1ä¸‡ã‚¤ãƒ™ãƒ³ãƒˆã§95MB
- **çŠ¶æ…‹æ¯”è¼ƒ**: 4ns/op â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡ãŒé«˜ã„

### ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

- **Snyk**: ä¾å­˜é–¢ä¿‚ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆSARIFå¯¾å¿œï¼‰
- **GoSec**: Goã‚³ãƒ¼ãƒ‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
- **Nancy**: OSSä¾å­˜é–¢ä¿‚ã‚¹ã‚­ãƒ£ãƒŠãƒ¼
- **ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ**: `./scripts/security-scan.sh` ã§å³åº§ã«ç¢ºèªå¯èƒ½

### ğŸ“ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

- `.github/SECURITY.md`: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼
- `scripts/security-scan.sh`: ãƒ­ãƒ¼ã‚«ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
- README.md: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 

### ğŸ’¾ ã‚³ãƒŸãƒƒãƒˆå±¥æ­´

```
770d1e7 test: add backend tests and enable benchmark tests
044cc92 chore: improve Snyk security scanning setup
be38860 docs: add quality improvements documentation
3def46c docs: add Snyk setup guide and update load testing benchmarks
[æ¬¡å›] feat: add load test implementation
```

---

## å­¦ã‚“ã ã“ã¨

### 1. ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã®æœ‰ç”¨æ€§

æœ¬ç•ªã‚³ãƒ¼ãƒ‰ã®ã‚«ãƒ—ã‚»ãƒ«åŒ–ã‚’ç¶­æŒã—ã¤ã¤ã€ãƒ†ã‚¹ãƒˆã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¯èƒ½ã«ã™ã‚‹ `*ForTest()` ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯æœ‰åŠ¹ã§ã—ãŸã€‚

```go
// æœ¬ç•ªã‚³ãƒ¼ãƒ‰ã¯éå…¬é–‹ã®ã¾ã¾
func (d *Detector) handleEvent(event types.Event) { ... }

// ãƒ†ã‚¹ãƒˆç”¨ã«å…¬é–‹
func (d *Detector) HandleEventForTest(event types.Event) {
    d.handleEvent(event)
}
```

### 2. ãƒ¡ãƒ¢ãƒªæ¸¬å®šã®è½ã¨ã—ç©´

`runtime.MemStats.Alloc` ã¯ç¾åœ¨ã®å‰²ã‚Šå½“ã¦é‡ï¼ˆGCã§æ¸›å°‘ï¼‰ã€`TotalAlloc` ã¯ç´¯ç©å‰²ã‚Šå½“ã¦é‡ï¼ˆå˜èª¿å¢—åŠ ï¼‰ã§ã™ã€‚å·®åˆ†è¨ˆç®—ã§ã¯å¿…ãš `TotalAlloc` ã‚’ä½¿ã†ã¹ãã§ã™ã€‚

### 3. SARIFå‡ºåŠ›ã®é‡è¦æ€§

GitHub Code Scanningã¨çµ±åˆã™ã‚‹ã«ã¯ã€SARIFå½¢å¼ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒãƒ¼ãƒˆãŒå¿…é ˆã§ã™ã€‚ãƒ„ãƒ¼ãƒ«ã”ã¨ã«å‡ºåŠ›æ–¹æ³•ãŒç•°ãªã‚‹ãŸã‚ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç¢ºèªãŒé‡è¦ã§ã™ã€‚

### 4. ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¯å®šæœŸå®Ÿè¡Œã™ã¹ã

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é€€è¡Œã‚’é˜²ããŸã‚ã€ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆã¯å®šæœŸçš„ã«å®Ÿè¡Œã—ã€çµæœã‚’è¨˜éŒ²ã™ã¹ãã§ã™ã€‚ä»Šå›ç¢ºç«‹ã—ãŸãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’ä»Šå¾Œã®æŒ‡æ¨™ã¨ã—ã¾ã™ã€‚

---

## ä»Šå¾Œã®å±•æœ›

### çŸ­æœŸï¼ˆæ¬¡ã®ãƒã‚¤ãƒŠãƒ¼ãƒªãƒªãƒ¼ã‚¹ï¼‰
- [ ] Snykãƒˆãƒ¼ã‚¯ãƒ³ã®è¨­å®šï¼ˆãƒªãƒã‚¸ãƒˆãƒªã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼‰
- [ ] E2E/Integration ãƒ†ã‚¹ãƒˆç’°å¢ƒã®æ§‹ç¯‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã®è‡ªå‹•åŒ–

### ä¸­æœŸï¼ˆv0.3.0ï¼‰
- [ ] ã‚ˆã‚Šå¤šãã®AWSã‚µãƒ¼ãƒ“ã‚¹å¯¾å¿œ
- [ ] ãƒãƒ«ãƒãƒªãƒ¼ã‚¸ãƒ§ãƒ³å¯¾å¿œã®å¼·åŒ–
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã‚¨ãƒ³ã‚¸ãƒ³ã®å®Ÿè£…

### é•·æœŸï¼ˆv1.0.0ã«å‘ã‘ã¦ï¼‰
- [ ] ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½ï¼ˆRBACã€ç›£æŸ»ãƒ­ã‚°ï¼‰
- [ ] ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
- [ ] Web UIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

---

## ã¾ã¨ã‚

v0.2.0-betaãƒªãƒªãƒ¼ã‚¹å¾Œã€ã‚ãšã‹4æ—¥é–“ã§ä»¥ä¸‹ã‚’é”æˆã—ã¾ã—ãŸï¼š

âœ… Backendãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ 0% â†’ 67.4%
âœ… ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆã®æœ‰åŠ¹åŒ–ã¨ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç¢ºç«‹
âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã®å®Œå…¨ãªè¨­å®š
âœ… åŒ…æ‹¬çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

OSSãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã ã‘ã§ãªãã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã™ã¹ã¦ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€TFDrift-Falcoã¯**æœ¬ç•ªç’°å¢ƒã§ã®åˆ©ç”¨ã«ã‚ˆã‚Šé©ã—ãŸçŠ¶æ…‹**ã«ãªã‚Šã¾ã—ãŸ ğŸ‰

---

## é–¢é€£ãƒªãƒ³ã‚¯

- [GitHub Repository](https://github.com/keitahigaki/tfdrift-falco)
- [v0.2.0-beta Release Notes](https://github.com/keitahigaki/tfdrift-falco/releases/tag/v0.2.0-beta)
- [SECURITY.md](../.github/SECURITY.md)
- [Contributing Guide](../CONTRIBUTING.md)
