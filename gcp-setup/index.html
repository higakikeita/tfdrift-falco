<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Real-time Terraform Drift Detection using CloudTrail + Falco"><link href=https://higakikeita.github.io/tfdrift-falco/gcp-setup/ rel=canonical><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>GCP Setup Guide for TFDrift-Falco - TFDrift-Falco Documentation</title><link rel=stylesheet href=../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XXXXXXXXXX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#gcp-setup-guide-for-tfdrift-falco class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="TFDrift-Falco Documentation" class="md-header__button md-logo" aria-label="TFDrift-Falco Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> TFDrift-Falco Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> GCP Setup Guide for TFDrift-Falco </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/higakikeita/tfdrift-falco title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> higakikeita/tfdrift-falco </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../overview/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../services/ class=md-tabs__link> AWS Services </a> </li> <li class=md-tabs__item> <a href=../release-notes/v0.2.0-beta/ class=md-tabs__link> Release Notes </a> </li> <li class=md-tabs__item> <a href=../CONTRIBUTING/ class=md-tabs__link> Community </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="TFDrift-Falco Documentation" class="md-nav__button md-logo" aria-label="TFDrift-Falco Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> TFDrift-Falco Documentation </label> <div class=md-nav__source> <a href=https://github.com/higakikeita/tfdrift-falco title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> higakikeita/tfdrift-falco </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../how-it-works/ class=md-nav__link> <span class=md-ellipsis> How It Works </span> </a> </li> <li class=md-nav__item> <a href=../architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../quickstart/ class=md-nav__link> <span class=md-ellipsis> Quickstart </span> </a> </li> <li class=md-nav__item> <a href=../deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> </a> </li> <li class=md-nav__item> <a href=../falco-setup/ class=md-nav__link> <span class=md-ellipsis> Falco Setup </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../services/ class="md-nav__link "> <span class=md-ellipsis> AWS Services </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> AWS Services </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> Compute </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Compute </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../services/ec2/ class=md-nav__link> <span class=md-ellipsis> EC2 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> Networking </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Networking </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../services/vpc/ class=md-nav__link> <span class=md-ellipsis> VPC </span> </a> </li> <li class=md-nav__item> <a href=../services/route53/ class=md-nav__link> <span class=md-ellipsis> Route53 </span> </a> </li> <li class=md-nav__item> <a href=../services/cloudfront/ class=md-nav__link> <span class=md-ellipsis> CloudFront </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> Storage </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../services/s3/ class=md-nav__link> <span class=md-ellipsis> S3 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex=0> <span class=md-ellipsis> Databases </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Databases </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../services/rds/ class=md-nav__link> <span class=md-ellipsis> RDS/Aurora </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> <span class=md-ellipsis> Security </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../services/iam/ class=md-nav__link> <span class=md-ellipsis> IAM </span> </a> </li> <li class=md-nav__item> <a href=../services/kms/ class=md-nav__link> <span class=md-ellipsis> KMS </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex=0> <span class=md-ellipsis> Application </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Application </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../services/api-gateway/ class=md-nav__link> <span class=md-ellipsis> API Gateway </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8 id=__nav_3_8_label tabindex=0> <span class=md-ellipsis> Messaging </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Messaging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../services/sns/ class=md-nav__link> <span class=md-ellipsis> SNS </span> </a> </li> <li class=md-nav__item> <a href=../services/sqs/ class=md-nav__link> <span class=md-ellipsis> SQS </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_9> <label class=md-nav__link for=__nav_3_9 id=__nav_3_9_label tabindex=0> <span class=md-ellipsis> Containers </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../services/ecs/ class=md-nav__link> <span class=md-ellipsis> ECS </span> </a> </li> <li class=md-nav__item> <a href=../services/eks/ class=md-nav__link> <span class=md-ellipsis> EKS </span> </a> </li> <li class=md-nav__item> <a href=../services/ecr/ class=md-nav__link> <span class=md-ellipsis> ECR </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Release Notes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Release Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../release-notes/v0.2.0-beta/ class=md-nav__link> <span class=md-ellipsis> v0.2.0-beta </span> </a> </li> <li class=md-nav__item> <a href=../release-notes/v0.3.0/ class=md-nav__link> <span class=md-ellipsis> v0.3.0 (planned) </span> </a> </li> <li class=md-nav__item> <a href=../release-notes/architecture-changes/ class=md-nav__link> <span class=md-ellipsis> Architecture Changes </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Community </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Community </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../CONTRIBUTING/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../CODE_OF_CONDUCT/ class=md-nav__link> <span class=md-ellipsis> Code of Conduct </span> </a> </li> <li class=md-nav__item> <a href=../SECURITY/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#quick-start-5-minutes class=md-nav__link> <span class=md-ellipsis> Quick Start (5 Minutes) </span> </a> <nav class=md-nav aria-label="Quick Start (5 Minutes)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#one-command-setup class=md-nav__link> <span class=md-ellipsis> One-Command Setup </span> </a> </li> <li class=md-nav__item> <a href=#manual-quick-start class=md-nav__link> <span class=md-ellipsis> Manual Quick Start </span> </a> </li> <li class=md-nav__item> <a href=#what-this-sets-up class=md-nav__link> <span class=md-ellipsis> What This Sets Up </span> </a> </li> <li class=md-nav__item> <a href=#test-it class=md-nav__link> <span class=md-ellipsis> Test It </span> </a> </li> <li class=md-nav__item> <a href=#clean-up class=md-nav__link> <span class=md-ellipsis> Clean Up </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> <nav class=md-nav aria-label=Prerequisites> <ul class=md-nav__list> <li class=md-nav__item> <a href=#required-tools class=md-nav__link> <span class=md-ellipsis> Required Tools </span> </a> </li> <li class=md-nav__item> <a href=#pre-flight-checklist class=md-nav__link> <span class=md-ellipsis> Pre-flight Checklist </span> </a> </li> <li class=md-nav__item> <a href=#required-gcp-permissions class=md-nav__link> <span class=md-ellipsis> Required GCP Permissions </span> </a> </li> <li class=md-nav__item> <a href=#estimated-time class=md-nav__link> <span class=md-ellipsis> Estimated Time </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#architecture-overview class=md-nav__link> <span class=md-ellipsis> Architecture Overview </span> </a> </li> <li class=md-nav__item> <a href=#step-1-enable-gcp-audit-logs class=md-nav__link> <span class=md-ellipsis> Step 1: Enable GCP Audit Logs </span> </a> <nav class=md-nav aria-label="Step 1: Enable GCP Audit Logs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-enable-admin-activity-logs-enabled-by-default class=md-nav__link> <span class=md-ellipsis> 1.1 Enable Admin Activity Logs (Enabled by Default) </span> </a> </li> <li class=md-nav__item> <a href=#12-enable-data-access-logs-optional-but-recommended class=md-nav__link> <span class=md-ellipsis> 1.2 Enable Data Access Logs (Optional but Recommended) </span> </a> </li> <li class=md-nav__item> <a href=#13-verify-audit-logs class=md-nav__link> <span class=md-ellipsis> 1.3 Verify Audit Logs </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-2-configure-pubsub-for-audit-logs class=md-nav__link> <span class=md-ellipsis> Step 2: Configure Pub/Sub for Audit Logs </span> </a> <nav class=md-nav aria-label="Step 2: Configure Pub/Sub for Audit Logs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-create-pubsub-topic class=md-nav__link> <span class=md-ellipsis> 2.1 Create Pub/Sub Topic </span> </a> </li> <li class=md-nav__item> <a href=#22-create-log-sink class=md-nav__link> <span class=md-ellipsis> 2.2 Create Log Sink </span> </a> </li> <li class=md-nav__item> <a href=#23-grant-permissions-to-sink class=md-nav__link> <span class=md-ellipsis> 2.3 Grant Permissions to Sink </span> </a> </li> <li class=md-nav__item> <a href=#24-create-subscription-for-falco class=md-nav__link> <span class=md-ellipsis> 2.4 Create Subscription for Falco </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-3-install-and-configure-falco class=md-nav__link> <span class=md-ellipsis> Step 3: Install and Configure Falco </span> </a> <nav class=md-nav aria-label="Step 3: Install and Configure Falco"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-install-falco-with-docker-recommended class=md-nav__link> <span class=md-ellipsis> 3.1 Install Falco with Docker (Recommended) </span> </a> </li> <li class=md-nav__item> <a href=#32-create-falco-configuration class=md-nav__link> <span class=md-ellipsis> 3.2 Create Falco Configuration </span> </a> </li> <li class=md-nav__item> <a href=#33-create-gcp-credentials-secret class=md-nav__link> <span class=md-ellipsis> 3.3 Create GCP Credentials Secret </span> </a> </li> <li class=md-nav__item> <a href=#34-run-falco class=md-nav__link> <span class=md-ellipsis> 3.4 Run Falco </span> </a> </li> <li class=md-nav__item> <a href=#35-verify-falco-is-running class=md-nav__link> <span class=md-ellipsis> 3.5 Verify Falco is Running </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-4-configure-tfdrift-falco class=md-nav__link> <span class=md-ellipsis> Step 4: Configure TFDrift-Falco </span> </a> <nav class=md-nav aria-label="Step 4: Configure TFDrift-Falco"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-create-gcs-bucket-for-terraform-state-if-using-gcs-backend class=md-nav__link> <span class=md-ellipsis> 4.1 Create GCS Bucket for Terraform State (If Using GCS Backend) </span> </a> </li> <li class=md-nav__item> <a href=#42-create-tfdrift-falco-configuration class=md-nav__link> <span class=md-ellipsis> 4.2 Create TFDrift-Falco Configuration </span> </a> </li> <li class=md-nav__item> <a href=#43-run-tfdrift-falco class=md-nav__link> <span class=md-ellipsis> 4.3 Run TFDrift-Falco </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-5-verify-setup class=md-nav__link> <span class=md-ellipsis> Step 5: Verify Setup </span> </a> <nav class=md-nav aria-label="Step 5: Verify Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-test-drift-detection class=md-nav__link> <span class=md-ellipsis> 5.1 Test Drift Detection </span> </a> </li> <li class=md-nav__item> <a href=#52-check-tfdrift-falco-logs class=md-nav__link> <span class=md-ellipsis> 5.2 Check TFDrift-Falco Logs </span> </a> </li> <li class=md-nav__item> <a href=#53-check-slack-notification class=md-nav__link> <span class=md-ellipsis> 5.3 Check Slack Notification </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue-1-falco-not-receiving-audit-logs class=md-nav__link> <span class=md-ellipsis> Issue 1: Falco Not Receiving Audit Logs </span> </a> </li> <li class=md-nav__item> <a href=#issue-2-tfdrift-falco-cannot-connect-to-falco class=md-nav__link> <span class=md-ellipsis> Issue 2: TFDrift-Falco Cannot Connect to Falco </span> </a> </li> <li class=md-nav__item> <a href=#issue-3-gcs-backend-authentication-fails class=md-nav__link> <span class=md-ellipsis> Issue 3: GCS Backend Authentication Fails </span> </a> </li> <li class=md-nav__item> <a href=#issue-4-events-not-matching-terraform-resources class=md-nav__link> <span class=md-ellipsis> Issue 4: Events Not Matching Terraform Resources </span> </a> </li> <li class=md-nav__item> <a href=#issue-5-high-volume-of-irrelevant-events class=md-nav__link> <span class=md-ellipsis> Issue 5: High Volume of Irrelevant Events </span> </a> </li> <li class=md-nav__item> <a href=#issue-6-falco-container-crashes-or-restarts class=md-nav__link> <span class=md-ellipsis> Issue 6: Falco Container Crashes or Restarts </span> </a> </li> <li class=md-nav__item> <a href=#issue-7-permission-denied-on-pubsub-subscription class=md-nav__link> <span class=md-ellipsis> Issue 7: Permission Denied on Pub/Sub Subscription </span> </a> </li> <li class=md-nav__item> <a href=#issue-8-log-sink-service-account-missing-permissions class=md-nav__link> <span class=md-ellipsis> Issue 8: Log Sink Service Account Missing Permissions </span> </a> </li> <li class=md-nav__item> <a href=#issue-9-invalid-configuration-file class=md-nav__link> <span class=md-ellipsis> Issue 9: Invalid Configuration File </span> </a> </li> <li class=md-nav__item> <a href=#issue-10-drift-not-detected-for-specific-resources class=md-nav__link> <span class=md-ellipsis> Issue 10: Drift Not Detected for Specific Resources </span> </a> </li> <li class=md-nav__item> <a href=#issue-11-webhook-notifications-not-sending class=md-nav__link> <span class=md-ellipsis> Issue 11: Webhook Notifications Not Sending </span> </a> </li> <li class=md-nav__item> <a href=#issue-12-multiple-projects-not-loading-state class=md-nav__link> <span class=md-ellipsis> Issue 12: Multiple Projects Not Loading State </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#debug-procedures class=md-nav__link> <span class=md-ellipsis> Debug Procedures </span> </a> <nav class=md-nav aria-label="Debug Procedures"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#step-by-step-debugging-workflow class=md-nav__link> <span class=md-ellipsis> Step-by-Step Debugging Workflow </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#log-analysis-guide class=md-nav__link> <span class=md-ellipsis> Log Analysis Guide </span> </a> <nav class=md-nav aria-label="Log Analysis Guide"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#understanding-gcp-audit-log-structure class=md-nav__link> <span class=md-ellipsis> Understanding GCP Audit Log Structure </span> </a> </li> <li class=md-nav__item> <a href=#key-fields-for-drift-detection class=md-nav__link> <span class=md-ellipsis> Key Fields for Drift Detection </span> </a> </li> <li class=md-nav__item> <a href=#falco-grpc-output-format class=md-nav__link> <span class=md-ellipsis> Falco gRPC Output Format </span> </a> </li> <li class=md-nav__item> <a href=#tfdrift-falco-event-processing class=md-nav__link> <span class=md-ellipsis> TFDrift-Falco Event Processing </span> </a> </li> <li class=md-nav__item> <a href=#reading-tfdrift-falco-logs class=md-nav__link> <span class=md-ellipsis> Reading TFDrift-Falco Logs </span> </a> </li> <li class=md-nav__item> <a href=#common-log-patterns-and-meanings class=md-nav__link> <span class=md-ellipsis> Common Log Patterns and Meanings </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-configuration class=md-nav__link> <span class=md-ellipsis> Advanced Configuration </span> </a> <nav class=md-nav aria-label="Advanced Configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#multi-project-setup class=md-nav__link> <span class=md-ellipsis> Multi-Project Setup </span> </a> </li> <li class=md-nav__item> <a href=#custom-falco-rules class=md-nav__link> <span class=md-ellipsis> Custom Falco Rules </span> </a> </li> <li class=md-nav__item> <a href=#regional-deployment class=md-nav__link> <span class=md-ellipsis> Regional Deployment </span> </a> </li> <li class=md-nav__item> <a href=#integration-with-siem class=md-nav__link> <span class=md-ellipsis> Integration with SIEM </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#complete-examples class=md-nav__link> <span class=md-ellipsis> Complete Examples </span> </a> <nav class=md-nav aria-label="Complete Examples"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example-1-basic-gce-instance-with-networking class=md-nav__link> <span class=md-ellipsis> Example 1: Basic GCE Instance with Networking </span> </a> </li> <li class=md-nav__item> <a href=#example-2-multi-tier-web-application class=md-nav__link> <span class=md-ellipsis> Example 2: Multi-Tier Web Application </span> </a> </li> <li class=md-nav__item> <a href=#example-3-gke-cluster-with-monitoring class=md-nav__link> <span class=md-ellipsis> Example 3: GKE Cluster with Monitoring </span> </a> </li> <li class=md-nav__item> <a href=#example-4-production-multi-project-setup class=md-nav__link> <span class=md-ellipsis> Example 4: Production Multi-Project Setup </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#production-best-practices class=md-nav__link> <span class=md-ellipsis> Production Best Practices </span> </a> <nav class=md-nav aria-label="Production Best Practices"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-infrastructure-design class=md-nav__link> <span class=md-ellipsis> 1. Infrastructure Design </span> </a> </li> <li class=md-nav__item> <a href=#2-configuration-management class=md-nav__link> <span class=md-ellipsis> 2. Configuration Management </span> </a> </li> <li class=md-nav__item> <a href=#3-monitoring-alerting class=md-nav__link> <span class=md-ellipsis> 3. Monitoring &amp; Alerting </span> </a> </li> <li class=md-nav__item> <a href=#4-operational-excellence class=md-nav__link> <span class=md-ellipsis> 4. Operational Excellence </span> </a> </li> <li class=md-nav__item> <a href=#step-3-investigation-30-minutes class=md-nav__link> <span class=md-ellipsis> Step 3: Investigation (&lt; 30 minutes) </span> </a> </li> <li class=md-nav__item> <a href=#step-4-remediation class=md-nav__link> <span class=md-ellipsis> Step 4: Remediation </span> </a> </li> <li class=md-nav__item> <a href=#step-5-follow-up class=md-nav__link> <span class=md-ellipsis> Step 5: Follow-up </span> </a> </li> <li class=md-nav__item> <a href=#6-security class=md-nav__link> <span class=md-ellipsis> 6. Security </span> </a> </li> <li class=md-nav__item> <a href=#7-cost-optimization class=md-nav__link> <span class=md-ellipsis> 7. Cost Optimization </span> </a> </li> <li class=md-nav__item> <a href=#8-disaster-recovery class=md-nav__link> <span class=md-ellipsis> 8. Disaster Recovery </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#performance-tuning class=md-nav__link> <span class=md-ellipsis> Performance Tuning </span> </a> <nav class=md-nav aria-label="Performance Tuning"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#falco-configuration class=md-nav__link> <span class=md-ellipsis> Falco Configuration </span> </a> </li> <li class=md-nav__item> <a href=#tfdrift-falco-configuration class=md-nav__link> <span class=md-ellipsis> TFDrift-Falco Configuration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-best-practices class=md-nav__link> <span class=md-ellipsis> Security Best Practices </span> </a> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> <span class=md-ellipsis> Next Steps </span> </a> </li> <li class=md-nav__item> <a href=#support class=md-nav__link> <span class=md-ellipsis> Support </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=gcp-setup-guide-for-tfdrift-falco>GCP Setup Guide for TFDrift-Falco<a class=headerlink href=#gcp-setup-guide-for-tfdrift-falco title="Permanent link">&para;</a></h1> <p>This guide walks you through setting up TFDrift-Falco for Google Cloud Platform (GCP) drift detection.</p> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h2> <ul> <li><a href=#quick-start-5-minutes>Quick Start (5 Minutes)</a> ‚≠ê <strong>Start Here!</strong></li> <li><a href=#prerequisites>Prerequisites</a></li> <li><a href=#architecture-overview>Architecture Overview</a></li> <li><a href=#step-1-enable-gcp-audit-logs>Step 1: Enable GCP Audit Logs</a></li> <li><a href=#step-2-configure-pubsub-for-audit-logs>Step 2: Configure Pub/Sub for Audit Logs</a></li> <li><a href=#step-3-install-and-configure-falco>Step 3: Install and Configure Falco</a></li> <li><a href=#step-4-configure-tfdrift-falco>Step 4: Configure TFDrift-Falco</a></li> <li><a href=#step-5-verify-setup>Step 5: Verify Setup</a></li> <li><a href=#troubleshooting>Troubleshooting</a></li> <li><a href=#best-practices>Best Practices</a></li> <li><a href=#complete-examples>Complete Examples</a></li> <li><a href=#advanced-configuration>Advanced Configuration</a></li> </ul> <hr> <h2 id=quick-start-5-minutes>Quick Start (5 Minutes)<a class=headerlink href=#quick-start-5-minutes title="Permanent link">&para;</a></h2> <p><strong>Want to try TFDrift-Falco with GCP right now?</strong> This automated script sets everything up for you.</p> <h3 id=one-command-setup>One-Command Setup<a class=headerlink href=#one-command-setup title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># Download and run the setup script</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>curl<span class=w> </span>-fsSL<span class=w> </span>https://raw.githubusercontent.com/higakikeita/tfdrift-falco/main/scripts/gcp-quick-start.sh<span class=w> </span><span class=p>|</span><span class=w> </span>bash
</span></code></pre></div> <h3 id=manual-quick-start>Manual Quick Start<a class=headerlink href=#manual-quick-start title="Permanent link">&para;</a></h3> <p>If you prefer to run commands manually:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># 1. Set your project</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=nb>export</span><span class=w> </span><span class=nv>PROJECT_ID</span><span class=o>=</span><span class=s2>&quot;your-gcp-project-id&quot;</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>gcloud<span class=w> </span>config<span class=w> </span><span class=nb>set</span><span class=w> </span>project<span class=w> </span><span class=nv>$PROJECT_ID</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1># 2. Enable required APIs (30 seconds)</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>gcloud<span class=w> </span>services<span class=w> </span><span class=nb>enable</span><span class=w> </span>logging.googleapis.com<span class=w> </span>pubsub.googleapis.com<span class=w> </span>compute.googleapis.com
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=c1># 3. Create Pub/Sub infrastructure (30 seconds)</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>gcloud<span class=w> </span>pubsub<span class=w> </span>topics<span class=w> </span>create<span class=w> </span>tfdrift-audit-logs
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>gcloud<span class=w> </span>logging<span class=w> </span>sinks<span class=w> </span>create<span class=w> </span>tfdrift-sink<span class=w> </span><span class=se>\</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>  </span>pubsub.googleapis.com/projects/<span class=nv>$PROJECT_ID</span>/topics/tfdrift-audit-logs<span class=w> </span><span class=se>\</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>  </span>--log-filter<span class=o>=</span><span class=s1>&#39;protoPayload.serviceName=&quot;compute.googleapis.com&quot;&#39;</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=nv>SINK_SA</span><span class=o>=</span><span class=k>$(</span>gcloud<span class=w> </span>logging<span class=w> </span>sinks<span class=w> </span>describe<span class=w> </span>tfdrift-sink<span class=w> </span>--format<span class=o>=</span><span class=s2>&quot;value(writerIdentity)&quot;</span><span class=k>)</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>gcloud<span class=w> </span>pubsub<span class=w> </span>topics<span class=w> </span>add-iam-policy-binding<span class=w> </span>tfdrift-audit-logs<span class=w> </span><span class=se>\</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=w>  </span>--member<span class=o>=</span><span class=s2>&quot;</span><span class=nv>$SINK_SA</span><span class=s2>&quot;</span><span class=w> </span>--role<span class=o>=</span><span class=s2>&quot;roles/pubsub.publisher&quot;</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a>gcloud<span class=w> </span>pubsub<span class=w> </span>subscriptions<span class=w> </span>create<span class=w> </span>tfdrift-falco-sub<span class=w> </span><span class=se>\</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=w>  </span>--topic<span class=o>=</span>tfdrift-audit-logs
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=c1># 4. Create service account for Falco (30 seconds)</span>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a>gcloud<span class=w> </span>iam<span class=w> </span>service-accounts<span class=w> </span>create<span class=w> </span>tfdrift-falco<span class=w> </span><span class=se>\</span>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=w>  </span>--display-name<span class=o>=</span><span class=s2>&quot;TFDrift Falco&quot;</span>
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a>
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a>gcloud<span class=w> </span>projects<span class=w> </span>add-iam-policy-binding<span class=w> </span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-1-26><a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>  </span>--member<span class=o>=</span><span class=s2>&quot;serviceAccount:tfdrift-falco@</span><span class=nv>$PROJECT_ID</span><span class=s2>.iam.gserviceaccount.com&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-1-27><a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=w>  </span>--role<span class=o>=</span><span class=s2>&quot;roles/pubsub.subscriber&quot;</span>
</span><span id=__span-1-28><a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a>
</span><span id=__span-1-29><a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a>mkdir<span class=w> </span>-p<span class=w> </span>~/tfdrift-config
</span><span id=__span-1-30><a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a>gcloud<span class=w> </span>iam<span class=w> </span>service-accounts<span class=w> </span>keys<span class=w> </span>create<span class=w> </span>~/tfdrift-config/gcp-key.json<span class=w> </span><span class=se>\</span>
</span><span id=__span-1-31><a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=w>  </span>--iam-account<span class=o>=</span>tfdrift-falco@<span class=nv>$PROJECT_ID</span>.iam.gserviceaccount.com
</span><span id=__span-1-32><a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a>
</span><span id=__span-1-33><a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=c1># 5. Run Falco with Docker (1 minute)</span>
</span><span id=__span-1-34><a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a>cat<span class=w> </span>&gt;<span class=w> </span>~/tfdrift-config/falco.yaml<span class=w> </span><span class=s>&lt;&lt;EOF</span>
</span><span id=__span-1-35><a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a><span class=s>engine:</span>
</span><span id=__span-1-36><a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=s>  kind: modern_ebpf</span>
</span><span id=__span-1-37><a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=s>plugins:</span>
</span><span id=__span-1-38><a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a><span class=s>  - name: gcpaudit</span>
</span><span id=__span-1-39><a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a><span class=s>    library_path: /usr/share/falco/plugins/libgcpaudit.so</span>
</span><span id=__span-1-40><a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a><span class=s>    init_config:</span>
</span><span id=__span-1-41><a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a><span class=s>      project_id: &quot;$PROJECT_ID&quot;</span>
</span><span id=__span-1-42><a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a><span class=s>      subscription: &quot;tfdrift-falco-sub&quot;</span>
</span><span id=__span-1-43><a id=__codelineno-1-43 name=__codelineno-1-43 href=#__codelineno-1-43></a><span class=s>load_plugins: [gcpaudit]</span>
</span><span id=__span-1-44><a id=__codelineno-1-44 name=__codelineno-1-44 href=#__codelineno-1-44></a><span class=s>json_output: true</span>
</span><span id=__span-1-45><a id=__codelineno-1-45 name=__codelineno-1-45 href=#__codelineno-1-45></a><span class=s>grpc:</span>
</span><span id=__span-1-46><a id=__codelineno-1-46 name=__codelineno-1-46 href=#__codelineno-1-46></a><span class=s>  enabled: true</span>
</span><span id=__span-1-47><a id=__codelineno-1-47 name=__codelineno-1-47 href=#__codelineno-1-47></a><span class=s>  bind_address: &quot;0.0.0.0:5060&quot;</span>
</span><span id=__span-1-48><a id=__codelineno-1-48 name=__codelineno-1-48 href=#__codelineno-1-48></a><span class=s>  threadiness: 8</span>
</span><span id=__span-1-49><a id=__codelineno-1-49 name=__codelineno-1-49 href=#__codelineno-1-49></a><span class=s>grpc_output:</span>
</span><span id=__span-1-50><a id=__codelineno-1-50 name=__codelineno-1-50 href=#__codelineno-1-50></a><span class=s>  enabled: true</span>
</span><span id=__span-1-51><a id=__codelineno-1-51 name=__codelineno-1-51 href=#__codelineno-1-51></a><span class=s>EOF</span>
</span><span id=__span-1-52><a id=__codelineno-1-52 name=__codelineno-1-52 href=#__codelineno-1-52></a>
</span><span id=__span-1-53><a id=__codelineno-1-53 name=__codelineno-1-53 href=#__codelineno-1-53></a>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span>--name<span class=w> </span>falco<span class=w> </span><span class=se>\</span>
</span><span id=__span-1-54><a id=__codelineno-1-54 name=__codelineno-1-54 href=#__codelineno-1-54></a><span class=w>  </span>-p<span class=w> </span><span class=m>5060</span>:5060<span class=w> </span><span class=se>\</span>
</span><span id=__span-1-55><a id=__codelineno-1-55 name=__codelineno-1-55 href=#__codelineno-1-55></a><span class=w>  </span>-v<span class=w> </span>~/tfdrift-config:/etc/falco<span class=w> </span><span class=se>\</span>
</span><span id=__span-1-56><a id=__codelineno-1-56 name=__codelineno-1-56 href=#__codelineno-1-56></a><span class=w>  </span>-e<span class=w> </span><span class=nv>GOOGLE_APPLICATION_CREDENTIALS</span><span class=o>=</span>/etc/falco/gcp-key.json<span class=w> </span><span class=se>\</span>
</span><span id=__span-1-57><a id=__codelineno-1-57 name=__codelineno-1-57 href=#__codelineno-1-57></a><span class=w>  </span>falcosecurity/falco:latest<span class=w> </span><span class=se>\</span>
</span><span id=__span-1-58><a id=__codelineno-1-58 name=__codelineno-1-58 href=#__codelineno-1-58></a><span class=w>  </span>-c<span class=w> </span>/etc/falco/falco.yaml
</span><span id=__span-1-59><a id=__codelineno-1-59 name=__codelineno-1-59 href=#__codelineno-1-59></a>
</span><span id=__span-1-60><a id=__codelineno-1-60 name=__codelineno-1-60 href=#__codelineno-1-60></a><span class=c1># 6. Create TFDrift-Falco config (30 seconds)</span>
</span><span id=__span-1-61><a id=__codelineno-1-61 name=__codelineno-1-61 href=#__codelineno-1-61></a>cat<span class=w> </span>&gt;<span class=w> </span>~/tfdrift-config/config-gcp.yaml<span class=w> </span><span class=s>&lt;&lt;EOF</span>
</span><span id=__span-1-62><a id=__codelineno-1-62 name=__codelineno-1-62 href=#__codelineno-1-62></a><span class=s>providers:</span>
</span><span id=__span-1-63><a id=__codelineno-1-63 name=__codelineno-1-63 href=#__codelineno-1-63></a><span class=s>  gcp:</span>
</span><span id=__span-1-64><a id=__codelineno-1-64 name=__codelineno-1-64 href=#__codelineno-1-64></a><span class=s>    enabled: true</span>
</span><span id=__span-1-65><a id=__codelineno-1-65 name=__codelineno-1-65 href=#__codelineno-1-65></a><span class=s>    projects:</span>
</span><span id=__span-1-66><a id=__codelineno-1-66 name=__codelineno-1-66 href=#__codelineno-1-66></a><span class=s>      - &quot;$PROJECT_ID&quot;</span>
</span><span id=__span-1-67><a id=__codelineno-1-67 name=__codelineno-1-67 href=#__codelineno-1-67></a><span class=s>    state:</span>
</span><span id=__span-1-68><a id=__codelineno-1-68 name=__codelineno-1-68 href=#__codelineno-1-68></a><span class=s>      backend: &quot;local&quot;</span>
</span><span id=__span-1-69><a id=__codelineno-1-69 name=__codelineno-1-69 href=#__codelineno-1-69></a><span class=s>      local_path: &quot;./terraform.tfstate&quot;</span>
</span><span id=__span-1-70><a id=__codelineno-1-70 name=__codelineno-1-70 href=#__codelineno-1-70></a>
</span><span id=__span-1-71><a id=__codelineno-1-71 name=__codelineno-1-71 href=#__codelineno-1-71></a><span class=s>falco:</span>
</span><span id=__span-1-72><a id=__codelineno-1-72 name=__codelineno-1-72 href=#__codelineno-1-72></a><span class=s>  enabled: true</span>
</span><span id=__span-1-73><a id=__codelineno-1-73 name=__codelineno-1-73 href=#__codelineno-1-73></a><span class=s>  hostname: &quot;localhost&quot;</span>
</span><span id=__span-1-74><a id=__codelineno-1-74 name=__codelineno-1-74 href=#__codelineno-1-74></a><span class=s>  port: 5060</span>
</span><span id=__span-1-75><a id=__codelineno-1-75 name=__codelineno-1-75 href=#__codelineno-1-75></a>
</span><span id=__span-1-76><a id=__codelineno-1-76 name=__codelineno-1-76 href=#__codelineno-1-76></a><span class=s>drift_rules:</span>
</span><span id=__span-1-77><a id=__codelineno-1-77 name=__codelineno-1-77 href=#__codelineno-1-77></a><span class=s>  - name: &quot;GCE Instance Change&quot;</span>
</span><span id=__span-1-78><a id=__codelineno-1-78 name=__codelineno-1-78 href=#__codelineno-1-78></a><span class=s>    resource_types:</span>
</span><span id=__span-1-79><a id=__codelineno-1-79 name=__codelineno-1-79 href=#__codelineno-1-79></a><span class=s>      - &quot;google_compute_instance&quot;</span>
</span><span id=__span-1-80><a id=__codelineno-1-80 name=__codelineno-1-80 href=#__codelineno-1-80></a><span class=s>    watched_attributes:</span>
</span><span id=__span-1-81><a id=__codelineno-1-81 name=__codelineno-1-81 href=#__codelineno-1-81></a><span class=s>      - &quot;metadata&quot;</span>
</span><span id=__span-1-82><a id=__codelineno-1-82 name=__codelineno-1-82 href=#__codelineno-1-82></a><span class=s>      - &quot;labels&quot;</span>
</span><span id=__span-1-83><a id=__codelineno-1-83 name=__codelineno-1-83 href=#__codelineno-1-83></a><span class=s>    severity: &quot;high&quot;</span>
</span><span id=__span-1-84><a id=__codelineno-1-84 name=__codelineno-1-84 href=#__codelineno-1-84></a>
</span><span id=__span-1-85><a id=__codelineno-1-85 name=__codelineno-1-85 href=#__codelineno-1-85></a><span class=s>notifications:</span>
</span><span id=__span-1-86><a id=__codelineno-1-86 name=__codelineno-1-86 href=#__codelineno-1-86></a><span class=s>  slack:</span>
</span><span id=__span-1-87><a id=__codelineno-1-87 name=__codelineno-1-87 href=#__codelineno-1-87></a><span class=s>    enabled: false</span>
</span><span id=__span-1-88><a id=__codelineno-1-88 name=__codelineno-1-88 href=#__codelineno-1-88></a>
</span><span id=__span-1-89><a id=__codelineno-1-89 name=__codelineno-1-89 href=#__codelineno-1-89></a><span class=s>logging:</span>
</span><span id=__span-1-90><a id=__codelineno-1-90 name=__codelineno-1-90 href=#__codelineno-1-90></a><span class=s>  level: &quot;info&quot;</span>
</span><span id=__span-1-91><a id=__codelineno-1-91 name=__codelineno-1-91 href=#__codelineno-1-91></a><span class=s>EOF</span>
</span><span id=__span-1-92><a id=__codelineno-1-92 name=__codelineno-1-92 href=#__codelineno-1-92></a>
</span><span id=__span-1-93><a id=__codelineno-1-93 name=__codelineno-1-93 href=#__codelineno-1-93></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;‚úÖ Setup complete!&quot;</span>
</span><span id=__span-1-94><a id=__codelineno-1-94 name=__codelineno-1-94 href=#__codelineno-1-94></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
</span><span id=__span-1-95><a id=__codelineno-1-95 name=__codelineno-1-95 href=#__codelineno-1-95></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Next steps:&quot;</span>
</span><span id=__span-1-96><a id=__codelineno-1-96 name=__codelineno-1-96 href=#__codelineno-1-96></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;1. Create a test Terraform resource:&quot;</span>
</span><span id=__span-1-97><a id=__codelineno-1-97 name=__codelineno-1-97 href=#__codelineno-1-97></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   terraform init &amp;&amp; terraform apply&quot;</span>
</span><span id=__span-1-98><a id=__codelineno-1-98 name=__codelineno-1-98 href=#__codelineno-1-98></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
</span><span id=__span-1-99><a id=__codelineno-1-99 name=__codelineno-1-99 href=#__codelineno-1-99></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;2. Run TFDrift-Falco:&quot;</span>
</span><span id=__span-1-100><a id=__codelineno-1-100 name=__codelineno-1-100 href=#__codelineno-1-100></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   tfdrift --config ~/tfdrift-config/config-gcp.yaml&quot;</span>
</span><span id=__span-1-101><a id=__codelineno-1-101 name=__codelineno-1-101 href=#__codelineno-1-101></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
</span><span id=__span-1-102><a id=__codelineno-1-102 name=__codelineno-1-102 href=#__codelineno-1-102></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;3. Make a manual change in GCP Console to trigger drift detection&quot;</span>
</span><span id=__span-1-103><a id=__codelineno-1-103 name=__codelineno-1-103 href=#__codelineno-1-103></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   Example: gcloud compute instances add-metadata INSTANCE_NAME --metadata=test=value&quot;</span>
</span></code></pre></div> <h3 id=what-this-sets-up>What This Sets Up<a class=headerlink href=#what-this-sets-up title="Permanent link">&para;</a></h3> <ul> <li>‚úÖ GCP Audit Logs ‚Üí Pub/Sub pipeline</li> <li>‚úÖ Falco with gcpaudit plugin (Docker)</li> <li>‚úÖ TFDrift-Falco configuration</li> <li>‚úÖ Service account with minimal permissions</li> </ul> <h3 id=test-it>Test It<a class=headerlink href=#test-it title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># 1. Create a simple test resource with Terraform</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>cat<span class=w> </span>&gt;<span class=w> </span>main.tf<span class=w> </span><span class=s>&lt;&lt;EOF</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=s>resource &quot;google_compute_network&quot; &quot;test&quot; {</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=s>  name = &quot;tfdrift-test-network&quot;</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=s>  auto_create_subnetworks = false</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=s>}</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=s>EOF</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>terraform<span class=w> </span>init
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>terraform<span class=w> </span>apply<span class=w> </span>-auto-approve
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=c1># 2. Run TFDrift-Falco</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>tfdrift<span class=w> </span>--config<span class=w> </span>~/tfdrift-config/config-gcp.yaml<span class=w> </span><span class=p>&amp;</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=c1># 3. Make a manual change</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>gcloud<span class=w> </span>compute<span class=w> </span>networks<span class=w> </span>update<span class=w> </span>tfdrift-test-network<span class=w> </span><span class=se>\</span>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=w>  </span>--description<span class=o>=</span><span class=s2>&quot;Manual change - should trigger drift&quot;</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=c1># You should see a drift detection alert!</span>
</span></code></pre></div> <h3 id=clean-up>Clean Up<a class=headerlink href=#clean-up title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># Remove test resources</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>terraform<span class=w> </span>destroy<span class=w> </span>-auto-approve
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=c1># Stop Falco</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>docker<span class=w> </span>stop<span class=w> </span>falco<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>docker<span class=w> </span>rm<span class=w> </span>falco
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=c1># Delete GCP resources</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>gcloud<span class=w> </span>pubsub<span class=w> </span>subscriptions<span class=w> </span>delete<span class=w> </span>tfdrift-falco-sub
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>gcloud<span class=w> </span>pubsub<span class=w> </span>topics<span class=w> </span>delete<span class=w> </span>tfdrift-audit-logs
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>gcloud<span class=w> </span>logging<span class=w> </span>sinks<span class=w> </span>delete<span class=w> </span>tfdrift-sink
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>gcloud<span class=w> </span>iam<span class=w> </span>service-accounts<span class=w> </span>delete<span class=w> </span>tfdrift-falco@<span class=nv>$PROJECT_ID</span>.iam.gserviceaccount.com
</span></code></pre></div> <hr> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <h3 id=required-tools>Required Tools<a class=headerlink href=#required-tools title="Permanent link">&para;</a></h3> <ul> <li><strong>GCP Project</strong> with appropriate permissions</li> <li><strong>Terraform 1.0+</strong> managing GCP resources</li> <li><strong>Falco 0.35+</strong> (to be installed)</li> <li><strong>Docker 20.10+</strong> (optional, recommended for Falco)</li> <li><strong>GCP CLI (<code>gcloud</code>)</strong> installed and configured</li> </ul> <h3 id=pre-flight-checklist>Pre-flight Checklist<a class=headerlink href=#pre-flight-checklist title="Permanent link">&para;</a></h3> <p>Run these commands to verify your environment is ready:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># Check gcloud is installed and authenticated</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>gcloud<span class=w> </span>--version
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>gcloud<span class=w> </span>auth<span class=w> </span>list
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=c1># Verify you have an active project</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=nb>export</span><span class=w> </span><span class=nv>PROJECT_ID</span><span class=o>=</span><span class=k>$(</span>gcloud<span class=w> </span>config<span class=w> </span>get-value<span class=w> </span>project<span class=k>)</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Current project: </span><span class=nv>$PROJECT_ID</span><span class=s2>&quot;</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=c1># Check required APIs are enabled</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>gcloud<span class=w> </span>services<span class=w> </span>list<span class=w> </span>--enabled<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;(logging|pubsub|compute)&quot;</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=c1># Enable required APIs if not already enabled</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>gcloud<span class=w> </span>services<span class=w> </span><span class=nb>enable</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=w>  </span>logging.googleapis.com<span class=w> </span><span class=se>\</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=w>  </span>pubsub.googleapis.com<span class=w> </span><span class=se>\</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=w>  </span>compute.googleapis.com<span class=w> </span><span class=se>\</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=w>  </span>storage-api.googleapis.com
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a><span class=c1># Check Terraform is installed</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>terraform<span class=w> </span>version
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a><span class=c1># Check Docker is running (if using Docker for Falco)</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>docker<span class=w> </span>ps
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a><span class=c1># Verify you have sufficient permissions</span>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>gcloud<span class=w> </span>projects<span class=w> </span>get-iam-policy<span class=w> </span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a><span class=w>  </span>--flatten<span class=o>=</span><span class=s2>&quot;bindings[].members&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a><span class=w>  </span>--filter<span class=o>=</span><span class=s2>&quot;bindings.members:user:</span><span class=k>$(</span>gcloud<span class=w> </span>config<span class=w> </span>get-value<span class=w> </span>account<span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a><span class=w>  </span>--format<span class=o>=</span><span class=s2>&quot;table(bindings.role)&quot;</span>
</span></code></pre></div> <p><strong>Expected Result:</strong> All commands should complete successfully without errors.</p> <h3 id=required-gcp-permissions>Required GCP Permissions<a class=headerlink href=#required-gcp-permissions title="Permanent link">&para;</a></h3> <p>Your account needs these IAM roles: - <code>roles/logging.admin</code> - Create log sinks - <code>roles/pubsub.admin</code> - Create Pub/Sub topics and subscriptions - <code>roles/iam.serviceAccountAdmin</code> - Create service accounts - <code>roles/storage.objectViewer</code> - Read Terraform state from GCS (if using GCS backend)</p> <p><strong>Verify permissions:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>gcloud<span class=w> </span>projects<span class=w> </span>get-iam-policy<span class=w> </span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>  </span>--flatten<span class=o>=</span><span class=s2>&quot;bindings[].members&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>  </span>--filter<span class=o>=</span><span class=s2>&quot;bindings.members:user:</span><span class=k>$(</span>gcloud<span class=w> </span>config<span class=w> </span>get-value<span class=w> </span>account<span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>  </span>--format<span class=o>=</span><span class=s2>&quot;table(bindings.role)&quot;</span>
</span></code></pre></div></p> <h3 id=estimated-time>Estimated Time<a class=headerlink href=#estimated-time title="Permanent link">&para;</a></h3> <ul> <li><strong>Total setup time</strong>: 20-30 minutes</li> <li>Step 1 (Audit Logs): 5 minutes</li> <li>Step 2 (Pub/Sub): 5 minutes</li> <li>Step 3 (Falco): 10 minutes</li> <li>Step 4 (TFDrift-Falco): 5 minutes</li> <li>Step 5 (Verification): 5 minutes</li> </ul> <hr> <h2 id=architecture-overview>Architecture Overview<a class=headerlink href=#architecture-overview title="Permanent link">&para;</a></h2> <div class="language-text highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>‚îÇ  GCP Resources  ‚îÇ
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>‚îÇ  (Terraform)    ‚îÇ
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>         ‚îÇ
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>         ‚îÇ Manual Changes
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>         ‚îÇ (Console/CLI)
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>         ‚ñº
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>‚îÇ  GCP Audit Logs ‚îÇ
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>         ‚îÇ
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>         ‚ñº
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>‚îÇ  Cloud Pub/Sub  ‚îÇ
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>         ‚îÇ
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>         ‚ñº
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>‚îÇ  Falco          ‚îÇ
</span><span id=__span-6-21><a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a>‚îÇ  (gcpaudit)     ‚îÇ
</span><span id=__span-6-22><a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</span><span id=__span-6-23><a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a>         ‚îÇ gRPC
</span><span id=__span-6-24><a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a>         ‚ñº
</span><span id=__span-6-25><a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
</span><span id=__span-6-26><a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a>‚îÇ  TFDrift-Falco  ‚îÇ
</span><span id=__span-6-27><a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a>‚îÇ  + GCS Backend  ‚îÇ
</span><span id=__span-6-28><a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</span><span id=__span-6-29><a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a>         ‚îÇ
</span><span id=__span-6-30><a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a>         ‚ñº
</span><span id=__span-6-31><a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
</span><span id=__span-6-32><a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a>‚îÇ  Notifications  ‚îÇ
</span><span id=__span-6-33><a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a>‚îÇ  (Slack/etc)    ‚îÇ
</span><span id=__span-6-34><a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</span></code></pre></div> <hr> <h2 id=step-1-enable-gcp-audit-logs>Step 1: Enable GCP Audit Logs<a class=headerlink href=#step-1-enable-gcp-audit-logs title="Permanent link">&para;</a></h2> <p><strong>‚è±Ô∏è Estimated time: 5 minutes</strong></p> <h3 id=11-enable-admin-activity-logs-enabled-by-default>1.1 Enable Admin Activity Logs (Enabled by Default)<a class=headerlink href=#11-enable-admin-activity-logs-enabled-by-default title="Permanent link">&para;</a></h3> <p>Admin Activity audit logs are enabled by default and cannot be disabled.</p> <p><strong>‚úÖ Verification:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># Check if Admin Activity logs are flowing</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>gcloud<span class=w> </span>logging<span class=w> </span><span class=nb>read</span><span class=w> </span><span class=s2>&quot;protoPayload.serviceName=compute.googleapis.com&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w>  </span>--limit<span class=o>=</span><span class=m>5</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>  </span>--format<span class=o>=</span>json
</span></code></pre></div></p> <p><strong>Expected output:</strong> You should see recent audit log entries.</p> <h3 id=12-enable-data-access-logs-optional-but-recommended>1.2 Enable Data Access Logs (Optional but Recommended)<a class=headerlink href=#12-enable-data-access-logs-optional-but-recommended title="Permanent link">&para;</a></h3> <p>For comprehensive drift detection, enable Data Access logs:</p> <blockquote> <p>‚ö†Ô∏è <strong>Warning:</strong> Data Access logs can increase your Cloud Logging costs. Start with Admin Activity logs only for testing, then enable Data Access logs for production monitoring.</p> </blockquote> <div class="language-bash highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># Create audit config</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>cat<span class=w> </span>&gt;<span class=w> </span>audit-config.yaml<span class=w> </span><span class=s>&lt;&lt;EOF</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=s>auditConfigs:</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=s>- auditLogConfigs:</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=s>  - logType: ADMIN_READ</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=s>  - logType: DATA_READ</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=s>  - logType: DATA_WRITE</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=s>  service: compute.googleapis.com</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=s>- auditLogConfigs:</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=s>  - logType: ADMIN_READ</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=s>  - logType: DATA_WRITE</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=s>  service: storage.googleapis.com</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=s>- auditLogConfigs:</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=s>  - logType: ADMIN_READ</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=s>  - logType: DATA_WRITE</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=s>  service: sqladmin.googleapis.com</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=s>EOF</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=c1># Apply audit config to project</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a>gcloud<span class=w> </span>projects<span class=w> </span>set-iam-policy<span class=w> </span>PROJECT_ID<span class=w> </span>audit-config.yaml
</span></code></pre></div> <h3 id=13-verify-audit-logs>1.3 Verify Audit Logs<a class=headerlink href=#13-verify-audit-logs title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># List recent audit logs</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>gcloud<span class=w> </span>logging<span class=w> </span><span class=nb>read</span><span class=w> </span><span class=s2>&quot;protoPayload.serviceName=compute.googleapis.com&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>  </span>--limit<span class=w> </span><span class=m>10</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>  </span>--format<span class=w> </span>json
</span></code></pre></div> <hr> <h2 id=step-2-configure-pubsub-for-audit-logs>Step 2: Configure Pub/Sub for Audit Logs<a class=headerlink href=#step-2-configure-pubsub-for-audit-logs title="Permanent link">&para;</a></h2> <p><strong>‚è±Ô∏è Estimated time: 5 minutes</strong></p> <h3 id=21-create-pubsub-topic>2.1 Create Pub/Sub Topic<a class=headerlink href=#21-create-pubsub-topic title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># Set project (replace with your actual project ID)</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=nb>export</span><span class=w> </span><span class=nv>PROJECT_ID</span><span class=o>=</span><span class=s2>&quot;your-gcp-project-id&quot;</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>gcloud<span class=w> </span>config<span class=w> </span><span class=nb>set</span><span class=w> </span>project<span class=w> </span><span class=nv>$PROJECT_ID</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=c1># Create topic for audit logs</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>gcloud<span class=w> </span>pubsub<span class=w> </span>topics<span class=w> </span>create<span class=w> </span>tfdrift-audit-logs
</span></code></pre></div> <p><strong>‚úÖ Verification:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1># Verify topic was created</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>gcloud<span class=w> </span>pubsub<span class=w> </span>topics<span class=w> </span>describe<span class=w> </span>tfdrift-audit-logs
</span></code></pre></div></p> <p><strong>Expected output:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>name: projects/YOUR_PROJECT_ID/topics/tfdrift-audit-logs
</span></code></pre></div></p> <h3 id=22-create-log-sink>2.2 Create Log Sink<a class=headerlink href=#22-create-log-sink title="Permanent link">&para;</a></h3> <p>Route audit logs to Pub/Sub:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1># Create log sink</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>gcloud<span class=w> </span>logging<span class=w> </span>sinks<span class=w> </span>create<span class=w> </span>tfdrift-sink<span class=w> </span><span class=se>\</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=w>  </span>pubsub.googleapis.com/projects/<span class=nv>$PROJECT_ID</span>/topics/tfdrift-audit-logs<span class=w> </span><span class=se>\</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>  </span>--log-filter<span class=o>=</span><span class=s1>&#39;</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=s1>    protoPayload.serviceName=&quot;compute.googleapis.com&quot; OR</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=s1>    protoPayload.serviceName=&quot;storage.googleapis.com&quot; OR</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=s1>    protoPayload.serviceName=&quot;sqladmin.googleapis.com&quot; OR</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=s1>    protoPayload.serviceName=&quot;container.googleapis.com&quot;</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=s1>  &#39;</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=c1># Get sink service account</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=nv>SINK_SA</span><span class=o>=</span><span class=k>$(</span>gcloud<span class=w> </span>logging<span class=w> </span>sinks<span class=w> </span>describe<span class=w> </span>tfdrift-sink<span class=w> </span>--format<span class=o>=</span><span class=s2>&quot;value(writerIdentity)&quot;</span><span class=k>)</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Sink Service Account: </span><span class=nv>$SINK_SA</span><span class=s2>&quot;</span>
</span></code></pre></div> <p><strong>‚úÖ Verification:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># Verify sink was created and is active</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>gcloud<span class=w> </span>logging<span class=w> </span>sinks<span class=w> </span>describe<span class=w> </span>tfdrift-sink
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=c1># Check the filter</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>gcloud<span class=w> </span>logging<span class=w> </span>sinks<span class=w> </span>describe<span class=w> </span>tfdrift-sink<span class=w> </span>--format<span class=o>=</span><span class=s2>&quot;value(filter)&quot;</span>
</span></code></pre></div></p> <p><strong>Expected output:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>Created [tfdrift-sink].
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>writerIdentity: serviceAccount:service-XXXX@gcp-sa-logging.iam.gserviceaccount.com
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>destination: pubsub.googleapis.com/projects/YOUR_PROJECT_ID/topics/tfdrift-audit-logs
</span></code></pre></div></p> <blockquote> <p>üí° <strong>Tip:</strong> The <code>writerIdentity</code> is automatically created by Google Cloud and will be used to publish messages to Pub/Sub.</p> </blockquote> <h3 id=23-grant-permissions-to-sink>2.3 Grant Permissions to Sink<a class=headerlink href=#23-grant-permissions-to-sink title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1># Grant publish permission to sink service account</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>gcloud<span class=w> </span>pubsub<span class=w> </span>topics<span class=w> </span>add-iam-policy-binding<span class=w> </span>tfdrift-audit-logs<span class=w> </span><span class=se>\</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=w>  </span>--member<span class=o>=</span><span class=s2>&quot;</span><span class=nv>$SINK_SA</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=w>  </span>--role<span class=o>=</span><span class=s2>&quot;roles/pubsub.publisher&quot;</span>
</span></code></pre></div> <p><strong>‚úÖ Verification:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1># Verify IAM policy</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>gcloud<span class=w> </span>pubsub<span class=w> </span>topics<span class=w> </span>get-iam-policy<span class=w> </span>tfdrift-audit-logs
</span></code></pre></div></p> <p><strong>Expected output:</strong> You should see the sink service account with <code>roles/pubsub.publisher</code> role.</p> <h3 id=24-create-subscription-for-falco>2.4 Create Subscription for Falco<a class=headerlink href=#24-create-subscription-for-falco title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1># Create pull subscription</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>gcloud<span class=w> </span>pubsub<span class=w> </span>subscriptions<span class=w> </span>create<span class=w> </span>tfdrift-falco-sub<span class=w> </span><span class=se>\</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=w>  </span>--topic<span class=o>=</span>tfdrift-audit-logs<span class=w> </span><span class=se>\</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>  </span>--ack-deadline<span class=o>=</span><span class=m>60</span>
</span></code></pre></div> <hr> <h2 id=step-3-install-and-configure-falco>Step 3: Install and Configure Falco<a class=headerlink href=#step-3-install-and-configure-falco title="Permanent link">&para;</a></h2> <h3 id=31-install-falco-with-docker-recommended>3.1 Install Falco with Docker (Recommended)<a class=headerlink href=#31-install-falco-with-docker-recommended title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1># Pull Falco image</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>docker<span class=w> </span>pull<span class=w> </span>falcosecurity/falco:latest
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=c1># Create Falco config directory</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>mkdir<span class=w> </span>-p<span class=w> </span>~/falco-config
</span></code></pre></div> <h3 id=32-create-falco-configuration>3.2 Create Falco Configuration<a class=headerlink href=#32-create-falco-configuration title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>cat<span class=w> </span>&gt;<span class=w> </span>~/falco-config/falco.yaml<span class=w> </span><span class=s>&lt;&lt;EOF</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=s># Falco Configuration for GCP Audit Logs</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=s># Enable gRPC output</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=s>grpc:</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=s>  enabled: true</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=s>  bind_address: &quot;0.0.0.0:5060&quot;</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=s>  threadiness: 8</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=s>grpc_output:</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=s>  enabled: true</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=s># Disable kernel module (not needed for cloud audit logs)</span>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=s>engine:</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=s>  kind: modern_ebpf</span>
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=s>  modern_ebpf:</span>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=s>    cpus_for_each_buffer: 2</span>
</span><span id=__span-20-18><a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a>
</span><span id=__span-20-19><a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=s># Load GCP audit plugin</span>
</span><span id=__span-20-20><a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a><span class=s>plugins:</span>
</span><span id=__span-20-21><a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a><span class=s>  - name: gcpaudit</span>
</span><span id=__span-20-22><a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a><span class=s>    library_path: /usr/share/falco/plugins/libgcpaudit.so</span>
</span><span id=__span-20-23><a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=s>    init_config:</span>
</span><span id=__span-20-24><a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a><span class=s>      project_id: &quot;$PROJECT_ID&quot;</span>
</span><span id=__span-20-25><a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=s>      subscription: &quot;tfdrift-falco-sub&quot;</span>
</span><span id=__span-20-26><a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a><span class=s>    open_params: &quot;&quot;</span>
</span><span id=__span-20-27><a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a>
</span><span id=__span-20-28><a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a><span class=s># Load rules for GCP</span>
</span><span id=__span-20-29><a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a><span class=s>load_plugins: [gcpaudit]</span>
</span><span id=__span-20-30><a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a>
</span><span id=__span-20-31><a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a><span class=s># Output configuration</span>
</span><span id=__span-20-32><a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a><span class=s>json_output: true</span>
</span><span id=__span-20-33><a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a><span class=s>json_include_output_property: true</span>
</span><span id=__span-20-34><a id=__codelineno-20-34 name=__codelineno-20-34 href=#__codelineno-20-34></a><span class=s>EOF</span>
</span></code></pre></div> <h3 id=33-create-gcp-credentials-secret>3.3 Create GCP Credentials Secret<a class=headerlink href=#33-create-gcp-credentials-secret title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1># Create service account for Falco</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>gcloud<span class=w> </span>iam<span class=w> </span>service-accounts<span class=w> </span>create<span class=w> </span>tfdrift-falco<span class=w> </span><span class=se>\</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=w>  </span>--display-name<span class=o>=</span><span class=s2>&quot;TFDrift Falco Service Account&quot;</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=c1># Grant Pub/Sub subscriber role</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>gcloud<span class=w> </span>projects<span class=w> </span>add-iam-policy-binding<span class=w> </span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=w>  </span>--member<span class=o>=</span><span class=s2>&quot;serviceAccount:tfdrift-falco@</span><span class=nv>$PROJECT_ID</span><span class=s2>.iam.gserviceaccount.com&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=w>  </span>--role<span class=o>=</span><span class=s2>&quot;roles/pubsub.subscriber&quot;</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=c1># Download key</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>gcloud<span class=w> </span>iam<span class=w> </span>service-accounts<span class=w> </span>keys<span class=w> </span>create<span class=w> </span>~/falco-config/gcp-key.json<span class=w> </span><span class=se>\</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=w>  </span>--iam-account<span class=o>=</span>tfdrift-falco@<span class=nv>$PROJECT_ID</span>.iam.gserviceaccount.com
</span></code></pre></div> <h3 id=34-run-falco>3.4 Run Falco<a class=headerlink href=#34-run-falco title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># Run Falco with GCP plugin</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span><span class=se>\</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=w>  </span>--name<span class=w> </span>falco<span class=w> </span><span class=se>\</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=w>  </span>-p<span class=w> </span><span class=m>5060</span>:5060<span class=w> </span><span class=se>\</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=w>  </span>-v<span class=w> </span>~/falco-config:/etc/falco<span class=w> </span><span class=se>\</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=w>  </span>-e<span class=w> </span><span class=nv>GOOGLE_APPLICATION_CREDENTIALS</span><span class=o>=</span>/etc/falco/gcp-key.json<span class=w> </span><span class=se>\</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=w>  </span>falcosecurity/falco:latest<span class=w> </span><span class=se>\</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>  </span>-c<span class=w> </span>/etc/falco/falco.yaml
</span></code></pre></div> <h3 id=35-verify-falco-is-running>3.5 Verify Falco is Running<a class=headerlink href=#35-verify-falco-is-running title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># Check Falco logs</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>docker<span class=w> </span>logs<span class=w> </span>falco
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=c1># You should see:</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=c1># &quot;Falco initialized with GCP Audit Log plugin&quot;</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=c1># &quot;gRPC server listening on 0.0.0.0:5060&quot;</span>
</span></code></pre></div> <hr> <h2 id=step-4-configure-tfdrift-falco>Step 4: Configure TFDrift-Falco<a class=headerlink href=#step-4-configure-tfdrift-falco title="Permanent link">&para;</a></h2> <h3 id=41-create-gcs-bucket-for-terraform-state-if-using-gcs-backend>4.1 Create GCS Bucket for Terraform State (If Using GCS Backend)<a class=headerlink href=#41-create-gcs-bucket-for-terraform-state-if-using-gcs-backend title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># Create bucket</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>gsutil<span class=w> </span>mb<span class=w> </span>-p<span class=w> </span><span class=nv>$PROJECT_ID</span><span class=w> </span>-l<span class=w> </span>us-central1<span class=w> </span>gs://tfdrift-terraform-state
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=c1># Enable versioning</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>gsutil<span class=w> </span>versioning<span class=w> </span><span class=nb>set</span><span class=w> </span>on<span class=w> </span>gs://tfdrift-terraform-state
</span></code></pre></div> <h3 id=42-create-tfdrift-falco-configuration>4.2 Create TFDrift-Falco Configuration<a class=headerlink href=#42-create-tfdrift-falco-configuration title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>cat<span class=w> </span>&gt;<span class=w> </span>config-gcp.yaml<span class=w> </span><span class=s>&lt;&lt;EOF</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=s># TFDrift-Falco GCP Configuration</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=s>providers:</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=s>  aws:</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=s>    enabled: false</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=s>  gcp:</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=s>    enabled: true</span>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=s>    projects:</span>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=s>      - &quot;$PROJECT_ID&quot;</span>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=s>    state:</span>
</span><span id=__span-25-13><a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a><span class=s>      backend: &quot;gcs&quot;</span>
</span><span id=__span-25-14><a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a><span class=s>      gcs_bucket: &quot;tfdrift-terraform-state&quot;</span>
</span><span id=__span-25-15><a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a><span class=s>      gcs_prefix: &quot;terraform.tfstate&quot;</span>
</span><span id=__span-25-16><a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a>
</span><span id=__span-25-17><a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a><span class=s>falco:</span>
</span><span id=__span-25-18><a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a><span class=s>  enabled: true</span>
</span><span id=__span-25-19><a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a><span class=s>  hostname: &quot;localhost&quot;  # or Falco container IP</span>
</span><span id=__span-25-20><a id=__codelineno-25-20 name=__codelineno-25-20 href=#__codelineno-25-20></a><span class=s>  port: 5060</span>
</span><span id=__span-25-21><a id=__codelineno-25-21 name=__codelineno-25-21 href=#__codelineno-25-21></a>
</span><span id=__span-25-22><a id=__codelineno-25-22 name=__codelineno-25-22 href=#__codelineno-25-22></a><span class=s>drift_rules:</span>
</span><span id=__span-25-23><a id=__codelineno-25-23 name=__codelineno-25-23 href=#__codelineno-25-23></a><span class=s>  - name: &quot;GCE Instance Configuration Change&quot;</span>
</span><span id=__span-25-24><a id=__codelineno-25-24 name=__codelineno-25-24 href=#__codelineno-25-24></a><span class=s>    resource_types:</span>
</span><span id=__span-25-25><a id=__codelineno-25-25 name=__codelineno-25-25 href=#__codelineno-25-25></a><span class=s>      - &quot;google_compute_instance&quot;</span>
</span><span id=__span-25-26><a id=__codelineno-25-26 name=__codelineno-25-26 href=#__codelineno-25-26></a><span class=s>    watched_attributes:</span>
</span><span id=__span-25-27><a id=__codelineno-25-27 name=__codelineno-25-27 href=#__codelineno-25-27></a><span class=s>      - &quot;metadata&quot;</span>
</span><span id=__span-25-28><a id=__codelineno-25-28 name=__codelineno-25-28 href=#__codelineno-25-28></a><span class=s>      - &quot;labels&quot;</span>
</span><span id=__span-25-29><a id=__codelineno-25-29 name=__codelineno-25-29 href=#__codelineno-25-29></a><span class=s>      - &quot;tags&quot;</span>
</span><span id=__span-25-30><a id=__codelineno-25-30 name=__codelineno-25-30 href=#__codelineno-25-30></a><span class=s>      - &quot;machine_type&quot;</span>
</span><span id=__span-25-31><a id=__codelineno-25-31 name=__codelineno-25-31 href=#__codelineno-25-31></a><span class=s>      - &quot;service_account&quot;</span>
</span><span id=__span-25-32><a id=__codelineno-25-32 name=__codelineno-25-32 href=#__codelineno-25-32></a><span class=s>    severity: &quot;high&quot;</span>
</span><span id=__span-25-33><a id=__codelineno-25-33 name=__codelineno-25-33 href=#__codelineno-25-33></a>
</span><span id=__span-25-34><a id=__codelineno-25-34 name=__codelineno-25-34 href=#__codelineno-25-34></a><span class=s>  - name: &quot;Firewall Rule Modification&quot;</span>
</span><span id=__span-25-35><a id=__codelineno-25-35 name=__codelineno-25-35 href=#__codelineno-25-35></a><span class=s>    resource_types:</span>
</span><span id=__span-25-36><a id=__codelineno-25-36 name=__codelineno-25-36 href=#__codelineno-25-36></a><span class=s>      - &quot;google_compute_firewall&quot;</span>
</span><span id=__span-25-37><a id=__codelineno-25-37 name=__codelineno-25-37 href=#__codelineno-25-37></a><span class=s>    watched_attributes:</span>
</span><span id=__span-25-38><a id=__codelineno-25-38 name=__codelineno-25-38 href=#__codelineno-25-38></a><span class=s>      - &quot;allow&quot;</span>
</span><span id=__span-25-39><a id=__codelineno-25-39 name=__codelineno-25-39 href=#__codelineno-25-39></a><span class=s>      - &quot;deny&quot;</span>
</span><span id=__span-25-40><a id=__codelineno-25-40 name=__codelineno-25-40 href=#__codelineno-25-40></a><span class=s>      - &quot;source_ranges&quot;</span>
</span><span id=__span-25-41><a id=__codelineno-25-41 name=__codelineno-25-41 href=#__codelineno-25-41></a><span class=s>      - &quot;target_tags&quot;</span>
</span><span id=__span-25-42><a id=__codelineno-25-42 name=__codelineno-25-42 href=#__codelineno-25-42></a><span class=s>    severity: &quot;critical&quot;</span>
</span><span id=__span-25-43><a id=__codelineno-25-43 name=__codelineno-25-43 href=#__codelineno-25-43></a>
</span><span id=__span-25-44><a id=__codelineno-25-44 name=__codelineno-25-44 href=#__codelineno-25-44></a><span class=s>  - name: &quot;Cloud Storage Security Settings&quot;</span>
</span><span id=__span-25-45><a id=__codelineno-25-45 name=__codelineno-25-45 href=#__codelineno-25-45></a><span class=s>    resource_types:</span>
</span><span id=__span-25-46><a id=__codelineno-25-46 name=__codelineno-25-46 href=#__codelineno-25-46></a><span class=s>      - &quot;google_storage_bucket&quot;</span>
</span><span id=__span-25-47><a id=__codelineno-25-47 name=__codelineno-25-47 href=#__codelineno-25-47></a><span class=s>    watched_attributes:</span>
</span><span id=__span-25-48><a id=__codelineno-25-48 name=__codelineno-25-48 href=#__codelineno-25-48></a><span class=s>      - &quot;encryption&quot;</span>
</span><span id=__span-25-49><a id=__codelineno-25-49 name=__codelineno-25-49 href=#__codelineno-25-49></a><span class=s>      - &quot;public_access_prevention&quot;</span>
</span><span id=__span-25-50><a id=__codelineno-25-50 name=__codelineno-25-50 href=#__codelineno-25-50></a><span class=s>      - &quot;uniform_bucket_level_access&quot;</span>
</span><span id=__span-25-51><a id=__codelineno-25-51 name=__codelineno-25-51 href=#__codelineno-25-51></a><span class=s>    severity: &quot;critical&quot;</span>
</span><span id=__span-25-52><a id=__codelineno-25-52 name=__codelineno-25-52 href=#__codelineno-25-52></a>
</span><span id=__span-25-53><a id=__codelineno-25-53 name=__codelineno-25-53 href=#__codelineno-25-53></a><span class=s>  - name: &quot;Cloud SQL Instance Change&quot;</span>
</span><span id=__span-25-54><a id=__codelineno-25-54 name=__codelineno-25-54 href=#__codelineno-25-54></a><span class=s>    resource_types:</span>
</span><span id=__span-25-55><a id=__codelineno-25-55 name=__codelineno-25-55 href=#__codelineno-25-55></a><span class=s>      - &quot;google_sql_database_instance&quot;</span>
</span><span id=__span-25-56><a id=__codelineno-25-56 name=__codelineno-25-56 href=#__codelineno-25-56></a><span class=s>    watched_attributes:</span>
</span><span id=__span-25-57><a id=__codelineno-25-57 name=__codelineno-25-57 href=#__codelineno-25-57></a><span class=s>      - &quot;settings&quot;</span>
</span><span id=__span-25-58><a id=__codelineno-25-58 name=__codelineno-25-58 href=#__codelineno-25-58></a><span class=s>      - &quot;database_version&quot;</span>
</span><span id=__span-25-59><a id=__codelineno-25-59 name=__codelineno-25-59 href=#__codelineno-25-59></a><span class=s>      - &quot;deletion_protection&quot;</span>
</span><span id=__span-25-60><a id=__codelineno-25-60 name=__codelineno-25-60 href=#__codelineno-25-60></a><span class=s>    severity: &quot;high&quot;</span>
</span><span id=__span-25-61><a id=__codelineno-25-61 name=__codelineno-25-61 href=#__codelineno-25-61></a>
</span><span id=__span-25-62><a id=__codelineno-25-62 name=__codelineno-25-62 href=#__codelineno-25-62></a><span class=s>  - name: &quot;IAM Policy Change&quot;</span>
</span><span id=__span-25-63><a id=__codelineno-25-63 name=__codelineno-25-63 href=#__codelineno-25-63></a><span class=s>    resource_types:</span>
</span><span id=__span-25-64><a id=__codelineno-25-64 name=__codelineno-25-64 href=#__codelineno-25-64></a><span class=s>      - &quot;google_project_iam_binding&quot;</span>
</span><span id=__span-25-65><a id=__codelineno-25-65 name=__codelineno-25-65 href=#__codelineno-25-65></a><span class=s>      - &quot;google_project_iam_member&quot;</span>
</span><span id=__span-25-66><a id=__codelineno-25-66 name=__codelineno-25-66 href=#__codelineno-25-66></a><span class=s>    watched_attributes:</span>
</span><span id=__span-25-67><a id=__codelineno-25-67 name=__codelineno-25-67 href=#__codelineno-25-67></a><span class=s>      - &quot;role&quot;</span>
</span><span id=__span-25-68><a id=__codelineno-25-68 name=__codelineno-25-68 href=#__codelineno-25-68></a><span class=s>      - &quot;members&quot;</span>
</span><span id=__span-25-69><a id=__codelineno-25-69 name=__codelineno-25-69 href=#__codelineno-25-69></a><span class=s>    severity: &quot;critical&quot;</span>
</span><span id=__span-25-70><a id=__codelineno-25-70 name=__codelineno-25-70 href=#__codelineno-25-70></a>
</span><span id=__span-25-71><a id=__codelineno-25-71 name=__codelineno-25-71 href=#__codelineno-25-71></a><span class=s>notifications:</span>
</span><span id=__span-25-72><a id=__codelineno-25-72 name=__codelineno-25-72 href=#__codelineno-25-72></a><span class=s>  slack:</span>
</span><span id=__span-25-73><a id=__codelineno-25-73 name=__codelineno-25-73 href=#__codelineno-25-73></a><span class=s>    enabled: true</span>
</span><span id=__span-25-74><a id=__codelineno-25-74 name=__codelineno-25-74 href=#__codelineno-25-74></a><span class=s>    webhook_url: &quot;https://hooks.slack.com/services/YOUR/WEBHOOK/URL&quot;</span>
</span><span id=__span-25-75><a id=__codelineno-25-75 name=__codelineno-25-75 href=#__codelineno-25-75></a><span class=s>    channel: &quot;#gcp-security-alerts&quot;</span>
</span><span id=__span-25-76><a id=__codelineno-25-76 name=__codelineno-25-76 href=#__codelineno-25-76></a>
</span><span id=__span-25-77><a id=__codelineno-25-77 name=__codelineno-25-77 href=#__codelineno-25-77></a><span class=s>  webhook:</span>
</span><span id=__span-25-78><a id=__codelineno-25-78 name=__codelineno-25-78 href=#__codelineno-25-78></a><span class=s>    enabled: false</span>
</span><span id=__span-25-79><a id=__codelineno-25-79 name=__codelineno-25-79 href=#__codelineno-25-79></a><span class=s>    url: &quot;https://your-siem.example.com/webhook&quot;</span>
</span><span id=__span-25-80><a id=__codelineno-25-80 name=__codelineno-25-80 href=#__codelineno-25-80></a>
</span><span id=__span-25-81><a id=__codelineno-25-81 name=__codelineno-25-81 href=#__codelineno-25-81></a><span class=s>logging:</span>
</span><span id=__span-25-82><a id=__codelineno-25-82 name=__codelineno-25-82 href=#__codelineno-25-82></a><span class=s>  level: &quot;info&quot;</span>
</span><span id=__span-25-83><a id=__codelineno-25-83 name=__codelineno-25-83 href=#__codelineno-25-83></a><span class=s>  format: &quot;json&quot;</span>
</span><span id=__span-25-84><a id=__codelineno-25-84 name=__codelineno-25-84 href=#__codelineno-25-84></a><span class=s>EOF</span>
</span></code></pre></div> <h3 id=43-run-tfdrift-falco>4.3 Run TFDrift-Falco<a class=headerlink href=#43-run-tfdrift-falco title="Permanent link">&para;</a></h3> <h4 id=option-a-docker>Option A: Docker<a class=headerlink href=#option-a-docker title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span><span class=se>\</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=w>  </span>--name<span class=w> </span>tfdrift-falco<span class=w> </span><span class=se>\</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=w>  </span>--network<span class=w> </span>host<span class=w> </span><span class=se>\</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>  </span>-v<span class=w> </span><span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>/config-gcp.yaml:/config/config.yaml:ro<span class=w> </span><span class=se>\</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>  </span>-e<span class=w> </span><span class=nv>GOOGLE_APPLICATION_CREDENTIALS</span><span class=o>=</span>/config/gcp-key.json<span class=w> </span><span class=se>\</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=w>  </span>-v<span class=w> </span>~/falco-config/gcp-key.json:/config/gcp-key.json:ro<span class=w> </span><span class=se>\</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=w>  </span>ghcr.io/higakikeita/tfdrift-falco:latest<span class=w> </span><span class=se>\</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=w>  </span>--config<span class=w> </span>/config/config.yaml
</span></code></pre></div> <h4 id=option-b-binary>Option B: Binary<a class=headerlink href=#option-b-binary title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1># Set GCP credentials</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=nb>export</span><span class=w> </span><span class=nv>GOOGLE_APPLICATION_CREDENTIALS</span><span class=o>=</span>~/falco-config/gcp-key.json
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=c1># Run TFDrift-Falco</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>./tfdrift<span class=w> </span>--config<span class=w> </span>config-gcp.yaml
</span></code></pre></div> <hr> <h2 id=step-5-verify-setup>Step 5: Verify Setup<a class=headerlink href=#step-5-verify-setup title="Permanent link">&para;</a></h2> <h3 id=51-test-drift-detection>5.1 Test Drift Detection<a class=headerlink href=#51-test-drift-detection title="Permanent link">&para;</a></h3> <p>Manually modify a Terraform-managed resource:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1># Example: Add metadata to a GCE instance</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>gcloud<span class=w> </span>compute<span class=w> </span>instances<span class=w> </span>add-metadata<span class=w> </span>INSTANCE_NAME<span class=w> </span><span class=se>\</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=w>  </span>--zone<span class=o>=</span>us-central1-a<span class=w> </span><span class=se>\</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=w>  </span>--metadata<span class=o>=</span>test-key<span class=o>=</span>test-value
</span></code></pre></div> <h3 id=52-check-tfdrift-falco-logs>5.2 Check TFDrift-Falco Logs<a class=headerlink href=#52-check-tfdrift-falco-logs title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1># Docker</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>docker<span class=w> </span>logs<span class=w> </span>-f<span class=w> </span>tfdrift-falco
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=c1># You should see:</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=c1># &quot;Drift Detected: google_compute_instance.INSTANCE_NAME&quot;</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=c1># &quot;Changed: metadata.test-key = null ‚Üí test-value&quot;</span>
</span></code></pre></div> <h3 id=53-check-slack-notification>5.3 Check Slack Notification<a class=headerlink href=#53-check-slack-notification title="Permanent link">&para;</a></h3> <p>You should receive a Slack alert with: - üö® Resource: <code>google_compute_instance.INSTANCE_NAME</code> - Changed attribute: <code>metadata.test-key</code> - User: <code>your-email@example.com</code> - Project: <code>your-gcp-project-id</code></p> <hr> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h2> <h3 id=issue-1-falco-not-receiving-audit-logs>Issue 1: Falco Not Receiving Audit Logs<a class=headerlink href=#issue-1-falco-not-receiving-audit-logs title="Permanent link">&para;</a></h3> <p><strong>Symptoms:</strong> - Falco starts but no events appear - <code>docker logs falco</code> shows no audit log entries</p> <p><strong>Solutions:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=c1># 1. Verify Pub/Sub subscription</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>gcloud<span class=w> </span>pubsub<span class=w> </span>subscriptions<span class=w> </span>describe<span class=w> </span>tfdrift-falco-sub
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=c1># 2. Check messages in subscription</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a>gcloud<span class=w> </span>pubsub<span class=w> </span>subscriptions<span class=w> </span>pull<span class=w> </span>tfdrift-falco-sub<span class=w> </span>--limit<span class=o>=</span><span class=m>5</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=c1># 3. Verify log sink</span>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a>gcloud<span class=w> </span>logging<span class=w> </span>sinks<span class=w> </span>describe<span class=w> </span>tfdrift-sink
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=c1># 4. Check service account permissions</span>
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a>gcloud<span class=w> </span>projects<span class=w> </span>get-iam-policy<span class=w> </span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-30-12><a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=w>  </span>--flatten<span class=o>=</span><span class=s2>&quot;bindings[].members&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-30-13><a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=w>  </span>--filter<span class=o>=</span><span class=s2>&quot;bindings.members:serviceAccount:tfdrift-falco@*&quot;</span>
</span></code></pre></div> <h3 id=issue-2-tfdrift-falco-cannot-connect-to-falco>Issue 2: TFDrift-Falco Cannot Connect to Falco<a class=headerlink href=#issue-2-tfdrift-falco-cannot-connect-to-falco title="Permanent link">&para;</a></h3> <p><strong>Symptoms:</strong> - Error: "failed to connect to Falco" - gRPC connection refused</p> <p><strong>Solutions:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=c1># 1. Check Falco gRPC port</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>falco<span class=w> </span>netstat<span class=w> </span>-tlnp<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=m>5060</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=c1># 2. Test gRPC connection</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a>grpcurl<span class=w> </span>-plaintext<span class=w> </span>localhost:5060<span class=w> </span>list
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=c1># 3. Check firewall rules (if using remote Falco)</span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a>gcloud<span class=w> </span>compute<span class=w> </span>firewall-rules<span class=w> </span>create<span class=w> </span>allow-falco-grpc<span class=w> </span><span class=se>\</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=w>  </span>--allow<span class=o>=</span>tcp:5060<span class=w> </span><span class=se>\</span>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=w>  </span>--source-ranges<span class=o>=</span>YOUR_CLIENT_IP/32
</span></code></pre></div> <h3 id=issue-3-gcs-backend-authentication-fails>Issue 3: GCS Backend Authentication Fails<a class=headerlink href=#issue-3-gcs-backend-authentication-fails title="Permanent link">&para;</a></h3> <p><strong>Symptoms:</strong> - Error: "failed to read object from GCS" - Permission denied</p> <p><strong>Solutions:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c1># 1. Verify service account has Storage Object Viewer role</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>gcloud<span class=w> </span>projects<span class=w> </span>add-iam-policy-binding<span class=w> </span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=w>  </span>--member<span class=o>=</span><span class=s2>&quot;serviceAccount:tfdrift-falco@</span><span class=nv>$PROJECT_ID</span><span class=s2>.iam.gserviceaccount.com&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=w>  </span>--role<span class=o>=</span><span class=s2>&quot;roles/storage.objectViewer&quot;</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=c1># 2. Test GCS access manually</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a>gsutil<span class=w> </span>ls<span class=w> </span>gs://tfdrift-terraform-state/
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=c1># 3. Verify GOOGLE_APPLICATION_CREDENTIALS is set</span>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=nb>echo</span><span class=w> </span><span class=nv>$GOOGLE_APPLICATION_CREDENTIALS</span>
</span></code></pre></div> <h3 id=issue-4-events-not-matching-terraform-resources>Issue 4: Events Not Matching Terraform Resources<a class=headerlink href=#issue-4-events-not-matching-terraform-resources title="Permanent link">&para;</a></h3> <p><strong>Symptoms:</strong> - Audit logs received but no drift detected - "Resource not found in Terraform state"</p> <p><strong>Solutions:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1># 1. Verify Terraform state path</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>gsutil<span class=w> </span>ls<span class=w> </span>gs://tfdrift-terraform-state/terraform.tfstate
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=c1># 2. Check resource naming in Terraform vs GCP</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a>terraform<span class=w> </span>show<span class=w> </span>-json<span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span><span class=s1>&#39;.values.root_module.resources[] | {type, name}&#39;</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=c1># 3. Enable debug logging</span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=c1># In config.yaml:</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a>logging:
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=w>  </span>level:<span class=w> </span><span class=s2>&quot;debug&quot;</span>
</span></code></pre></div> <h3 id=issue-5-high-volume-of-irrelevant-events>Issue 5: High Volume of Irrelevant Events<a class=headerlink href=#issue-5-high-volume-of-irrelevant-events title="Permanent link">&para;</a></h3> <p><strong>Symptoms:</strong> - Too many events being processed - Performance degradation</p> <p><strong>Solutions:</strong></p> <p>Update log sink filter to be more specific:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>gcloud<span class=w> </span>logging<span class=w> </span>sinks<span class=w> </span>update<span class=w> </span>tfdrift-sink<span class=w> </span><span class=se>\</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=w>  </span>--log-filter<span class=o>=</span><span class=s1>&#39;</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=s1>    protoPayload.serviceName=&quot;compute.googleapis.com&quot; AND</span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=s1>    protoPayload.methodName=~&quot;compute\.(instances|firewalls|networks)\.(insert|delete|update|patch|set.*)&quot;</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=s1>  &#39;</span>
</span></code></pre></div> <h3 id=issue-6-falco-container-crashes-or-restarts>Issue 6: Falco Container Crashes or Restarts<a class=headerlink href=#issue-6-falco-container-crashes-or-restarts title="Permanent link">&para;</a></h3> <p><strong>Symptoms:</strong> - Docker container exits immediately after starting - Error: <code>error opening device /dev/host/proc</code> - Container restart loop</p> <p><strong>Error Messages:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>Error: Unable to load gcpaudit plugin: Cannot open library: /usr/share/falco/plugins/libgcpaudit.so
</span></code></pre></div></p> <p><strong>Solutions:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=c1># 1. Check container logs for exact error</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>docker<span class=w> </span>logs<span class=w> </span>falco<span class=w> </span>--tail<span class=w> </span><span class=m>50</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=c1># 2. Verify plugin exists in container</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>falco<span class=w> </span>ls<span class=w> </span>-la<span class=w> </span>/usr/share/falco/plugins/
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=c1># 3. Use correct Falco version with gcpaudit plugin (0.37.0+)</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a>docker<span class=w> </span>pull<span class=w> </span>falcosecurity/falco:latest
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=c1># 4. Check configuration file syntax</span>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a>docker<span class=w> </span>run<span class=w> </span>--rm<span class=w> </span>-v<span class=w> </span>~/tfdrift-config:/config<span class=w> </span><span class=se>\</span>
</span><span id=__span-36-12><a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a><span class=w>  </span>falcosecurity/falco:latest<span class=w> </span><span class=se>\</span>
</span><span id=__span-36-13><a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a><span class=w>  </span>-c<span class=w> </span>/config/falco.yaml<span class=w> </span>--validate
</span><span id=__span-36-14><a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a>
</span><span id=__span-36-15><a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a><span class=c1># 5. Verify GOOGLE_APPLICATION_CREDENTIALS path</span>
</span><span id=__span-36-16><a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>falco<span class=w> </span>ls<span class=w> </span>-la<span class=w> </span><span class=nv>$GOOGLE_APPLICATION_CREDENTIALS</span>
</span></code></pre></div> <h3 id=issue-7-permission-denied-on-pubsub-subscription>Issue 7: Permission Denied on Pub/Sub Subscription<a class=headerlink href=#issue-7-permission-denied-on-pubsub-subscription title="Permanent link">&para;</a></h3> <p><strong>Symptoms:</strong> - Error: <code>PERMISSION_DENIED: User not authorized to perform this action</code> - Falco cannot pull messages from subscription</p> <p><strong>Error Messages:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a>ERROR Failed to pull messages: rpc error: code = PermissionDenied
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>desc = User not authorized to perform this action.
</span></code></pre></div></p> <p><strong>Solutions:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=c1># 1. Verify service account has Pub/Sub Subscriber role</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>gcloud<span class=w> </span>projects<span class=w> </span>get-iam-policy<span class=w> </span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=w>  </span>--flatten<span class=o>=</span><span class=s2>&quot;bindings[].members&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=w>  </span>--filter<span class=o>=</span><span class=s2>&quot;bindings.role:roles/pubsub.subscriber&quot;</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=c1># 2. Grant required permission</span>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a>gcloud<span class=w> </span>projects<span class=w> </span>add-iam-policy-binding<span class=w> </span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=w>  </span>--member<span class=o>=</span><span class=s2>&quot;serviceAccount:tfdrift-falco@</span><span class=nv>$PROJECT_ID</span><span class=s2>.iam.gserviceaccount.com&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-38-9><a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=w>  </span>--role<span class=o>=</span><span class=s2>&quot;roles/pubsub.subscriber&quot;</span>
</span><span id=__span-38-10><a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a>
</span><span id=__span-38-11><a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a><span class=c1># 3. Test subscription access with service account</span>
</span><span id=__span-38-12><a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a>gcloud<span class=w> </span>pubsub<span class=w> </span>subscriptions<span class=w> </span>pull<span class=w> </span>tfdrift-falco-sub<span class=w> </span><span class=se>\</span>
</span><span id=__span-38-13><a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=w>  </span>--limit<span class=o>=</span><span class=m>1</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-38-14><a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a><span class=w>  </span>--impersonate-service-account<span class=o>=</span>tfdrift-falco@<span class=nv>$PROJECT_ID</span>.iam.gserviceaccount.com
</span><span id=__span-38-15><a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a>
</span><span id=__span-38-16><a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a><span class=c1># 4. Verify key file has correct format</span>
</span><span id=__span-38-17><a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a>cat<span class=w> </span>~/tfdrift-config/gcp-key.json<span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>.
</span><span id=__span-38-18><a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a><span class=c1># Should show valid JSON with private_key, client_email, etc.</span>
</span></code></pre></div> <h3 id=issue-8-log-sink-service-account-missing-permissions>Issue 8: Log Sink Service Account Missing Permissions<a class=headerlink href=#issue-8-log-sink-service-account-missing-permissions title="Permanent link">&para;</a></h3> <p><strong>Symptoms:</strong> - Audit logs generated but not appearing in Pub/Sub - Log sink exists but messages not delivered</p> <p><strong>Error Messages:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a>The caller does not have permission to publish to topic
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>projects/PROJECT_ID/topics/tfdrift-audit-logs
</span></code></pre></div></p> <p><strong>Solutions:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=c1># 1. Get the log sink service account (writer identity)</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=nv>SINK_SA</span><span class=o>=</span><span class=k>$(</span>gcloud<span class=w> </span>logging<span class=w> </span>sinks<span class=w> </span>describe<span class=w> </span>tfdrift-sink<span class=w> </span><span class=se>\</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=w>  </span>--project<span class=o>=</span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=w>  </span>--format<span class=o>=</span><span class=s2>&quot;value(writerIdentity)&quot;</span><span class=k>)</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Sink Service Account: </span><span class=nv>$SINK_SA</span><span class=s2>&quot;</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=c1># 2. Grant Publisher role to the sink service account</span>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a>gcloud<span class=w> </span>pubsub<span class=w> </span>topics<span class=w> </span>add-iam-policy-binding<span class=w> </span>tfdrift-audit-logs<span class=w> </span><span class=se>\</span>
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=w>  </span>--member<span class=o>=</span><span class=s2>&quot;</span><span class=nv>$SINK_SA</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-40-10><a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=w>  </span>--role<span class=o>=</span><span class=s2>&quot;roles/pubsub.publisher&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-40-11><a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=w>  </span>--project<span class=o>=</span><span class=nv>$PROJECT_ID</span>
</span><span id=__span-40-12><a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a>
</span><span id=__span-40-13><a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=c1># 3. Verify the binding</span>
</span><span id=__span-40-14><a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a>gcloud<span class=w> </span>pubsub<span class=w> </span>topics<span class=w> </span>get-iam-policy<span class=w> </span>tfdrift-audit-logs<span class=w> </span><span class=se>\</span>
</span><span id=__span-40-15><a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=w>  </span>--project<span class=o>=</span><span class=nv>$PROJECT_ID</span>
</span><span id=__span-40-16><a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a>
</span><span id=__span-40-17><a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a><span class=c1># 4. Trigger a test event and check delivery</span>
</span><span id=__span-40-18><a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a>gcloud<span class=w> </span>compute<span class=w> </span>instances<span class=w> </span>list<span class=w>  </span><span class=c1># Triggers compute.instances.list</span>
</span><span id=__span-40-19><a id=__codelineno-40-19 name=__codelineno-40-19 href=#__codelineno-40-19></a>sleep<span class=w> </span><span class=m>30</span><span class=w>  </span><span class=c1># Wait for log delivery</span>
</span><span id=__span-40-20><a id=__codelineno-40-20 name=__codelineno-40-20 href=#__codelineno-40-20></a>gcloud<span class=w> </span>pubsub<span class=w> </span>subscriptions<span class=w> </span>pull<span class=w> </span>tfdrift-falco-sub<span class=w> </span>--limit<span class=o>=</span><span class=m>1</span>
</span></code></pre></div> <h3 id=issue-9-invalid-configuration-file>Issue 9: Invalid Configuration File<a class=headerlink href=#issue-9-invalid-configuration-file title="Permanent link">&para;</a></h3> <p><strong>Symptoms:</strong> - TFDrift-Falco fails to start - Error: <code>failed to load configuration</code> - YAML parsing errors</p> <p><strong>Error Messages:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a>Error: yaml: unmarshal errors:
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>  line 12: cannot unmarshal !!str `tfdrift...` into []string
</span></code></pre></div></p> <p><strong>Solutions:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=c1># 1. Validate YAML syntax</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>yamllint<span class=w> </span>~/tfdrift-config/config-gcp.yaml
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=c1># Or use Python</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a>python3<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;import yaml; yaml.safe_load(open(&#39;config-gcp.yaml&#39;))&quot;</span>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=c1># 2. Check common issues:</span>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a>
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=c1># ‚ùå Wrong: projects as string</span>
</span><span id=__span-42-10><a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a>providers:
</span><span id=__span-42-11><a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=w>  </span>gcp:
</span><span id=__span-42-12><a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=w>    </span>projects:<span class=w> </span><span class=s2>&quot;my-project&quot;</span><span class=w>  </span><span class=c1># Wrong</span>
</span><span id=__span-42-13><a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a>
</span><span id=__span-42-14><a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a><span class=c1># ‚úÖ Correct: projects as list</span>
</span><span id=__span-42-15><a id=__codelineno-42-15 name=__codelineno-42-15 href=#__codelineno-42-15></a>providers:
</span><span id=__span-42-16><a id=__codelineno-42-16 name=__codelineno-42-16 href=#__codelineno-42-16></a><span class=w>  </span>gcp:
</span><span id=__span-42-17><a id=__codelineno-42-17 name=__codelineno-42-17 href=#__codelineno-42-17></a><span class=w>    </span>projects:
</span><span id=__span-42-18><a id=__codelineno-42-18 name=__codelineno-42-18 href=#__codelineno-42-18></a><span class=w>      </span>-<span class=w> </span><span class=s2>&quot;my-project&quot;</span>
</span><span id=__span-42-19><a id=__codelineno-42-19 name=__codelineno-42-19 href=#__codelineno-42-19></a>
</span><span id=__span-42-20><a id=__codelineno-42-20 name=__codelineno-42-20 href=#__codelineno-42-20></a><span class=c1># ‚ùå Wrong: watched_attributes with quotes issues</span>
</span><span id=__span-42-21><a id=__codelineno-42-21 name=__codelineno-42-21 href=#__codelineno-42-21></a>watched_attributes:
</span><span id=__span-42-22><a id=__codelineno-42-22 name=__codelineno-42-22 href=#__codelineno-42-22></a><span class=w>  </span>-<span class=w> </span>metadata<span class=w>  </span><span class=c1># Missing quotes</span>
</span><span id=__span-42-23><a id=__codelineno-42-23 name=__codelineno-42-23 href=#__codelineno-42-23></a>
</span><span id=__span-42-24><a id=__codelineno-42-24 name=__codelineno-42-24 href=#__codelineno-42-24></a><span class=c1># ‚úÖ Correct:</span>
</span><span id=__span-42-25><a id=__codelineno-42-25 name=__codelineno-42-25 href=#__codelineno-42-25></a>watched_attributes:
</span><span id=__span-42-26><a id=__codelineno-42-26 name=__codelineno-42-26 href=#__codelineno-42-26></a><span class=w>  </span>-<span class=w> </span><span class=s2>&quot;metadata&quot;</span>
</span><span id=__span-42-27><a id=__codelineno-42-27 name=__codelineno-42-27 href=#__codelineno-42-27></a><span class=w>  </span>-<span class=w> </span><span class=s2>&quot;labels&quot;</span>
</span><span id=__span-42-28><a id=__codelineno-42-28 name=__codelineno-42-28 href=#__codelineno-42-28></a>
</span><span id=__span-42-29><a id=__codelineno-42-29 name=__codelineno-42-29 href=#__codelineno-42-29></a><span class=c1># 3. Use config validation if available</span>
</span><span id=__span-42-30><a id=__codelineno-42-30 name=__codelineno-42-30 href=#__codelineno-42-30></a>tfdrift<span class=w> </span>--config<span class=w> </span>~/tfdrift-config/config-gcp.yaml<span class=w> </span>--validate
</span></code></pre></div> <h3 id=issue-10-drift-not-detected-for-specific-resources>Issue 10: Drift Not Detected for Specific Resources<a class=headerlink href=#issue-10-drift-not-detected-for-specific-resources title="Permanent link">&para;</a></h3> <p><strong>Symptoms:</strong> - Some resources show drift, others don't - Manual changes not triggering alerts - Logs show "resource not found in state"</p> <p><strong>Solutions:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=c1># 1. Verify resource exists in Terraform state</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>terraform<span class=w> </span>show<span class=w> </span>-json<span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>-r<span class=w> </span><span class=se>\</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=w>  </span><span class=s1>&#39;.values.root_module.resources[] | select(.type==&quot;google_compute_instance&quot;) | .name&#39;</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=c1># 2. Check resource name format matches</span>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=c1># GCP Audit Log format: projects/PROJECT_ID/zones/ZONE/instances/NAME</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=c1># Terraform resource address: google_compute_instance.NAME</span>
</span><span id=__span-43-8><a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a>
</span><span id=__span-43-9><a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=c1># 3. Enable debug logging to see resource matching</span>
</span><span id=__span-43-10><a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=c1># In config-gcp.yaml:</span>
</span><span id=__span-43-11><a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a>logging:
</span><span id=__span-43-12><a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=w>  </span>level:<span class=w> </span><span class=s2>&quot;debug&quot;</span>
</span><span id=__span-43-13><a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=w>  </span>format:<span class=w> </span><span class=s2>&quot;json&quot;</span>
</span><span id=__span-43-14><a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a>
</span><span id=__span-43-15><a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a><span class=c1># 4. Check drift rule configuration</span>
</span><span id=__span-43-16><a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a><span class=c1># Ensure resource type matches exactly:</span>
</span><span id=__span-43-17><a id=__codelineno-43-17 name=__codelineno-43-17 href=#__codelineno-43-17></a>drift_rules:
</span><span id=__span-43-18><a id=__codelineno-43-18 name=__codelineno-43-18 href=#__codelineno-43-18></a><span class=w>  </span>-<span class=w> </span>name:<span class=w> </span><span class=s2>&quot;GCE Instance Drift&quot;</span>
</span><span id=__span-43-19><a id=__codelineno-43-19 name=__codelineno-43-19 href=#__codelineno-43-19></a><span class=w>    </span>resource_types:
</span><span id=__span-43-20><a id=__codelineno-43-20 name=__codelineno-43-20 href=#__codelineno-43-20></a><span class=w>      </span>-<span class=w> </span><span class=s2>&quot;google_compute_instance&quot;</span><span class=w>  </span><span class=c1># Must match Terraform type exactly</span>
</span><span id=__span-43-21><a id=__codelineno-43-21 name=__codelineno-43-21 href=#__codelineno-43-21></a>
</span><span id=__span-43-22><a id=__codelineno-43-22 name=__codelineno-43-22 href=#__codelineno-43-22></a><span class=c1># 5. Verify watched attributes exist in Terraform state</span>
</span><span id=__span-43-23><a id=__codelineno-43-23 name=__codelineno-43-23 href=#__codelineno-43-23></a>terraform<span class=w> </span>show<span class=w> </span>-json<span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span><span class=se>\</span>
</span><span id=__span-43-24><a id=__codelineno-43-24 name=__codelineno-43-24 href=#__codelineno-43-24></a><span class=w>  </span><span class=s1>&#39;.values.root_module.resources[] |</span>
</span><span id=__span-43-25><a id=__codelineno-43-25 name=__codelineno-43-25 href=#__codelineno-43-25></a><span class=s1>   select(.type==&quot;google_compute_instance&quot;) |</span>
</span><span id=__span-43-26><a id=__codelineno-43-26 name=__codelineno-43-26 href=#__codelineno-43-26></a><span class=s1>   .values | keys&#39;</span>
</span></code></pre></div> <h3 id=issue-11-webhook-notifications-not-sending>Issue 11: Webhook Notifications Not Sending<a class=headerlink href=#issue-11-webhook-notifications-not-sending title="Permanent link">&para;</a></h3> <p><strong>Symptoms:</strong> - Drift detected but no Slack/webhook notification - No errors in TFDrift-Falco logs</p> <p><strong>Solutions:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1># 1. Test webhook URL manually</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>https://hooks.slack.com/services/YOUR/WEBHOOK/URL<span class=w> </span><span class=se>\</span>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=w>  </span>-H<span class=w> </span><span class=s1>&#39;Content-Type: application/json&#39;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=w>  </span>-d<span class=w> </span><span class=s1>&#39;{&quot;text&quot;:&quot;Test message from TFDrift-Falco&quot;}&#39;</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a>
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=c1># 2. Check webhook configuration</span>
</span><span id=__span-44-7><a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=c1># In config-gcp.yaml:</span>
</span><span id=__span-44-8><a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a>notifications:
</span><span id=__span-44-9><a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a><span class=w>  </span>slack:
</span><span id=__span-44-10><a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=w>    </span>enabled:<span class=w> </span><span class=nb>true</span><span class=w>  </span><span class=c1># Must be true</span>
</span><span id=__span-44-11><a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a><span class=w>    </span>webhook_url:<span class=w> </span><span class=s2>&quot;https://hooks.slack.com/services/...&quot;</span><span class=w>  </span><span class=c1># Must be valid URL</span>
</span><span id=__span-44-12><a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a>
</span><span id=__span-44-13><a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a><span class=w>  </span>webhook:
</span><span id=__span-44-14><a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a><span class=w>    </span>enabled:<span class=w> </span><span class=nb>true</span>
</span><span id=__span-44-15><a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a><span class=w>    </span>url:<span class=w> </span><span class=s2>&quot;https://your-webhook.example.com/tfdrift&quot;</span>
</span><span id=__span-44-16><a id=__codelineno-44-16 name=__codelineno-44-16 href=#__codelineno-44-16></a><span class=w>    </span>method:<span class=w> </span><span class=s2>&quot;POST&quot;</span>
</span><span id=__span-44-17><a id=__codelineno-44-17 name=__codelineno-44-17 href=#__codelineno-44-17></a><span class=w>    </span>headers:
</span><span id=__span-44-18><a id=__codelineno-44-18 name=__codelineno-44-18 href=#__codelineno-44-18></a><span class=w>      </span>Content-Type:<span class=w> </span><span class=s2>&quot;application/json&quot;</span>
</span><span id=__span-44-19><a id=__codelineno-44-19 name=__codelineno-44-19 href=#__codelineno-44-19></a><span class=w>      </span>Authorization:<span class=w> </span><span class=s2>&quot;Bearer YOUR_TOKEN&quot;</span>
</span><span id=__span-44-20><a id=__codelineno-44-20 name=__codelineno-44-20 href=#__codelineno-44-20></a>
</span><span id=__span-44-21><a id=__codelineno-44-21 name=__codelineno-44-21 href=#__codelineno-44-21></a><span class=c1># 3. Enable verbose logging for notifications</span>
</span><span id=__span-44-22><a id=__codelineno-44-22 name=__codelineno-44-22 href=#__codelineno-44-22></a>logging:
</span><span id=__span-44-23><a id=__codelineno-44-23 name=__codelineno-44-23 href=#__codelineno-44-23></a><span class=w>  </span>level:<span class=w> </span><span class=s2>&quot;debug&quot;</span>
</span><span id=__span-44-24><a id=__codelineno-44-24 name=__codelineno-44-24 href=#__codelineno-44-24></a>
</span><span id=__span-44-25><a id=__codelineno-44-25 name=__codelineno-44-25 href=#__codelineno-44-25></a><span class=c1># 4. Check for network connectivity issues</span>
</span><span id=__span-44-26><a id=__codelineno-44-26 name=__codelineno-44-26 href=#__codelineno-44-26></a>curl<span class=w> </span>-v<span class=w> </span>https://hooks.slack.com
</span></code></pre></div> <h3 id=issue-12-multiple-projects-not-loading-state>Issue 12: Multiple Projects Not Loading State<a class=headerlink href=#issue-12-multiple-projects-not-loading-state title="Permanent link">&para;</a></h3> <p><strong>Symptoms:</strong> - Only first project's state loaded - Resources from other projects not detected</p> <p><strong>Solutions:</strong></p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=c1># ‚ùå Wrong: Single state file for multiple projects</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=nt>providers</span><span class=p>:</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=w>  </span><span class=nt>gcp</span><span class=p>:</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=w>    </span><span class=nt>projects</span><span class=p>:</span>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;project-1&quot;</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;project-2&quot;</span>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;gcs&quot;</span>
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=w>      </span><span class=nt>gcs_bucket</span><span class=p>:</span><span class=w> </span><span class=s>&quot;terraform-state&quot;</span>
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=w>      </span><span class=nt>gcs_prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;terraform.tfstate&quot;</span><span class=w>  </span><span class=c1># Same file for all!</span>
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a>
</span><span id=__span-45-12><a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=c1># ‚úÖ Correct: Use {PROJECT_ID} placeholder</span>
</span><span id=__span-45-13><a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=nt>providers</span><span class=p>:</span>
</span><span id=__span-45-14><a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a><span class=w>  </span><span class=nt>gcp</span><span class=p>:</span>
</span><span id=__span-45-15><a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a><span class=w>    </span><span class=nt>projects</span><span class=p>:</span>
</span><span id=__span-45-16><a id=__codelineno-45-16 name=__codelineno-45-16 href=#__codelineno-45-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;project-1&quot;</span>
</span><span id=__span-45-17><a id=__codelineno-45-17 name=__codelineno-45-17 href=#__codelineno-45-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;project-2&quot;</span>
</span><span id=__span-45-18><a id=__codelineno-45-18 name=__codelineno-45-18 href=#__codelineno-45-18></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span>
</span><span id=__span-45-19><a id=__codelineno-45-19 name=__codelineno-45-19 href=#__codelineno-45-19></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;gcs&quot;</span>
</span><span id=__span-45-20><a id=__codelineno-45-20 name=__codelineno-45-20 href=#__codelineno-45-20></a><span class=w>      </span><span class=nt>gcs_bucket</span><span class=p>:</span><span class=w> </span><span class=s>&quot;terraform-state&quot;</span>
</span><span id=__span-45-21><a id=__codelineno-45-21 name=__codelineno-45-21 href=#__codelineno-45-21></a><span class=w>      </span><span class=nt>gcs_prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{PROJECT_ID}/terraform.tfstate&quot;</span><span class=w>  </span><span class=c1># Different per project</span>
</span></code></pre></div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=c1># Verify state files exist for all projects</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=k>for</span><span class=w> </span>project<span class=w> </span><span class=k>in</span><span class=w> </span>project-1<span class=w> </span>project-2<span class=p>;</span><span class=w> </span><span class=k>do</span>
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=w>  </span>gsutil<span class=w> </span>ls<span class=w> </span>gs://terraform-state/<span class=nv>$project</span>/terraform.tfstate
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=k>done</span>
</span></code></pre></div> <hr> <h2 id=debug-procedures>Debug Procedures<a class=headerlink href=#debug-procedures title="Permanent link">&para;</a></h2> <h3 id=step-by-step-debugging-workflow>Step-by-Step Debugging Workflow<a class=headerlink href=#step-by-step-debugging-workflow title="Permanent link">&para;</a></h3> <p>When TFDrift-Falco is not working as expected, follow this systematic approach:</p> <h4 id=1-verify-the-complete-pipeline>1. Verify the Complete Pipeline<a class=headerlink href=#1-verify-the-complete-pipeline title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=c1># Debug script - save as debug-tfdrift.sh</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=nv>PROJECT_ID</span><span class=o>=</span><span class=s2>&quot;your-project-id&quot;</span>
</span><span id=__span-47-5><a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a>
</span><span id=__span-47-6><a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;==&gt; 1. Checking GCP Audit Logs&quot;</span>
</span><span id=__span-47-7><a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a>gcloud<span class=w> </span>logging<span class=w> </span><span class=nb>read</span><span class=w> </span><span class=s2>&quot;protoPayload.serviceName=compute.googleapis.com&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-47-8><a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=w>  </span>--limit<span class=o>=</span><span class=m>3</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-47-9><a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a><span class=w>  </span>--format<span class=o>=</span>json<span class=w> </span><span class=se>\</span>
</span><span id=__span-47-10><a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a><span class=w>  </span>--project<span class=o>=</span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span><span class=s1>&#39;.[0].protoPayload.methodName&#39;</span>
</span><span id=__span-47-11><a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a>
</span><span id=__span-47-12><a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;==&gt; 2. Checking Log Sink&quot;</span>
</span><span id=__span-47-13><a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a>gcloud<span class=w> </span>logging<span class=w> </span>sinks<span class=w> </span>describe<span class=w> </span>tfdrift-sink<span class=w> </span>--project<span class=o>=</span><span class=nv>$PROJECT_ID</span>
</span><span id=__span-47-14><a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a>
</span><span id=__span-47-15><a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;==&gt; 3. Checking Pub/Sub Topic&quot;</span>
</span><span id=__span-47-16><a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a>gcloud<span class=w> </span>pubsub<span class=w> </span>topics<span class=w> </span>describe<span class=w> </span>tfdrift-audit-logs<span class=w> </span>--project<span class=o>=</span><span class=nv>$PROJECT_ID</span>
</span><span id=__span-47-17><a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a>
</span><span id=__span-47-18><a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;==&gt; 4. Checking Pub/Sub Subscription&quot;</span>
</span><span id=__span-47-19><a id=__codelineno-47-19 name=__codelineno-47-19 href=#__codelineno-47-19></a>gcloud<span class=w> </span>pubsub<span class=w> </span>subscriptions<span class=w> </span>describe<span class=w> </span>tfdrift-falco-sub<span class=w> </span>--project<span class=o>=</span><span class=nv>$PROJECT_ID</span>
</span><span id=__span-47-20><a id=__codelineno-47-20 name=__codelineno-47-20 href=#__codelineno-47-20></a>
</span><span id=__span-47-21><a id=__codelineno-47-21 name=__codelineno-47-21 href=#__codelineno-47-21></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;==&gt; 5. Pulling Sample Message&quot;</span>
</span><span id=__span-47-22><a id=__codelineno-47-22 name=__codelineno-47-22 href=#__codelineno-47-22></a>gcloud<span class=w> </span>pubsub<span class=w> </span>subscriptions<span class=w> </span>pull<span class=w> </span>tfdrift-falco-sub<span class=w> </span><span class=se>\</span>
</span><span id=__span-47-23><a id=__codelineno-47-23 name=__codelineno-47-23 href=#__codelineno-47-23></a><span class=w>  </span>--limit<span class=o>=</span><span class=m>1</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-47-24><a id=__codelineno-47-24 name=__codelineno-47-24 href=#__codelineno-47-24></a><span class=w>  </span>--format<span class=o>=</span>json<span class=w> </span><span class=se>\</span>
</span><span id=__span-47-25><a id=__codelineno-47-25 name=__codelineno-47-25 href=#__codelineno-47-25></a><span class=w>  </span>--project<span class=o>=</span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span><span class=s1>&#39;.[0].message.data&#39;</span><span class=w> </span>-r<span class=w> </span><span class=p>|</span><span class=w> </span>base64<span class=w> </span>-d<span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>.
</span><span id=__span-47-26><a id=__codelineno-47-26 name=__codelineno-47-26 href=#__codelineno-47-26></a>
</span><span id=__span-47-27><a id=__codelineno-47-27 name=__codelineno-47-27 href=#__codelineno-47-27></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;==&gt; 6. Checking Falco Container&quot;</span>
</span><span id=__span-47-28><a id=__codelineno-47-28 name=__codelineno-47-28 href=#__codelineno-47-28></a>docker<span class=w> </span>ps<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>falco
</span><span id=__span-47-29><a id=__codelineno-47-29 name=__codelineno-47-29 href=#__codelineno-47-29></a>docker<span class=w> </span>logs<span class=w> </span>falco<span class=w> </span>--tail<span class=w> </span><span class=m>20</span>
</span><span id=__span-47-30><a id=__codelineno-47-30 name=__codelineno-47-30 href=#__codelineno-47-30></a>
</span><span id=__span-47-31><a id=__codelineno-47-31 name=__codelineno-47-31 href=#__codelineno-47-31></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;==&gt; 7. Testing Falco gRPC&quot;</span>
</span><span id=__span-47-32><a id=__codelineno-47-32 name=__codelineno-47-32 href=#__codelineno-47-32></a>grpcurl<span class=w> </span>-plaintext<span class=w> </span>localhost:5060<span class=w> </span>list
</span><span id=__span-47-33><a id=__codelineno-47-33 name=__codelineno-47-33 href=#__codelineno-47-33></a>
</span><span id=__span-47-34><a id=__codelineno-47-34 name=__codelineno-47-34 href=#__codelineno-47-34></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;==&gt; 8. Testing TFDrift-Falco Connection&quot;</span>
</span><span id=__span-47-35><a id=__codelineno-47-35 name=__codelineno-47-35 href=#__codelineno-47-35></a><span class=c1># Run TFDrift-Falco with debug logging</span>
</span><span id=__span-47-36><a id=__codelineno-47-36 name=__codelineno-47-36 href=#__codelineno-47-36></a>tfdrift<span class=w> </span>--config<span class=w> </span>config-gcp.yaml<span class=w> </span>--log-level<span class=o>=</span>debug
</span></code></pre></div> <h4 id=2-enable-maximum-verbosity>2. Enable Maximum Verbosity<a class=headerlink href=#2-enable-maximum-verbosity title="Permanent link">&para;</a></h4> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=c1># config-gcp.yaml - Debug configuration</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=w>  </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=s>&quot;debug&quot;</span><span class=w>  </span><span class=c1># trace, debug, info, warn, error</span>
</span><span id=__span-48-4><a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=w>  </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=s>&quot;json&quot;</span><span class=w>  </span><span class=c1># json or text</span>
</span><span id=__span-48-5><a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a>
</span><span id=__span-48-6><a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=nt>falco</span><span class=p>:</span>
</span><span id=__span-48-7><a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-48-8><a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class=w>  </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=s>&quot;localhost&quot;</span>
</span><span id=__span-48-9><a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5060</span>
</span><span id=__span-48-10><a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a><span class=w>  </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-48-11><a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a><span class=w>  </span><span class=nt>retry</span><span class=p>:</span>
</span><span id=__span-48-12><a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a><span class=w>    </span><span class=nt>max_attempts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-48-13><a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a><span class=w>    </span><span class=nt>initial_interval</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1s&quot;</span>
</span></code></pre></div> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=c1># falco.yaml - Debug configuration</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=nt>json_output</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=nt>json_include_output_property</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=nt>log_level</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">debug</span><span class=w>  </span><span class=c1># Add this for Falco debug logs</span>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a>
</span><span id=__span-49-6><a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=nt>grpc</span><span class=p>:</span>
</span><span id=__span-49-7><a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-49-8><a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a><span class=w>  </span><span class=nt>bind_address</span><span class=p>:</span><span class=w> </span><span class=s>&quot;0.0.0.0:5060&quot;</span>
</span><span id=__span-49-9><a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a><span class=w>  </span><span class=nt>threadiness</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
</span><span id=__span-49-10><a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a>
</span><span id=__span-49-11><a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a><span class=nt>grpc_output</span><span class=p>:</span>
</span><span id=__span-49-12><a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div> <h4 id=3-test-each-component-independently>3. Test Each Component Independently<a class=headerlink href=#3-test-each-component-independently title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=c1># Test 1: Trigger a known GCP event</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Creating test compute instance...&quot;</span>
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a>gcloud<span class=w> </span>compute<span class=w> </span>instances<span class=w> </span>create<span class=w> </span>tfdrift-test-instance<span class=w> </span><span class=se>\</span>
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=w>  </span>--zone<span class=o>=</span>us-central1-a<span class=w> </span><span class=se>\</span>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=w>  </span>--machine-type<span class=o>=</span>e2-micro<span class=w> </span><span class=se>\</span>
</span><span id=__span-50-6><a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=w>  </span>--project<span class=o>=</span><span class=nv>$PROJECT_ID</span>
</span><span id=__span-50-7><a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a>
</span><span id=__span-50-8><a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=c1># Wait for audit log (30 seconds typical)</span>
</span><span id=__span-50-9><a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a>sleep<span class=w> </span><span class=m>35</span>
</span><span id=__span-50-10><a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a>
</span><span id=__span-50-11><a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a><span class=c1># Test 2: Check if audit log was created</span>
</span><span id=__span-50-12><a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a>gcloud<span class=w> </span>logging<span class=w> </span><span class=nb>read</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-50-13><a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a><span class=w>  </span><span class=s1>&#39;protoPayload.methodName=&quot;v1.compute.instances.insert&quot; AND</span>
</span><span id=__span-50-14><a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a><span class=s1>   resource.labels.instance_id=&quot;tfdrift-test-instance&quot;&#39;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-50-15><a id=__codelineno-50-15 name=__codelineno-50-15 href=#__codelineno-50-15></a><span class=w>  </span>--limit<span class=o>=</span><span class=m>1</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-50-16><a id=__codelineno-50-16 name=__codelineno-50-16 href=#__codelineno-50-16></a><span class=w>  </span>--format<span class=o>=</span>json<span class=w> </span><span class=se>\</span>
</span><span id=__span-50-17><a id=__codelineno-50-17 name=__codelineno-50-17 href=#__codelineno-50-17></a><span class=w>  </span>--project<span class=o>=</span><span class=nv>$PROJECT_ID</span>
</span><span id=__span-50-18><a id=__codelineno-50-18 name=__codelineno-50-18 href=#__codelineno-50-18></a>
</span><span id=__span-50-19><a id=__codelineno-50-19 name=__codelineno-50-19 href=#__codelineno-50-19></a><span class=c1># Test 3: Check if it reached Pub/Sub</span>
</span><span id=__span-50-20><a id=__codelineno-50-20 name=__codelineno-50-20 href=#__codelineno-50-20></a>gcloud<span class=w> </span>pubsub<span class=w> </span>subscriptions<span class=w> </span>pull<span class=w> </span>tfdrift-falco-sub<span class=w> </span><span class=se>\</span>
</span><span id=__span-50-21><a id=__codelineno-50-21 name=__codelineno-50-21 href=#__codelineno-50-21></a><span class=w>  </span>--limit<span class=o>=</span><span class=m>5</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-50-22><a id=__codelineno-50-22 name=__codelineno-50-22 href=#__codelineno-50-22></a><span class=w>  </span>--format<span class=o>=</span>json<span class=w> </span><span class=se>\</span>
</span><span id=__span-50-23><a id=__codelineno-50-23 name=__codelineno-50-23 href=#__codelineno-50-23></a><span class=w>  </span>--project<span class=o>=</span><span class=nv>$PROJECT_ID</span>
</span><span id=__span-50-24><a id=__codelineno-50-24 name=__codelineno-50-24 href=#__codelineno-50-24></a>
</span><span id=__span-50-25><a id=__codelineno-50-25 name=__codelineno-50-25 href=#__codelineno-50-25></a><span class=c1># Test 4: Check Falco received it</span>
</span><span id=__span-50-26><a id=__codelineno-50-26 name=__codelineno-50-26 href=#__codelineno-50-26></a>docker<span class=w> </span>logs<span class=w> </span>falco<span class=w> </span>--tail<span class=w> </span><span class=m>50</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s2>&quot;compute.instances.insert&quot;</span>
</span><span id=__span-50-27><a id=__codelineno-50-27 name=__codelineno-50-27 href=#__codelineno-50-27></a>
</span><span id=__span-50-28><a id=__codelineno-50-28 name=__codelineno-50-28 href=#__codelineno-50-28></a><span class=c1># Cleanup</span>
</span><span id=__span-50-29><a id=__codelineno-50-29 name=__codelineno-50-29 href=#__codelineno-50-29></a>gcloud<span class=w> </span>compute<span class=w> </span>instances<span class=w> </span>delete<span class=w> </span>tfdrift-test-instance<span class=w> </span><span class=se>\</span>
</span><span id=__span-50-30><a id=__codelineno-50-30 name=__codelineno-50-30 href=#__codelineno-50-30></a><span class=w>  </span>--zone<span class=o>=</span>us-central1-a<span class=w> </span><span class=se>\</span>
</span><span id=__span-50-31><a id=__codelineno-50-31 name=__codelineno-50-31 href=#__codelineno-50-31></a><span class=w>  </span>--quiet<span class=w> </span><span class=se>\</span>
</span><span id=__span-50-32><a id=__codelineno-50-32 name=__codelineno-50-32 href=#__codelineno-50-32></a><span class=w>  </span>--project<span class=o>=</span><span class=nv>$PROJECT_ID</span>
</span></code></pre></div> <h4 id=4-isolate-network-issues>4. Isolate Network Issues<a class=headerlink href=#4-isolate-network-issues title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=c1># Test gRPC connectivity from TFDrift-Falco perspective</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a>grpcurl<span class=w> </span>-plaintext<span class=w> </span>localhost:5060<span class=w> </span>list
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=c1># If using remote Falco, test from client machine</span>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a>grpcurl<span class=w> </span>-plaintext<span class=w> </span>FALCO_HOST:5060<span class=w> </span>list
</span><span id=__span-51-6><a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a>
</span><span id=__span-51-7><a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=c1># Check Docker network</span>
</span><span id=__span-51-8><a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a>docker<span class=w> </span>network<span class=w> </span>inspect<span class=w> </span>bridge
</span><span id=__span-51-9><a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a>
</span><span id=__span-51-10><a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a><span class=c1># Check port bindings</span>
</span><span id=__span-51-11><a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a>docker<span class=w> </span>port<span class=w> </span>falco
</span><span id=__span-51-12><a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class=c1># Should show: 5060/tcp -&gt; 0.0.0.0:5060</span>
</span><span id=__span-51-13><a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a>
</span><span id=__span-51-14><a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a><span class=c1># Test with telnet</span>
</span><span id=__span-51-15><a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a>telnet<span class=w> </span>localhost<span class=w> </span><span class=m>5060</span>
</span></code></pre></div> <hr> <h2 id=log-analysis-guide>Log Analysis Guide<a class=headerlink href=#log-analysis-guide title="Permanent link">&para;</a></h2> <h3 id=understanding-gcp-audit-log-structure>Understanding GCP Audit Log Structure<a class=headerlink href=#understanding-gcp-audit-log-structure title="Permanent link">&para;</a></h3> <p>GCP Audit Logs delivered via Falco gcpaudit plugin have this structure:</p> <div class="language-json highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=p>{</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=w>  </span><span class=nt>&quot;protoPayload&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=w>    </span><span class=nt>&quot;serviceName&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;compute.googleapis.com&quot;</span><span class=p>,</span>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=w>    </span><span class=nt>&quot;methodName&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;v1.compute.instances.setMetadata&quot;</span><span class=p>,</span>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=w>    </span><span class=nt>&quot;resourceName&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;projects/123456789/zones/us-central1-a/instances/my-instance&quot;</span><span class=p>,</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=w>    </span><span class=nt>&quot;authenticationInfo&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=w>      </span><span class=nt>&quot;principalEmail&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;user@example.com&quot;</span>
</span><span id=__span-52-8><a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-52-9><a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a><span class=w>    </span><span class=nt>&quot;request&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-10><a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a><span class=w>      </span><span class=nt>&quot;metadata&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-11><a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=w>        </span><span class=nt>&quot;items&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-52-12><a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a><span class=w>          </span><span class=p>{</span>
</span><span id=__span-52-13><a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a><span class=w>            </span><span class=nt>&quot;key&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;ssh-keys&quot;</span><span class=p>,</span>
</span><span id=__span-52-14><a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a><span class=w>            </span><span class=nt>&quot;value&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;user:ssh-rsa AAAA...&quot;</span>
</span><span id=__span-52-15><a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a><span class=w>          </span><span class=p>}</span>
</span><span id=__span-52-16><a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a><span class=w>        </span><span class=p>]</span>
</span><span id=__span-52-17><a id=__codelineno-52-17 name=__codelineno-52-17 href=#__codelineno-52-17></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-52-18><a id=__codelineno-52-18 name=__codelineno-52-18 href=#__codelineno-52-18></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-52-19><a id=__codelineno-52-19 name=__codelineno-52-19 href=#__codelineno-52-19></a><span class=w>    </span><span class=nt>&quot;response&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-20><a id=__codelineno-52-20 name=__codelineno-52-20 href=#__codelineno-52-20></a><span class=w>      </span><span class=nt>&quot;operationType&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;setMetadata&quot;</span>
</span><span id=__span-52-21><a id=__codelineno-52-21 name=__codelineno-52-21 href=#__codelineno-52-21></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-52-22><a id=__codelineno-52-22 name=__codelineno-52-22 href=#__codelineno-52-22></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-52-23><a id=__codelineno-52-23 name=__codelineno-52-23 href=#__codelineno-52-23></a><span class=w>  </span><span class=nt>&quot;timestamp&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2025-12-17T10:30:45.123456Z&quot;</span><span class=p>,</span>
</span><span id=__span-52-24><a id=__codelineno-52-24 name=__codelineno-52-24 href=#__codelineno-52-24></a><span class=w>  </span><span class=nt>&quot;severity&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;NOTICE&quot;</span>
</span><span id=__span-52-25><a id=__codelineno-52-25 name=__codelineno-52-25 href=#__codelineno-52-25></a><span class=p>}</span>
</span></code></pre></div> <h3 id=key-fields-for-drift-detection>Key Fields for Drift Detection<a class=headerlink href=#key-fields-for-drift-detection title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Field</th> <th>Purpose</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td><code>serviceName</code></td> <td>Which GCP service</td> <td><code>compute.googleapis.com</code></td> </tr> <tr> <td><code>methodName</code></td> <td>What action</td> <td><code>v1.compute.instances.setMetadata</code></td> </tr> <tr> <td><code>resourceName</code></td> <td>Which resource</td> <td><code>projects/.../instances/my-instance</code></td> </tr> <tr> <td><code>principalEmail</code></td> <td>Who made the change</td> <td><code>user@example.com</code></td> </tr> <tr> <td><code>request</code></td> <td>What changed</td> <td>New metadata values</td> </tr> <tr> <td><code>timestamp</code></td> <td>When</td> <td>ISO 8601 timestamp</td> </tr> </tbody> </table> <h3 id=falco-grpc-output-format>Falco gRPC Output Format<a class=headerlink href=#falco-grpc-output-format title="Permanent link">&para;</a></h3> <p>When Falco forwards events to TFDrift-Falco via gRPC:</p> <div class="language-json highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=p>{</span>
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=w>  </span><span class=nt>&quot;output&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;GCP Audit Log Event&quot;</span><span class=p>,</span>
</span><span id=__span-53-3><a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=w>  </span><span class=nt>&quot;priority&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Notice&quot;</span><span class=p>,</span>
</span><span id=__span-53-4><a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=w>  </span><span class=nt>&quot;rule&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;GCP Audit Log&quot;</span><span class=p>,</span>
</span><span id=__span-53-5><a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=w>  </span><span class=nt>&quot;time&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2025-12-17T10:30:45.123456Z&quot;</span><span class=p>,</span>
</span><span id=__span-53-6><a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=w>  </span><span class=nt>&quot;output_fields&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-53-7><a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=w>    </span><span class=nt>&quot;gcp.serviceName&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;compute.googleapis.com&quot;</span><span class=p>,</span>
</span><span id=__span-53-8><a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=w>    </span><span class=nt>&quot;gcp.methodName&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;v1.compute.instances.setMetadata&quot;</span><span class=p>,</span>
</span><span id=__span-53-9><a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=w>    </span><span class=nt>&quot;gcp.resourceName&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;projects/123456789/zones/us-central1-a/instances/my-instance&quot;</span><span class=p>,</span>
</span><span id=__span-53-10><a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a><span class=w>    </span><span class=nt>&quot;gcp.principalEmail&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;user@example.com&quot;</span><span class=p>,</span>
</span><span id=__span-53-11><a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a><span class=w>    </span><span class=nt>&quot;gcp.projectId&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;my-project-123&quot;</span>
</span><span id=__span-53-12><a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-53-13><a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a><span class=w>  </span><span class=nt>&quot;source&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;gcpaudit&quot;</span>
</span><span id=__span-53-14><a id=__codelineno-53-14 name=__codelineno-53-14 href=#__codelineno-53-14></a><span class=p>}</span>
</span></code></pre></div> <h3 id=tfdrift-falco-event-processing>TFDrift-Falco Event Processing<a class=headerlink href=#tfdrift-falco-event-processing title="Permanent link">&para;</a></h3> <p>TFDrift-Falco processes events through these stages:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a>1. Receive gRPC event from Falco
</span><span id=__span-54-2><a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a>   ‚Üì
</span><span id=__span-54-3><a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a>2. Parse GCP-specific fields (gcp.serviceName, gcp.methodName, etc.)
</span><span id=__span-54-4><a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a>   ‚Üì
</span><span id=__span-54-5><a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a>3. Map methodName to Terraform resource type
</span><span id=__span-54-6><a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a>   compute.instances.setMetadata ‚Üí google_compute_instance
</span><span id=__span-54-7><a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a>   ‚Üì
</span><span id=__span-54-8><a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a>4. Extract resource identifier from resourceName
</span><span id=__span-54-9><a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a>   projects/.../instances/my-instance ‚Üí my-instance
</span><span id=__span-54-10><a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a>   ‚Üì
</span><span id=__span-54-11><a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a>5. Load Terraform state for project
</span><span id=__span-54-12><a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a>   ‚Üì
</span><span id=__span-54-13><a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a>6. Find matching resource in state
</span><span id=__span-54-14><a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a>   google_compute_instance.my_instance
</span><span id=__span-54-15><a id=__codelineno-54-15 name=__codelineno-54-15 href=#__codelineno-54-15></a>   ‚Üì
</span><span id=__span-54-16><a id=__codelineno-54-16 name=__codelineno-54-16 href=#__codelineno-54-16></a>7. Compare changed attributes with drift rules
</span><span id=__span-54-17><a id=__codelineno-54-17 name=__codelineno-54-17 href=#__codelineno-54-17></a>   ‚Üì
</span><span id=__span-54-18><a id=__codelineno-54-18 name=__codelineno-54-18 href=#__codelineno-54-18></a>8. Generate drift alert if mismatch detected
</span></code></pre></div> <h3 id=reading-tfdrift-falco-logs>Reading TFDrift-Falco Logs<a class=headerlink href=#reading-tfdrift-falco-logs title="Permanent link">&para;</a></h3> <p><strong>Normal Operation:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a>INFO[2025-12-17T10:30:00Z] Starting TFDrift-Falco v0.5.0
</span><span id=__span-55-2><a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a>INFO[2025-12-17T10:30:01Z] Connected to Falco gRPC at localhost:5060
</span><span id=__span-55-3><a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a>INFO[2025-12-17T10:30:01Z] Loaded Terraform state for project my-project-123 (45 resources)
</span><span id=__span-55-4><a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a>INFO[2025-12-17T10:30:45Z] Received event: compute.instances.setMetadata (user@example.com)
</span><span id=__span-55-5><a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a>INFO[2025-12-17T10:30:45Z] Mapped to resource: google_compute_instance.my_instance
</span><span id=__span-55-6><a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a>WARN[2025-12-17T10:30:45Z] Drift detected: metadata changed on google_compute_instance.my_instance
</span><span id=__span-55-7><a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a>INFO[2025-12-17T10:30:45Z] Sent Slack notification
</span></code></pre></div></p> <p><strong>Debug Mode (--log-level=debug):</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a>DEBUG[2025-12-17T10:30:45Z] Raw Falco event: {output_fields:{gcp.methodName:v1.compute.instances.setMetadata}}
</span><span id=__span-56-2><a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>DEBUG[2025-12-17T10:30:45Z] Parsed GCP event: service=compute.googleapis.com method=setMetadata resource=my-instance
</span><span id=__span-56-3><a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a>DEBUG[2025-12-17T10:30:45Z] Resource mapper: compute.instances ‚Üí google_compute_instance
</span><span id=__span-56-4><a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a>DEBUG[2025-12-17T10:30:45Z] State lookup: google_compute_instance.my_instance found
</span><span id=__span-56-5><a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a>DEBUG[2025-12-17T10:30:45Z] Comparing attributes: [metadata, labels, tags]
</span><span id=__span-56-6><a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a>DEBUG[2025-12-17T10:30:45Z] Attribute &#39;metadata&#39; differs: state={...} event={...}
</span><span id=__span-56-7><a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a>DEBUG[2025-12-17T10:30:45Z] Drift rule matched: GCE Instance Configuration Change (severity: high)
</span><span id=__span-56-8><a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a>DEBUG[2025-12-17T10:30:45Z] Calling webhook: https://hooks.slack.com/services/...
</span><span id=__span-56-9><a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a>DEBUG[2025-12-17T10:30:46Z] Webhook response: 200 OK
</span></code></pre></div></p> <h3 id=common-log-patterns-and-meanings>Common Log Patterns and Meanings<a class=headerlink href=#common-log-patterns-and-meanings title="Permanent link">&para;</a></h3> <p><strong>Pattern: "Resource not found in Terraform state"</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a>WARN[...] Resource not found in Terraform state: google_compute_instance.my_instance
</span></code></pre></div> <strong>Meaning:</strong> The GCP resource exists and was modified, but it's not managed by Terraform (or state file path is wrong)</p> <p><strong>Pattern: "Failed to connect to Falco"</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a>ERROR[...] Failed to connect to Falco gRPC: connection refused
</span></code></pre></div> <strong>Meaning:</strong> TFDrift-Falco cannot reach Falco on the configured hostname:port</p> <p><strong>Pattern: "Failed to load Terraform state"</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a>ERROR[...] Failed to load Terraform state from GCS: storage: object doesn&#39;t exist
</span></code></pre></div> <strong>Meaning:</strong> State file path in configuration doesn't match actual GCS object path</p> <p><strong>Pattern: "No drift rules matched"</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a>DEBUG[...] No drift rules matched for resource type: google_compute_firewall
</span></code></pre></div> <strong>Meaning:</strong> Event received, but no drift rules configured for this resource type</p> <hr> <h2 id=advanced-configuration>Advanced Configuration<a class=headerlink href=#advanced-configuration title="Permanent link">&para;</a></h2> <h3 id=multi-project-setup>Multi-Project Setup<a class=headerlink href=#multi-project-setup title="Permanent link">&para;</a></h3> <p>Monitor multiple GCP projects:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=nt>providers</span><span class=p>:</span>
</span><span id=__span-61-2><a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=w>  </span><span class=nt>gcp</span><span class=p>:</span>
</span><span id=__span-61-3><a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-61-4><a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=w>    </span><span class=nt>projects</span><span class=p>:</span>
</span><span id=__span-61-5><a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;project-1&quot;</span>
</span><span id=__span-61-6><a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;project-2&quot;</span>
</span><span id=__span-61-7><a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;project-3&quot;</span>
</span><span id=__span-61-8><a id=__codelineno-61-8 name=__codelineno-61-8 href=#__codelineno-61-8></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span>
</span><span id=__span-61-9><a id=__codelineno-61-9 name=__codelineno-61-9 href=#__codelineno-61-9></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;gcs&quot;</span>
</span><span id=__span-61-10><a id=__codelineno-61-10 name=__codelineno-61-10 href=#__codelineno-61-10></a><span class=w>      </span><span class=nt>gcs_bucket</span><span class=p>:</span><span class=w> </span><span class=s>&quot;tfdrift-terraform-state&quot;</span>
</span><span id=__span-61-11><a id=__codelineno-61-11 name=__codelineno-61-11 href=#__codelineno-61-11></a><span class=w>      </span><span class=nt>gcs_prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;project-{PROJECT_ID}/terraform.tfstate&quot;</span>
</span></code></pre></div> <h3 id=custom-falco-rules>Custom Falco Rules<a class=headerlink href=#custom-falco-rules title="Permanent link">&para;</a></h3> <p>Create custom rules for specific GCP events:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-62-1><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=c1># falco-custom-rules.yaml</span>
</span><span id=__span-62-2><a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Managed GCE Instance Modified</span>
</span><span id=__span-62-3><a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=w>  </span><span class=nt>desc</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Detect modifications to Terraform-managed GCE instances</span>
</span><span id=__span-62-4><a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=w>  </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;</span>
</span><span id=__span-62-5><a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=w>    </span><span class=no>gcp.methodName in (compute.instances.setMetadata,</span>
</span><span id=__span-62-6><a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a><span class=w>                        </span><span class=no>compute.instances.setLabels,</span>
</span><span id=__span-62-7><a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a><span class=w>                        </span><span class=no>compute.instances.setTags) and</span>
</span><span id=__span-62-8><a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a><span class=w>    </span><span class=no>not gcp.authenticationInfo.principalEmail startswith &quot;terraform-&quot;</span>
</span><span id=__span-62-9><a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a><span class=w>  </span><span class=nt>output</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;</span>
</span><span id=__span-62-10><a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a><span class=w>    </span><span class=no>GCE instance modified outside Terraform</span>
</span><span id=__span-62-11><a id=__codelineno-62-11 name=__codelineno-62-11 href=#__codelineno-62-11></a><span class=w>    </span><span class=no>(user=%gcp.authenticationInfo.principalEmail</span>
</span><span id=__span-62-12><a id=__codelineno-62-12 name=__codelineno-62-12 href=#__codelineno-62-12></a><span class=w>     </span><span class=no>instance=%gcp.resource.name</span>
</span><span id=__span-62-13><a id=__codelineno-62-13 name=__codelineno-62-13 href=#__codelineno-62-13></a><span class=w>     </span><span class=no>method=%gcp.methodName)</span>
</span><span id=__span-62-14><a id=__codelineno-62-14 name=__codelineno-62-14 href=#__codelineno-62-14></a><span class=w>  </span><span class=nt>priority</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">WARNING</span>
</span><span id=__span-62-15><a id=__codelineno-62-15 name=__codelineno-62-15 href=#__codelineno-62-15></a><span class=w>  </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>gcp</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>terraform</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>drift</span><span class="p p-Indicator">]</span>
</span></code></pre></div> <h3 id=regional-deployment>Regional Deployment<a class=headerlink href=#regional-deployment title="Permanent link">&para;</a></h3> <p>Deploy TFDrift-Falco per region:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-63-1><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=c1># config-us-central1.yaml</span>
</span><span id=__span-63-2><a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=nt>providers</span><span class=p>:</span>
</span><span id=__span-63-3><a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a><span class=w>  </span><span class=nt>gcp</span><span class=p>:</span>
</span><span id=__span-63-4><a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-63-5><a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a><span class=w>    </span><span class=nt>projects</span><span class=p>:</span>
</span><span id=__span-63-6><a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;my-project&quot;</span>
</span><span id=__span-63-7><a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span>
</span><span id=__span-63-8><a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;gcs&quot;</span>
</span><span id=__span-63-9><a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a><span class=w>      </span><span class=nt>gcs_bucket</span><span class=p>:</span><span class=w> </span><span class=s>&quot;tfdrift-state-us-central1&quot;</span>
</span><span id=__span-63-10><a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a><span class=w>      </span><span class=nt>gcs_prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;terraform.tfstate&quot;</span>
</span><span id=__span-63-11><a id=__codelineno-63-11 name=__codelineno-63-11 href=#__codelineno-63-11></a>
</span><span id=__span-63-12><a id=__codelineno-63-12 name=__codelineno-63-12 href=#__codelineno-63-12></a><span class=c1># Separate config for each region</span>
</span></code></pre></div> <h3 id=integration-with-siem>Integration with SIEM<a class=headerlink href=#integration-with-siem title="Permanent link">&para;</a></h3> <p>Send events to your SIEM:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-64-1><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=nt>notifications</span><span class=p>:</span>
</span><span id=__span-64-2><a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a><span class=w>  </span><span class=nt>webhook</span><span class=p>:</span>
</span><span id=__span-64-3><a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-64-4><a id=__codelineno-64-4 name=__codelineno-64-4 href=#__codelineno-64-4></a><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://splunk.example.com/services/collector&quot;</span>
</span><span id=__span-64-5><a id=__codelineno-64-5 name=__codelineno-64-5 href=#__codelineno-64-5></a><span class=w>    </span><span class=nt>headers</span><span class=p>:</span>
</span><span id=__span-64-6><a id=__codelineno-64-6 name=__codelineno-64-6 href=#__codelineno-64-6></a><span class=w>      </span><span class=nt>Authorization</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Splunk</span><span class=nv> </span><span class=s>YOUR_HEC_TOKEN&quot;</span>
</span><span id=__span-64-7><a id=__codelineno-64-7 name=__codelineno-64-7 href=#__codelineno-64-7></a><span class=w>      </span><span class=nt>Content-Type</span><span class=p>:</span><span class=w> </span><span class=s>&quot;application/json&quot;</span>
</span></code></pre></div> <hr> <h2 id=complete-examples>Complete Examples<a class=headerlink href=#complete-examples title="Permanent link">&para;</a></h2> <p>This section provides production-ready Terraform configurations with corresponding TFDrift-Falco setups.</p> <h3 id=example-1-basic-gce-instance-with-networking>Example 1: Basic GCE Instance with Networking<a class=headerlink href=#example-1-basic-gce-instance-with-networking title="Permanent link">&para;</a></h3> <p><strong>Scenario:</strong> Monitor a simple compute instance for configuration drift.</p> <p><strong>Terraform Configuration</strong> (<code>main.tf</code>): <div class="language-hcl highlight"><pre><span></span><code><span id=__span-65-1><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class=c1># Provider configuration</span>
</span><span id=__span-65-2><a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=nb>terraform</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-3><a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=w>  </span><span class=na>required_version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;&gt;= 1.0&quot;</span>
</span><span id=__span-65-4><a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a>
</span><span id=__span-65-5><a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a><span class=w>  </span><span class=nb>required_providers</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-6><a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a><span class=w>    </span><span class=nb>google</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-7><a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a><span class=w>      </span><span class=na>source</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;hashicorp/google&quot;</span>
</span><span id=__span-65-8><a id=__codelineno-65-8 name=__codelineno-65-8 href=#__codelineno-65-8></a><span class=w>      </span><span class=na>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;~&gt; 5.0&quot;</span>
</span><span id=__span-65-9><a id=__codelineno-65-9 name=__codelineno-65-9 href=#__codelineno-65-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-65-10><a id=__codelineno-65-10 name=__codelineno-65-10 href=#__codelineno-65-10></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-65-11><a id=__codelineno-65-11 name=__codelineno-65-11 href=#__codelineno-65-11></a>
</span><span id=__span-65-12><a id=__codelineno-65-12 name=__codelineno-65-12 href=#__codelineno-65-12></a><span class=w>  </span><span class=kr>backend</span><span class=w> </span><span class=nv>&quot;gcs&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-13><a id=__codelineno-65-13 name=__codelineno-65-13 href=#__codelineno-65-13></a><span class=w>    </span><span class=na>bucket</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;my-terraform-state&quot;</span>
</span><span id=__span-65-14><a id=__codelineno-65-14 name=__codelineno-65-14 href=#__codelineno-65-14></a><span class=w>    </span><span class=na>prefix</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod/compute&quot;</span>
</span><span id=__span-65-15><a id=__codelineno-65-15 name=__codelineno-65-15 href=#__codelineno-65-15></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-65-16><a id=__codelineno-65-16 name=__codelineno-65-16 href=#__codelineno-65-16></a><span class=p>}</span>
</span><span id=__span-65-17><a id=__codelineno-65-17 name=__codelineno-65-17 href=#__codelineno-65-17></a>
</span><span id=__span-65-18><a id=__codelineno-65-18 name=__codelineno-65-18 href=#__codelineno-65-18></a><span class=kr>provider</span><span class=w> </span><span class=nv>&quot;google&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-19><a id=__codelineno-65-19 name=__codelineno-65-19 href=#__codelineno-65-19></a><span class=w>  </span><span class=na>project</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span>
</span><span id=__span-65-20><a id=__codelineno-65-20 name=__codelineno-65-20 href=#__codelineno-65-20></a><span class=w>  </span><span class=na>region</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-65-21><a id=__codelineno-65-21 name=__codelineno-65-21 href=#__codelineno-65-21></a><span class=p>}</span>
</span><span id=__span-65-22><a id=__codelineno-65-22 name=__codelineno-65-22 href=#__codelineno-65-22></a>
</span><span id=__span-65-23><a id=__codelineno-65-23 name=__codelineno-65-23 href=#__codelineno-65-23></a><span class=c1># Variables</span>
</span><span id=__span-65-24><a id=__codelineno-65-24 name=__codelineno-65-24 href=#__codelineno-65-24></a><span class=kr>variable</span><span class=w> </span><span class=nv>&quot;project_id&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-25><a id=__codelineno-65-25 name=__codelineno-65-25 href=#__codelineno-65-25></a><span class=w>  </span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;GCP Project ID&quot;</span>
</span><span id=__span-65-26><a id=__codelineno-65-26 name=__codelineno-65-26 href=#__codelineno-65-26></a><span class=w>  </span><span class=na>type</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-65-27><a id=__codelineno-65-27 name=__codelineno-65-27 href=#__codelineno-65-27></a><span class=p>}</span>
</span><span id=__span-65-28><a id=__codelineno-65-28 name=__codelineno-65-28 href=#__codelineno-65-28></a>
</span><span id=__span-65-29><a id=__codelineno-65-29 name=__codelineno-65-29 href=#__codelineno-65-29></a><span class=kr>variable</span><span class=w> </span><span class=nv>&quot;region&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-30><a id=__codelineno-65-30 name=__codelineno-65-30 href=#__codelineno-65-30></a><span class=w>  </span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;GCP Region&quot;</span>
</span><span id=__span-65-31><a id=__codelineno-65-31 name=__codelineno-65-31 href=#__codelineno-65-31></a><span class=w>  </span><span class=na>type</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-65-32><a id=__codelineno-65-32 name=__codelineno-65-32 href=#__codelineno-65-32></a><span class=w>  </span><span class=na>default</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;us-central1&quot;</span>
</span><span id=__span-65-33><a id=__codelineno-65-33 name=__codelineno-65-33 href=#__codelineno-65-33></a><span class=p>}</span>
</span><span id=__span-65-34><a id=__codelineno-65-34 name=__codelineno-65-34 href=#__codelineno-65-34></a>
</span><span id=__span-65-35><a id=__codelineno-65-35 name=__codelineno-65-35 href=#__codelineno-65-35></a><span class=kr>variable</span><span class=w> </span><span class=nv>&quot;zone&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-36><a id=__codelineno-65-36 name=__codelineno-65-36 href=#__codelineno-65-36></a><span class=w>  </span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;GCP Zone&quot;</span>
</span><span id=__span-65-37><a id=__codelineno-65-37 name=__codelineno-65-37 href=#__codelineno-65-37></a><span class=w>  </span><span class=na>type</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-65-38><a id=__codelineno-65-38 name=__codelineno-65-38 href=#__codelineno-65-38></a><span class=w>  </span><span class=na>default</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;us-central1-a&quot;</span>
</span><span id=__span-65-39><a id=__codelineno-65-39 name=__codelineno-65-39 href=#__codelineno-65-39></a><span class=p>}</span>
</span><span id=__span-65-40><a id=__codelineno-65-40 name=__codelineno-65-40 href=#__codelineno-65-40></a>
</span><span id=__span-65-41><a id=__codelineno-65-41 name=__codelineno-65-41 href=#__codelineno-65-41></a><span class=c1># VPC Network</span>
</span><span id=__span-65-42><a id=__codelineno-65-42 name=__codelineno-65-42 href=#__codelineno-65-42></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_network&quot;</span><span class=w> </span><span class=nv>&quot;main&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-43><a id=__codelineno-65-43 name=__codelineno-65-43 href=#__codelineno-65-43></a><span class=w>  </span><span class=na>name</span><span class=w>                    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;tfdrift-demo-network&quot;</span>
</span><span id=__span-65-44><a id=__codelineno-65-44 name=__codelineno-65-44 href=#__codelineno-65-44></a><span class=w>  </span><span class=na>auto_create_subnetworks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
</span><span id=__span-65-45><a id=__codelineno-65-45 name=__codelineno-65-45 href=#__codelineno-65-45></a><span class=w>  </span><span class=na>description</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Network managed by Terraform&quot;</span>
</span><span id=__span-65-46><a id=__codelineno-65-46 name=__codelineno-65-46 href=#__codelineno-65-46></a><span class=p>}</span>
</span><span id=__span-65-47><a id=__codelineno-65-47 name=__codelineno-65-47 href=#__codelineno-65-47></a>
</span><span id=__span-65-48><a id=__codelineno-65-48 name=__codelineno-65-48 href=#__codelineno-65-48></a><span class=c1># Subnet</span>
</span><span id=__span-65-49><a id=__codelineno-65-49 name=__codelineno-65-49 href=#__codelineno-65-49></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_subnetwork&quot;</span><span class=w> </span><span class=nv>&quot;main&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-50><a id=__codelineno-65-50 name=__codelineno-65-50 href=#__codelineno-65-50></a><span class=w>  </span><span class=na>name</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;tfdrift-demo-subnet&quot;</span>
</span><span id=__span-65-51><a id=__codelineno-65-51 name=__codelineno-65-51 href=#__codelineno-65-51></a><span class=w>  </span><span class=na>ip_cidr_range</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;10.0.1.0/24&quot;</span>
</span><span id=__span-65-52><a id=__codelineno-65-52 name=__codelineno-65-52 href=#__codelineno-65-52></a><span class=w>  </span><span class=na>region</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-65-53><a id=__codelineno-65-53 name=__codelineno-65-53 href=#__codelineno-65-53></a><span class=w>  </span><span class=na>network</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_network.main.id</span>
</span><span id=__span-65-54><a id=__codelineno-65-54 name=__codelineno-65-54 href=#__codelineno-65-54></a>
</span><span id=__span-65-55><a id=__codelineno-65-55 name=__codelineno-65-55 href=#__codelineno-65-55></a><span class=w>  </span><span class=nb>log_config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-56><a id=__codelineno-65-56 name=__codelineno-65-56 href=#__codelineno-65-56></a><span class=w>    </span><span class=na>aggregation_interval</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;INTERVAL_5_SEC&quot;</span>
</span><span id=__span-65-57><a id=__codelineno-65-57 name=__codelineno-65-57 href=#__codelineno-65-57></a><span class=w>    </span><span class=na>flow_sampling</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=nv>0.5</span>
</span><span id=__span-65-58><a id=__codelineno-65-58 name=__codelineno-65-58 href=#__codelineno-65-58></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-65-59><a id=__codelineno-65-59 name=__codelineno-65-59 href=#__codelineno-65-59></a><span class=p>}</span>
</span><span id=__span-65-60><a id=__codelineno-65-60 name=__codelineno-65-60 href=#__codelineno-65-60></a>
</span><span id=__span-65-61><a id=__codelineno-65-61 name=__codelineno-65-61 href=#__codelineno-65-61></a><span class=c1># Firewall - Allow SSH</span>
</span><span id=__span-65-62><a id=__codelineno-65-62 name=__codelineno-65-62 href=#__codelineno-65-62></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_firewall&quot;</span><span class=w> </span><span class=nv>&quot;allow_ssh&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-63><a id=__codelineno-65-63 name=__codelineno-65-63 href=#__codelineno-65-63></a><span class=w>  </span><span class=na>name</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;tfdrift-demo-allow-ssh&quot;</span>
</span><span id=__span-65-64><a id=__codelineno-65-64 name=__codelineno-65-64 href=#__codelineno-65-64></a><span class=w>  </span><span class=na>network</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_network.main.name</span>
</span><span id=__span-65-65><a id=__codelineno-65-65 name=__codelineno-65-65 href=#__codelineno-65-65></a>
</span><span id=__span-65-66><a id=__codelineno-65-66 name=__codelineno-65-66 href=#__codelineno-65-66></a><span class=w>  </span><span class=nb>allow</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-67><a id=__codelineno-65-67 name=__codelineno-65-67 href=#__codelineno-65-67></a><span class=w>    </span><span class=na>protocol</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;tcp&quot;</span>
</span><span id=__span-65-68><a id=__codelineno-65-68 name=__codelineno-65-68 href=#__codelineno-65-68></a><span class=w>    </span><span class=na>ports</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;22&quot;</span><span class=p>]</span>
</span><span id=__span-65-69><a id=__codelineno-65-69 name=__codelineno-65-69 href=#__codelineno-65-69></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-65-70><a id=__codelineno-65-70 name=__codelineno-65-70 href=#__codelineno-65-70></a>
</span><span id=__span-65-71><a id=__codelineno-65-71 name=__codelineno-65-71 href=#__codelineno-65-71></a><span class=w>  </span><span class=na>source_ranges</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;35.235.240.0/20&quot;</span><span class=p>]</span><span class=c1>  # IAP ranges</span>
</span><span id=__span-65-72><a id=__codelineno-65-72 name=__codelineno-65-72 href=#__codelineno-65-72></a><span class=w>  </span><span class=na>target_tags</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;ssh-enabled&quot;</span><span class=p>]</span>
</span><span id=__span-65-73><a id=__codelineno-65-73 name=__codelineno-65-73 href=#__codelineno-65-73></a>
</span><span id=__span-65-74><a id=__codelineno-65-74 name=__codelineno-65-74 href=#__codelineno-65-74></a><span class=w>  </span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Allow SSH via IAP&quot;</span>
</span><span id=__span-65-75><a id=__codelineno-65-75 name=__codelineno-65-75 href=#__codelineno-65-75></a><span class=p>}</span>
</span><span id=__span-65-76><a id=__codelineno-65-76 name=__codelineno-65-76 href=#__codelineno-65-76></a>
</span><span id=__span-65-77><a id=__codelineno-65-77 name=__codelineno-65-77 href=#__codelineno-65-77></a><span class=c1># Compute Instance</span>
</span><span id=__span-65-78><a id=__codelineno-65-78 name=__codelineno-65-78 href=#__codelineno-65-78></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_instance&quot;</span><span class=w> </span><span class=nv>&quot;web&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-79><a id=__codelineno-65-79 name=__codelineno-65-79 href=#__codelineno-65-79></a><span class=w>  </span><span class=na>name</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;tfdrift-demo-web-server&quot;</span>
</span><span id=__span-65-80><a id=__codelineno-65-80 name=__codelineno-65-80 href=#__codelineno-65-80></a><span class=w>  </span><span class=na>machine_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;e2-medium&quot;</span>
</span><span id=__span-65-81><a id=__codelineno-65-81 name=__codelineno-65-81 href=#__codelineno-65-81></a><span class=w>  </span><span class=na>zone</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=nv>var.zone</span>
</span><span id=__span-65-82><a id=__codelineno-65-82 name=__codelineno-65-82 href=#__codelineno-65-82></a>
</span><span id=__span-65-83><a id=__codelineno-65-83 name=__codelineno-65-83 href=#__codelineno-65-83></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;ssh-enabled&quot;, &quot;web-server&quot;</span><span class=p>]</span>
</span><span id=__span-65-84><a id=__codelineno-65-84 name=__codelineno-65-84 href=#__codelineno-65-84></a>
</span><span id=__span-65-85><a id=__codelineno-65-85 name=__codelineno-65-85 href=#__codelineno-65-85></a><span class=w>  </span><span class=nb>labels</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-86><a id=__codelineno-65-86 name=__codelineno-65-86 href=#__codelineno-65-86></a><span class=w>    </span><span class=na>environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;production&quot;</span>
</span><span id=__span-65-87><a id=__codelineno-65-87 name=__codelineno-65-87 href=#__codelineno-65-87></a><span class=w>    </span><span class=na>managed_by</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;terraform&quot;</span>
</span><span id=__span-65-88><a id=__codelineno-65-88 name=__codelineno-65-88 href=#__codelineno-65-88></a><span class=w>    </span><span class=na>app</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;web&quot;</span>
</span><span id=__span-65-89><a id=__codelineno-65-89 name=__codelineno-65-89 href=#__codelineno-65-89></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-65-90><a id=__codelineno-65-90 name=__codelineno-65-90 href=#__codelineno-65-90></a>
</span><span id=__span-65-91><a id=__codelineno-65-91 name=__codelineno-65-91 href=#__codelineno-65-91></a><span class=w>  </span><span class=nb>boot_disk</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-92><a id=__codelineno-65-92 name=__codelineno-65-92 href=#__codelineno-65-92></a><span class=w>    </span><span class=nb>initialize_params</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-93><a id=__codelineno-65-93 name=__codelineno-65-93 href=#__codelineno-65-93></a><span class=w>      </span><span class=na>image</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;debian-cloud/debian-11&quot;</span>
</span><span id=__span-65-94><a id=__codelineno-65-94 name=__codelineno-65-94 href=#__codelineno-65-94></a><span class=w>      </span><span class=na>size</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>20</span>
</span><span id=__span-65-95><a id=__codelineno-65-95 name=__codelineno-65-95 href=#__codelineno-65-95></a><span class=w>      </span><span class=na>type</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;pd-standard&quot;</span>
</span><span id=__span-65-96><a id=__codelineno-65-96 name=__codelineno-65-96 href=#__codelineno-65-96></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-65-97><a id=__codelineno-65-97 name=__codelineno-65-97 href=#__codelineno-65-97></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-65-98><a id=__codelineno-65-98 name=__codelineno-65-98 href=#__codelineno-65-98></a>
</span><span id=__span-65-99><a id=__codelineno-65-99 name=__codelineno-65-99 href=#__codelineno-65-99></a><span class=w>  </span><span class=nb>network_interface</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-100><a id=__codelineno-65-100 name=__codelineno-65-100 href=#__codelineno-65-100></a><span class=w>    </span><span class=na>subnetwork</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_subnetwork.main.id</span>
</span><span id=__span-65-101><a id=__codelineno-65-101 name=__codelineno-65-101 href=#__codelineno-65-101></a>
</span><span id=__span-65-102><a id=__codelineno-65-102 name=__codelineno-65-102 href=#__codelineno-65-102></a><span class=w>    </span><span class=nb>access_config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-103><a id=__codelineno-65-103 name=__codelineno-65-103 href=#__codelineno-65-103></a><span class=c1>      // Ephemeral public IP</span>
</span><span id=__span-65-104><a id=__codelineno-65-104 name=__codelineno-65-104 href=#__codelineno-65-104></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-65-105><a id=__codelineno-65-105 name=__codelineno-65-105 href=#__codelineno-65-105></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-65-106><a id=__codelineno-65-106 name=__codelineno-65-106 href=#__codelineno-65-106></a>
</span><span id=__span-65-107><a id=__codelineno-65-107 name=__codelineno-65-107 href=#__codelineno-65-107></a><span class=w>  </span><span class=nb>metadata</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-108><a id=__codelineno-65-108 name=__codelineno-65-108 href=#__codelineno-65-108></a><span class=w>    </span><span class=na>enable-oslogin</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;TRUE&quot;</span>
</span><span id=__span-65-109><a id=__codelineno-65-109 name=__codelineno-65-109 href=#__codelineno-65-109></a><span class=w>    </span><span class=na>startup-script</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&lt;&lt;-</span><span class=dl>EOF</span>
</span><span id=__span-65-110><a id=__codelineno-65-110 name=__codelineno-65-110 href=#__codelineno-65-110></a><span class=sh>      #!/bin/bash</span>
</span><span id=__span-65-111><a id=__codelineno-65-111 name=__codelineno-65-111 href=#__codelineno-65-111></a><span class=sh>      apt-get update</span>
</span><span id=__span-65-112><a id=__codelineno-65-112 name=__codelineno-65-112 href=#__codelineno-65-112></a><span class=sh>      apt-get install -y nginx</span>
</span><span id=__span-65-113><a id=__codelineno-65-113 name=__codelineno-65-113 href=#__codelineno-65-113></a><span class=sh>      systemctl start nginx</span>
</span><span id=__span-65-114><a id=__codelineno-65-114 name=__codelineno-65-114 href=#__codelineno-65-114></a><span class=sh>      systemctl enable nginx</span>
</span><span id=__span-65-115><a id=__codelineno-65-115 name=__codelineno-65-115 href=#__codelineno-65-115></a><span class=dl>    EOF</span>
</span><span id=__span-65-116><a id=__codelineno-65-116 name=__codelineno-65-116 href=#__codelineno-65-116></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-65-117><a id=__codelineno-65-117 name=__codelineno-65-117 href=#__codelineno-65-117></a>
</span><span id=__span-65-118><a id=__codelineno-65-118 name=__codelineno-65-118 href=#__codelineno-65-118></a><span class=w>  </span><span class=nb>service_account</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-119><a id=__codelineno-65-119 name=__codelineno-65-119 href=#__codelineno-65-119></a><span class=w>    </span><span class=na>email</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>google_service_account.instance_sa.email</span>
</span><span id=__span-65-120><a id=__codelineno-65-120 name=__codelineno-65-120 href=#__codelineno-65-120></a><span class=w>    </span><span class=na>scopes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;cloud-platform&quot;</span><span class=p>]</span>
</span><span id=__span-65-121><a id=__codelineno-65-121 name=__codelineno-65-121 href=#__codelineno-65-121></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-65-122><a id=__codelineno-65-122 name=__codelineno-65-122 href=#__codelineno-65-122></a>
</span><span id=__span-65-123><a id=__codelineno-65-123 name=__codelineno-65-123 href=#__codelineno-65-123></a><span class=w>  </span><span class=nb>scheduling</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-124><a id=__codelineno-65-124 name=__codelineno-65-124 href=#__codelineno-65-124></a><span class=w>    </span><span class=na>automatic_restart</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-65-125><a id=__codelineno-65-125 name=__codelineno-65-125 href=#__codelineno-65-125></a><span class=w>    </span><span class=na>on_host_maintenance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;MIGRATE&quot;</span>
</span><span id=__span-65-126><a id=__codelineno-65-126 name=__codelineno-65-126 href=#__codelineno-65-126></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-65-127><a id=__codelineno-65-127 name=__codelineno-65-127 href=#__codelineno-65-127></a><span class=p>}</span>
</span><span id=__span-65-128><a id=__codelineno-65-128 name=__codelineno-65-128 href=#__codelineno-65-128></a>
</span><span id=__span-65-129><a id=__codelineno-65-129 name=__codelineno-65-129 href=#__codelineno-65-129></a><span class=c1># Service Account for Instance</span>
</span><span id=__span-65-130><a id=__codelineno-65-130 name=__codelineno-65-130 href=#__codelineno-65-130></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_service_account&quot;</span><span class=w> </span><span class=nv>&quot;instance_sa&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-131><a id=__codelineno-65-131 name=__codelineno-65-131 href=#__codelineno-65-131></a><span class=w>  </span><span class=na>account_id</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;tfdrift-demo-instance-sa&quot;</span>
</span><span id=__span-65-132><a id=__codelineno-65-132 name=__codelineno-65-132 href=#__codelineno-65-132></a><span class=w>  </span><span class=na>display_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;TFDrift Demo Instance Service Account&quot;</span>
</span><span id=__span-65-133><a id=__codelineno-65-133 name=__codelineno-65-133 href=#__codelineno-65-133></a><span class=w>  </span><span class=na>description</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Service account for demo web server&quot;</span>
</span><span id=__span-65-134><a id=__codelineno-65-134 name=__codelineno-65-134 href=#__codelineno-65-134></a><span class=p>}</span>
</span><span id=__span-65-135><a id=__codelineno-65-135 name=__codelineno-65-135 href=#__codelineno-65-135></a>
</span><span id=__span-65-136><a id=__codelineno-65-136 name=__codelineno-65-136 href=#__codelineno-65-136></a><span class=c1># Outputs</span>
</span><span id=__span-65-137><a id=__codelineno-65-137 name=__codelineno-65-137 href=#__codelineno-65-137></a><span class=kr>output</span><span class=w> </span><span class=nv>&quot;instance_name&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-138><a id=__codelineno-65-138 name=__codelineno-65-138 href=#__codelineno-65-138></a><span class=w>  </span><span class=na>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_instance.web.name</span>
</span><span id=__span-65-139><a id=__codelineno-65-139 name=__codelineno-65-139 href=#__codelineno-65-139></a><span class=p>}</span>
</span><span id=__span-65-140><a id=__codelineno-65-140 name=__codelineno-65-140 href=#__codelineno-65-140></a>
</span><span id=__span-65-141><a id=__codelineno-65-141 name=__codelineno-65-141 href=#__codelineno-65-141></a><span class=kr>output</span><span class=w> </span><span class=nv>&quot;instance_external_ip&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-142><a id=__codelineno-65-142 name=__codelineno-65-142 href=#__codelineno-65-142></a><span class=w>  </span><span class=na>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_instance.web.network_interface[0].access_config[0].nat_ip</span>
</span><span id=__span-65-143><a id=__codelineno-65-143 name=__codelineno-65-143 href=#__codelineno-65-143></a><span class=p>}</span>
</span><span id=__span-65-144><a id=__codelineno-65-144 name=__codelineno-65-144 href=#__codelineno-65-144></a>
</span><span id=__span-65-145><a id=__codelineno-65-145 name=__codelineno-65-145 href=#__codelineno-65-145></a><span class=kr>output</span><span class=w> </span><span class=nv>&quot;network_name&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-146><a id=__codelineno-65-146 name=__codelineno-65-146 href=#__codelineno-65-146></a><span class=w>  </span><span class=na>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_network.main.name</span>
</span><span id=__span-65-147><a id=__codelineno-65-147 name=__codelineno-65-147 href=#__codelineno-65-147></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>TFDrift-Falco Configuration</strong> (<code>config-demo.yaml</code>): <div class="language-yaml highlight"><pre><span></span><code><span id=__span-66-1><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=nt>providers</span><span class=p>:</span>
</span><span id=__span-66-2><a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a><span class=w>  </span><span class=nt>gcp</span><span class=p>:</span>
</span><span id=__span-66-3><a id=__codelineno-66-3 name=__codelineno-66-3 href=#__codelineno-66-3></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-66-4><a id=__codelineno-66-4 name=__codelineno-66-4 href=#__codelineno-66-4></a><span class=w>    </span><span class=nt>projects</span><span class=p>:</span>
</span><span id=__span-66-5><a id=__codelineno-66-5 name=__codelineno-66-5 href=#__codelineno-66-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;my-project-123&quot;</span>
</span><span id=__span-66-6><a id=__codelineno-66-6 name=__codelineno-66-6 href=#__codelineno-66-6></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span>
</span><span id=__span-66-7><a id=__codelineno-66-7 name=__codelineno-66-7 href=#__codelineno-66-7></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;gcs&quot;</span>
</span><span id=__span-66-8><a id=__codelineno-66-8 name=__codelineno-66-8 href=#__codelineno-66-8></a><span class=w>      </span><span class=nt>gcs_bucket</span><span class=p>:</span><span class=w> </span><span class=s>&quot;my-terraform-state&quot;</span>
</span><span id=__span-66-9><a id=__codelineno-66-9 name=__codelineno-66-9 href=#__codelineno-66-9></a><span class=w>      </span><span class=nt>gcs_prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;prod/compute/terraform.tfstate&quot;</span>
</span><span id=__span-66-10><a id=__codelineno-66-10 name=__codelineno-66-10 href=#__codelineno-66-10></a>
</span><span id=__span-66-11><a id=__codelineno-66-11 name=__codelineno-66-11 href=#__codelineno-66-11></a><span class=nt>falco</span><span class=p>:</span>
</span><span id=__span-66-12><a id=__codelineno-66-12 name=__codelineno-66-12 href=#__codelineno-66-12></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-66-13><a id=__codelineno-66-13 name=__codelineno-66-13 href=#__codelineno-66-13></a><span class=w>  </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=s>&quot;localhost&quot;</span>
</span><span id=__span-66-14><a id=__codelineno-66-14 name=__codelineno-66-14 href=#__codelineno-66-14></a><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5060</span>
</span><span id=__span-66-15><a id=__codelineno-66-15 name=__codelineno-66-15 href=#__codelineno-66-15></a><span class=w>  </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-66-16><a id=__codelineno-66-16 name=__codelineno-66-16 href=#__codelineno-66-16></a>
</span><span id=__span-66-17><a id=__codelineno-66-17 name=__codelineno-66-17 href=#__codelineno-66-17></a><span class=nt>drift_rules</span><span class=p>:</span>
</span><span id=__span-66-18><a id=__codelineno-66-18 name=__codelineno-66-18 href=#__codelineno-66-18></a><span class=w>  </span><span class=c1># Monitor instance configuration changes</span>
</span><span id=__span-66-19><a id=__codelineno-66-19 name=__codelineno-66-19 href=#__codelineno-66-19></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;GCE</span><span class=nv> </span><span class=s>Instance</span><span class=nv> </span><span class=s>Configuration</span><span class=nv> </span><span class=s>Drift&quot;</span>
</span><span id=__span-66-20><a id=__codelineno-66-20 name=__codelineno-66-20 href=#__codelineno-66-20></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-66-21><a id=__codelineno-66-21 name=__codelineno-66-21 href=#__codelineno-66-21></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_instance&quot;</span>
</span><span id=__span-66-22><a id=__codelineno-66-22 name=__codelineno-66-22 href=#__codelineno-66-22></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-66-23><a id=__codelineno-66-23 name=__codelineno-66-23 href=#__codelineno-66-23></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;metadata&quot;</span>
</span><span id=__span-66-24><a id=__codelineno-66-24 name=__codelineno-66-24 href=#__codelineno-66-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;labels&quot;</span>
</span><span id=__span-66-25><a id=__codelineno-66-25 name=__codelineno-66-25 href=#__codelineno-66-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;tags&quot;</span>
</span><span id=__span-66-26><a id=__codelineno-66-26 name=__codelineno-66-26 href=#__codelineno-66-26></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;machine_type&quot;</span>
</span><span id=__span-66-27><a id=__codelineno-66-27 name=__codelineno-66-27 href=#__codelineno-66-27></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;high&quot;</span>
</span><span id=__span-66-28><a id=__codelineno-66-28 name=__codelineno-66-28 href=#__codelineno-66-28></a>
</span><span id=__span-66-29><a id=__codelineno-66-29 name=__codelineno-66-29 href=#__codelineno-66-29></a><span class=w>  </span><span class=c1># Critical: Monitor firewall rules</span>
</span><span id=__span-66-30><a id=__codelineno-66-30 name=__codelineno-66-30 href=#__codelineno-66-30></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Firewall</span><span class=nv> </span><span class=s>Rule</span><span class=nv> </span><span class=s>Modification&quot;</span>
</span><span id=__span-66-31><a id=__codelineno-66-31 name=__codelineno-66-31 href=#__codelineno-66-31></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-66-32><a id=__codelineno-66-32 name=__codelineno-66-32 href=#__codelineno-66-32></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_firewall&quot;</span>
</span><span id=__span-66-33><a id=__codelineno-66-33 name=__codelineno-66-33 href=#__codelineno-66-33></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-66-34><a id=__codelineno-66-34 name=__codelineno-66-34 href=#__codelineno-66-34></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;allow&quot;</span>
</span><span id=__span-66-35><a id=__codelineno-66-35 name=__codelineno-66-35 href=#__codelineno-66-35></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;deny&quot;</span>
</span><span id=__span-66-36><a id=__codelineno-66-36 name=__codelineno-66-36 href=#__codelineno-66-36></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;source_ranges&quot;</span>
</span><span id=__span-66-37><a id=__codelineno-66-37 name=__codelineno-66-37 href=#__codelineno-66-37></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;target_tags&quot;</span>
</span><span id=__span-66-38><a id=__codelineno-66-38 name=__codelineno-66-38 href=#__codelineno-66-38></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span>
</span><span id=__span-66-39><a id=__codelineno-66-39 name=__codelineno-66-39 href=#__codelineno-66-39></a>
</span><span id=__span-66-40><a id=__codelineno-66-40 name=__codelineno-66-40 href=#__codelineno-66-40></a><span class=w>  </span><span class=c1># Monitor network changes</span>
</span><span id=__span-66-41><a id=__codelineno-66-41 name=__codelineno-66-41 href=#__codelineno-66-41></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Network</span><span class=nv> </span><span class=s>Configuration</span><span class=nv> </span><span class=s>Change&quot;</span>
</span><span id=__span-66-42><a id=__codelineno-66-42 name=__codelineno-66-42 href=#__codelineno-66-42></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-66-43><a id=__codelineno-66-43 name=__codelineno-66-43 href=#__codelineno-66-43></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_network&quot;</span>
</span><span id=__span-66-44><a id=__codelineno-66-44 name=__codelineno-66-44 href=#__codelineno-66-44></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_subnetwork&quot;</span>
</span><span id=__span-66-45><a id=__codelineno-66-45 name=__codelineno-66-45 href=#__codelineno-66-45></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-66-46><a id=__codelineno-66-46 name=__codelineno-66-46 href=#__codelineno-66-46></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;auto_create_subnetworks&quot;</span>
</span><span id=__span-66-47><a id=__codelineno-66-47 name=__codelineno-66-47 href=#__codelineno-66-47></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;ip_cidr_range&quot;</span>
</span><span id=__span-66-48><a id=__codelineno-66-48 name=__codelineno-66-48 href=#__codelineno-66-48></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;high&quot;</span>
</span><span id=__span-66-49><a id=__codelineno-66-49 name=__codelineno-66-49 href=#__codelineno-66-49></a>
</span><span id=__span-66-50><a id=__codelineno-66-50 name=__codelineno-66-50 href=#__codelineno-66-50></a><span class=nt>notifications</span><span class=p>:</span>
</span><span id=__span-66-51><a id=__codelineno-66-51 name=__codelineno-66-51 href=#__codelineno-66-51></a><span class=w>  </span><span class=nt>slack</span><span class=p>:</span>
</span><span id=__span-66-52><a id=__codelineno-66-52 name=__codelineno-66-52 href=#__codelineno-66-52></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-66-53><a id=__codelineno-66-53 name=__codelineno-66-53 href=#__codelineno-66-53></a><span class=w>    </span><span class=nt>webhook_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://hooks.slack.com/services/YOUR/WEBHOOK/URL&quot;</span>
</span><span id=__span-66-54><a id=__codelineno-66-54 name=__codelineno-66-54 href=#__codelineno-66-54></a>
</span><span id=__span-66-55><a id=__codelineno-66-55 name=__codelineno-66-55 href=#__codelineno-66-55></a><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-66-56><a id=__codelineno-66-56 name=__codelineno-66-56 href=#__codelineno-66-56></a><span class=w>  </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=s>&quot;info&quot;</span>
</span><span id=__span-66-57><a id=__codelineno-66-57 name=__codelineno-66-57 href=#__codelineno-66-57></a><span class=w>  </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=s>&quot;text&quot;</span>
</span></code></pre></div></p> <p><strong>Deployment Steps:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-67-1><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=c1># 1. Apply Terraform configuration</span>
</span><span id=__span-67-2><a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a>terraform<span class=w> </span>init
</span><span id=__span-67-3><a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a>terraform<span class=w> </span>apply<span class=w> </span>-var<span class=o>=</span><span class=s2>&quot;project_id=my-project-123&quot;</span>
</span><span id=__span-67-4><a id=__codelineno-67-4 name=__codelineno-67-4 href=#__codelineno-67-4></a>
</span><span id=__span-67-5><a id=__codelineno-67-5 name=__codelineno-67-5 href=#__codelineno-67-5></a><span class=c1># 2. Start TFDrift-Falco</span>
</span><span id=__span-67-6><a id=__codelineno-67-6 name=__codelineno-67-6 href=#__codelineno-67-6></a>tfdrift<span class=w> </span>--config<span class=w> </span>config-demo.yaml
</span><span id=__span-67-7><a id=__codelineno-67-7 name=__codelineno-67-7 href=#__codelineno-67-7></a>
</span><span id=__span-67-8><a id=__codelineno-67-8 name=__codelineno-67-8 href=#__codelineno-67-8></a><span class=c1># 3. Trigger drift by making manual changes</span>
</span><span id=__span-67-9><a id=__codelineno-67-9 name=__codelineno-67-9 href=#__codelineno-67-9></a>gcloud<span class=w> </span>compute<span class=w> </span>instances<span class=w> </span>add-labels<span class=w> </span>tfdrift-demo-web-server<span class=w> </span><span class=se>\</span>
</span><span id=__span-67-10><a id=__codelineno-67-10 name=__codelineno-67-10 href=#__codelineno-67-10></a><span class=w>  </span>--zone<span class=o>=</span>us-central1-a<span class=w> </span><span class=se>\</span>
</span><span id=__span-67-11><a id=__codelineno-67-11 name=__codelineno-67-11 href=#__codelineno-67-11></a><span class=w>  </span>--labels<span class=o>=</span><span class=nv>manual_change</span><span class=o>=</span><span class=nb>true</span>
</span><span id=__span-67-12><a id=__codelineno-67-12 name=__codelineno-67-12 href=#__codelineno-67-12></a>
</span><span id=__span-67-13><a id=__codelineno-67-13 name=__codelineno-67-13 href=#__codelineno-67-13></a><span class=c1># Expected: Drift alert in Slack within 30-60 seconds</span>
</span></code></pre></div></p> <hr> <h3 id=example-2-multi-tier-web-application>Example 2: Multi-Tier Web Application<a class=headerlink href=#example-2-multi-tier-web-application title="Permanent link">&para;</a></h3> <p><strong>Scenario:</strong> Complete web application with load balancer, managed instance group, and Cloud SQL.</p> <p><strong>Terraform Configuration</strong> (<code>main.tf</code>): <div class="language-hcl highlight"><pre><span></span><code><span id=__span-68-1><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=nb>terraform</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-2><a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a><span class=w>  </span><span class=na>required_version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;&gt;= 1.0&quot;</span>
</span><span id=__span-68-3><a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a>
</span><span id=__span-68-4><a id=__codelineno-68-4 name=__codelineno-68-4 href=#__codelineno-68-4></a><span class=w>  </span><span class=kr>backend</span><span class=w> </span><span class=nv>&quot;gcs&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-5><a id=__codelineno-68-5 name=__codelineno-68-5 href=#__codelineno-68-5></a><span class=w>    </span><span class=na>bucket</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;my-terraform-state&quot;</span>
</span><span id=__span-68-6><a id=__codelineno-68-6 name=__codelineno-68-6 href=#__codelineno-68-6></a><span class=w>    </span><span class=na>prefix</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod/webapp&quot;</span>
</span><span id=__span-68-7><a id=__codelineno-68-7 name=__codelineno-68-7 href=#__codelineno-68-7></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-8><a id=__codelineno-68-8 name=__codelineno-68-8 href=#__codelineno-68-8></a><span class=p>}</span>
</span><span id=__span-68-9><a id=__codelineno-68-9 name=__codelineno-68-9 href=#__codelineno-68-9></a>
</span><span id=__span-68-10><a id=__codelineno-68-10 name=__codelineno-68-10 href=#__codelineno-68-10></a><span class=kr>provider</span><span class=w> </span><span class=nv>&quot;google&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-11><a id=__codelineno-68-11 name=__codelineno-68-11 href=#__codelineno-68-11></a><span class=w>  </span><span class=na>project</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span>
</span><span id=__span-68-12><a id=__codelineno-68-12 name=__codelineno-68-12 href=#__codelineno-68-12></a><span class=w>  </span><span class=na>region</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-68-13><a id=__codelineno-68-13 name=__codelineno-68-13 href=#__codelineno-68-13></a><span class=p>}</span>
</span><span id=__span-68-14><a id=__codelineno-68-14 name=__codelineno-68-14 href=#__codelineno-68-14></a>
</span><span id=__span-68-15><a id=__codelineno-68-15 name=__codelineno-68-15 href=#__codelineno-68-15></a><span class=kr>variable</span><span class=w> </span><span class=nv>&quot;project_id&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-16><a id=__codelineno-68-16 name=__codelineno-68-16 href=#__codelineno-68-16></a><span class=w>  </span><span class=na>type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-68-17><a id=__codelineno-68-17 name=__codelineno-68-17 href=#__codelineno-68-17></a><span class=p>}</span>
</span><span id=__span-68-18><a id=__codelineno-68-18 name=__codelineno-68-18 href=#__codelineno-68-18></a>
</span><span id=__span-68-19><a id=__codelineno-68-19 name=__codelineno-68-19 href=#__codelineno-68-19></a><span class=kr>variable</span><span class=w> </span><span class=nv>&quot;region&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-20><a id=__codelineno-68-20 name=__codelineno-68-20 href=#__codelineno-68-20></a><span class=w>  </span><span class=na>type</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-68-21><a id=__codelineno-68-21 name=__codelineno-68-21 href=#__codelineno-68-21></a><span class=w>  </span><span class=na>default</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;us-central1&quot;</span>
</span><span id=__span-68-22><a id=__codelineno-68-22 name=__codelineno-68-22 href=#__codelineno-68-22></a><span class=p>}</span>
</span><span id=__span-68-23><a id=__codelineno-68-23 name=__codelineno-68-23 href=#__codelineno-68-23></a>
</span><span id=__span-68-24><a id=__codelineno-68-24 name=__codelineno-68-24 href=#__codelineno-68-24></a><span class=c1># Network</span>
</span><span id=__span-68-25><a id=__codelineno-68-25 name=__codelineno-68-25 href=#__codelineno-68-25></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_network&quot;</span><span class=w> </span><span class=nv>&quot;webapp&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-26><a id=__codelineno-68-26 name=__codelineno-68-26 href=#__codelineno-68-26></a><span class=w>  </span><span class=na>name</span><span class=w>                    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp-network&quot;</span>
</span><span id=__span-68-27><a id=__codelineno-68-27 name=__codelineno-68-27 href=#__codelineno-68-27></a><span class=w>  </span><span class=na>auto_create_subnetworks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
</span><span id=__span-68-28><a id=__codelineno-68-28 name=__codelineno-68-28 href=#__codelineno-68-28></a><span class=p>}</span>
</span><span id=__span-68-29><a id=__codelineno-68-29 name=__codelineno-68-29 href=#__codelineno-68-29></a>
</span><span id=__span-68-30><a id=__codelineno-68-30 name=__codelineno-68-30 href=#__codelineno-68-30></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_subnetwork&quot;</span><span class=w> </span><span class=nv>&quot;webapp&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-31><a id=__codelineno-68-31 name=__codelineno-68-31 href=#__codelineno-68-31></a><span class=w>  </span><span class=na>name</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp-subnet&quot;</span>
</span><span id=__span-68-32><a id=__codelineno-68-32 name=__codelineno-68-32 href=#__codelineno-68-32></a><span class=w>  </span><span class=na>ip_cidr_range</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;10.0.0.0/24&quot;</span>
</span><span id=__span-68-33><a id=__codelineno-68-33 name=__codelineno-68-33 href=#__codelineno-68-33></a><span class=w>  </span><span class=na>region</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-68-34><a id=__codelineno-68-34 name=__codelineno-68-34 href=#__codelineno-68-34></a><span class=w>  </span><span class=na>network</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_network.webapp.id</span>
</span><span id=__span-68-35><a id=__codelineno-68-35 name=__codelineno-68-35 href=#__codelineno-68-35></a><span class=p>}</span>
</span><span id=__span-68-36><a id=__codelineno-68-36 name=__codelineno-68-36 href=#__codelineno-68-36></a>
</span><span id=__span-68-37><a id=__codelineno-68-37 name=__codelineno-68-37 href=#__codelineno-68-37></a><span class=c1># Firewall Rules</span>
</span><span id=__span-68-38><a id=__codelineno-68-38 name=__codelineno-68-38 href=#__codelineno-68-38></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_firewall&quot;</span><span class=w> </span><span class=nv>&quot;allow_lb&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-39><a id=__codelineno-68-39 name=__codelineno-68-39 href=#__codelineno-68-39></a><span class=w>  </span><span class=na>name</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp-allow-lb&quot;</span>
</span><span id=__span-68-40><a id=__codelineno-68-40 name=__codelineno-68-40 href=#__codelineno-68-40></a><span class=w>  </span><span class=na>network</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_network.webapp.name</span>
</span><span id=__span-68-41><a id=__codelineno-68-41 name=__codelineno-68-41 href=#__codelineno-68-41></a>
</span><span id=__span-68-42><a id=__codelineno-68-42 name=__codelineno-68-42 href=#__codelineno-68-42></a><span class=w>  </span><span class=nb>allow</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-43><a id=__codelineno-68-43 name=__codelineno-68-43 href=#__codelineno-68-43></a><span class=w>    </span><span class=na>protocol</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;tcp&quot;</span>
</span><span id=__span-68-44><a id=__codelineno-68-44 name=__codelineno-68-44 href=#__codelineno-68-44></a><span class=w>    </span><span class=na>ports</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;80&quot;, &quot;443&quot;</span><span class=p>]</span>
</span><span id=__span-68-45><a id=__codelineno-68-45 name=__codelineno-68-45 href=#__codelineno-68-45></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-46><a id=__codelineno-68-46 name=__codelineno-68-46 href=#__codelineno-68-46></a>
</span><span id=__span-68-47><a id=__codelineno-68-47 name=__codelineno-68-47 href=#__codelineno-68-47></a><span class=w>  </span><span class=na>source_ranges</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;130.211.0.0/22&quot;, &quot;35.191.0.0/16&quot;</span><span class=p>]</span>
</span><span id=__span-68-48><a id=__codelineno-68-48 name=__codelineno-68-48 href=#__codelineno-68-48></a><span class=w>  </span><span class=na>target_tags</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;web-backend&quot;</span><span class=p>]</span>
</span><span id=__span-68-49><a id=__codelineno-68-49 name=__codelineno-68-49 href=#__codelineno-68-49></a><span class=p>}</span>
</span><span id=__span-68-50><a id=__codelineno-68-50 name=__codelineno-68-50 href=#__codelineno-68-50></a>
</span><span id=__span-68-51><a id=__codelineno-68-51 name=__codelineno-68-51 href=#__codelineno-68-51></a><span class=c1># Instance Template</span>
</span><span id=__span-68-52><a id=__codelineno-68-52 name=__codelineno-68-52 href=#__codelineno-68-52></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_instance_template&quot;</span><span class=w> </span><span class=nv>&quot;webapp&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-53><a id=__codelineno-68-53 name=__codelineno-68-53 href=#__codelineno-68-53></a><span class=w>  </span><span class=na>name_prefix</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp-template-&quot;</span>
</span><span id=__span-68-54><a id=__codelineno-68-54 name=__codelineno-68-54 href=#__codelineno-68-54></a><span class=w>  </span><span class=na>machine_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;e2-medium&quot;</span>
</span><span id=__span-68-55><a id=__codelineno-68-55 name=__codelineno-68-55 href=#__codelineno-68-55></a>
</span><span id=__span-68-56><a id=__codelineno-68-56 name=__codelineno-68-56 href=#__codelineno-68-56></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;web-backend&quot;</span><span class=p>]</span>
</span><span id=__span-68-57><a id=__codelineno-68-57 name=__codelineno-68-57 href=#__codelineno-68-57></a>
</span><span id=__span-68-58><a id=__codelineno-68-58 name=__codelineno-68-58 href=#__codelineno-68-58></a><span class=w>  </span><span class=nb>labels</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-59><a id=__codelineno-68-59 name=__codelineno-68-59 href=#__codelineno-68-59></a><span class=w>    </span><span class=na>environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;production&quot;</span>
</span><span id=__span-68-60><a id=__codelineno-68-60 name=__codelineno-68-60 href=#__codelineno-68-60></a><span class=w>    </span><span class=na>tier</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;web&quot;</span>
</span><span id=__span-68-61><a id=__codelineno-68-61 name=__codelineno-68-61 href=#__codelineno-68-61></a><span class=w>    </span><span class=na>managed_by</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;terraform&quot;</span>
</span><span id=__span-68-62><a id=__codelineno-68-62 name=__codelineno-68-62 href=#__codelineno-68-62></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-63><a id=__codelineno-68-63 name=__codelineno-68-63 href=#__codelineno-68-63></a>
</span><span id=__span-68-64><a id=__codelineno-68-64 name=__codelineno-68-64 href=#__codelineno-68-64></a><span class=w>  </span><span class=nb>disk</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-65><a id=__codelineno-68-65 name=__codelineno-68-65 href=#__codelineno-68-65></a><span class=w>    </span><span class=na>source_image</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;debian-cloud/debian-11&quot;</span>
</span><span id=__span-68-66><a id=__codelineno-68-66 name=__codelineno-68-66 href=#__codelineno-68-66></a><span class=w>    </span><span class=na>auto_delete</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-68-67><a id=__codelineno-68-67 name=__codelineno-68-67 href=#__codelineno-68-67></a><span class=w>    </span><span class=na>boot</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-68-68><a id=__codelineno-68-68 name=__codelineno-68-68 href=#__codelineno-68-68></a><span class=w>    </span><span class=na>disk_size_gb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>20</span>
</span><span id=__span-68-69><a id=__codelineno-68-69 name=__codelineno-68-69 href=#__codelineno-68-69></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-70><a id=__codelineno-68-70 name=__codelineno-68-70 href=#__codelineno-68-70></a>
</span><span id=__span-68-71><a id=__codelineno-68-71 name=__codelineno-68-71 href=#__codelineno-68-71></a><span class=w>  </span><span class=nb>network_interface</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-72><a id=__codelineno-68-72 name=__codelineno-68-72 href=#__codelineno-68-72></a><span class=w>    </span><span class=na>subnetwork</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_subnetwork.webapp.id</span>
</span><span id=__span-68-73><a id=__codelineno-68-73 name=__codelineno-68-73 href=#__codelineno-68-73></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-74><a id=__codelineno-68-74 name=__codelineno-68-74 href=#__codelineno-68-74></a>
</span><span id=__span-68-75><a id=__codelineno-68-75 name=__codelineno-68-75 href=#__codelineno-68-75></a><span class=w>  </span><span class=nb>metadata</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-76><a id=__codelineno-68-76 name=__codelineno-68-76 href=#__codelineno-68-76></a><span class=w>    </span><span class=na>startup-script</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>templatefile</span><span class=p>(</span><span class=s2>&quot;${path.module}/startup.sh&quot;</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-77><a id=__codelineno-68-77 name=__codelineno-68-77 href=#__codelineno-68-77></a><span class=w>      </span><span class=na>db_host</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=nv>google_sql_database_instance.main.private_ip_address</span>
</span><span id=__span-68-78><a id=__codelineno-68-78 name=__codelineno-68-78 href=#__codelineno-68-78></a><span class=w>      </span><span class=na>db_name</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=nv>google_sql_database.webapp.name</span>
</span><span id=__span-68-79><a id=__codelineno-68-79 name=__codelineno-68-79 href=#__codelineno-68-79></a><span class=w>      </span><span class=na>db_user</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=nv>google_sql_user.webapp.name</span>
</span><span id=__span-68-80><a id=__codelineno-68-80 name=__codelineno-68-80 href=#__codelineno-68-80></a><span class=w>      </span><span class=na>db_password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>random_password.db_password.result</span>
</span><span id=__span-68-81><a id=__codelineno-68-81 name=__codelineno-68-81 href=#__codelineno-68-81></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-68-82><a id=__codelineno-68-82 name=__codelineno-68-82 href=#__codelineno-68-82></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-83><a id=__codelineno-68-83 name=__codelineno-68-83 href=#__codelineno-68-83></a>
</span><span id=__span-68-84><a id=__codelineno-68-84 name=__codelineno-68-84 href=#__codelineno-68-84></a><span class=w>  </span><span class=nb>service_account</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-85><a id=__codelineno-68-85 name=__codelineno-68-85 href=#__codelineno-68-85></a><span class=w>    </span><span class=na>email</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>google_service_account.webapp.email</span>
</span><span id=__span-68-86><a id=__codelineno-68-86 name=__codelineno-68-86 href=#__codelineno-68-86></a><span class=w>    </span><span class=na>scopes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;cloud-platform&quot;</span><span class=p>]</span>
</span><span id=__span-68-87><a id=__codelineno-68-87 name=__codelineno-68-87 href=#__codelineno-68-87></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-88><a id=__codelineno-68-88 name=__codelineno-68-88 href=#__codelineno-68-88></a>
</span><span id=__span-68-89><a id=__codelineno-68-89 name=__codelineno-68-89 href=#__codelineno-68-89></a><span class=w>  </span><span class=nb>lifecycle</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-90><a id=__codelineno-68-90 name=__codelineno-68-90 href=#__codelineno-68-90></a><span class=w>    </span><span class=na>create_before_destroy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-68-91><a id=__codelineno-68-91 name=__codelineno-68-91 href=#__codelineno-68-91></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-92><a id=__codelineno-68-92 name=__codelineno-68-92 href=#__codelineno-68-92></a><span class=p>}</span>
</span><span id=__span-68-93><a id=__codelineno-68-93 name=__codelineno-68-93 href=#__codelineno-68-93></a>
</span><span id=__span-68-94><a id=__codelineno-68-94 name=__codelineno-68-94 href=#__codelineno-68-94></a><span class=c1># Managed Instance Group</span>
</span><span id=__span-68-95><a id=__codelineno-68-95 name=__codelineno-68-95 href=#__codelineno-68-95></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_region_instance_group_manager&quot;</span><span class=w> </span><span class=nv>&quot;webapp&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-96><a id=__codelineno-68-96 name=__codelineno-68-96 href=#__codelineno-68-96></a><span class=w>  </span><span class=na>name</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp-mig&quot;</span>
</span><span id=__span-68-97><a id=__codelineno-68-97 name=__codelineno-68-97 href=#__codelineno-68-97></a><span class=w>  </span><span class=na>region</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-68-98><a id=__codelineno-68-98 name=__codelineno-68-98 href=#__codelineno-68-98></a>
</span><span id=__span-68-99><a id=__codelineno-68-99 name=__codelineno-68-99 href=#__codelineno-68-99></a><span class=w>  </span><span class=na>base_instance_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp-instance&quot;</span>
</span><span id=__span-68-100><a id=__codelineno-68-100 name=__codelineno-68-100 href=#__codelineno-68-100></a>
</span><span id=__span-68-101><a id=__codelineno-68-101 name=__codelineno-68-101 href=#__codelineno-68-101></a><span class=w>  </span><span class=nb>version</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-102><a id=__codelineno-68-102 name=__codelineno-68-102 href=#__codelineno-68-102></a><span class=w>    </span><span class=na>instance_template</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_instance_template.webapp.id</span>
</span><span id=__span-68-103><a id=__codelineno-68-103 name=__codelineno-68-103 href=#__codelineno-68-103></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-104><a id=__codelineno-68-104 name=__codelineno-68-104 href=#__codelineno-68-104></a>
</span><span id=__span-68-105><a id=__codelineno-68-105 name=__codelineno-68-105 href=#__codelineno-68-105></a><span class=w>  </span><span class=na>target_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>3</span>
</span><span id=__span-68-106><a id=__codelineno-68-106 name=__codelineno-68-106 href=#__codelineno-68-106></a>
</span><span id=__span-68-107><a id=__codelineno-68-107 name=__codelineno-68-107 href=#__codelineno-68-107></a><span class=w>  </span><span class=nb>named_port</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-108><a id=__codelineno-68-108 name=__codelineno-68-108 href=#__codelineno-68-108></a><span class=w>    </span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;http&quot;</span>
</span><span id=__span-68-109><a id=__codelineno-68-109 name=__codelineno-68-109 href=#__codelineno-68-109></a><span class=w>    </span><span class=na>port</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>80</span>
</span><span id=__span-68-110><a id=__codelineno-68-110 name=__codelineno-68-110 href=#__codelineno-68-110></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-111><a id=__codelineno-68-111 name=__codelineno-68-111 href=#__codelineno-68-111></a>
</span><span id=__span-68-112><a id=__codelineno-68-112 name=__codelineno-68-112 href=#__codelineno-68-112></a><span class=w>  </span><span class=nb>auto_healing_policies</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-113><a id=__codelineno-68-113 name=__codelineno-68-113 href=#__codelineno-68-113></a><span class=w>    </span><span class=na>health_check</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_health_check.webapp.id</span>
</span><span id=__span-68-114><a id=__codelineno-68-114 name=__codelineno-68-114 href=#__codelineno-68-114></a><span class=w>    </span><span class=na>initial_delay_sec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>300</span>
</span><span id=__span-68-115><a id=__codelineno-68-115 name=__codelineno-68-115 href=#__codelineno-68-115></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-116><a id=__codelineno-68-116 name=__codelineno-68-116 href=#__codelineno-68-116></a><span class=p>}</span>
</span><span id=__span-68-117><a id=__codelineno-68-117 name=__codelineno-68-117 href=#__codelineno-68-117></a>
</span><span id=__span-68-118><a id=__codelineno-68-118 name=__codelineno-68-118 href=#__codelineno-68-118></a><span class=c1># Health Check</span>
</span><span id=__span-68-119><a id=__codelineno-68-119 name=__codelineno-68-119 href=#__codelineno-68-119></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_health_check&quot;</span><span class=w> </span><span class=nv>&quot;webapp&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-120><a id=__codelineno-68-120 name=__codelineno-68-120 href=#__codelineno-68-120></a><span class=w>  </span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp-health-check&quot;</span>
</span><span id=__span-68-121><a id=__codelineno-68-121 name=__codelineno-68-121 href=#__codelineno-68-121></a>
</span><span id=__span-68-122><a id=__codelineno-68-122 name=__codelineno-68-122 href=#__codelineno-68-122></a><span class=w>  </span><span class=nb>http_health_check</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-123><a id=__codelineno-68-123 name=__codelineno-68-123 href=#__codelineno-68-123></a><span class=w>    </span><span class=na>port</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=m>80</span>
</span><span id=__span-68-124><a id=__codelineno-68-124 name=__codelineno-68-124 href=#__codelineno-68-124></a><span class=w>    </span><span class=na>request_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;/health&quot;</span>
</span><span id=__span-68-125><a id=__codelineno-68-125 name=__codelineno-68-125 href=#__codelineno-68-125></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-126><a id=__codelineno-68-126 name=__codelineno-68-126 href=#__codelineno-68-126></a>
</span><span id=__span-68-127><a id=__codelineno-68-127 name=__codelineno-68-127 href=#__codelineno-68-127></a><span class=w>  </span><span class=na>check_interval_sec</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>10</span>
</span><span id=__span-68-128><a id=__codelineno-68-128 name=__codelineno-68-128 href=#__codelineno-68-128></a><span class=w>  </span><span class=na>timeout_sec</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=m>5</span>
</span><span id=__span-68-129><a id=__codelineno-68-129 name=__codelineno-68-129 href=#__codelineno-68-129></a><span class=w>  </span><span class=na>healthy_threshold</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=m>2</span>
</span><span id=__span-68-130><a id=__codelineno-68-130 name=__codelineno-68-130 href=#__codelineno-68-130></a><span class=w>  </span><span class=na>unhealthy_threshold</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>3</span>
</span><span id=__span-68-131><a id=__codelineno-68-131 name=__codelineno-68-131 href=#__codelineno-68-131></a><span class=p>}</span>
</span><span id=__span-68-132><a id=__codelineno-68-132 name=__codelineno-68-132 href=#__codelineno-68-132></a>
</span><span id=__span-68-133><a id=__codelineno-68-133 name=__codelineno-68-133 href=#__codelineno-68-133></a><span class=c1># Backend Service</span>
</span><span id=__span-68-134><a id=__codelineno-68-134 name=__codelineno-68-134 href=#__codelineno-68-134></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_backend_service&quot;</span><span class=w> </span><span class=nv>&quot;webapp&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-135><a id=__codelineno-68-135 name=__codelineno-68-135 href=#__codelineno-68-135></a><span class=w>  </span><span class=na>name</span><span class=w>                  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp-backend&quot;</span>
</span><span id=__span-68-136><a id=__codelineno-68-136 name=__codelineno-68-136 href=#__codelineno-68-136></a><span class=w>  </span><span class=na>protocol</span><span class=w>              </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;HTTP&quot;</span>
</span><span id=__span-68-137><a id=__codelineno-68-137 name=__codelineno-68-137 href=#__codelineno-68-137></a><span class=w>  </span><span class=na>port_name</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;http&quot;</span>
</span><span id=__span-68-138><a id=__codelineno-68-138 name=__codelineno-68-138 href=#__codelineno-68-138></a><span class=w>  </span><span class=na>timeout_sec</span><span class=w>           </span><span class=o>=</span><span class=w> </span><span class=m>30</span>
</span><span id=__span-68-139><a id=__codelineno-68-139 name=__codelineno-68-139 href=#__codelineno-68-139></a><span class=w>  </span><span class=na>enable_cdn</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-68-140><a id=__codelineno-68-140 name=__codelineno-68-140 href=#__codelineno-68-140></a><span class=w>  </span><span class=na>health_checks</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=nv>google_compute_health_check.webapp.id</span><span class=p>]</span>
</span><span id=__span-68-141><a id=__codelineno-68-141 name=__codelineno-68-141 href=#__codelineno-68-141></a><span class=w>  </span><span class=na>load_balancing_scheme</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;EXTERNAL&quot;</span>
</span><span id=__span-68-142><a id=__codelineno-68-142 name=__codelineno-68-142 href=#__codelineno-68-142></a>
</span><span id=__span-68-143><a id=__codelineno-68-143 name=__codelineno-68-143 href=#__codelineno-68-143></a><span class=w>  </span><span class=nb>backend</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-144><a id=__codelineno-68-144 name=__codelineno-68-144 href=#__codelineno-68-144></a><span class=w>    </span><span class=na>group</span><span class=w>           </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_region_instance_group_manager.webapp.instance_group</span>
</span><span id=__span-68-145><a id=__codelineno-68-145 name=__codelineno-68-145 href=#__codelineno-68-145></a><span class=w>    </span><span class=na>balancing_mode</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;UTILIZATION&quot;</span>
</span><span id=__span-68-146><a id=__codelineno-68-146 name=__codelineno-68-146 href=#__codelineno-68-146></a><span class=w>    </span><span class=na>capacity_scaler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>1.0</span>
</span><span id=__span-68-147><a id=__codelineno-68-147 name=__codelineno-68-147 href=#__codelineno-68-147></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-148><a id=__codelineno-68-148 name=__codelineno-68-148 href=#__codelineno-68-148></a>
</span><span id=__span-68-149><a id=__codelineno-68-149 name=__codelineno-68-149 href=#__codelineno-68-149></a><span class=w>  </span><span class=nb>log_config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-150><a id=__codelineno-68-150 name=__codelineno-68-150 href=#__codelineno-68-150></a><span class=w>    </span><span class=na>enable</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-68-151><a id=__codelineno-68-151 name=__codelineno-68-151 href=#__codelineno-68-151></a><span class=w>    </span><span class=na>sample_rate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>1.0</span>
</span><span id=__span-68-152><a id=__codelineno-68-152 name=__codelineno-68-152 href=#__codelineno-68-152></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-153><a id=__codelineno-68-153 name=__codelineno-68-153 href=#__codelineno-68-153></a><span class=p>}</span>
</span><span id=__span-68-154><a id=__codelineno-68-154 name=__codelineno-68-154 href=#__codelineno-68-154></a>
</span><span id=__span-68-155><a id=__codelineno-68-155 name=__codelineno-68-155 href=#__codelineno-68-155></a><span class=c1># URL Map</span>
</span><span id=__span-68-156><a id=__codelineno-68-156 name=__codelineno-68-156 href=#__codelineno-68-156></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_url_map&quot;</span><span class=w> </span><span class=nv>&quot;webapp&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-157><a id=__codelineno-68-157 name=__codelineno-68-157 href=#__codelineno-68-157></a><span class=w>  </span><span class=na>name</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp-url-map&quot;</span>
</span><span id=__span-68-158><a id=__codelineno-68-158 name=__codelineno-68-158 href=#__codelineno-68-158></a><span class=w>  </span><span class=na>default_service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_backend_service.webapp.id</span>
</span><span id=__span-68-159><a id=__codelineno-68-159 name=__codelineno-68-159 href=#__codelineno-68-159></a><span class=p>}</span>
</span><span id=__span-68-160><a id=__codelineno-68-160 name=__codelineno-68-160 href=#__codelineno-68-160></a>
</span><span id=__span-68-161><a id=__codelineno-68-161 name=__codelineno-68-161 href=#__codelineno-68-161></a><span class=c1># HTTP Proxy</span>
</span><span id=__span-68-162><a id=__codelineno-68-162 name=__codelineno-68-162 href=#__codelineno-68-162></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_target_http_proxy&quot;</span><span class=w> </span><span class=nv>&quot;webapp&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-163><a id=__codelineno-68-163 name=__codelineno-68-163 href=#__codelineno-68-163></a><span class=w>  </span><span class=na>name</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp-http-proxy&quot;</span>
</span><span id=__span-68-164><a id=__codelineno-68-164 name=__codelineno-68-164 href=#__codelineno-68-164></a><span class=w>  </span><span class=na>url_map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_url_map.webapp.id</span>
</span><span id=__span-68-165><a id=__codelineno-68-165 name=__codelineno-68-165 href=#__codelineno-68-165></a><span class=p>}</span>
</span><span id=__span-68-166><a id=__codelineno-68-166 name=__codelineno-68-166 href=#__codelineno-68-166></a>
</span><span id=__span-68-167><a id=__codelineno-68-167 name=__codelineno-68-167 href=#__codelineno-68-167></a><span class=c1># Global Forwarding Rule</span>
</span><span id=__span-68-168><a id=__codelineno-68-168 name=__codelineno-68-168 href=#__codelineno-68-168></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_global_forwarding_rule&quot;</span><span class=w> </span><span class=nv>&quot;webapp&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-169><a id=__codelineno-68-169 name=__codelineno-68-169 href=#__codelineno-68-169></a><span class=w>  </span><span class=na>name</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp-forwarding-rule&quot;</span>
</span><span id=__span-68-170><a id=__codelineno-68-170 name=__codelineno-68-170 href=#__codelineno-68-170></a><span class=w>  </span><span class=na>target</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_target_http_proxy.webapp.id</span>
</span><span id=__span-68-171><a id=__codelineno-68-171 name=__codelineno-68-171 href=#__codelineno-68-171></a><span class=w>  </span><span class=na>port_range</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;80&quot;</span>
</span><span id=__span-68-172><a id=__codelineno-68-172 name=__codelineno-68-172 href=#__codelineno-68-172></a><span class=p>}</span>
</span><span id=__span-68-173><a id=__codelineno-68-173 name=__codelineno-68-173 href=#__codelineno-68-173></a>
</span><span id=__span-68-174><a id=__codelineno-68-174 name=__codelineno-68-174 href=#__codelineno-68-174></a><span class=c1># Cloud SQL Instance</span>
</span><span id=__span-68-175><a id=__codelineno-68-175 name=__codelineno-68-175 href=#__codelineno-68-175></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_sql_database_instance&quot;</span><span class=w> </span><span class=nv>&quot;main&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-176><a id=__codelineno-68-176 name=__codelineno-68-176 href=#__codelineno-68-176></a><span class=w>  </span><span class=na>name</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp-db-instance&quot;</span>
</span><span id=__span-68-177><a id=__codelineno-68-177 name=__codelineno-68-177 href=#__codelineno-68-177></a><span class=w>  </span><span class=na>database_version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;POSTGRES_14&quot;</span>
</span><span id=__span-68-178><a id=__codelineno-68-178 name=__codelineno-68-178 href=#__codelineno-68-178></a><span class=w>  </span><span class=na>region</span><span class=w>           </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-68-179><a id=__codelineno-68-179 name=__codelineno-68-179 href=#__codelineno-68-179></a>
</span><span id=__span-68-180><a id=__codelineno-68-180 name=__codelineno-68-180 href=#__codelineno-68-180></a><span class=w>  </span><span class=nb>settings</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-181><a id=__codelineno-68-181 name=__codelineno-68-181 href=#__codelineno-68-181></a><span class=w>    </span><span class=na>tier</span><span class=w>              </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;db-f1-micro&quot;</span>
</span><span id=__span-68-182><a id=__codelineno-68-182 name=__codelineno-68-182 href=#__codelineno-68-182></a><span class=w>    </span><span class=na>availability_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;REGIONAL&quot;</span>
</span><span id=__span-68-183><a id=__codelineno-68-183 name=__codelineno-68-183 href=#__codelineno-68-183></a>
</span><span id=__span-68-184><a id=__codelineno-68-184 name=__codelineno-68-184 href=#__codelineno-68-184></a><span class=w>    </span><span class=nb>backup_configuration</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-185><a id=__codelineno-68-185 name=__codelineno-68-185 href=#__codelineno-68-185></a><span class=w>      </span><span class=na>enabled</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-68-186><a id=__codelineno-68-186 name=__codelineno-68-186 href=#__codelineno-68-186></a><span class=w>      </span><span class=na>start_time</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;03:00&quot;</span>
</span><span id=__span-68-187><a id=__codelineno-68-187 name=__codelineno-68-187 href=#__codelineno-68-187></a><span class=w>      </span><span class=na>point_in_time_recovery_enabled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-68-188><a id=__codelineno-68-188 name=__codelineno-68-188 href=#__codelineno-68-188></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-68-189><a id=__codelineno-68-189 name=__codelineno-68-189 href=#__codelineno-68-189></a>
</span><span id=__span-68-190><a id=__codelineno-68-190 name=__codelineno-68-190 href=#__codelineno-68-190></a><span class=w>    </span><span class=nb>ip_configuration</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-191><a id=__codelineno-68-191 name=__codelineno-68-191 href=#__codelineno-68-191></a><span class=w>      </span><span class=na>ipv4_enabled</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
</span><span id=__span-68-192><a id=__codelineno-68-192 name=__codelineno-68-192 href=#__codelineno-68-192></a><span class=w>      </span><span class=na>private_network</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_network.webapp.id</span>
</span><span id=__span-68-193><a id=__codelineno-68-193 name=__codelineno-68-193 href=#__codelineno-68-193></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-68-194><a id=__codelineno-68-194 name=__codelineno-68-194 href=#__codelineno-68-194></a>
</span><span id=__span-68-195><a id=__codelineno-68-195 name=__codelineno-68-195 href=#__codelineno-68-195></a><span class=w>    </span><span class=nb>maintenance_window</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-196><a id=__codelineno-68-196 name=__codelineno-68-196 href=#__codelineno-68-196></a><span class=w>      </span><span class=na>day</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>7</span><span class=c1>  # Sunday</span>
</span><span id=__span-68-197><a id=__codelineno-68-197 name=__codelineno-68-197 href=#__codelineno-68-197></a><span class=w>      </span><span class=na>hour</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>3</span>
</span><span id=__span-68-198><a id=__codelineno-68-198 name=__codelineno-68-198 href=#__codelineno-68-198></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-68-199><a id=__codelineno-68-199 name=__codelineno-68-199 href=#__codelineno-68-199></a>
</span><span id=__span-68-200><a id=__codelineno-68-200 name=__codelineno-68-200 href=#__codelineno-68-200></a><span class=w>    </span><span class=nb>database_flags</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-201><a id=__codelineno-68-201 name=__codelineno-68-201 href=#__codelineno-68-201></a><span class=w>      </span><span class=na>name</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;log_connections&quot;</span>
</span><span id=__span-68-202><a id=__codelineno-68-202 name=__codelineno-68-202 href=#__codelineno-68-202></a><span class=w>      </span><span class=na>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;on&quot;</span>
</span><span id=__span-68-203><a id=__codelineno-68-203 name=__codelineno-68-203 href=#__codelineno-68-203></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-68-204><a id=__codelineno-68-204 name=__codelineno-68-204 href=#__codelineno-68-204></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-68-205><a id=__codelineno-68-205 name=__codelineno-68-205 href=#__codelineno-68-205></a>
</span><span id=__span-68-206><a id=__codelineno-68-206 name=__codelineno-68-206 href=#__codelineno-68-206></a><span class=w>  </span><span class=na>deletion_protection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-68-207><a id=__codelineno-68-207 name=__codelineno-68-207 href=#__codelineno-68-207></a><span class=p>}</span>
</span><span id=__span-68-208><a id=__codelineno-68-208 name=__codelineno-68-208 href=#__codelineno-68-208></a>
</span><span id=__span-68-209><a id=__codelineno-68-209 name=__codelineno-68-209 href=#__codelineno-68-209></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_sql_database&quot;</span><span class=w> </span><span class=nv>&quot;webapp&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-210><a id=__codelineno-68-210 name=__codelineno-68-210 href=#__codelineno-68-210></a><span class=w>  </span><span class=na>name</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp&quot;</span>
</span><span id=__span-68-211><a id=__codelineno-68-211 name=__codelineno-68-211 href=#__codelineno-68-211></a><span class=w>  </span><span class=na>instance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_sql_database_instance.main.name</span>
</span><span id=__span-68-212><a id=__codelineno-68-212 name=__codelineno-68-212 href=#__codelineno-68-212></a><span class=p>}</span>
</span><span id=__span-68-213><a id=__codelineno-68-213 name=__codelineno-68-213 href=#__codelineno-68-213></a>
</span><span id=__span-68-214><a id=__codelineno-68-214 name=__codelineno-68-214 href=#__codelineno-68-214></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_sql_user&quot;</span><span class=w> </span><span class=nv>&quot;webapp&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-215><a id=__codelineno-68-215 name=__codelineno-68-215 href=#__codelineno-68-215></a><span class=w>  </span><span class=na>name</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp_user&quot;</span>
</span><span id=__span-68-216><a id=__codelineno-68-216 name=__codelineno-68-216 href=#__codelineno-68-216></a><span class=w>  </span><span class=na>instance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_sql_database_instance.main.name</span>
</span><span id=__span-68-217><a id=__codelineno-68-217 name=__codelineno-68-217 href=#__codelineno-68-217></a><span class=w>  </span><span class=na>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>random_password.db_password.result</span>
</span><span id=__span-68-218><a id=__codelineno-68-218 name=__codelineno-68-218 href=#__codelineno-68-218></a><span class=p>}</span>
</span><span id=__span-68-219><a id=__codelineno-68-219 name=__codelineno-68-219 href=#__codelineno-68-219></a>
</span><span id=__span-68-220><a id=__codelineno-68-220 name=__codelineno-68-220 href=#__codelineno-68-220></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;random_password&quot;</span><span class=w> </span><span class=nv>&quot;db_password&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-221><a id=__codelineno-68-221 name=__codelineno-68-221 href=#__codelineno-68-221></a><span class=w>  </span><span class=na>length</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>16</span>
</span><span id=__span-68-222><a id=__codelineno-68-222 name=__codelineno-68-222 href=#__codelineno-68-222></a><span class=w>  </span><span class=na>special</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-68-223><a id=__codelineno-68-223 name=__codelineno-68-223 href=#__codelineno-68-223></a><span class=p>}</span>
</span><span id=__span-68-224><a id=__codelineno-68-224 name=__codelineno-68-224 href=#__codelineno-68-224></a>
</span><span id=__span-68-225><a id=__codelineno-68-225 name=__codelineno-68-225 href=#__codelineno-68-225></a><span class=c1># Service Account</span>
</span><span id=__span-68-226><a id=__codelineno-68-226 name=__codelineno-68-226 href=#__codelineno-68-226></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_service_account&quot;</span><span class=w> </span><span class=nv>&quot;webapp&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-227><a id=__codelineno-68-227 name=__codelineno-68-227 href=#__codelineno-68-227></a><span class=w>  </span><span class=na>account_id</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp-instance-sa&quot;</span>
</span><span id=__span-68-228><a id=__codelineno-68-228 name=__codelineno-68-228 href=#__codelineno-68-228></a><span class=w>  </span><span class=na>display_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;WebApp Instance Service Account&quot;</span>
</span><span id=__span-68-229><a id=__codelineno-68-229 name=__codelineno-68-229 href=#__codelineno-68-229></a><span class=p>}</span>
</span><span id=__span-68-230><a id=__codelineno-68-230 name=__codelineno-68-230 href=#__codelineno-68-230></a>
</span><span id=__span-68-231><a id=__codelineno-68-231 name=__codelineno-68-231 href=#__codelineno-68-231></a><span class=c1># IAM Bindings</span>
</span><span id=__span-68-232><a id=__codelineno-68-232 name=__codelineno-68-232 href=#__codelineno-68-232></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_project_iam_member&quot;</span><span class=w> </span><span class=nv>&quot;webapp_sql_client&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-233><a id=__codelineno-68-233 name=__codelineno-68-233 href=#__codelineno-68-233></a><span class=w>  </span><span class=na>project</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span>
</span><span id=__span-68-234><a id=__codelineno-68-234 name=__codelineno-68-234 href=#__codelineno-68-234></a><span class=w>  </span><span class=na>role</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;roles/cloudsql.client&quot;</span>
</span><span id=__span-68-235><a id=__codelineno-68-235 name=__codelineno-68-235 href=#__codelineno-68-235></a><span class=w>  </span><span class=na>member</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;serviceAccount:${google_service_account.webapp.email}&quot;</span>
</span><span id=__span-68-236><a id=__codelineno-68-236 name=__codelineno-68-236 href=#__codelineno-68-236></a><span class=p>}</span>
</span><span id=__span-68-237><a id=__codelineno-68-237 name=__codelineno-68-237 href=#__codelineno-68-237></a>
</span><span id=__span-68-238><a id=__codelineno-68-238 name=__codelineno-68-238 href=#__codelineno-68-238></a><span class=c1># Outputs</span>
</span><span id=__span-68-239><a id=__codelineno-68-239 name=__codelineno-68-239 href=#__codelineno-68-239></a><span class=kr>output</span><span class=w> </span><span class=nv>&quot;load_balancer_ip&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-240><a id=__codelineno-68-240 name=__codelineno-68-240 href=#__codelineno-68-240></a><span class=w>  </span><span class=na>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_global_forwarding_rule.webapp.ip_address</span>
</span><span id=__span-68-241><a id=__codelineno-68-241 name=__codelineno-68-241 href=#__codelineno-68-241></a><span class=p>}</span>
</span><span id=__span-68-242><a id=__codelineno-68-242 name=__codelineno-68-242 href=#__codelineno-68-242></a>
</span><span id=__span-68-243><a id=__codelineno-68-243 name=__codelineno-68-243 href=#__codelineno-68-243></a><span class=kr>output</span><span class=w> </span><span class=nv>&quot;db_instance_connection&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-244><a id=__codelineno-68-244 name=__codelineno-68-244 href=#__codelineno-68-244></a><span class=w>  </span><span class=na>value</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=nv>google_sql_database_instance.main.connection_name</span>
</span><span id=__span-68-245><a id=__codelineno-68-245 name=__codelineno-68-245 href=#__codelineno-68-245></a><span class=w>  </span><span class=na>sensitive</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-68-246><a id=__codelineno-68-246 name=__codelineno-68-246 href=#__codelineno-68-246></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>TFDrift-Falco Configuration</strong> (<code>config-webapp.yaml</code>): <div class="language-yaml highlight"><pre><span></span><code><span id=__span-69-1><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a><span class=nt>providers</span><span class=p>:</span>
</span><span id=__span-69-2><a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a><span class=w>  </span><span class=nt>gcp</span><span class=p>:</span>
</span><span id=__span-69-3><a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-69-4><a id=__codelineno-69-4 name=__codelineno-69-4 href=#__codelineno-69-4></a><span class=w>    </span><span class=nt>projects</span><span class=p>:</span>
</span><span id=__span-69-5><a id=__codelineno-69-5 name=__codelineno-69-5 href=#__codelineno-69-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;my-project-123&quot;</span>
</span><span id=__span-69-6><a id=__codelineno-69-6 name=__codelineno-69-6 href=#__codelineno-69-6></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span>
</span><span id=__span-69-7><a id=__codelineno-69-7 name=__codelineno-69-7 href=#__codelineno-69-7></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;gcs&quot;</span>
</span><span id=__span-69-8><a id=__codelineno-69-8 name=__codelineno-69-8 href=#__codelineno-69-8></a><span class=w>      </span><span class=nt>gcs_bucket</span><span class=p>:</span><span class=w> </span><span class=s>&quot;my-terraform-state&quot;</span>
</span><span id=__span-69-9><a id=__codelineno-69-9 name=__codelineno-69-9 href=#__codelineno-69-9></a><span class=w>      </span><span class=nt>gcs_prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;prod/webapp/terraform.tfstate&quot;</span>
</span><span id=__span-69-10><a id=__codelineno-69-10 name=__codelineno-69-10 href=#__codelineno-69-10></a>
</span><span id=__span-69-11><a id=__codelineno-69-11 name=__codelineno-69-11 href=#__codelineno-69-11></a><span class=nt>falco</span><span class=p>:</span>
</span><span id=__span-69-12><a id=__codelineno-69-12 name=__codelineno-69-12 href=#__codelineno-69-12></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-69-13><a id=__codelineno-69-13 name=__codelineno-69-13 href=#__codelineno-69-13></a><span class=w>  </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=s>&quot;localhost&quot;</span>
</span><span id=__span-69-14><a id=__codelineno-69-14 name=__codelineno-69-14 href=#__codelineno-69-14></a><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5060</span>
</span><span id=__span-69-15><a id=__codelineno-69-15 name=__codelineno-69-15 href=#__codelineno-69-15></a>
</span><span id=__span-69-16><a id=__codelineno-69-16 name=__codelineno-69-16 href=#__codelineno-69-16></a><span class=nt>drift_rules</span><span class=p>:</span>
</span><span id=__span-69-17><a id=__codelineno-69-17 name=__codelineno-69-17 href=#__codelineno-69-17></a><span class=w>  </span><span class=c1># Critical: Database configuration</span>
</span><span id=__span-69-18><a id=__codelineno-69-18 name=__codelineno-69-18 href=#__codelineno-69-18></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Cloud</span><span class=nv> </span><span class=s>SQL</span><span class=nv> </span><span class=s>Configuration</span><span class=nv> </span><span class=s>Change&quot;</span>
</span><span id=__span-69-19><a id=__codelineno-69-19 name=__codelineno-69-19 href=#__codelineno-69-19></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-69-20><a id=__codelineno-69-20 name=__codelineno-69-20 href=#__codelineno-69-20></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_sql_database_instance&quot;</span>
</span><span id=__span-69-21><a id=__codelineno-69-21 name=__codelineno-69-21 href=#__codelineno-69-21></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-69-22><a id=__codelineno-69-22 name=__codelineno-69-22 href=#__codelineno-69-22></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;settings&quot;</span>
</span><span id=__span-69-23><a id=__codelineno-69-23 name=__codelineno-69-23 href=#__codelineno-69-23></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;database_version&quot;</span>
</span><span id=__span-69-24><a id=__codelineno-69-24 name=__codelineno-69-24 href=#__codelineno-69-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;deletion_protection&quot;</span>
</span><span id=__span-69-25><a id=__codelineno-69-25 name=__codelineno-69-25 href=#__codelineno-69-25></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span>
</span><span id=__span-69-26><a id=__codelineno-69-26 name=__codelineno-69-26 href=#__codelineno-69-26></a>
</span><span id=__span-69-27><a id=__codelineno-69-27 name=__codelineno-69-27 href=#__codelineno-69-27></a><span class=w>  </span><span class=c1># Critical: IAM changes</span>
</span><span id=__span-69-28><a id=__codelineno-69-28 name=__codelineno-69-28 href=#__codelineno-69-28></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;IAM</span><span class=nv> </span><span class=s>Binding</span><span class=nv> </span><span class=s>Modification&quot;</span>
</span><span id=__span-69-29><a id=__codelineno-69-29 name=__codelineno-69-29 href=#__codelineno-69-29></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-69-30><a id=__codelineno-69-30 name=__codelineno-69-30 href=#__codelineno-69-30></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_project_iam_member&quot;</span>
</span><span id=__span-69-31><a id=__codelineno-69-31 name=__codelineno-69-31 href=#__codelineno-69-31></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_service_account_iam_binding&quot;</span>
</span><span id=__span-69-32><a id=__codelineno-69-32 name=__codelineno-69-32 href=#__codelineno-69-32></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-69-33><a id=__codelineno-69-33 name=__codelineno-69-33 href=#__codelineno-69-33></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;role&quot;</span>
</span><span id=__span-69-34><a id=__codelineno-69-34 name=__codelineno-69-34 href=#__codelineno-69-34></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;members&quot;</span>
</span><span id=__span-69-35><a id=__codelineno-69-35 name=__codelineno-69-35 href=#__codelineno-69-35></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span>
</span><span id=__span-69-36><a id=__codelineno-69-36 name=__codelineno-69-36 href=#__codelineno-69-36></a>
</span><span id=__span-69-37><a id=__codelineno-69-37 name=__codelineno-69-37 href=#__codelineno-69-37></a><span class=w>  </span><span class=c1># High: Load balancer configuration</span>
</span><span id=__span-69-38><a id=__codelineno-69-38 name=__codelineno-69-38 href=#__codelineno-69-38></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Load</span><span class=nv> </span><span class=s>Balancer</span><span class=nv> </span><span class=s>Configuration</span><span class=nv> </span><span class=s>Change&quot;</span>
</span><span id=__span-69-39><a id=__codelineno-69-39 name=__codelineno-69-39 href=#__codelineno-69-39></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-69-40><a id=__codelineno-69-40 name=__codelineno-69-40 href=#__codelineno-69-40></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_backend_service&quot;</span>
</span><span id=__span-69-41><a id=__codelineno-69-41 name=__codelineno-69-41 href=#__codelineno-69-41></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_url_map&quot;</span>
</span><span id=__span-69-42><a id=__codelineno-69-42 name=__codelineno-69-42 href=#__codelineno-69-42></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_target_http_proxy&quot;</span>
</span><span id=__span-69-43><a id=__codelineno-69-43 name=__codelineno-69-43 href=#__codelineno-69-43></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-69-44><a id=__codelineno-69-44 name=__codelineno-69-44 href=#__codelineno-69-44></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;backend&quot;</span>
</span><span id=__span-69-45><a id=__codelineno-69-45 name=__codelineno-69-45 href=#__codelineno-69-45></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;health_checks&quot;</span>
</span><span id=__span-69-46><a id=__codelineno-69-46 name=__codelineno-69-46 href=#__codelineno-69-46></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;enable_cdn&quot;</span>
</span><span id=__span-69-47><a id=__codelineno-69-47 name=__codelineno-69-47 href=#__codelineno-69-47></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;high&quot;</span>
</span><span id=__span-69-48><a id=__codelineno-69-48 name=__codelineno-69-48 href=#__codelineno-69-48></a>
</span><span id=__span-69-49><a id=__codelineno-69-49 name=__codelineno-69-49 href=#__codelineno-69-49></a><span class=w>  </span><span class=c1># High: Instance template changes</span>
</span><span id=__span-69-50><a id=__codelineno-69-50 name=__codelineno-69-50 href=#__codelineno-69-50></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Instance</span><span class=nv> </span><span class=s>Template</span><span class=nv> </span><span class=s>Modification&quot;</span>
</span><span id=__span-69-51><a id=__codelineno-69-51 name=__codelineno-69-51 href=#__codelineno-69-51></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-69-52><a id=__codelineno-69-52 name=__codelineno-69-52 href=#__codelineno-69-52></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_instance_template&quot;</span>
</span><span id=__span-69-53><a id=__codelineno-69-53 name=__codelineno-69-53 href=#__codelineno-69-53></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-69-54><a id=__codelineno-69-54 name=__codelineno-69-54 href=#__codelineno-69-54></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;machine_type&quot;</span>
</span><span id=__span-69-55><a id=__codelineno-69-55 name=__codelineno-69-55 href=#__codelineno-69-55></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;disk&quot;</span>
</span><span id=__span-69-56><a id=__codelineno-69-56 name=__codelineno-69-56 href=#__codelineno-69-56></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;metadata&quot;</span>
</span><span id=__span-69-57><a id=__codelineno-69-57 name=__codelineno-69-57 href=#__codelineno-69-57></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;service_account&quot;</span>
</span><span id=__span-69-58><a id=__codelineno-69-58 name=__codelineno-69-58 href=#__codelineno-69-58></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;high&quot;</span>
</span><span id=__span-69-59><a id=__codelineno-69-59 name=__codelineno-69-59 href=#__codelineno-69-59></a>
</span><span id=__span-69-60><a id=__codelineno-69-60 name=__codelineno-69-60 href=#__codelineno-69-60></a><span class=w>  </span><span class=c1># Medium: MIG scaling</span>
</span><span id=__span-69-61><a id=__codelineno-69-61 name=__codelineno-69-61 href=#__codelineno-69-61></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;MIG</span><span class=nv> </span><span class=s>Target</span><span class=nv> </span><span class=s>Size</span><span class=nv> </span><span class=s>Change&quot;</span>
</span><span id=__span-69-62><a id=__codelineno-69-62 name=__codelineno-69-62 href=#__codelineno-69-62></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-69-63><a id=__codelineno-69-63 name=__codelineno-69-63 href=#__codelineno-69-63></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_region_instance_group_manager&quot;</span>
</span><span id=__span-69-64><a id=__codelineno-69-64 name=__codelineno-69-64 href=#__codelineno-69-64></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-69-65><a id=__codelineno-69-65 name=__codelineno-69-65 href=#__codelineno-69-65></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;target_size&quot;</span>
</span><span id=__span-69-66><a id=__codelineno-69-66 name=__codelineno-69-66 href=#__codelineno-69-66></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;version&quot;</span>
</span><span id=__span-69-67><a id=__codelineno-69-67 name=__codelineno-69-67 href=#__codelineno-69-67></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;medium&quot;</span>
</span><span id=__span-69-68><a id=__codelineno-69-68 name=__codelineno-69-68 href=#__codelineno-69-68></a>
</span><span id=__span-69-69><a id=__codelineno-69-69 name=__codelineno-69-69 href=#__codelineno-69-69></a><span class=nt>notifications</span><span class=p>:</span>
</span><span id=__span-69-70><a id=__codelineno-69-70 name=__codelineno-69-70 href=#__codelineno-69-70></a><span class=w>  </span><span class=nt>slack</span><span class=p>:</span>
</span><span id=__span-69-71><a id=__codelineno-69-71 name=__codelineno-69-71 href=#__codelineno-69-71></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-69-72><a id=__codelineno-69-72 name=__codelineno-69-72 href=#__codelineno-69-72></a><span class=w>    </span><span class=nt>webhook_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://hooks.slack.com/services/YOUR/WEBHOOK/URL&quot;</span>
</span><span id=__span-69-73><a id=__codelineno-69-73 name=__codelineno-69-73 href=#__codelineno-69-73></a>
</span><span id=__span-69-74><a id=__codelineno-69-74 name=__codelineno-69-74 href=#__codelineno-69-74></a><span class=w>  </span><span class=nt>webhook</span><span class=p>:</span>
</span><span id=__span-69-75><a id=__codelineno-69-75 name=__codelineno-69-75 href=#__codelineno-69-75></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-69-76><a id=__codelineno-69-76 name=__codelineno-69-76 href=#__codelineno-69-76></a><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://monitoring.example.com/webhooks/tfdrift&quot;</span>
</span><span id=__span-69-77><a id=__codelineno-69-77 name=__codelineno-69-77 href=#__codelineno-69-77></a><span class=w>    </span><span class=nt>method</span><span class=p>:</span><span class=w> </span><span class=s>&quot;POST&quot;</span>
</span><span id=__span-69-78><a id=__codelineno-69-78 name=__codelineno-69-78 href=#__codelineno-69-78></a><span class=w>    </span><span class=nt>headers</span><span class=p>:</span>
</span><span id=__span-69-79><a id=__codelineno-69-79 name=__codelineno-69-79 href=#__codelineno-69-79></a><span class=w>      </span><span class=nt>Content-Type</span><span class=p>:</span><span class=w> </span><span class=s>&quot;application/json&quot;</span>
</span><span id=__span-69-80><a id=__codelineno-69-80 name=__codelineno-69-80 href=#__codelineno-69-80></a><span class=w>      </span><span class=nt>Authorization</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Bearer</span><span class=nv> </span><span class=s>YOUR_API_TOKEN&quot;</span>
</span><span id=__span-69-81><a id=__codelineno-69-81 name=__codelineno-69-81 href=#__codelineno-69-81></a>
</span><span id=__span-69-82><a id=__codelineno-69-82 name=__codelineno-69-82 href=#__codelineno-69-82></a><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-69-83><a id=__codelineno-69-83 name=__codelineno-69-83 href=#__codelineno-69-83></a><span class=w>  </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=s>&quot;info&quot;</span>
</span><span id=__span-69-84><a id=__codelineno-69-84 name=__codelineno-69-84 href=#__codelineno-69-84></a><span class=w>  </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=s>&quot;json&quot;</span>
</span></code></pre></div></p> <p><strong>Test Drift Detection:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-70-1><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=c1># 1. Deploy infrastructure</span>
</span><span id=__span-70-2><a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a>terraform<span class=w> </span>apply<span class=w> </span>-var<span class=o>=</span><span class=s2>&quot;project_id=my-project-123&quot;</span>
</span><span id=__span-70-3><a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a>
</span><span id=__span-70-4><a id=__codelineno-70-4 name=__codelineno-70-4 href=#__codelineno-70-4></a><span class=c1># 2. Start TFDrift-Falco</span>
</span><span id=__span-70-5><a id=__codelineno-70-5 name=__codelineno-70-5 href=#__codelineno-70-5></a>tfdrift<span class=w> </span>--config<span class=w> </span>config-webapp.yaml
</span><span id=__span-70-6><a id=__codelineno-70-6 name=__codelineno-70-6 href=#__codelineno-70-6></a>
</span><span id=__span-70-7><a id=__codelineno-70-7 name=__codelineno-70-7 href=#__codelineno-70-7></a><span class=c1># 3. Trigger various drift scenarios</span>
</span><span id=__span-70-8><a id=__codelineno-70-8 name=__codelineno-70-8 href=#__codelineno-70-8></a>
</span><span id=__span-70-9><a id=__codelineno-70-9 name=__codelineno-70-9 href=#__codelineno-70-9></a><span class=c1># Scenario A: Modify database backup settings (CRITICAL)</span>
</span><span id=__span-70-10><a id=__codelineno-70-10 name=__codelineno-70-10 href=#__codelineno-70-10></a>gcloud<span class=w> </span>sql<span class=w> </span>instances<span class=w> </span>patch<span class=w> </span>webapp-db-instance<span class=w> </span><span class=se>\</span>
</span><span id=__span-70-11><a id=__codelineno-70-11 name=__codelineno-70-11 href=#__codelineno-70-11></a><span class=w>  </span>--backup-start-time<span class=o>=</span><span class=m>04</span>:00
</span><span id=__span-70-12><a id=__codelineno-70-12 name=__codelineno-70-12 href=#__codelineno-70-12></a>
</span><span id=__span-70-13><a id=__codelineno-70-13 name=__codelineno-70-13 href=#__codelineno-70-13></a><span class=c1># Scenario B: Change MIG target size (MEDIUM)</span>
</span><span id=__span-70-14><a id=__codelineno-70-14 name=__codelineno-70-14 href=#__codelineno-70-14></a>gcloud<span class=w> </span>compute<span class=w> </span>instance-groups<span class=w> </span>managed<span class=w> </span>set-autoscaling<span class=w> </span>webapp-mig<span class=w> </span><span class=se>\</span>
</span><span id=__span-70-15><a id=__codelineno-70-15 name=__codelineno-70-15 href=#__codelineno-70-15></a><span class=w>  </span>--region<span class=o>=</span>us-central1<span class=w> </span><span class=se>\</span>
</span><span id=__span-70-16><a id=__codelineno-70-16 name=__codelineno-70-16 href=#__codelineno-70-16></a><span class=w>  </span>--max-num-replicas<span class=o>=</span><span class=m>5</span>
</span><span id=__span-70-17><a id=__codelineno-70-17 name=__codelineno-70-17 href=#__codelineno-70-17></a>
</span><span id=__span-70-18><a id=__codelineno-70-18 name=__codelineno-70-18 href=#__codelineno-70-18></a><span class=c1># Scenario C: Modify backend service timeout (HIGH)</span>
</span><span id=__span-70-19><a id=__codelineno-70-19 name=__codelineno-70-19 href=#__codelineno-70-19></a>gcloud<span class=w> </span>compute<span class=w> </span>backend-services<span class=w> </span>update<span class=w> </span>webapp-backend<span class=w> </span><span class=se>\</span>
</span><span id=__span-70-20><a id=__codelineno-70-20 name=__codelineno-70-20 href=#__codelineno-70-20></a><span class=w>  </span>--global<span class=w> </span><span class=se>\</span>
</span><span id=__span-70-21><a id=__codelineno-70-21 name=__codelineno-70-21 href=#__codelineno-70-21></a><span class=w>  </span>--timeout<span class=o>=</span><span class=m>60</span>
</span><span id=__span-70-22><a id=__codelineno-70-22 name=__codelineno-70-22 href=#__codelineno-70-22></a>
</span><span id=__span-70-23><a id=__codelineno-70-23 name=__codelineno-70-23 href=#__codelineno-70-23></a><span class=c1># Expected: Different severity alerts in Slack</span>
</span></code></pre></div></p> <hr> <h3 id=example-3-gke-cluster-with-monitoring>Example 3: GKE Cluster with Monitoring<a class=headerlink href=#example-3-gke-cluster-with-monitoring title="Permanent link">&para;</a></h3> <p><strong>Terraform Configuration</strong> (<code>gke-cluster.tf</code>): <div class="language-hcl highlight"><pre><span></span><code><span id=__span-71-1><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=nb>terraform</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-2><a id=__codelineno-71-2 name=__codelineno-71-2 href=#__codelineno-71-2></a><span class=w>  </span><span class=kr>backend</span><span class=w> </span><span class=nv>&quot;gcs&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-3><a id=__codelineno-71-3 name=__codelineno-71-3 href=#__codelineno-71-3></a><span class=w>    </span><span class=na>bucket</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;my-terraform-state&quot;</span>
</span><span id=__span-71-4><a id=__codelineno-71-4 name=__codelineno-71-4 href=#__codelineno-71-4></a><span class=w>    </span><span class=na>prefix</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod/gke&quot;</span>
</span><span id=__span-71-5><a id=__codelineno-71-5 name=__codelineno-71-5 href=#__codelineno-71-5></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-71-6><a id=__codelineno-71-6 name=__codelineno-71-6 href=#__codelineno-71-6></a><span class=p>}</span>
</span><span id=__span-71-7><a id=__codelineno-71-7 name=__codelineno-71-7 href=#__codelineno-71-7></a>
</span><span id=__span-71-8><a id=__codelineno-71-8 name=__codelineno-71-8 href=#__codelineno-71-8></a><span class=kr>provider</span><span class=w> </span><span class=nv>&quot;google&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-9><a id=__codelineno-71-9 name=__codelineno-71-9 href=#__codelineno-71-9></a><span class=w>  </span><span class=na>project</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span>
</span><span id=__span-71-10><a id=__codelineno-71-10 name=__codelineno-71-10 href=#__codelineno-71-10></a><span class=w>  </span><span class=na>region</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-71-11><a id=__codelineno-71-11 name=__codelineno-71-11 href=#__codelineno-71-11></a><span class=p>}</span>
</span><span id=__span-71-12><a id=__codelineno-71-12 name=__codelineno-71-12 href=#__codelineno-71-12></a>
</span><span id=__span-71-13><a id=__codelineno-71-13 name=__codelineno-71-13 href=#__codelineno-71-13></a><span class=kr>variable</span><span class=w> </span><span class=nv>&quot;project_id&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-14><a id=__codelineno-71-14 name=__codelineno-71-14 href=#__codelineno-71-14></a><span class=w>  </span><span class=na>type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-71-15><a id=__codelineno-71-15 name=__codelineno-71-15 href=#__codelineno-71-15></a><span class=p>}</span>
</span><span id=__span-71-16><a id=__codelineno-71-16 name=__codelineno-71-16 href=#__codelineno-71-16></a>
</span><span id=__span-71-17><a id=__codelineno-71-17 name=__codelineno-71-17 href=#__codelineno-71-17></a><span class=kr>variable</span><span class=w> </span><span class=nv>&quot;region&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-18><a id=__codelineno-71-18 name=__codelineno-71-18 href=#__codelineno-71-18></a><span class=w>  </span><span class=na>type</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-71-19><a id=__codelineno-71-19 name=__codelineno-71-19 href=#__codelineno-71-19></a><span class=w>  </span><span class=na>default</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;us-central1&quot;</span>
</span><span id=__span-71-20><a id=__codelineno-71-20 name=__codelineno-71-20 href=#__codelineno-71-20></a><span class=p>}</span>
</span><span id=__span-71-21><a id=__codelineno-71-21 name=__codelineno-71-21 href=#__codelineno-71-21></a>
</span><span id=__span-71-22><a id=__codelineno-71-22 name=__codelineno-71-22 href=#__codelineno-71-22></a><span class=kr>variable</span><span class=w> </span><span class=nv>&quot;cluster_name&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-23><a id=__codelineno-71-23 name=__codelineno-71-23 href=#__codelineno-71-23></a><span class=w>  </span><span class=na>type</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-71-24><a id=__codelineno-71-24 name=__codelineno-71-24 href=#__codelineno-71-24></a><span class=w>  </span><span class=na>default</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod-gke-cluster&quot;</span>
</span><span id=__span-71-25><a id=__codelineno-71-25 name=__codelineno-71-25 href=#__codelineno-71-25></a><span class=p>}</span>
</span><span id=__span-71-26><a id=__codelineno-71-26 name=__codelineno-71-26 href=#__codelineno-71-26></a>
</span><span id=__span-71-27><a id=__codelineno-71-27 name=__codelineno-71-27 href=#__codelineno-71-27></a><span class=c1># VPC for GKE</span>
</span><span id=__span-71-28><a id=__codelineno-71-28 name=__codelineno-71-28 href=#__codelineno-71-28></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_network&quot;</span><span class=w> </span><span class=nv>&quot;gke&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-29><a id=__codelineno-71-29 name=__codelineno-71-29 href=#__codelineno-71-29></a><span class=w>  </span><span class=na>name</span><span class=w>                    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;gke-network&quot;</span>
</span><span id=__span-71-30><a id=__codelineno-71-30 name=__codelineno-71-30 href=#__codelineno-71-30></a><span class=w>  </span><span class=na>auto_create_subnetworks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
</span><span id=__span-71-31><a id=__codelineno-71-31 name=__codelineno-71-31 href=#__codelineno-71-31></a><span class=p>}</span>
</span><span id=__span-71-32><a id=__codelineno-71-32 name=__codelineno-71-32 href=#__codelineno-71-32></a>
</span><span id=__span-71-33><a id=__codelineno-71-33 name=__codelineno-71-33 href=#__codelineno-71-33></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_subnetwork&quot;</span><span class=w> </span><span class=nv>&quot;gke&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-34><a id=__codelineno-71-34 name=__codelineno-71-34 href=#__codelineno-71-34></a><span class=w>  </span><span class=na>name</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;gke-subnet&quot;</span>
</span><span id=__span-71-35><a id=__codelineno-71-35 name=__codelineno-71-35 href=#__codelineno-71-35></a><span class=w>  </span><span class=na>ip_cidr_range</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;10.0.0.0/20&quot;</span>
</span><span id=__span-71-36><a id=__codelineno-71-36 name=__codelineno-71-36 href=#__codelineno-71-36></a><span class=w>  </span><span class=na>region</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-71-37><a id=__codelineno-71-37 name=__codelineno-71-37 href=#__codelineno-71-37></a><span class=w>  </span><span class=na>network</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_network.gke.id</span>
</span><span id=__span-71-38><a id=__codelineno-71-38 name=__codelineno-71-38 href=#__codelineno-71-38></a>
</span><span id=__span-71-39><a id=__codelineno-71-39 name=__codelineno-71-39 href=#__codelineno-71-39></a><span class=w>  </span><span class=nb>secondary_ip_range</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-40><a id=__codelineno-71-40 name=__codelineno-71-40 href=#__codelineno-71-40></a><span class=w>    </span><span class=na>range_name</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;pods&quot;</span>
</span><span id=__span-71-41><a id=__codelineno-71-41 name=__codelineno-71-41 href=#__codelineno-71-41></a><span class=w>    </span><span class=na>ip_cidr_range</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;10.4.0.0/14&quot;</span>
</span><span id=__span-71-42><a id=__codelineno-71-42 name=__codelineno-71-42 href=#__codelineno-71-42></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-71-43><a id=__codelineno-71-43 name=__codelineno-71-43 href=#__codelineno-71-43></a>
</span><span id=__span-71-44><a id=__codelineno-71-44 name=__codelineno-71-44 href=#__codelineno-71-44></a><span class=w>  </span><span class=nb>secondary_ip_range</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-45><a id=__codelineno-71-45 name=__codelineno-71-45 href=#__codelineno-71-45></a><span class=w>    </span><span class=na>range_name</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;services&quot;</span>
</span><span id=__span-71-46><a id=__codelineno-71-46 name=__codelineno-71-46 href=#__codelineno-71-46></a><span class=w>    </span><span class=na>ip_cidr_range</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;10.8.0.0/20&quot;</span>
</span><span id=__span-71-47><a id=__codelineno-71-47 name=__codelineno-71-47 href=#__codelineno-71-47></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-71-48><a id=__codelineno-71-48 name=__codelineno-71-48 href=#__codelineno-71-48></a><span class=p>}</span>
</span><span id=__span-71-49><a id=__codelineno-71-49 name=__codelineno-71-49 href=#__codelineno-71-49></a>
</span><span id=__span-71-50><a id=__codelineno-71-50 name=__codelineno-71-50 href=#__codelineno-71-50></a><span class=c1># GKE Cluster</span>
</span><span id=__span-71-51><a id=__codelineno-71-51 name=__codelineno-71-51 href=#__codelineno-71-51></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_container_cluster&quot;</span><span class=w> </span><span class=nv>&quot;primary&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-52><a id=__codelineno-71-52 name=__codelineno-71-52 href=#__codelineno-71-52></a><span class=w>  </span><span class=na>name</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=nv>var.cluster_name</span>
</span><span id=__span-71-53><a id=__codelineno-71-53 name=__codelineno-71-53 href=#__codelineno-71-53></a><span class=w>  </span><span class=na>location</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-71-54><a id=__codelineno-71-54 name=__codelineno-71-54 href=#__codelineno-71-54></a>
</span><span id=__span-71-55><a id=__codelineno-71-55 name=__codelineno-71-55 href=#__codelineno-71-55></a><span class=c1>  # We can&#39;t create a cluster with no node pool defined, but we want to only use</span>
</span><span id=__span-71-56><a id=__codelineno-71-56 name=__codelineno-71-56 href=#__codelineno-71-56></a><span class=c1>  # separately managed node pools. So we create the smallest possible default</span>
</span><span id=__span-71-57><a id=__codelineno-71-57 name=__codelineno-71-57 href=#__codelineno-71-57></a><span class=c1>  # node pool and immediately delete it.</span>
</span><span id=__span-71-58><a id=__codelineno-71-58 name=__codelineno-71-58 href=#__codelineno-71-58></a><span class=w>  </span><span class=na>remove_default_node_pool</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-71-59><a id=__codelineno-71-59 name=__codelineno-71-59 href=#__codelineno-71-59></a><span class=w>  </span><span class=na>initial_node_count</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=m>1</span>
</span><span id=__span-71-60><a id=__codelineno-71-60 name=__codelineno-71-60 href=#__codelineno-71-60></a>
</span><span id=__span-71-61><a id=__codelineno-71-61 name=__codelineno-71-61 href=#__codelineno-71-61></a><span class=w>  </span><span class=na>network</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_network.gke.name</span>
</span><span id=__span-71-62><a id=__codelineno-71-62 name=__codelineno-71-62 href=#__codelineno-71-62></a><span class=w>  </span><span class=na>subnetwork</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_subnetwork.gke.name</span>
</span><span id=__span-71-63><a id=__codelineno-71-63 name=__codelineno-71-63 href=#__codelineno-71-63></a>
</span><span id=__span-71-64><a id=__codelineno-71-64 name=__codelineno-71-64 href=#__codelineno-71-64></a><span class=c1>  # IP allocation for VPC-native cluster</span>
</span><span id=__span-71-65><a id=__codelineno-71-65 name=__codelineno-71-65 href=#__codelineno-71-65></a><span class=w>  </span><span class=nb>ip_allocation_policy</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-66><a id=__codelineno-71-66 name=__codelineno-71-66 href=#__codelineno-71-66></a><span class=w>    </span><span class=na>cluster_secondary_range_name</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;pods&quot;</span>
</span><span id=__span-71-67><a id=__codelineno-71-67 name=__codelineno-71-67 href=#__codelineno-71-67></a><span class=w>    </span><span class=na>services_secondary_range_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;services&quot;</span>
</span><span id=__span-71-68><a id=__codelineno-71-68 name=__codelineno-71-68 href=#__codelineno-71-68></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-71-69><a id=__codelineno-71-69 name=__codelineno-71-69 href=#__codelineno-71-69></a>
</span><span id=__span-71-70><a id=__codelineno-71-70 name=__codelineno-71-70 href=#__codelineno-71-70></a><span class=c1>  # Enable Workload Identity</span>
</span><span id=__span-71-71><a id=__codelineno-71-71 name=__codelineno-71-71 href=#__codelineno-71-71></a><span class=w>  </span><span class=nb>workload_identity_config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-72><a id=__codelineno-71-72 name=__codelineno-71-72 href=#__codelineno-71-72></a><span class=w>    </span><span class=na>workload_pool</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${var.project_id}.svc.id.goog&quot;</span>
</span><span id=__span-71-73><a id=__codelineno-71-73 name=__codelineno-71-73 href=#__codelineno-71-73></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-71-74><a id=__codelineno-71-74 name=__codelineno-71-74 href=#__codelineno-71-74></a>
</span><span id=__span-71-75><a id=__codelineno-71-75 name=__codelineno-71-75 href=#__codelineno-71-75></a><span class=c1>  # Master authorized networks</span>
</span><span id=__span-71-76><a id=__codelineno-71-76 name=__codelineno-71-76 href=#__codelineno-71-76></a><span class=w>  </span><span class=nb>master_authorized_networks_config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-77><a id=__codelineno-71-77 name=__codelineno-71-77 href=#__codelineno-71-77></a><span class=w>    </span><span class=nb>cidr_blocks</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-78><a id=__codelineno-71-78 name=__codelineno-71-78 href=#__codelineno-71-78></a><span class=w>      </span><span class=na>cidr_block</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;10.0.0.0/8&quot;</span>
</span><span id=__span-71-79><a id=__codelineno-71-79 name=__codelineno-71-79 href=#__codelineno-71-79></a><span class=w>      </span><span class=na>display_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Internal&quot;</span>
</span><span id=__span-71-80><a id=__codelineno-71-80 name=__codelineno-71-80 href=#__codelineno-71-80></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-71-81><a id=__codelineno-71-81 name=__codelineno-71-81 href=#__codelineno-71-81></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-71-82><a id=__codelineno-71-82 name=__codelineno-71-82 href=#__codelineno-71-82></a>
</span><span id=__span-71-83><a id=__codelineno-71-83 name=__codelineno-71-83 href=#__codelineno-71-83></a><span class=c1>  # Monitoring and logging</span>
</span><span id=__span-71-84><a id=__codelineno-71-84 name=__codelineno-71-84 href=#__codelineno-71-84></a><span class=w>  </span><span class=na>logging_service</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;logging.googleapis.com/kubernetes&quot;</span>
</span><span id=__span-71-85><a id=__codelineno-71-85 name=__codelineno-71-85 href=#__codelineno-71-85></a><span class=w>  </span><span class=na>monitoring_service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;monitoring.googleapis.com/kubernetes&quot;</span>
</span><span id=__span-71-86><a id=__codelineno-71-86 name=__codelineno-71-86 href=#__codelineno-71-86></a>
</span><span id=__span-71-87><a id=__codelineno-71-87 name=__codelineno-71-87 href=#__codelineno-71-87></a><span class=c1>  # Addons</span>
</span><span id=__span-71-88><a id=__codelineno-71-88 name=__codelineno-71-88 href=#__codelineno-71-88></a><span class=w>  </span><span class=nb>addons_config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-89><a id=__codelineno-71-89 name=__codelineno-71-89 href=#__codelineno-71-89></a><span class=w>    </span><span class=nb>http_load_balancing</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-90><a id=__codelineno-71-90 name=__codelineno-71-90 href=#__codelineno-71-90></a><span class=w>      </span><span class=na>disabled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
</span><span id=__span-71-91><a id=__codelineno-71-91 name=__codelineno-71-91 href=#__codelineno-71-91></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-71-92><a id=__codelineno-71-92 name=__codelineno-71-92 href=#__codelineno-71-92></a>
</span><span id=__span-71-93><a id=__codelineno-71-93 name=__codelineno-71-93 href=#__codelineno-71-93></a><span class=w>    </span><span class=nb>horizontal_pod_autoscaling</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-94><a id=__codelineno-71-94 name=__codelineno-71-94 href=#__codelineno-71-94></a><span class=w>      </span><span class=na>disabled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
</span><span id=__span-71-95><a id=__codelineno-71-95 name=__codelineno-71-95 href=#__codelineno-71-95></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-71-96><a id=__codelineno-71-96 name=__codelineno-71-96 href=#__codelineno-71-96></a>
</span><span id=__span-71-97><a id=__codelineno-71-97 name=__codelineno-71-97 href=#__codelineno-71-97></a><span class=w>    </span><span class=nb>network_policy_config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-98><a id=__codelineno-71-98 name=__codelineno-71-98 href=#__codelineno-71-98></a><span class=w>      </span><span class=na>disabled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
</span><span id=__span-71-99><a id=__codelineno-71-99 name=__codelineno-71-99 href=#__codelineno-71-99></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-71-100><a id=__codelineno-71-100 name=__codelineno-71-100 href=#__codelineno-71-100></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-71-101><a id=__codelineno-71-101 name=__codelineno-71-101 href=#__codelineno-71-101></a>
</span><span id=__span-71-102><a id=__codelineno-71-102 name=__codelineno-71-102 href=#__codelineno-71-102></a><span class=c1>  # Network policy</span>
</span><span id=__span-71-103><a id=__codelineno-71-103 name=__codelineno-71-103 href=#__codelineno-71-103></a><span class=w>  </span><span class=nb>network_policy</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-104><a id=__codelineno-71-104 name=__codelineno-71-104 href=#__codelineno-71-104></a><span class=w>    </span><span class=na>enabled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-71-105><a id=__codelineno-71-105 name=__codelineno-71-105 href=#__codelineno-71-105></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-71-106><a id=__codelineno-71-106 name=__codelineno-71-106 href=#__codelineno-71-106></a>
</span><span id=__span-71-107><a id=__codelineno-71-107 name=__codelineno-71-107 href=#__codelineno-71-107></a><span class=c1>  # Maintenance window</span>
</span><span id=__span-71-108><a id=__codelineno-71-108 name=__codelineno-71-108 href=#__codelineno-71-108></a><span class=w>  </span><span class=nb>maintenance_policy</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-109><a id=__codelineno-71-109 name=__codelineno-71-109 href=#__codelineno-71-109></a><span class=w>    </span><span class=nb>daily_maintenance_window</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-110><a id=__codelineno-71-110 name=__codelineno-71-110 href=#__codelineno-71-110></a><span class=w>      </span><span class=na>start_time</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;03:00&quot;</span>
</span><span id=__span-71-111><a id=__codelineno-71-111 name=__codelineno-71-111 href=#__codelineno-71-111></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-71-112><a id=__codelineno-71-112 name=__codelineno-71-112 href=#__codelineno-71-112></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-71-113><a id=__codelineno-71-113 name=__codelineno-71-113 href=#__codelineno-71-113></a>
</span><span id=__span-71-114><a id=__codelineno-71-114 name=__codelineno-71-114 href=#__codelineno-71-114></a><span class=c1>  # Binary authorization</span>
</span><span id=__span-71-115><a id=__codelineno-71-115 name=__codelineno-71-115 href=#__codelineno-71-115></a><span class=w>  </span><span class=nb>binary_authorization</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-116><a id=__codelineno-71-116 name=__codelineno-71-116 href=#__codelineno-71-116></a><span class=w>    </span><span class=na>evaluation_mode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;PROJECT_SINGLETON_POLICY_ENFORCE&quot;</span>
</span><span id=__span-71-117><a id=__codelineno-71-117 name=__codelineno-71-117 href=#__codelineno-71-117></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-71-118><a id=__codelineno-71-118 name=__codelineno-71-118 href=#__codelineno-71-118></a><span class=p>}</span>
</span><span id=__span-71-119><a id=__codelineno-71-119 name=__codelineno-71-119 href=#__codelineno-71-119></a>
</span><span id=__span-71-120><a id=__codelineno-71-120 name=__codelineno-71-120 href=#__codelineno-71-120></a><span class=c1># Node Pool</span>
</span><span id=__span-71-121><a id=__codelineno-71-121 name=__codelineno-71-121 href=#__codelineno-71-121></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_container_node_pool&quot;</span><span class=w> </span><span class=nv>&quot;primary_nodes&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-122><a id=__codelineno-71-122 name=__codelineno-71-122 href=#__codelineno-71-122></a><span class=w>  </span><span class=na>name</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;primary-node-pool&quot;</span>
</span><span id=__span-71-123><a id=__codelineno-71-123 name=__codelineno-71-123 href=#__codelineno-71-123></a><span class=w>  </span><span class=na>location</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-71-124><a id=__codelineno-71-124 name=__codelineno-71-124 href=#__codelineno-71-124></a><span class=w>  </span><span class=na>cluster</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=nv>google_container_cluster.primary.name</span>
</span><span id=__span-71-125><a id=__codelineno-71-125 name=__codelineno-71-125 href=#__codelineno-71-125></a><span class=w>  </span><span class=na>node_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>3</span>
</span><span id=__span-71-126><a id=__codelineno-71-126 name=__codelineno-71-126 href=#__codelineno-71-126></a>
</span><span id=__span-71-127><a id=__codelineno-71-127 name=__codelineno-71-127 href=#__codelineno-71-127></a><span class=w>  </span><span class=nb>node_config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-128><a id=__codelineno-71-128 name=__codelineno-71-128 href=#__codelineno-71-128></a><span class=w>    </span><span class=na>machine_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;e2-medium&quot;</span>
</span><span id=__span-71-129><a id=__codelineno-71-129 name=__codelineno-71-129 href=#__codelineno-71-129></a>
</span><span id=__span-71-130><a id=__codelineno-71-130 name=__codelineno-71-130 href=#__codelineno-71-130></a><span class=w>    </span><span class=nb>labels</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-131><a id=__codelineno-71-131 name=__codelineno-71-131 href=#__codelineno-71-131></a><span class=w>      </span><span class=na>environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;production&quot;</span>
</span><span id=__span-71-132><a id=__codelineno-71-132 name=__codelineno-71-132 href=#__codelineno-71-132></a><span class=w>      </span><span class=na>managed_by</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;terraform&quot;</span>
</span><span id=__span-71-133><a id=__codelineno-71-133 name=__codelineno-71-133 href=#__codelineno-71-133></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-71-134><a id=__codelineno-71-134 name=__codelineno-71-134 href=#__codelineno-71-134></a>
</span><span id=__span-71-135><a id=__codelineno-71-135 name=__codelineno-71-135 href=#__codelineno-71-135></a><span class=w>    </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;gke-node&quot;, &quot;prod&quot;</span><span class=p>]</span>
</span><span id=__span-71-136><a id=__codelineno-71-136 name=__codelineno-71-136 href=#__codelineno-71-136></a>
</span><span id=__span-71-137><a id=__codelineno-71-137 name=__codelineno-71-137 href=#__codelineno-71-137></a><span class=w>    </span><span class=na>oauth_scopes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-71-138><a id=__codelineno-71-138 name=__codelineno-71-138 href=#__codelineno-71-138></a><span class=w>      </span><span class=s2>&quot;https://www.googleapis.com/auth/cloud-platform&quot;</span>
</span><span id=__span-71-139><a id=__codelineno-71-139 name=__codelineno-71-139 href=#__codelineno-71-139></a><span class=w>    </span><span class=p>]</span>
</span><span id=__span-71-140><a id=__codelineno-71-140 name=__codelineno-71-140 href=#__codelineno-71-140></a>
</span><span id=__span-71-141><a id=__codelineno-71-141 name=__codelineno-71-141 href=#__codelineno-71-141></a><span class=w>    </span><span class=na>service_account</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_service_account.gke_nodes.email</span>
</span><span id=__span-71-142><a id=__codelineno-71-142 name=__codelineno-71-142 href=#__codelineno-71-142></a>
</span><span id=__span-71-143><a id=__codelineno-71-143 name=__codelineno-71-143 href=#__codelineno-71-143></a><span class=w>    </span><span class=nb>workload_metadata_config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-144><a id=__codelineno-71-144 name=__codelineno-71-144 href=#__codelineno-71-144></a><span class=w>      </span><span class=na>mode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;GKE_METADATA&quot;</span>
</span><span id=__span-71-145><a id=__codelineno-71-145 name=__codelineno-71-145 href=#__codelineno-71-145></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-71-146><a id=__codelineno-71-146 name=__codelineno-71-146 href=#__codelineno-71-146></a>
</span><span id=__span-71-147><a id=__codelineno-71-147 name=__codelineno-71-147 href=#__codelineno-71-147></a><span class=w>    </span><span class=nb>shielded_instance_config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-148><a id=__codelineno-71-148 name=__codelineno-71-148 href=#__codelineno-71-148></a><span class=w>      </span><span class=na>enable_secure_boot</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-71-149><a id=__codelineno-71-149 name=__codelineno-71-149 href=#__codelineno-71-149></a><span class=w>      </span><span class=na>enable_integrity_monitoring</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-71-150><a id=__codelineno-71-150 name=__codelineno-71-150 href=#__codelineno-71-150></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-71-151><a id=__codelineno-71-151 name=__codelineno-71-151 href=#__codelineno-71-151></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-71-152><a id=__codelineno-71-152 name=__codelineno-71-152 href=#__codelineno-71-152></a>
</span><span id=__span-71-153><a id=__codelineno-71-153 name=__codelineno-71-153 href=#__codelineno-71-153></a><span class=w>  </span><span class=nb>autoscaling</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-154><a id=__codelineno-71-154 name=__codelineno-71-154 href=#__codelineno-71-154></a><span class=w>    </span><span class=na>min_node_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>2</span>
</span><span id=__span-71-155><a id=__codelineno-71-155 name=__codelineno-71-155 href=#__codelineno-71-155></a><span class=w>    </span><span class=na>max_node_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>10</span>
</span><span id=__span-71-156><a id=__codelineno-71-156 name=__codelineno-71-156 href=#__codelineno-71-156></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-71-157><a id=__codelineno-71-157 name=__codelineno-71-157 href=#__codelineno-71-157></a>
</span><span id=__span-71-158><a id=__codelineno-71-158 name=__codelineno-71-158 href=#__codelineno-71-158></a><span class=w>  </span><span class=nb>management</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-159><a id=__codelineno-71-159 name=__codelineno-71-159 href=#__codelineno-71-159></a><span class=w>    </span><span class=na>auto_repair</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-71-160><a id=__codelineno-71-160 name=__codelineno-71-160 href=#__codelineno-71-160></a><span class=w>    </span><span class=na>auto_upgrade</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-71-161><a id=__codelineno-71-161 name=__codelineno-71-161 href=#__codelineno-71-161></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-71-162><a id=__codelineno-71-162 name=__codelineno-71-162 href=#__codelineno-71-162></a><span class=p>}</span>
</span><span id=__span-71-163><a id=__codelineno-71-163 name=__codelineno-71-163 href=#__codelineno-71-163></a>
</span><span id=__span-71-164><a id=__codelineno-71-164 name=__codelineno-71-164 href=#__codelineno-71-164></a><span class=c1># Service Account for GKE nodes</span>
</span><span id=__span-71-165><a id=__codelineno-71-165 name=__codelineno-71-165 href=#__codelineno-71-165></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_service_account&quot;</span><span class=w> </span><span class=nv>&quot;gke_nodes&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-166><a id=__codelineno-71-166 name=__codelineno-71-166 href=#__codelineno-71-166></a><span class=w>  </span><span class=na>account_id</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;gke-node-sa&quot;</span>
</span><span id=__span-71-167><a id=__codelineno-71-167 name=__codelineno-71-167 href=#__codelineno-71-167></a><span class=w>  </span><span class=na>display_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;GKE Node Service Account&quot;</span>
</span><span id=__span-71-168><a id=__codelineno-71-168 name=__codelineno-71-168 href=#__codelineno-71-168></a><span class=p>}</span>
</span><span id=__span-71-169><a id=__codelineno-71-169 name=__codelineno-71-169 href=#__codelineno-71-169></a>
</span><span id=__span-71-170><a id=__codelineno-71-170 name=__codelineno-71-170 href=#__codelineno-71-170></a><span class=c1># IAM bindings for nodes</span>
</span><span id=__span-71-171><a id=__codelineno-71-171 name=__codelineno-71-171 href=#__codelineno-71-171></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_project_iam_member&quot;</span><span class=w> </span><span class=nv>&quot;gke_node_sa_logging&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-172><a id=__codelineno-71-172 name=__codelineno-71-172 href=#__codelineno-71-172></a><span class=w>  </span><span class=na>project</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span>
</span><span id=__span-71-173><a id=__codelineno-71-173 name=__codelineno-71-173 href=#__codelineno-71-173></a><span class=w>  </span><span class=na>role</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;roles/logging.logWriter&quot;</span>
</span><span id=__span-71-174><a id=__codelineno-71-174 name=__codelineno-71-174 href=#__codelineno-71-174></a><span class=w>  </span><span class=na>member</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;serviceAccount:${google_service_account.gke_nodes.email}&quot;</span>
</span><span id=__span-71-175><a id=__codelineno-71-175 name=__codelineno-71-175 href=#__codelineno-71-175></a><span class=p>}</span>
</span><span id=__span-71-176><a id=__codelineno-71-176 name=__codelineno-71-176 href=#__codelineno-71-176></a>
</span><span id=__span-71-177><a id=__codelineno-71-177 name=__codelineno-71-177 href=#__codelineno-71-177></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_project_iam_member&quot;</span><span class=w> </span><span class=nv>&quot;gke_node_sa_monitoring&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-178><a id=__codelineno-71-178 name=__codelineno-71-178 href=#__codelineno-71-178></a><span class=w>  </span><span class=na>project</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span>
</span><span id=__span-71-179><a id=__codelineno-71-179 name=__codelineno-71-179 href=#__codelineno-71-179></a><span class=w>  </span><span class=na>role</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;roles/monitoring.metricWriter&quot;</span>
</span><span id=__span-71-180><a id=__codelineno-71-180 name=__codelineno-71-180 href=#__codelineno-71-180></a><span class=w>  </span><span class=na>member</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;serviceAccount:${google_service_account.gke_nodes.email}&quot;</span>
</span><span id=__span-71-181><a id=__codelineno-71-181 name=__codelineno-71-181 href=#__codelineno-71-181></a><span class=p>}</span>
</span><span id=__span-71-182><a id=__codelineno-71-182 name=__codelineno-71-182 href=#__codelineno-71-182></a>
</span><span id=__span-71-183><a id=__codelineno-71-183 name=__codelineno-71-183 href=#__codelineno-71-183></a><span class=c1># Outputs</span>
</span><span id=__span-71-184><a id=__codelineno-71-184 name=__codelineno-71-184 href=#__codelineno-71-184></a><span class=kr>output</span><span class=w> </span><span class=nv>&quot;cluster_name&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-185><a id=__codelineno-71-185 name=__codelineno-71-185 href=#__codelineno-71-185></a><span class=w>  </span><span class=na>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_container_cluster.primary.name</span>
</span><span id=__span-71-186><a id=__codelineno-71-186 name=__codelineno-71-186 href=#__codelineno-71-186></a><span class=p>}</span>
</span><span id=__span-71-187><a id=__codelineno-71-187 name=__codelineno-71-187 href=#__codelineno-71-187></a>
</span><span id=__span-71-188><a id=__codelineno-71-188 name=__codelineno-71-188 href=#__codelineno-71-188></a><span class=kr>output</span><span class=w> </span><span class=nv>&quot;cluster_endpoint&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-189><a id=__codelineno-71-189 name=__codelineno-71-189 href=#__codelineno-71-189></a><span class=w>  </span><span class=na>value</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=nv>google_container_cluster.primary.endpoint</span>
</span><span id=__span-71-190><a id=__codelineno-71-190 name=__codelineno-71-190 href=#__codelineno-71-190></a><span class=w>  </span><span class=na>sensitive</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-71-191><a id=__codelineno-71-191 name=__codelineno-71-191 href=#__codelineno-71-191></a><span class=p>}</span>
</span><span id=__span-71-192><a id=__codelineno-71-192 name=__codelineno-71-192 href=#__codelineno-71-192></a>
</span><span id=__span-71-193><a id=__codelineno-71-193 name=__codelineno-71-193 href=#__codelineno-71-193></a><span class=kr>output</span><span class=w> </span><span class=nv>&quot;cluster_ca_certificate&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-194><a id=__codelineno-71-194 name=__codelineno-71-194 href=#__codelineno-71-194></a><span class=w>  </span><span class=na>value</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=nv>google_container_cluster.primary.master_auth.0.cluster_ca_certificate</span>
</span><span id=__span-71-195><a id=__codelineno-71-195 name=__codelineno-71-195 href=#__codelineno-71-195></a><span class=w>  </span><span class=na>sensitive</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-71-196><a id=__codelineno-71-196 name=__codelineno-71-196 href=#__codelineno-71-196></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>TFDrift-Falco Configuration</strong> (<code>config-gke.yaml</code>): <div class="language-yaml highlight"><pre><span></span><code><span id=__span-72-1><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a><span class=nt>providers</span><span class=p>:</span>
</span><span id=__span-72-2><a id=__codelineno-72-2 name=__codelineno-72-2 href=#__codelineno-72-2></a><span class=w>  </span><span class=nt>gcp</span><span class=p>:</span>
</span><span id=__span-72-3><a id=__codelineno-72-3 name=__codelineno-72-3 href=#__codelineno-72-3></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-72-4><a id=__codelineno-72-4 name=__codelineno-72-4 href=#__codelineno-72-4></a><span class=w>    </span><span class=nt>projects</span><span class=p>:</span>
</span><span id=__span-72-5><a id=__codelineno-72-5 name=__codelineno-72-5 href=#__codelineno-72-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;my-project-123&quot;</span>
</span><span id=__span-72-6><a id=__codelineno-72-6 name=__codelineno-72-6 href=#__codelineno-72-6></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span>
</span><span id=__span-72-7><a id=__codelineno-72-7 name=__codelineno-72-7 href=#__codelineno-72-7></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;gcs&quot;</span>
</span><span id=__span-72-8><a id=__codelineno-72-8 name=__codelineno-72-8 href=#__codelineno-72-8></a><span class=w>      </span><span class=nt>gcs_bucket</span><span class=p>:</span><span class=w> </span><span class=s>&quot;my-terraform-state&quot;</span>
</span><span id=__span-72-9><a id=__codelineno-72-9 name=__codelineno-72-9 href=#__codelineno-72-9></a><span class=w>      </span><span class=nt>gcs_prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;prod/gke/terraform.tfstate&quot;</span>
</span><span id=__span-72-10><a id=__codelineno-72-10 name=__codelineno-72-10 href=#__codelineno-72-10></a>
</span><span id=__span-72-11><a id=__codelineno-72-11 name=__codelineno-72-11 href=#__codelineno-72-11></a><span class=nt>falco</span><span class=p>:</span>
</span><span id=__span-72-12><a id=__codelineno-72-12 name=__codelineno-72-12 href=#__codelineno-72-12></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-72-13><a id=__codelineno-72-13 name=__codelineno-72-13 href=#__codelineno-72-13></a><span class=w>  </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=s>&quot;localhost&quot;</span>
</span><span id=__span-72-14><a id=__codelineno-72-14 name=__codelineno-72-14 href=#__codelineno-72-14></a><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5060</span>
</span><span id=__span-72-15><a id=__codelineno-72-15 name=__codelineno-72-15 href=#__codelineno-72-15></a>
</span><span id=__span-72-16><a id=__codelineno-72-16 name=__codelineno-72-16 href=#__codelineno-72-16></a><span class=nt>drift_rules</span><span class=p>:</span>
</span><span id=__span-72-17><a id=__codelineno-72-17 name=__codelineno-72-17 href=#__codelineno-72-17></a><span class=w>  </span><span class=c1># Critical: GKE cluster configuration</span>
</span><span id=__span-72-18><a id=__codelineno-72-18 name=__codelineno-72-18 href=#__codelineno-72-18></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;GKE</span><span class=nv> </span><span class=s>Cluster</span><span class=nv> </span><span class=s>Configuration</span><span class=nv> </span><span class=s>Change&quot;</span>
</span><span id=__span-72-19><a id=__codelineno-72-19 name=__codelineno-72-19 href=#__codelineno-72-19></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-72-20><a id=__codelineno-72-20 name=__codelineno-72-20 href=#__codelineno-72-20></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_container_cluster&quot;</span>
</span><span id=__span-72-21><a id=__codelineno-72-21 name=__codelineno-72-21 href=#__codelineno-72-21></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-72-22><a id=__codelineno-72-22 name=__codelineno-72-22 href=#__codelineno-72-22></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;master_authorized_networks_config&quot;</span>
</span><span id=__span-72-23><a id=__codelineno-72-23 name=__codelineno-72-23 href=#__codelineno-72-23></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;workload_identity_config&quot;</span>
</span><span id=__span-72-24><a id=__codelineno-72-24 name=__codelineno-72-24 href=#__codelineno-72-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;binary_authorization&quot;</span>
</span><span id=__span-72-25><a id=__codelineno-72-25 name=__codelineno-72-25 href=#__codelineno-72-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;network_policy&quot;</span>
</span><span id=__span-72-26><a id=__codelineno-72-26 name=__codelineno-72-26 href=#__codelineno-72-26></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span>
</span><span id=__span-72-27><a id=__codelineno-72-27 name=__codelineno-72-27 href=#__codelineno-72-27></a>
</span><span id=__span-72-28><a id=__codelineno-72-28 name=__codelineno-72-28 href=#__codelineno-72-28></a><span class=w>  </span><span class=c1># High: Node pool configuration</span>
</span><span id=__span-72-29><a id=__codelineno-72-29 name=__codelineno-72-29 href=#__codelineno-72-29></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;GKE</span><span class=nv> </span><span class=s>Node</span><span class=nv> </span><span class=s>Pool</span><span class=nv> </span><span class=s>Modification&quot;</span>
</span><span id=__span-72-30><a id=__codelineno-72-30 name=__codelineno-72-30 href=#__codelineno-72-30></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-72-31><a id=__codelineno-72-31 name=__codelineno-72-31 href=#__codelineno-72-31></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_container_node_pool&quot;</span>
</span><span id=__span-72-32><a id=__codelineno-72-32 name=__codelineno-72-32 href=#__codelineno-72-32></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-72-33><a id=__codelineno-72-33 name=__codelineno-72-33 href=#__codelineno-72-33></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;node_config&quot;</span>
</span><span id=__span-72-34><a id=__codelineno-72-34 name=__codelineno-72-34 href=#__codelineno-72-34></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;autoscaling&quot;</span>
</span><span id=__span-72-35><a id=__codelineno-72-35 name=__codelineno-72-35 href=#__codelineno-72-35></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;management&quot;</span>
</span><span id=__span-72-36><a id=__codelineno-72-36 name=__codelineno-72-36 href=#__codelineno-72-36></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;high&quot;</span>
</span><span id=__span-72-37><a id=__codelineno-72-37 name=__codelineno-72-37 href=#__codelineno-72-37></a>
</span><span id=__span-72-38><a id=__codelineno-72-38 name=__codelineno-72-38 href=#__codelineno-72-38></a><span class=w>  </span><span class=c1># Medium: Node pool scaling</span>
</span><span id=__span-72-39><a id=__codelineno-72-39 name=__codelineno-72-39 href=#__codelineno-72-39></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Node</span><span class=nv> </span><span class=s>Pool</span><span class=nv> </span><span class=s>Size</span><span class=nv> </span><span class=s>Change&quot;</span>
</span><span id=__span-72-40><a id=__codelineno-72-40 name=__codelineno-72-40 href=#__codelineno-72-40></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-72-41><a id=__codelineno-72-41 name=__codelineno-72-41 href=#__codelineno-72-41></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_container_node_pool&quot;</span>
</span><span id=__span-72-42><a id=__codelineno-72-42 name=__codelineno-72-42 href=#__codelineno-72-42></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-72-43><a id=__codelineno-72-43 name=__codelineno-72-43 href=#__codelineno-72-43></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;node_count&quot;</span>
</span><span id=__span-72-44><a id=__codelineno-72-44 name=__codelineno-72-44 href=#__codelineno-72-44></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;medium&quot;</span>
</span><span id=__span-72-45><a id=__codelineno-72-45 name=__codelineno-72-45 href=#__codelineno-72-45></a>
</span><span id=__span-72-46><a id=__codelineno-72-46 name=__codelineno-72-46 href=#__codelineno-72-46></a><span class=nt>notifications</span><span class=p>:</span>
</span><span id=__span-72-47><a id=__codelineno-72-47 name=__codelineno-72-47 href=#__codelineno-72-47></a><span class=w>  </span><span class=nt>slack</span><span class=p>:</span>
</span><span id=__span-72-48><a id=__codelineno-72-48 name=__codelineno-72-48 href=#__codelineno-72-48></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-72-49><a id=__codelineno-72-49 name=__codelineno-72-49 href=#__codelineno-72-49></a><span class=w>    </span><span class=nt>webhook_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://hooks.slack.com/services/YOUR/WEBHOOK/URL&quot;</span>
</span><span id=__span-72-50><a id=__codelineno-72-50 name=__codelineno-72-50 href=#__codelineno-72-50></a>
</span><span id=__span-72-51><a id=__codelineno-72-51 name=__codelineno-72-51 href=#__codelineno-72-51></a><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-72-52><a id=__codelineno-72-52 name=__codelineno-72-52 href=#__codelineno-72-52></a><span class=w>  </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=s>&quot;info&quot;</span>
</span><span id=__span-72-53><a id=__codelineno-72-53 name=__codelineno-72-53 href=#__codelineno-72-53></a><span class=w>  </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=s>&quot;json&quot;</span>
</span></code></pre></div></p> <hr> <h3 id=example-4-production-multi-project-setup>Example 4: Production Multi-Project Setup<a class=headerlink href=#example-4-production-multi-project-setup title="Permanent link">&para;</a></h3> <p><strong>Directory Structure:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-73-1><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a>terraform/
</span><span id=__span-73-2><a id=__codelineno-73-2 name=__codelineno-73-2 href=#__codelineno-73-2></a>‚îú‚îÄ‚îÄ environments/
</span><span id=__span-73-3><a id=__codelineno-73-3 name=__codelineno-73-3 href=#__codelineno-73-3></a>‚îÇ   ‚îú‚îÄ‚îÄ prod/
</span><span id=__span-73-4><a id=__codelineno-73-4 name=__codelineno-73-4 href=#__codelineno-73-4></a>‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
</span><span id=__span-73-5><a id=__codelineno-73-5 name=__codelineno-73-5 href=#__codelineno-73-5></a>‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
</span><span id=__span-73-6><a id=__codelineno-73-6 name=__codelineno-73-6 href=#__codelineno-73-6></a>‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ terraform.tfvars
</span><span id=__span-73-7><a id=__codelineno-73-7 name=__codelineno-73-7 href=#__codelineno-73-7></a>‚îÇ   ‚îî‚îÄ‚îÄ staging/
</span><span id=__span-73-8><a id=__codelineno-73-8 name=__codelineno-73-8 href=#__codelineno-73-8></a>‚îÇ       ‚îú‚îÄ‚îÄ main.tf
</span><span id=__span-73-9><a id=__codelineno-73-9 name=__codelineno-73-9 href=#__codelineno-73-9></a>‚îÇ       ‚îú‚îÄ‚îÄ variables.tf
</span><span id=__span-73-10><a id=__codelineno-73-10 name=__codelineno-73-10 href=#__codelineno-73-10></a>‚îÇ       ‚îî‚îÄ‚îÄ terraform.tfvars
</span><span id=__span-73-11><a id=__codelineno-73-11 name=__codelineno-73-11 href=#__codelineno-73-11></a>‚îú‚îÄ‚îÄ modules/
</span><span id=__span-73-12><a id=__codelineno-73-12 name=__codelineno-73-12 href=#__codelineno-73-12></a>‚îÇ   ‚îú‚îÄ‚îÄ compute/
</span><span id=__span-73-13><a id=__codelineno-73-13 name=__codelineno-73-13 href=#__codelineno-73-13></a>‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
</span><span id=__span-73-14><a id=__codelineno-73-14 name=__codelineno-73-14 href=#__codelineno-73-14></a>‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
</span><span id=__span-73-15><a id=__codelineno-73-15 name=__codelineno-73-15 href=#__codelineno-73-15></a>‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf
</span><span id=__span-73-16><a id=__codelineno-73-16 name=__codelineno-73-16 href=#__codelineno-73-16></a>‚îÇ   ‚îú‚îÄ‚îÄ networking/
</span><span id=__span-73-17><a id=__codelineno-73-17 name=__codelineno-73-17 href=#__codelineno-73-17></a>‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
</span><span id=__span-73-18><a id=__codelineno-73-18 name=__codelineno-73-18 href=#__codelineno-73-18></a>‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
</span><span id=__span-73-19><a id=__codelineno-73-19 name=__codelineno-73-19 href=#__codelineno-73-19></a>‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf
</span><span id=__span-73-20><a id=__codelineno-73-20 name=__codelineno-73-20 href=#__codelineno-73-20></a>‚îÇ   ‚îî‚îÄ‚îÄ security/
</span><span id=__span-73-21><a id=__codelineno-73-21 name=__codelineno-73-21 href=#__codelineno-73-21></a>‚îÇ       ‚îú‚îÄ‚îÄ main.tf
</span><span id=__span-73-22><a id=__codelineno-73-22 name=__codelineno-73-22 href=#__codelineno-73-22></a>‚îÇ       ‚îú‚îÄ‚îÄ variables.tf
</span><span id=__span-73-23><a id=__codelineno-73-23 name=__codelineno-73-23 href=#__codelineno-73-23></a>‚îÇ       ‚îî‚îÄ‚îÄ outputs.tf
</span><span id=__span-73-24><a id=__codelineno-73-24 name=__codelineno-73-24 href=#__codelineno-73-24></a>‚îî‚îÄ‚îÄ tfdrift-config/
</span><span id=__span-73-25><a id=__codelineno-73-25 name=__codelineno-73-25 href=#__codelineno-73-25></a>    ‚îú‚îÄ‚îÄ config-prod.yaml
</span><span id=__span-73-26><a id=__codelineno-73-26 name=__codelineno-73-26 href=#__codelineno-73-26></a>    ‚îî‚îÄ‚îÄ config-staging.yaml
</span></code></pre></div></p> <p><strong>Module Example</strong> (<code>modules/compute/main.tf</code>): <div class="language-hcl highlight"><pre><span></span><code><span id=__span-74-1><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_instance&quot;</span><span class=w> </span><span class=nv>&quot;this&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-74-2><a id=__codelineno-74-2 name=__codelineno-74-2 href=#__codelineno-74-2></a><span class=w>  </span><span class=na>name</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=nv>var.instance_name</span>
</span><span id=__span-74-3><a id=__codelineno-74-3 name=__codelineno-74-3 href=#__codelineno-74-3></a><span class=w>  </span><span class=na>machine_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.machine_type</span>
</span><span id=__span-74-4><a id=__codelineno-74-4 name=__codelineno-74-4 href=#__codelineno-74-4></a><span class=w>  </span><span class=na>zone</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=nv>var.zone</span>
</span><span id=__span-74-5><a id=__codelineno-74-5 name=__codelineno-74-5 href=#__codelineno-74-5></a>
</span><span id=__span-74-6><a id=__codelineno-74-6 name=__codelineno-74-6 href=#__codelineno-74-6></a><span class=w>  </span><span class=na>tags</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>var.tags</span>
</span><span id=__span-74-7><a id=__codelineno-74-7 name=__codelineno-74-7 href=#__codelineno-74-7></a><span class=w>  </span><span class=na>labels</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.labels</span>
</span><span id=__span-74-8><a id=__codelineno-74-8 name=__codelineno-74-8 href=#__codelineno-74-8></a>
</span><span id=__span-74-9><a id=__codelineno-74-9 name=__codelineno-74-9 href=#__codelineno-74-9></a><span class=w>  </span><span class=nb>boot_disk</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-74-10><a id=__codelineno-74-10 name=__codelineno-74-10 href=#__codelineno-74-10></a><span class=w>    </span><span class=nb>initialize_params</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-74-11><a id=__codelineno-74-11 name=__codelineno-74-11 href=#__codelineno-74-11></a><span class=w>      </span><span class=na>image</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.boot_disk_image</span>
</span><span id=__span-74-12><a id=__codelineno-74-12 name=__codelineno-74-12 href=#__codelineno-74-12></a><span class=w>      </span><span class=na>size</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>var.boot_disk_size</span>
</span><span id=__span-74-13><a id=__codelineno-74-13 name=__codelineno-74-13 href=#__codelineno-74-13></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-74-14><a id=__codelineno-74-14 name=__codelineno-74-14 href=#__codelineno-74-14></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-74-15><a id=__codelineno-74-15 name=__codelineno-74-15 href=#__codelineno-74-15></a>
</span><span id=__span-74-16><a id=__codelineno-74-16 name=__codelineno-74-16 href=#__codelineno-74-16></a><span class=w>  </span><span class=nb>network_interface</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-74-17><a id=__codelineno-74-17 name=__codelineno-74-17 href=#__codelineno-74-17></a><span class=w>    </span><span class=na>subnetwork</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.subnetwork</span>
</span><span id=__span-74-18><a id=__codelineno-74-18 name=__codelineno-74-18 href=#__codelineno-74-18></a>
</span><span id=__span-74-19><a id=__codelineno-74-19 name=__codelineno-74-19 href=#__codelineno-74-19></a><span class=w>    </span><span class=err>dynamic</span><span class=w> </span><span class=s2>&quot;access_config&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-74-20><a id=__codelineno-74-20 name=__codelineno-74-20 href=#__codelineno-74-20></a><span class=w>      </span><span class=na>for_each</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.enable_external_ip</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=p>[</span><span class=m>1</span><span class=p>]</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=p>[]</span>
</span><span id=__span-74-21><a id=__codelineno-74-21 name=__codelineno-74-21 href=#__codelineno-74-21></a><span class=w>      </span><span class=nb>content</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-74-22><a id=__codelineno-74-22 name=__codelineno-74-22 href=#__codelineno-74-22></a><span class=w>        </span><span class=na>nat_ip</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.external_ip</span>
</span><span id=__span-74-23><a id=__codelineno-74-23 name=__codelineno-74-23 href=#__codelineno-74-23></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-74-24><a id=__codelineno-74-24 name=__codelineno-74-24 href=#__codelineno-74-24></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-74-25><a id=__codelineno-74-25 name=__codelineno-74-25 href=#__codelineno-74-25></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-74-26><a id=__codelineno-74-26 name=__codelineno-74-26 href=#__codelineno-74-26></a>
</span><span id=__span-74-27><a id=__codelineno-74-27 name=__codelineno-74-27 href=#__codelineno-74-27></a><span class=w>  </span><span class=na>metadata</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.metadata</span>
</span><span id=__span-74-28><a id=__codelineno-74-28 name=__codelineno-74-28 href=#__codelineno-74-28></a>
</span><span id=__span-74-29><a id=__codelineno-74-29 name=__codelineno-74-29 href=#__codelineno-74-29></a><span class=w>  </span><span class=nb>service_account</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-74-30><a id=__codelineno-74-30 name=__codelineno-74-30 href=#__codelineno-74-30></a><span class=w>    </span><span class=na>email</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>var.service_account_email</span>
</span><span id=__span-74-31><a id=__codelineno-74-31 name=__codelineno-74-31 href=#__codelineno-74-31></a><span class=w>    </span><span class=na>scopes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.service_account_scopes</span>
</span><span id=__span-74-32><a id=__codelineno-74-32 name=__codelineno-74-32 href=#__codelineno-74-32></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-74-33><a id=__codelineno-74-33 name=__codelineno-74-33 href=#__codelineno-74-33></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Environment Configuration</strong> (<code>environments/prod/main.tf</code>): <div class="language-hcl highlight"><pre><span></span><code><span id=__span-75-1><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a><span class=nb>terraform</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-75-2><a id=__codelineno-75-2 name=__codelineno-75-2 href=#__codelineno-75-2></a><span class=w>  </span><span class=kr>backend</span><span class=w> </span><span class=nv>&quot;gcs&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-75-3><a id=__codelineno-75-3 name=__codelineno-75-3 href=#__codelineno-75-3></a><span class=w>    </span><span class=na>bucket</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;company-terraform-state&quot;</span>
</span><span id=__span-75-4><a id=__codelineno-75-4 name=__codelineno-75-4 href=#__codelineno-75-4></a><span class=w>    </span><span class=na>prefix</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod&quot;</span>
</span><span id=__span-75-5><a id=__codelineno-75-5 name=__codelineno-75-5 href=#__codelineno-75-5></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-75-6><a id=__codelineno-75-6 name=__codelineno-75-6 href=#__codelineno-75-6></a><span class=p>}</span>
</span><span id=__span-75-7><a id=__codelineno-75-7 name=__codelineno-75-7 href=#__codelineno-75-7></a>
</span><span id=__span-75-8><a id=__codelineno-75-8 name=__codelineno-75-8 href=#__codelineno-75-8></a><span class=kr>module</span><span class=w> </span><span class=nv>&quot;networking&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-75-9><a id=__codelineno-75-9 name=__codelineno-75-9 href=#__codelineno-75-9></a><span class=w>  </span><span class=na>source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;../../modules/networking&quot;</span>
</span><span id=__span-75-10><a id=__codelineno-75-10 name=__codelineno-75-10 href=#__codelineno-75-10></a>
</span><span id=__span-75-11><a id=__codelineno-75-11 name=__codelineno-75-11 href=#__codelineno-75-11></a><span class=w>  </span><span class=na>project_id</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span>
</span><span id=__span-75-12><a id=__codelineno-75-12 name=__codelineno-75-12 href=#__codelineno-75-12></a><span class=w>  </span><span class=na>region</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-75-13><a id=__codelineno-75-13 name=__codelineno-75-13 href=#__codelineno-75-13></a><span class=w>  </span><span class=na>network_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod-network&quot;</span>
</span><span id=__span-75-14><a id=__codelineno-75-14 name=__codelineno-75-14 href=#__codelineno-75-14></a>
</span><span id=__span-75-15><a id=__codelineno-75-15 name=__codelineno-75-15 href=#__codelineno-75-15></a><span class=w>  </span><span class=na>subnets</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-75-16><a id=__codelineno-75-16 name=__codelineno-75-16 href=#__codelineno-75-16></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-75-17><a id=__codelineno-75-17 name=__codelineno-75-17 href=#__codelineno-75-17></a><span class=w>      </span><span class=na>name</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod-subnet-web&quot;</span>
</span><span id=__span-75-18><a id=__codelineno-75-18 name=__codelineno-75-18 href=#__codelineno-75-18></a><span class=w>      </span><span class=na>ip_cidr_range</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;10.0.1.0/24&quot;</span>
</span><span id=__span-75-19><a id=__codelineno-75-19 name=__codelineno-75-19 href=#__codelineno-75-19></a><span class=w>      </span><span class=na>region</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;us-central1&quot;</span>
</span><span id=__span-75-20><a id=__codelineno-75-20 name=__codelineno-75-20 href=#__codelineno-75-20></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-75-21><a id=__codelineno-75-21 name=__codelineno-75-21 href=#__codelineno-75-21></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-75-22><a id=__codelineno-75-22 name=__codelineno-75-22 href=#__codelineno-75-22></a><span class=w>      </span><span class=na>name</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod-subnet-db&quot;</span>
</span><span id=__span-75-23><a id=__codelineno-75-23 name=__codelineno-75-23 href=#__codelineno-75-23></a><span class=w>      </span><span class=na>ip_cidr_range</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;10.0.2.0/24&quot;</span>
</span><span id=__span-75-24><a id=__codelineno-75-24 name=__codelineno-75-24 href=#__codelineno-75-24></a><span class=w>      </span><span class=na>region</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;us-central1&quot;</span>
</span><span id=__span-75-25><a id=__codelineno-75-25 name=__codelineno-75-25 href=#__codelineno-75-25></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-75-26><a id=__codelineno-75-26 name=__codelineno-75-26 href=#__codelineno-75-26></a><span class=w>  </span><span class=p>]</span>
</span><span id=__span-75-27><a id=__codelineno-75-27 name=__codelineno-75-27 href=#__codelineno-75-27></a><span class=p>}</span>
</span><span id=__span-75-28><a id=__codelineno-75-28 name=__codelineno-75-28 href=#__codelineno-75-28></a>
</span><span id=__span-75-29><a id=__codelineno-75-29 name=__codelineno-75-29 href=#__codelineno-75-29></a><span class=kr>module</span><span class=w> </span><span class=nv>&quot;web_servers&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-75-30><a id=__codelineno-75-30 name=__codelineno-75-30 href=#__codelineno-75-30></a><span class=w>  </span><span class=na>source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;../../modules/compute&quot;</span>
</span><span id=__span-75-31><a id=__codelineno-75-31 name=__codelineno-75-31 href=#__codelineno-75-31></a><span class=w>  </span><span class=na>count</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>3</span>
</span><span id=__span-75-32><a id=__codelineno-75-32 name=__codelineno-75-32 href=#__codelineno-75-32></a>
</span><span id=__span-75-33><a id=__codelineno-75-33 name=__codelineno-75-33 href=#__codelineno-75-33></a><span class=w>  </span><span class=na>instance_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod-web-${count.index}&quot;</span>
</span><span id=__span-75-34><a id=__codelineno-75-34 name=__codelineno-75-34 href=#__codelineno-75-34></a><span class=w>  </span><span class=na>machine_type</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;n2-standard-2&quot;</span>
</span><span id=__span-75-35><a id=__codelineno-75-35 name=__codelineno-75-35 href=#__codelineno-75-35></a><span class=w>  </span><span class=na>zone</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;us-central1-a&quot;</span>
</span><span id=__span-75-36><a id=__codelineno-75-36 name=__codelineno-75-36 href=#__codelineno-75-36></a><span class=w>  </span><span class=na>subnetwork</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=nv>module.networking.subnet_ids</span><span class=p>[</span><span class=s2>&quot;prod-subnet-web&quot;</span><span class=p>]</span>
</span><span id=__span-75-37><a id=__codelineno-75-37 name=__codelineno-75-37 href=#__codelineno-75-37></a>
</span><span id=__span-75-38><a id=__codelineno-75-38 name=__codelineno-75-38 href=#__codelineno-75-38></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;web&quot;, &quot;prod&quot;</span><span class=p>]</span>
</span><span id=__span-75-39><a id=__codelineno-75-39 name=__codelineno-75-39 href=#__codelineno-75-39></a>
</span><span id=__span-75-40><a id=__codelineno-75-40 name=__codelineno-75-40 href=#__codelineno-75-40></a><span class=w>  </span><span class=nb>labels</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-75-41><a id=__codelineno-75-41 name=__codelineno-75-41 href=#__codelineno-75-41></a><span class=w>    </span><span class=na>environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;production&quot;</span>
</span><span id=__span-75-42><a id=__codelineno-75-42 name=__codelineno-75-42 href=#__codelineno-75-42></a><span class=w>    </span><span class=na>tier</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;web&quot;</span>
</span><span id=__span-75-43><a id=__codelineno-75-43 name=__codelineno-75-43 href=#__codelineno-75-43></a><span class=w>    </span><span class=na>managed_by</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;terraform&quot;</span>
</span><span id=__span-75-44><a id=__codelineno-75-44 name=__codelineno-75-44 href=#__codelineno-75-44></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-75-45><a id=__codelineno-75-45 name=__codelineno-75-45 href=#__codelineno-75-45></a>
</span><span id=__span-75-46><a id=__codelineno-75-46 name=__codelineno-75-46 href=#__codelineno-75-46></a><span class=w>  </span><span class=na>service_account_email</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>module.security.web_sa_email</span>
</span><span id=__span-75-47><a id=__codelineno-75-47 name=__codelineno-75-47 href=#__codelineno-75-47></a><span class=w>  </span><span class=na>service_account_scopes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;cloud-platform&quot;</span><span class=p>]</span>
</span><span id=__span-75-48><a id=__codelineno-75-48 name=__codelineno-75-48 href=#__codelineno-75-48></a><span class=p>}</span>
</span><span id=__span-75-49><a id=__codelineno-75-49 name=__codelineno-75-49 href=#__codelineno-75-49></a>
</span><span id=__span-75-50><a id=__codelineno-75-50 name=__codelineno-75-50 href=#__codelineno-75-50></a><span class=kr>module</span><span class=w> </span><span class=nv>&quot;security&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-75-51><a id=__codelineno-75-51 name=__codelineno-75-51 href=#__codelineno-75-51></a><span class=w>  </span><span class=na>source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;../../modules/security&quot;</span>
</span><span id=__span-75-52><a id=__codelineno-75-52 name=__codelineno-75-52 href=#__codelineno-75-52></a>
</span><span id=__span-75-53><a id=__codelineno-75-53 name=__codelineno-75-53 href=#__codelineno-75-53></a><span class=w>  </span><span class=na>project_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span>
</span><span id=__span-75-54><a id=__codelineno-75-54 name=__codelineno-75-54 href=#__codelineno-75-54></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>TFDrift-Falco Production Config</strong> (<code>tfdrift-config/config-prod.yaml</code>): <div class="language-yaml highlight"><pre><span></span><code><span id=__span-76-1><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a><span class=nt>providers</span><span class=p>:</span>
</span><span id=__span-76-2><a id=__codelineno-76-2 name=__codelineno-76-2 href=#__codelineno-76-2></a><span class=w>  </span><span class=nt>gcp</span><span class=p>:</span>
</span><span id=__span-76-3><a id=__codelineno-76-3 name=__codelineno-76-3 href=#__codelineno-76-3></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-76-4><a id=__codelineno-76-4 name=__codelineno-76-4 href=#__codelineno-76-4></a><span class=w>    </span><span class=nt>projects</span><span class=p>:</span>
</span><span id=__span-76-5><a id=__codelineno-76-5 name=__codelineno-76-5 href=#__codelineno-76-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;company-prod-123&quot;</span>
</span><span id=__span-76-6><a id=__codelineno-76-6 name=__codelineno-76-6 href=#__codelineno-76-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;company-prod-456&quot;</span>
</span><span id=__span-76-7><a id=__codelineno-76-7 name=__codelineno-76-7 href=#__codelineno-76-7></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span>
</span><span id=__span-76-8><a id=__codelineno-76-8 name=__codelineno-76-8 href=#__codelineno-76-8></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;gcs&quot;</span>
</span><span id=__span-76-9><a id=__codelineno-76-9 name=__codelineno-76-9 href=#__codelineno-76-9></a><span class=w>      </span><span class=nt>gcs_bucket</span><span class=p>:</span><span class=w> </span><span class=s>&quot;company-terraform-state&quot;</span>
</span><span id=__span-76-10><a id=__codelineno-76-10 name=__codelineno-76-10 href=#__codelineno-76-10></a><span class=w>      </span><span class=nt>gcs_prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{PROJECT_ID}/terraform.tfstate&quot;</span>
</span><span id=__span-76-11><a id=__codelineno-76-11 name=__codelineno-76-11 href=#__codelineno-76-11></a>
</span><span id=__span-76-12><a id=__codelineno-76-12 name=__codelineno-76-12 href=#__codelineno-76-12></a><span class=nt>falco</span><span class=p>:</span>
</span><span id=__span-76-13><a id=__codelineno-76-13 name=__codelineno-76-13 href=#__codelineno-76-13></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-76-14><a id=__codelineno-76-14 name=__codelineno-76-14 href=#__codelineno-76-14></a><span class=w>  </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=s>&quot;falco.internal.company.com&quot;</span>
</span><span id=__span-76-15><a id=__codelineno-76-15 name=__codelineno-76-15 href=#__codelineno-76-15></a><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5060</span>
</span><span id=__span-76-16><a id=__codelineno-76-16 name=__codelineno-76-16 href=#__codelineno-76-16></a><span class=w>  </span><span class=nt>tls</span><span class=p>:</span>
</span><span id=__span-76-17><a id=__codelineno-76-17 name=__codelineno-76-17 href=#__codelineno-76-17></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-76-18><a id=__codelineno-76-18 name=__codelineno-76-18 href=#__codelineno-76-18></a><span class=w>    </span><span class=nt>ca_cert</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/tfdrift/certs/ca.crt&quot;</span>
</span><span id=__span-76-19><a id=__codelineno-76-19 name=__codelineno-76-19 href=#__codelineno-76-19></a><span class=w>    </span><span class=nt>client_cert</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/tfdrift/certs/client.crt&quot;</span>
</span><span id=__span-76-20><a id=__codelineno-76-20 name=__codelineno-76-20 href=#__codelineno-76-20></a><span class=w>    </span><span class=nt>client_key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/tfdrift/certs/client.key&quot;</span>
</span><span id=__span-76-21><a id=__codelineno-76-21 name=__codelineno-76-21 href=#__codelineno-76-21></a>
</span><span id=__span-76-22><a id=__codelineno-76-22 name=__codelineno-76-22 href=#__codelineno-76-22></a><span class=nt>drift_rules</span><span class=p>:</span>
</span><span id=__span-76-23><a id=__codelineno-76-23 name=__codelineno-76-23 href=#__codelineno-76-23></a><span class=w>  </span><span class=c1># Production-critical rules</span>
</span><span id=__span-76-24><a id=__codelineno-76-24 name=__codelineno-76-24 href=#__codelineno-76-24></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Production</span><span class=nv> </span><span class=s>IAM</span><span class=nv> </span><span class=s>Changes&quot;</span>
</span><span id=__span-76-25><a id=__codelineno-76-25 name=__codelineno-76-25 href=#__codelineno-76-25></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-76-26><a id=__codelineno-76-26 name=__codelineno-76-26 href=#__codelineno-76-26></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_project_iam_member&quot;</span>
</span><span id=__span-76-27><a id=__codelineno-76-27 name=__codelineno-76-27 href=#__codelineno-76-27></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_project_iam_binding&quot;</span>
</span><span id=__span-76-28><a id=__codelineno-76-28 name=__codelineno-76-28 href=#__codelineno-76-28></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_service_account_iam_binding&quot;</span>
</span><span id=__span-76-29><a id=__codelineno-76-29 name=__codelineno-76-29 href=#__codelineno-76-29></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-76-30><a id=__codelineno-76-30 name=__codelineno-76-30 href=#__codelineno-76-30></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;role&quot;</span>
</span><span id=__span-76-31><a id=__codelineno-76-31 name=__codelineno-76-31 href=#__codelineno-76-31></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;members&quot;</span>
</span><span id=__span-76-32><a id=__codelineno-76-32 name=__codelineno-76-32 href=#__codelineno-76-32></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span>
</span><span id=__span-76-33><a id=__codelineno-76-33 name=__codelineno-76-33 href=#__codelineno-76-33></a>
</span><span id=__span-76-34><a id=__codelineno-76-34 name=__codelineno-76-34 href=#__codelineno-76-34></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Production</span><span class=nv> </span><span class=s>Database</span><span class=nv> </span><span class=s>Changes&quot;</span>
</span><span id=__span-76-35><a id=__codelineno-76-35 name=__codelineno-76-35 href=#__codelineno-76-35></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-76-36><a id=__codelineno-76-36 name=__codelineno-76-36 href=#__codelineno-76-36></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_sql_database_instance&quot;</span>
</span><span id=__span-76-37><a id=__codelineno-76-37 name=__codelineno-76-37 href=#__codelineno-76-37></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-76-38><a id=__codelineno-76-38 name=__codelineno-76-38 href=#__codelineno-76-38></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;settings&quot;</span>
</span><span id=__span-76-39><a id=__codelineno-76-39 name=__codelineno-76-39 href=#__codelineno-76-39></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;deletion_protection&quot;</span>
</span><span id=__span-76-40><a id=__codelineno-76-40 name=__codelineno-76-40 href=#__codelineno-76-40></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;database_version&quot;</span>
</span><span id=__span-76-41><a id=__codelineno-76-41 name=__codelineno-76-41 href=#__codelineno-76-41></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span>
</span><span id=__span-76-42><a id=__codelineno-76-42 name=__codelineno-76-42 href=#__codelineno-76-42></a>
</span><span id=__span-76-43><a id=__codelineno-76-43 name=__codelineno-76-43 href=#__codelineno-76-43></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Production</span><span class=nv> </span><span class=s>Network</span><span class=nv> </span><span class=s>Security&quot;</span>
</span><span id=__span-76-44><a id=__codelineno-76-44 name=__codelineno-76-44 href=#__codelineno-76-44></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-76-45><a id=__codelineno-76-45 name=__codelineno-76-45 href=#__codelineno-76-45></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_firewall&quot;</span>
</span><span id=__span-76-46><a id=__codelineno-76-46 name=__codelineno-76-46 href=#__codelineno-76-46></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_security_policy&quot;</span>
</span><span id=__span-76-47><a id=__codelineno-76-47 name=__codelineno-76-47 href=#__codelineno-76-47></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-76-48><a id=__codelineno-76-48 name=__codelineno-76-48 href=#__codelineno-76-48></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;allow&quot;</span>
</span><span id=__span-76-49><a id=__codelineno-76-49 name=__codelineno-76-49 href=#__codelineno-76-49></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;deny&quot;</span>
</span><span id=__span-76-50><a id=__codelineno-76-50 name=__codelineno-76-50 href=#__codelineno-76-50></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;source_ranges&quot;</span>
</span><span id=__span-76-51><a id=__codelineno-76-51 name=__codelineno-76-51 href=#__codelineno-76-51></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span>
</span><span id=__span-76-52><a id=__codelineno-76-52 name=__codelineno-76-52 href=#__codelineno-76-52></a>
</span><span id=__span-76-53><a id=__codelineno-76-53 name=__codelineno-76-53 href=#__codelineno-76-53></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Production</span><span class=nv> </span><span class=s>Compute</span><span class=nv> </span><span class=s>Changes&quot;</span>
</span><span id=__span-76-54><a id=__codelineno-76-54 name=__codelineno-76-54 href=#__codelineno-76-54></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-76-55><a id=__codelineno-76-55 name=__codelineno-76-55 href=#__codelineno-76-55></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_instance&quot;</span>
</span><span id=__span-76-56><a id=__codelineno-76-56 name=__codelineno-76-56 href=#__codelineno-76-56></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_instance_template&quot;</span>
</span><span id=__span-76-57><a id=__codelineno-76-57 name=__codelineno-76-57 href=#__codelineno-76-57></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-76-58><a id=__codelineno-76-58 name=__codelineno-76-58 href=#__codelineno-76-58></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;machine_type&quot;</span>
</span><span id=__span-76-59><a id=__codelineno-76-59 name=__codelineno-76-59 href=#__codelineno-76-59></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;metadata&quot;</span>
</span><span id=__span-76-60><a id=__codelineno-76-60 name=__codelineno-76-60 href=#__codelineno-76-60></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;labels&quot;</span>
</span><span id=__span-76-61><a id=__codelineno-76-61 name=__codelineno-76-61 href=#__codelineno-76-61></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;service_account&quot;</span>
</span><span id=__span-76-62><a id=__codelineno-76-62 name=__codelineno-76-62 href=#__codelineno-76-62></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;high&quot;</span>
</span><span id=__span-76-63><a id=__codelineno-76-63 name=__codelineno-76-63 href=#__codelineno-76-63></a>
</span><span id=__span-76-64><a id=__codelineno-76-64 name=__codelineno-76-64 href=#__codelineno-76-64></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Production</span><span class=nv> </span><span class=s>GKE</span><span class=nv> </span><span class=s>Cluster</span><span class=nv> </span><span class=s>Changes&quot;</span>
</span><span id=__span-76-65><a id=__codelineno-76-65 name=__codelineno-76-65 href=#__codelineno-76-65></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-76-66><a id=__codelineno-76-66 name=__codelineno-76-66 href=#__codelineno-76-66></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_container_cluster&quot;</span>
</span><span id=__span-76-67><a id=__codelineno-76-67 name=__codelineno-76-67 href=#__codelineno-76-67></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_container_node_pool&quot;</span>
</span><span id=__span-76-68><a id=__codelineno-76-68 name=__codelineno-76-68 href=#__codelineno-76-68></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-76-69><a id=__codelineno-76-69 name=__codelineno-76-69 href=#__codelineno-76-69></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;master_authorized_networks_config&quot;</span>
</span><span id=__span-76-70><a id=__codelineno-76-70 name=__codelineno-76-70 href=#__codelineno-76-70></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;node_config&quot;</span>
</span><span id=__span-76-71><a id=__codelineno-76-71 name=__codelineno-76-71 href=#__codelineno-76-71></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;autoscaling&quot;</span>
</span><span id=__span-76-72><a id=__codelineno-76-72 name=__codelineno-76-72 href=#__codelineno-76-72></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;high&quot;</span>
</span><span id=__span-76-73><a id=__codelineno-76-73 name=__codelineno-76-73 href=#__codelineno-76-73></a>
</span><span id=__span-76-74><a id=__codelineno-76-74 name=__codelineno-76-74 href=#__codelineno-76-74></a><span class=nt>notifications</span><span class=p>:</span>
</span><span id=__span-76-75><a id=__codelineno-76-75 name=__codelineno-76-75 href=#__codelineno-76-75></a><span class=w>  </span><span class=nt>slack</span><span class=p>:</span>
</span><span id=__span-76-76><a id=__codelineno-76-76 name=__codelineno-76-76 href=#__codelineno-76-76></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-76-77><a id=__codelineno-76-77 name=__codelineno-76-77 href=#__codelineno-76-77></a><span class=w>    </span><span class=nt>webhook_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://hooks.slack.com/services/T00/B00/XX&quot;</span>
</span><span id=__span-76-78><a id=__codelineno-76-78 name=__codelineno-76-78 href=#__codelineno-76-78></a><span class=w>    </span><span class=nt>channel</span><span class=p>:</span><span class=w> </span><span class=s>&quot;#prod-alerts&quot;</span>
</span><span id=__span-76-79><a id=__codelineno-76-79 name=__codelineno-76-79 href=#__codelineno-76-79></a><span class=w>    </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=s>&quot;TFDrift-Falco</span><span class=nv> </span><span class=s>[PROD]&quot;</span>
</span><span id=__span-76-80><a id=__codelineno-76-80 name=__codelineno-76-80 href=#__codelineno-76-80></a>
</span><span id=__span-76-81><a id=__codelineno-76-81 name=__codelineno-76-81 href=#__codelineno-76-81></a><span class=w>  </span><span class=nt>webhook</span><span class=p>:</span>
</span><span id=__span-76-82><a id=__codelineno-76-82 name=__codelineno-76-82 href=#__codelineno-76-82></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-76-83><a id=__codelineno-76-83 name=__codelineno-76-83 href=#__codelineno-76-83></a><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://monitoring.company.com/api/v1/alerts/tfdrift&quot;</span>
</span><span id=__span-76-84><a id=__codelineno-76-84 name=__codelineno-76-84 href=#__codelineno-76-84></a><span class=w>    </span><span class=nt>method</span><span class=p>:</span><span class=w> </span><span class=s>&quot;POST&quot;</span>
</span><span id=__span-76-85><a id=__codelineno-76-85 name=__codelineno-76-85 href=#__codelineno-76-85></a><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=s>&quot;10s&quot;</span>
</span><span id=__span-76-86><a id=__codelineno-76-86 name=__codelineno-76-86 href=#__codelineno-76-86></a><span class=w>    </span><span class=nt>retry</span><span class=p>:</span>
</span><span id=__span-76-87><a id=__codelineno-76-87 name=__codelineno-76-87 href=#__codelineno-76-87></a><span class=w>      </span><span class=nt>max_attempts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-76-88><a id=__codelineno-76-88 name=__codelineno-76-88 href=#__codelineno-76-88></a><span class=w>      </span><span class=nt>initial_interval</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2s&quot;</span>
</span><span id=__span-76-89><a id=__codelineno-76-89 name=__codelineno-76-89 href=#__codelineno-76-89></a><span class=w>      </span><span class=nt>max_interval</span><span class=p>:</span><span class=w> </span><span class=s>&quot;10s&quot;</span>
</span><span id=__span-76-90><a id=__codelineno-76-90 name=__codelineno-76-90 href=#__codelineno-76-90></a><span class=w>    </span><span class=nt>headers</span><span class=p>:</span>
</span><span id=__span-76-91><a id=__codelineno-76-91 name=__codelineno-76-91 href=#__codelineno-76-91></a><span class=w>      </span><span class=nt>Content-Type</span><span class=p>:</span><span class=w> </span><span class=s>&quot;application/json&quot;</span>
</span><span id=__span-76-92><a id=__codelineno-76-92 name=__codelineno-76-92 href=#__codelineno-76-92></a><span class=w>      </span><span class=nt>Authorization</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Bearer</span><span class=nv> </span><span class=s>${WEBHOOK_API_TOKEN}&quot;</span>
</span><span id=__span-76-93><a id=__codelineno-76-93 name=__codelineno-76-93 href=#__codelineno-76-93></a><span class=w>      </span><span class=nt>X-Environment</span><span class=p>:</span><span class=w> </span><span class=s>&quot;production&quot;</span>
</span><span id=__span-76-94><a id=__codelineno-76-94 name=__codelineno-76-94 href=#__codelineno-76-94></a>
</span><span id=__span-76-95><a id=__codelineno-76-95 name=__codelineno-76-95 href=#__codelineno-76-95></a><span class=w>  </span><span class=nt>pagerduty</span><span class=p>:</span>
</span><span id=__span-76-96><a id=__codelineno-76-96 name=__codelineno-76-96 href=#__codelineno-76-96></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-76-97><a id=__codelineno-76-97 name=__codelineno-76-97 href=#__codelineno-76-97></a><span class=w>    </span><span class=nt>integration_key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${PAGERDUTY_INTEGRATION_KEY}&quot;</span>
</span><span id=__span-76-98><a id=__codelineno-76-98 name=__codelineno-76-98 href=#__codelineno-76-98></a><span class=w>    </span><span class=nt>severity_mapping</span><span class=p>:</span>
</span><span id=__span-76-99><a id=__codelineno-76-99 name=__codelineno-76-99 href=#__codelineno-76-99></a><span class=w>      </span><span class=nt>critical</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span>
</span><span id=__span-76-100><a id=__codelineno-76-100 name=__codelineno-76-100 href=#__codelineno-76-100></a><span class=w>      </span><span class=nt>high</span><span class=p>:</span><span class=w> </span><span class=s>&quot;error&quot;</span>
</span><span id=__span-76-101><a id=__codelineno-76-101 name=__codelineno-76-101 href=#__codelineno-76-101></a><span class=w>      </span><span class=nt>medium</span><span class=p>:</span><span class=w> </span><span class=s>&quot;warning&quot;</span>
</span><span id=__span-76-102><a id=__codelineno-76-102 name=__codelineno-76-102 href=#__codelineno-76-102></a><span class=w>      </span><span class=nt>low</span><span class=p>:</span><span class=w> </span><span class=s>&quot;info&quot;</span>
</span><span id=__span-76-103><a id=__codelineno-76-103 name=__codelineno-76-103 href=#__codelineno-76-103></a>
</span><span id=__span-76-104><a id=__codelineno-76-104 name=__codelineno-76-104 href=#__codelineno-76-104></a><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-76-105><a id=__codelineno-76-105 name=__codelineno-76-105 href=#__codelineno-76-105></a><span class=w>  </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=s>&quot;info&quot;</span>
</span><span id=__span-76-106><a id=__codelineno-76-106 name=__codelineno-76-106 href=#__codelineno-76-106></a><span class=w>  </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=s>&quot;json&quot;</span>
</span><span id=__span-76-107><a id=__codelineno-76-107 name=__codelineno-76-107 href=#__codelineno-76-107></a><span class=w>  </span><span class=nt>output</span><span class=p>:</span><span class=w> </span><span class=s>&quot;stdout&quot;</span>
</span><span id=__span-76-108><a id=__codelineno-76-108 name=__codelineno-76-108 href=#__codelineno-76-108></a>
</span><span id=__span-76-109><a id=__codelineno-76-109 name=__codelineno-76-109 href=#__codelineno-76-109></a><span class=nt>filtering</span><span class=p>:</span>
</span><span id=__span-76-110><a id=__codelineno-76-110 name=__codelineno-76-110 href=#__codelineno-76-110></a><span class=w>  </span><span class=c1># Ignore read-only operations</span>
</span><span id=__span-76-111><a id=__codelineno-76-111 name=__codelineno-76-111 href=#__codelineno-76-111></a><span class=w>  </span><span class=nt>exclude_events</span><span class=p>:</span>
</span><span id=__span-76-112><a id=__codelineno-76-112 name=__codelineno-76-112 href=#__codelineno-76-112></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*.list&quot;</span>
</span><span id=__span-76-113><a id=__codelineno-76-113 name=__codelineno-76-113 href=#__codelineno-76-113></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*.get&quot;</span>
</span><span id=__span-76-114><a id=__codelineno-76-114 name=__codelineno-76-114 href=#__codelineno-76-114></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*.describe&quot;</span>
</span><span id=__span-76-115><a id=__codelineno-76-115 name=__codelineno-76-115 href=#__codelineno-76-115></a>
</span><span id=__span-76-116><a id=__codelineno-76-116 name=__codelineno-76-116 href=#__codelineno-76-116></a><span class=w>  </span><span class=c1># Focus on specific services</span>
</span><span id=__span-76-117><a id=__codelineno-76-117 name=__codelineno-76-117 href=#__codelineno-76-117></a><span class=w>  </span><span class=nt>include_services</span><span class=p>:</span>
</span><span id=__span-76-118><a id=__codelineno-76-118 name=__codelineno-76-118 href=#__codelineno-76-118></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;compute.googleapis.com&quot;</span>
</span><span id=__span-76-119><a id=__codelineno-76-119 name=__codelineno-76-119 href=#__codelineno-76-119></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;container.googleapis.com&quot;</span>
</span><span id=__span-76-120><a id=__codelineno-76-120 name=__codelineno-76-120 href=#__codelineno-76-120></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;sqladmin.googleapis.com&quot;</span>
</span><span id=__span-76-121><a id=__codelineno-76-121 name=__codelineno-76-121 href=#__codelineno-76-121></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;iam.googleapis.com&quot;</span>
</span><span id=__span-76-122><a id=__codelineno-76-122 name=__codelineno-76-122 href=#__codelineno-76-122></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;storage.googleapis.com&quot;</span>
</span></code></pre></div></p> <p><strong>Deployment Script</strong> (<code>deploy-prod.sh</code>): <div class="language-bash highlight"><pre><span></span><code><span id=__span-77-1><a id=__codelineno-77-1 name=__codelineno-77-1 href=#__codelineno-77-1></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-77-2><a id=__codelineno-77-2 name=__codelineno-77-2 href=#__codelineno-77-2></a><span class=nb>set</span><span class=w> </span>-e
</span><span id=__span-77-3><a id=__codelineno-77-3 name=__codelineno-77-3 href=#__codelineno-77-3></a>
</span><span id=__span-77-4><a id=__codelineno-77-4 name=__codelineno-77-4 href=#__codelineno-77-4></a><span class=nv>ENVIRONMENT</span><span class=o>=</span><span class=s2>&quot;prod&quot;</span>
</span><span id=__span-77-5><a id=__codelineno-77-5 name=__codelineno-77-5 href=#__codelineno-77-5></a><span class=nv>PROJECT_ID</span><span class=o>=</span><span class=s2>&quot;company-prod-123&quot;</span>
</span><span id=__span-77-6><a id=__codelineno-77-6 name=__codelineno-77-6 href=#__codelineno-77-6></a>
</span><span id=__span-77-7><a id=__codelineno-77-7 name=__codelineno-77-7 href=#__codelineno-77-7></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;==&gt; Deploying </span><span class=si>${</span><span class=nv>ENVIRONMENT</span><span class=si>}</span><span class=s2> infrastructure...&quot;</span>
</span><span id=__span-77-8><a id=__codelineno-77-8 name=__codelineno-77-8 href=#__codelineno-77-8></a>
</span><span id=__span-77-9><a id=__codelineno-77-9 name=__codelineno-77-9 href=#__codelineno-77-9></a><span class=nb>cd</span><span class=w> </span>environments/<span class=si>${</span><span class=nv>ENVIRONMENT</span><span class=si>}</span>
</span><span id=__span-77-10><a id=__codelineno-77-10 name=__codelineno-77-10 href=#__codelineno-77-10></a>
</span><span id=__span-77-11><a id=__codelineno-77-11 name=__codelineno-77-11 href=#__codelineno-77-11></a><span class=c1># Initialize Terraform</span>
</span><span id=__span-77-12><a id=__codelineno-77-12 name=__codelineno-77-12 href=#__codelineno-77-12></a>terraform<span class=w> </span>init
</span><span id=__span-77-13><a id=__codelineno-77-13 name=__codelineno-77-13 href=#__codelineno-77-13></a>
</span><span id=__span-77-14><a id=__codelineno-77-14 name=__codelineno-77-14 href=#__codelineno-77-14></a><span class=c1># Plan</span>
</span><span id=__span-77-15><a id=__codelineno-77-15 name=__codelineno-77-15 href=#__codelineno-77-15></a>terraform<span class=w> </span>plan<span class=w> </span>-var<span class=o>=</span><span class=s2>&quot;project_id=</span><span class=si>${</span><span class=nv>PROJECT_ID</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span>-out<span class=o>=</span>tfplan
</span><span id=__span-77-16><a id=__codelineno-77-16 name=__codelineno-77-16 href=#__codelineno-77-16></a>
</span><span id=__span-77-17><a id=__codelineno-77-17 name=__codelineno-77-17 href=#__codelineno-77-17></a><span class=c1># Apply with approval</span>
</span><span id=__span-77-18><a id=__codelineno-77-18 name=__codelineno-77-18 href=#__codelineno-77-18></a><span class=nb>read</span><span class=w> </span>-p<span class=w> </span><span class=s2>&quot;Apply changes? (yes/no): &quot;</span><span class=w> </span>APPLY
</span><span id=__span-77-19><a id=__codelineno-77-19 name=__codelineno-77-19 href=#__codelineno-77-19></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$APPLY</span><span class=s2>&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;yes&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-77-20><a id=__codelineno-77-20 name=__codelineno-77-20 href=#__codelineno-77-20></a><span class=w>    </span>terraform<span class=w> </span>apply<span class=w> </span>tfplan
</span><span id=__span-77-21><a id=__codelineno-77-21 name=__codelineno-77-21 href=#__codelineno-77-21></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;‚úì Terraform applied successfully&quot;</span>
</span><span id=__span-77-22><a id=__codelineno-77-22 name=__codelineno-77-22 href=#__codelineno-77-22></a>
</span><span id=__span-77-23><a id=__codelineno-77-23 name=__codelineno-77-23 href=#__codelineno-77-23></a><span class=w>    </span><span class=c1># Start TFDrift-Falco</span>
</span><span id=__span-77-24><a id=__codelineno-77-24 name=__codelineno-77-24 href=#__codelineno-77-24></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;==&gt; Starting TFDrift-Falco...&quot;</span>
</span><span id=__span-77-25><a id=__codelineno-77-25 name=__codelineno-77-25 href=#__codelineno-77-25></a><span class=w>    </span>tfdrift<span class=w> </span>--config<span class=w> </span>../../tfdrift-config/config-<span class=si>${</span><span class=nv>ENVIRONMENT</span><span class=si>}</span>.yaml<span class=w> </span><span class=p>&amp;</span>
</span><span id=__span-77-26><a id=__codelineno-77-26 name=__codelineno-77-26 href=#__codelineno-77-26></a><span class=w>    </span><span class=nv>TFDRIFT_PID</span><span class=o>=</span><span class=nv>$!</span>
</span><span id=__span-77-27><a id=__codelineno-77-27 name=__codelineno-77-27 href=#__codelineno-77-27></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;‚úì TFDrift-Falco started (PID: </span><span class=nv>$TFDRIFT_PID</span><span class=s2>)&quot;</span>
</span><span id=__span-77-28><a id=__codelineno-77-28 name=__codelineno-77-28 href=#__codelineno-77-28></a>
</span><span id=__span-77-29><a id=__codelineno-77-29 name=__codelineno-77-29 href=#__codelineno-77-29></a><span class=w>    </span><span class=c1># Save PID</span>
</span><span id=__span-77-30><a id=__codelineno-77-30 name=__codelineno-77-30 href=#__codelineno-77-30></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=nv>$TFDRIFT_PID</span><span class=w> </span>&gt;<span class=w> </span>/var/run/tfdrift.pid
</span><span id=__span-77-31><a id=__codelineno-77-31 name=__codelineno-77-31 href=#__codelineno-77-31></a><span class=k>else</span>
</span><span id=__span-77-32><a id=__codelineno-77-32 name=__codelineno-77-32 href=#__codelineno-77-32></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Deployment cancelled&quot;</span>
</span><span id=__span-77-33><a id=__codelineno-77-33 name=__codelineno-77-33 href=#__codelineno-77-33></a><span class=k>fi</span>
</span></code></pre></div></p> <hr> <h2 id=production-best-practices>Production Best Practices<a class=headerlink href=#production-best-practices title="Permanent link">&para;</a></h2> <p>This section covers best practices for running TFDrift-Falco in production environments.</p> <h3 id=1-infrastructure-design>1. Infrastructure Design<a class=headerlink href=#1-infrastructure-design title="Permanent link">&para;</a></h3> <h4 id=state-management>State Management<a class=headerlink href=#state-management title="Permanent link">&para;</a></h4> <p><strong>DO:</strong> - Use remote state backends (GCS) with versioning enabled - Implement state locking to prevent concurrent modifications - Organize state files by environment and project - Use workspace separation for different environments</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-78-1><a id=__codelineno-78-1 name=__codelineno-78-1 href=#__codelineno-78-1></a><span class=c1># ‚úÖ Good: Separate state files per project</span>
</span><span id=__span-78-2><a id=__codelineno-78-2 name=__codelineno-78-2 href=#__codelineno-78-2></a><span class=nt>providers</span><span class=p>:</span>
</span><span id=__span-78-3><a id=__codelineno-78-3 name=__codelineno-78-3 href=#__codelineno-78-3></a><span class=w>  </span><span class=nt>gcp</span><span class=p>:</span>
</span><span id=__span-78-4><a id=__codelineno-78-4 name=__codelineno-78-4 href=#__codelineno-78-4></a><span class=w>    </span><span class=nt>projects</span><span class=p>:</span>
</span><span id=__span-78-5><a id=__codelineno-78-5 name=__codelineno-78-5 href=#__codelineno-78-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;company-prod-123&quot;</span>
</span><span id=__span-78-6><a id=__codelineno-78-6 name=__codelineno-78-6 href=#__codelineno-78-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;company-prod-456&quot;</span>
</span><span id=__span-78-7><a id=__codelineno-78-7 name=__codelineno-78-7 href=#__codelineno-78-7></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span>
</span><span id=__span-78-8><a id=__codelineno-78-8 name=__codelineno-78-8 href=#__codelineno-78-8></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;gcs&quot;</span>
</span><span id=__span-78-9><a id=__codelineno-78-9 name=__codelineno-78-9 href=#__codelineno-78-9></a><span class=w>      </span><span class=nt>gcs_bucket</span><span class=p>:</span><span class=w> </span><span class=s>&quot;company-terraform-state&quot;</span>
</span><span id=__span-78-10><a id=__codelineno-78-10 name=__codelineno-78-10 href=#__codelineno-78-10></a><span class=w>      </span><span class=nt>gcs_prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{PROJECT_ID}/prod/terraform.tfstate&quot;</span>
</span></code></pre></div> <p><strong>DON'T:</strong> - Use local state files in production - Share state files across unrelated resources - Store state files in public buckets</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-79-1><a id=__codelineno-79-1 name=__codelineno-79-1 href=#__codelineno-79-1></a><span class=c1># ‚ùå Bad: Single state for all projects</span>
</span><span id=__span-79-2><a id=__codelineno-79-2 name=__codelineno-79-2 href=#__codelineno-79-2></a><span class=nt>state</span><span class=p>:</span>
</span><span id=__span-79-3><a id=__codelineno-79-3 name=__codelineno-79-3 href=#__codelineno-79-3></a><span class=w>  </span><span class=nt>backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;gcs&quot;</span>
</span><span id=__span-79-4><a id=__codelineno-79-4 name=__codelineno-79-4 href=#__codelineno-79-4></a><span class=w>  </span><span class=nt>gcs_prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;all-projects.tfstate&quot;</span><span class=w>  </span><span class=c1># Too broad!</span>
</span></code></pre></div> <h4 id=multi-project-organization>Multi-Project Organization<a class=headerlink href=#multi-project-organization title="Permanent link">&para;</a></h4> <p><strong>Recommended Structure:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-80-1><a id=__codelineno-80-1 name=__codelineno-80-1 href=#__codelineno-80-1></a>terraform/
</span><span id=__span-80-2><a id=__codelineno-80-2 name=__codelineno-80-2 href=#__codelineno-80-2></a>‚îú‚îÄ‚îÄ shared-services/        # Shared infrastructure
</span><span id=__span-80-3><a id=__codelineno-80-3 name=__codelineno-80-3 href=#__codelineno-80-3></a>‚îÇ   ‚îú‚îÄ‚îÄ networking/
</span><span id=__span-80-4><a id=__codelineno-80-4 name=__codelineno-80-4 href=#__codelineno-80-4></a>‚îÇ   ‚îú‚îÄ‚îÄ security/
</span><span id=__span-80-5><a id=__codelineno-80-5 name=__codelineno-80-5 href=#__codelineno-80-5></a>‚îÇ   ‚îî‚îÄ‚îÄ monitoring/
</span><span id=__span-80-6><a id=__codelineno-80-6 name=__codelineno-80-6 href=#__codelineno-80-6></a>‚îú‚îÄ‚îÄ environments/
</span><span id=__span-80-7><a id=__codelineno-80-7 name=__codelineno-80-7 href=#__codelineno-80-7></a>‚îÇ   ‚îú‚îÄ‚îÄ prod/              # Production environment
</span><span id=__span-80-8><a id=__codelineno-80-8 name=__codelineno-80-8 href=#__codelineno-80-8></a>‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ project-a/
</span><span id=__span-80-9><a id=__codelineno-80-9 name=__codelineno-80-9 href=#__codelineno-80-9></a>‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ project-b/
</span><span id=__span-80-10><a id=__codelineno-80-10 name=__codelineno-80-10 href=#__codelineno-80-10></a>‚îÇ   ‚îú‚îÄ‚îÄ staging/           # Staging environment
</span><span id=__span-80-11><a id=__codelineno-80-11 name=__codelineno-80-11 href=#__codelineno-80-11></a>‚îÇ   ‚îî‚îÄ‚îÄ dev/               # Development environment
</span><span id=__span-80-12><a id=__codelineno-80-12 name=__codelineno-80-12 href=#__codelineno-80-12></a>‚îî‚îÄ‚îÄ modules/               # Reusable modules
</span><span id=__span-80-13><a id=__codelineno-80-13 name=__codelineno-80-13 href=#__codelineno-80-13></a>    ‚îú‚îÄ‚îÄ compute/
</span><span id=__span-80-14><a id=__codelineno-80-14 name=__codelineno-80-14 href=#__codelineno-80-14></a>    ‚îú‚îÄ‚îÄ database/
</span><span id=__span-80-15><a id=__codelineno-80-15 name=__codelineno-80-15 href=#__codelineno-80-15></a>    ‚îî‚îÄ‚îÄ networking/
</span></code></pre></div></p> <p><strong>TFDrift Configuration per Environment:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-81-1><a id=__codelineno-81-1 name=__codelineno-81-1 href=#__codelineno-81-1></a><span class=c1># prod/tfdrift-config.yaml</span>
</span><span id=__span-81-2><a id=__codelineno-81-2 name=__codelineno-81-2 href=#__codelineno-81-2></a><span class=nt>providers</span><span class=p>:</span>
</span><span id=__span-81-3><a id=__codelineno-81-3 name=__codelineno-81-3 href=#__codelineno-81-3></a><span class=w>  </span><span class=nt>gcp</span><span class=p>:</span>
</span><span id=__span-81-4><a id=__codelineno-81-4 name=__codelineno-81-4 href=#__codelineno-81-4></a><span class=w>    </span><span class=nt>projects</span><span class=p>:</span>
</span><span id=__span-81-5><a id=__codelineno-81-5 name=__codelineno-81-5 href=#__codelineno-81-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;company-prod-project-a&quot;</span>
</span><span id=__span-81-6><a id=__codelineno-81-6 name=__codelineno-81-6 href=#__codelineno-81-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;company-prod-project-b&quot;</span>
</span><span id=__span-81-7><a id=__codelineno-81-7 name=__codelineno-81-7 href=#__codelineno-81-7></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span>
</span><span id=__span-81-8><a id=__codelineno-81-8 name=__codelineno-81-8 href=#__codelineno-81-8></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;gcs&quot;</span>
</span><span id=__span-81-9><a id=__codelineno-81-9 name=__codelineno-81-9 href=#__codelineno-81-9></a><span class=w>      </span><span class=nt>gcs_bucket</span><span class=p>:</span><span class=w> </span><span class=s>&quot;company-terraform-state&quot;</span>
</span><span id=__span-81-10><a id=__codelineno-81-10 name=__codelineno-81-10 href=#__codelineno-81-10></a><span class=w>      </span><span class=nt>gcs_prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{PROJECT_ID}/prod/terraform.tfstate&quot;</span>
</span><span id=__span-81-11><a id=__codelineno-81-11 name=__codelineno-81-11 href=#__codelineno-81-11></a>
</span><span id=__span-81-12><a id=__codelineno-81-12 name=__codelineno-81-12 href=#__codelineno-81-12></a><span class=nt>drift_rules</span><span class=p>:</span>
</span><span id=__span-81-13><a id=__codelineno-81-13 name=__codelineno-81-13 href=#__codelineno-81-13></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Critical</span><span class=nv> </span><span class=s>Production</span><span class=nv> </span><span class=s>Changes&quot;</span>
</span><span id=__span-81-14><a id=__codelineno-81-14 name=__codelineno-81-14 href=#__codelineno-81-14></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-81-15><a id=__codelineno-81-15 name=__codelineno-81-15 href=#__codelineno-81-15></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_sql_database_instance&quot;</span>
</span><span id=__span-81-16><a id=__codelineno-81-16 name=__codelineno-81-16 href=#__codelineno-81-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_firewall&quot;</span>
</span><span id=__span-81-17><a id=__codelineno-81-17 name=__codelineno-81-17 href=#__codelineno-81-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_project_iam_*&quot;</span>
</span><span id=__span-81-18><a id=__codelineno-81-18 name=__codelineno-81-18 href=#__codelineno-81-18></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span>
</span></code></pre></div></p> <h4 id=resource-naming-conventions>Resource Naming Conventions<a class=headerlink href=#resource-naming-conventions title="Permanent link">&para;</a></h4> <p><strong>Consistent Naming Pattern:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-82-1><a id=__codelineno-82-1 name=__codelineno-82-1 href=#__codelineno-82-1></a>{environment}-{project}-{service}-{resource_type}-{identifier}
</span><span id=__span-82-2><a id=__codelineno-82-2 name=__codelineno-82-2 href=#__codelineno-82-2></a>
</span><span id=__span-82-3><a id=__codelineno-82-3 name=__codelineno-82-3 href=#__codelineno-82-3></a>Examples:
</span><span id=__span-82-4><a id=__codelineno-82-4 name=__codelineno-82-4 href=#__codelineno-82-4></a>- prod-webapp-lb-frontend
</span><span id=__span-82-5><a id=__codelineno-82-5 name=__codelineno-82-5 href=#__codelineno-82-5></a>- staging-api-db-primary
</span><span id=__span-82-6><a id=__codelineno-82-6 name=__codelineno-82-6 href=#__codelineno-82-6></a>- prod-shared-network-main
</span></code></pre></div></p> <p><strong>In Terraform:</strong> <div class="language-hcl highlight"><pre><span></span><code><span id=__span-83-1><a id=__codelineno-83-1 name=__codelineno-83-1 href=#__codelineno-83-1></a><span class=nb>locals</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-83-2><a id=__codelineno-83-2 name=__codelineno-83-2 href=#__codelineno-83-2></a><span class=w>  </span><span class=na>environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;prod&quot;</span>
</span><span id=__span-83-3><a id=__codelineno-83-3 name=__codelineno-83-3 href=#__codelineno-83-3></a><span class=w>  </span><span class=na>project</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;webapp&quot;</span>
</span><span id=__span-83-4><a id=__codelineno-83-4 name=__codelineno-83-4 href=#__codelineno-83-4></a>
</span><span id=__span-83-5><a id=__codelineno-83-5 name=__codelineno-83-5 href=#__codelineno-83-5></a><span class=w>  </span><span class=na>naming_prefix</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${local.environment}-${local.project}&quot;</span>
</span><span id=__span-83-6><a id=__codelineno-83-6 name=__codelineno-83-6 href=#__codelineno-83-6></a><span class=p>}</span>
</span><span id=__span-83-7><a id=__codelineno-83-7 name=__codelineno-83-7 href=#__codelineno-83-7></a>
</span><span id=__span-83-8><a id=__codelineno-83-8 name=__codelineno-83-8 href=#__codelineno-83-8></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_instance&quot;</span><span class=w> </span><span class=nv>&quot;web&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-83-9><a id=__codelineno-83-9 name=__codelineno-83-9 href=#__codelineno-83-9></a><span class=w>  </span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${local.naming_prefix}-web-${count.index + 1}&quot;</span>
</span><span id=__span-83-10><a id=__codelineno-83-10 name=__codelineno-83-10 href=#__codelineno-83-10></a>
</span><span id=__span-83-11><a id=__codelineno-83-11 name=__codelineno-83-11 href=#__codelineno-83-11></a><span class=w>  </span><span class=nb>labels</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-83-12><a id=__codelineno-83-12 name=__codelineno-83-12 href=#__codelineno-83-12></a><span class=w>    </span><span class=na>environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>local.environment</span>
</span><span id=__span-83-13><a id=__codelineno-83-13 name=__codelineno-83-13 href=#__codelineno-83-13></a><span class=w>    </span><span class=na>project</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=nv>local.project</span>
</span><span id=__span-83-14><a id=__codelineno-83-14 name=__codelineno-83-14 href=#__codelineno-83-14></a><span class=w>    </span><span class=na>managed_by</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;terraform&quot;</span>
</span><span id=__span-83-15><a id=__codelineno-83-15 name=__codelineno-83-15 href=#__codelineno-83-15></a><span class=w>    </span><span class=na>cost_center</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.cost_center</span>
</span><span id=__span-83-16><a id=__codelineno-83-16 name=__codelineno-83-16 href=#__codelineno-83-16></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-83-17><a id=__codelineno-83-17 name=__codelineno-83-17 href=#__codelineno-83-17></a><span class=p>}</span>
</span></code></pre></div></p> <hr> <h3 id=2-configuration-management>2. Configuration Management<a class=headerlink href=#2-configuration-management title="Permanent link">&para;</a></h3> <h4 id=environment-separation>Environment Separation<a class=headerlink href=#environment-separation title="Permanent link">&para;</a></h4> <p><strong>Use separate configurations for each environment:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-84-1><a id=__codelineno-84-1 name=__codelineno-84-1 href=#__codelineno-84-1></a><span class=c1># Directory structure</span>
</span><span id=__span-84-2><a id=__codelineno-84-2 name=__codelineno-84-2 href=#__codelineno-84-2></a>configs/
</span><span id=__span-84-3><a id=__codelineno-84-3 name=__codelineno-84-3 href=#__codelineno-84-3></a>‚îú‚îÄ‚îÄ<span class=w> </span>dev.yaml<span class=w>          </span><span class=c1># Development settings</span>
</span><span id=__span-84-4><a id=__codelineno-84-4 name=__codelineno-84-4 href=#__codelineno-84-4></a>‚îú‚îÄ‚îÄ<span class=w> </span>staging.yaml<span class=w>      </span><span class=c1># Staging settings</span>
</span><span id=__span-84-5><a id=__codelineno-84-5 name=__codelineno-84-5 href=#__codelineno-84-5></a>‚îú‚îÄ‚îÄ<span class=w> </span>prod.yaml<span class=w>         </span><span class=c1># Production settings</span>
</span><span id=__span-84-6><a id=__codelineno-84-6 name=__codelineno-84-6 href=#__codelineno-84-6></a>‚îî‚îÄ‚îÄ<span class=w> </span>shared.yaml<span class=w>       </span><span class=c1># Shared base config</span>
</span></code></pre></div> <p><strong>Example: Development Config</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-85-1><a id=__codelineno-85-1 name=__codelineno-85-1 href=#__codelineno-85-1></a><span class=c1># configs/dev.yaml</span>
</span><span id=__span-85-2><a id=__codelineno-85-2 name=__codelineno-85-2 href=#__codelineno-85-2></a><span class=nt>providers</span><span class=p>:</span>
</span><span id=__span-85-3><a id=__codelineno-85-3 name=__codelineno-85-3 href=#__codelineno-85-3></a><span class=w>  </span><span class=nt>gcp</span><span class=p>:</span>
</span><span id=__span-85-4><a id=__codelineno-85-4 name=__codelineno-85-4 href=#__codelineno-85-4></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-85-5><a id=__codelineno-85-5 name=__codelineno-85-5 href=#__codelineno-85-5></a><span class=w>    </span><span class=nt>projects</span><span class=p>:</span>
</span><span id=__span-85-6><a id=__codelineno-85-6 name=__codelineno-85-6 href=#__codelineno-85-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;company-dev-123&quot;</span>
</span><span id=__span-85-7><a id=__codelineno-85-7 name=__codelineno-85-7 href=#__codelineno-85-7></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span>
</span><span id=__span-85-8><a id=__codelineno-85-8 name=__codelineno-85-8 href=#__codelineno-85-8></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;local&quot;</span><span class=w>  </span><span class=c1># OK for dev</span>
</span><span id=__span-85-9><a id=__codelineno-85-9 name=__codelineno-85-9 href=#__codelineno-85-9></a><span class=w>      </span><span class=nt>local_path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;./terraform.tfstate&quot;</span>
</span><span id=__span-85-10><a id=__codelineno-85-10 name=__codelineno-85-10 href=#__codelineno-85-10></a>
</span><span id=__span-85-11><a id=__codelineno-85-11 name=__codelineno-85-11 href=#__codelineno-85-11></a><span class=nt>drift_rules</span><span class=p>:</span>
</span><span id=__span-85-12><a id=__codelineno-85-12 name=__codelineno-85-12 href=#__codelineno-85-12></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Dev</span><span class=nv> </span><span class=s>Compute</span><span class=nv> </span><span class=s>Changes&quot;</span>
</span><span id=__span-85-13><a id=__codelineno-85-13 name=__codelineno-85-13 href=#__codelineno-85-13></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-85-14><a id=__codelineno-85-14 name=__codelineno-85-14 href=#__codelineno-85-14></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_instance&quot;</span>
</span><span id=__span-85-15><a id=__codelineno-85-15 name=__codelineno-85-15 href=#__codelineno-85-15></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;medium&quot;</span><span class=w>  </span><span class=c1># Lower severity for dev</span>
</span><span id=__span-85-16><a id=__codelineno-85-16 name=__codelineno-85-16 href=#__codelineno-85-16></a>
</span><span id=__span-85-17><a id=__codelineno-85-17 name=__codelineno-85-17 href=#__codelineno-85-17></a><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-85-18><a id=__codelineno-85-18 name=__codelineno-85-18 href=#__codelineno-85-18></a><span class=w>  </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=s>&quot;debug&quot;</span><span class=w>  </span><span class=c1># More verbose in dev</span>
</span><span id=__span-85-19><a id=__codelineno-85-19 name=__codelineno-85-19 href=#__codelineno-85-19></a>
</span><span id=__span-85-20><a id=__codelineno-85-20 name=__codelineno-85-20 href=#__codelineno-85-20></a><span class=nt>notifications</span><span class=p>:</span>
</span><span id=__span-85-21><a id=__codelineno-85-21 name=__codelineno-85-21 href=#__codelineno-85-21></a><span class=w>  </span><span class=nt>slack</span><span class=p>:</span>
</span><span id=__span-85-22><a id=__codelineno-85-22 name=__codelineno-85-22 href=#__codelineno-85-22></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w>  </span><span class=c1># Don&#39;t spam Slack in dev</span>
</span></code></pre></div></p> <p><strong>Example: Production Config</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-86-1><a id=__codelineno-86-1 name=__codelineno-86-1 href=#__codelineno-86-1></a><span class=c1># configs/prod.yaml</span>
</span><span id=__span-86-2><a id=__codelineno-86-2 name=__codelineno-86-2 href=#__codelineno-86-2></a><span class=nt>providers</span><span class=p>:</span>
</span><span id=__span-86-3><a id=__codelineno-86-3 name=__codelineno-86-3 href=#__codelineno-86-3></a><span class=w>  </span><span class=nt>gcp</span><span class=p>:</span>
</span><span id=__span-86-4><a id=__codelineno-86-4 name=__codelineno-86-4 href=#__codelineno-86-4></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-86-5><a id=__codelineno-86-5 name=__codelineno-86-5 href=#__codelineno-86-5></a><span class=w>    </span><span class=nt>projects</span><span class=p>:</span>
</span><span id=__span-86-6><a id=__codelineno-86-6 name=__codelineno-86-6 href=#__codelineno-86-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;company-prod-123&quot;</span>
</span><span id=__span-86-7><a id=__codelineno-86-7 name=__codelineno-86-7 href=#__codelineno-86-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;company-prod-456&quot;</span>
</span><span id=__span-86-8><a id=__codelineno-86-8 name=__codelineno-86-8 href=#__codelineno-86-8></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span>
</span><span id=__span-86-9><a id=__codelineno-86-9 name=__codelineno-86-9 href=#__codelineno-86-9></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;gcs&quot;</span><span class=w>  </span><span class=c1># Remote state required</span>
</span><span id=__span-86-10><a id=__codelineno-86-10 name=__codelineno-86-10 href=#__codelineno-86-10></a><span class=w>      </span><span class=nt>gcs_bucket</span><span class=p>:</span><span class=w> </span><span class=s>&quot;company-terraform-state-prod&quot;</span>
</span><span id=__span-86-11><a id=__codelineno-86-11 name=__codelineno-86-11 href=#__codelineno-86-11></a><span class=w>      </span><span class=nt>gcs_prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{PROJECT_ID}/terraform.tfstate&quot;</span>
</span><span id=__span-86-12><a id=__codelineno-86-12 name=__codelineno-86-12 href=#__codelineno-86-12></a>
</span><span id=__span-86-13><a id=__codelineno-86-13 name=__codelineno-86-13 href=#__codelineno-86-13></a><span class=nt>drift_rules</span><span class=p>:</span>
</span><span id=__span-86-14><a id=__codelineno-86-14 name=__codelineno-86-14 href=#__codelineno-86-14></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Critical</span><span class=nv> </span><span class=s>Production</span><span class=nv> </span><span class=s>IAM</span><span class=nv> </span><span class=s>Changes&quot;</span>
</span><span id=__span-86-15><a id=__codelineno-86-15 name=__codelineno-86-15 href=#__codelineno-86-15></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-86-16><a id=__codelineno-86-16 name=__codelineno-86-16 href=#__codelineno-86-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_project_iam_*&quot;</span>
</span><span id=__span-86-17><a id=__codelineno-86-17 name=__codelineno-86-17 href=#__codelineno-86-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_service_account_iam_*&quot;</span>
</span><span id=__span-86-18><a id=__codelineno-86-18 name=__codelineno-86-18 href=#__codelineno-86-18></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span>
</span><span id=__span-86-19><a id=__codelineno-86-19 name=__codelineno-86-19 href=#__codelineno-86-19></a>
</span><span id=__span-86-20><a id=__codelineno-86-20 name=__codelineno-86-20 href=#__codelineno-86-20></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Production</span><span class=nv> </span><span class=s>Database</span><span class=nv> </span><span class=s>Changes&quot;</span>
</span><span id=__span-86-21><a id=__codelineno-86-21 name=__codelineno-86-21 href=#__codelineno-86-21></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-86-22><a id=__codelineno-86-22 name=__codelineno-86-22 href=#__codelineno-86-22></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_sql_database_instance&quot;</span>
</span><span id=__span-86-23><a id=__codelineno-86-23 name=__codelineno-86-23 href=#__codelineno-86-23></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span>
</span><span id=__span-86-24><a id=__codelineno-86-24 name=__codelineno-86-24 href=#__codelineno-86-24></a>
</span><span id=__span-86-25><a id=__codelineno-86-25 name=__codelineno-86-25 href=#__codelineno-86-25></a><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-86-26><a id=__codelineno-86-26 name=__codelineno-86-26 href=#__codelineno-86-26></a><span class=w>  </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=s>&quot;info&quot;</span><span class=w>  </span><span class=c1># Production logging</span>
</span><span id=__span-86-27><a id=__codelineno-86-27 name=__codelineno-86-27 href=#__codelineno-86-27></a><span class=w>  </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=s>&quot;json&quot;</span>
</span><span id=__span-86-28><a id=__codelineno-86-28 name=__codelineno-86-28 href=#__codelineno-86-28></a><span class=w>  </span><span class=nt>output</span><span class=p>:</span><span class=w> </span><span class=s>&quot;stdout&quot;</span>
</span><span id=__span-86-29><a id=__codelineno-86-29 name=__codelineno-86-29 href=#__codelineno-86-29></a>
</span><span id=__span-86-30><a id=__codelineno-86-30 name=__codelineno-86-30 href=#__codelineno-86-30></a><span class=nt>notifications</span><span class=p>:</span>
</span><span id=__span-86-31><a id=__codelineno-86-31 name=__codelineno-86-31 href=#__codelineno-86-31></a><span class=w>  </span><span class=nt>slack</span><span class=p>:</span>
</span><span id=__span-86-32><a id=__codelineno-86-32 name=__codelineno-86-32 href=#__codelineno-86-32></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-86-33><a id=__codelineno-86-33 name=__codelineno-86-33 href=#__codelineno-86-33></a><span class=w>    </span><span class=nt>webhook_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${SLACK_WEBHOOK_PROD}&quot;</span>
</span><span id=__span-86-34><a id=__codelineno-86-34 name=__codelineno-86-34 href=#__codelineno-86-34></a><span class=w>    </span><span class=nt>channel</span><span class=p>:</span><span class=w> </span><span class=s>&quot;#prod-alerts&quot;</span>
</span><span id=__span-86-35><a id=__codelineno-86-35 name=__codelineno-86-35 href=#__codelineno-86-35></a>
</span><span id=__span-86-36><a id=__codelineno-86-36 name=__codelineno-86-36 href=#__codelineno-86-36></a><span class=w>  </span><span class=nt>pagerduty</span><span class=p>:</span>
</span><span id=__span-86-37><a id=__codelineno-86-37 name=__codelineno-86-37 href=#__codelineno-86-37></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-86-38><a id=__codelineno-86-38 name=__codelineno-86-38 href=#__codelineno-86-38></a><span class=w>    </span><span class=nt>integration_key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${PAGERDUTY_KEY_PROD}&quot;</span>
</span></code></pre></div></p> <h4 id=secret-management>Secret Management<a class=headerlink href=#secret-management title="Permanent link">&para;</a></h4> <p><strong>DO:</strong> - Use environment variables for secrets - Integrate with secret managers (Secret Manager, Vault) - Rotate credentials regularly - Never commit secrets to version control</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-87-1><a id=__codelineno-87-1 name=__codelineno-87-1 href=#__codelineno-87-1></a><span class=c1># ‚úÖ Good: Environment variables</span>
</span><span id=__span-87-2><a id=__codelineno-87-2 name=__codelineno-87-2 href=#__codelineno-87-2></a><span class=nb>export</span><span class=w> </span><span class=nv>SLACK_WEBHOOK_URL</span><span class=o>=</span><span class=s2>&quot;https://hooks.slack.com/services/...&quot;</span>
</span><span id=__span-87-3><a id=__codelineno-87-3 name=__codelineno-87-3 href=#__codelineno-87-3></a><span class=nb>export</span><span class=w> </span><span class=nv>PAGERDUTY_INTEGRATION_KEY</span><span class=o>=</span><span class=s2>&quot;xxx&quot;</span>
</span><span id=__span-87-4><a id=__codelineno-87-4 name=__codelineno-87-4 href=#__codelineno-87-4></a><span class=nb>export</span><span class=w> </span><span class=nv>GOOGLE_APPLICATION_CREDENTIALS</span><span class=o>=</span><span class=s2>&quot;/path/to/key.json&quot;</span>
</span><span id=__span-87-5><a id=__codelineno-87-5 name=__codelineno-87-5 href=#__codelineno-87-5></a>
</span><span id=__span-87-6><a id=__codelineno-87-6 name=__codelineno-87-6 href=#__codelineno-87-6></a><span class=c1># Run with secrets from environment</span>
</span><span id=__span-87-7><a id=__codelineno-87-7 name=__codelineno-87-7 href=#__codelineno-87-7></a>tfdrift<span class=w> </span>--config<span class=w> </span>config-prod.yaml
</span></code></pre></div> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-88-1><a id=__codelineno-88-1 name=__codelineno-88-1 href=#__codelineno-88-1></a><span class=c1># ‚úÖ Good: Reference environment variables in config</span>
</span><span id=__span-88-2><a id=__codelineno-88-2 name=__codelineno-88-2 href=#__codelineno-88-2></a><span class=nt>notifications</span><span class=p>:</span>
</span><span id=__span-88-3><a id=__codelineno-88-3 name=__codelineno-88-3 href=#__codelineno-88-3></a><span class=w>  </span><span class=nt>slack</span><span class=p>:</span>
</span><span id=__span-88-4><a id=__codelineno-88-4 name=__codelineno-88-4 href=#__codelineno-88-4></a><span class=w>    </span><span class=nt>webhook_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${SLACK_WEBHOOK_URL}&quot;</span>
</span><span id=__span-88-5><a id=__codelineno-88-5 name=__codelineno-88-5 href=#__codelineno-88-5></a><span class=w>  </span><span class=nt>pagerduty</span><span class=p>:</span>
</span><span id=__span-88-6><a id=__codelineno-88-6 name=__codelineno-88-6 href=#__codelineno-88-6></a><span class=w>    </span><span class=nt>integration_key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${PAGERDUTY_INTEGRATION_KEY}&quot;</span>
</span></code></pre></div> <p><strong>DON'T:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-89-1><a id=__codelineno-89-1 name=__codelineno-89-1 href=#__codelineno-89-1></a><span class=c1># ‚ùå Bad: Hardcoded secrets</span>
</span><span id=__span-89-2><a id=__codelineno-89-2 name=__codelineno-89-2 href=#__codelineno-89-2></a><span class=nt>notifications</span><span class=p>:</span>
</span><span id=__span-89-3><a id=__codelineno-89-3 name=__codelineno-89-3 href=#__codelineno-89-3></a><span class=w>  </span><span class=nt>slack</span><span class=p>:</span>
</span><span id=__span-89-4><a id=__codelineno-89-4 name=__codelineno-89-4 href=#__codelineno-89-4></a><span class=w>    </span><span class=nt>webhook_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://hooks.slack.com/services/T00/B00/actual_secret_here&quot;</span>
</span></code></pre></div></p> <p><strong>Integration with GCP Secret Manager:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-90-1><a id=__codelineno-90-1 name=__codelineno-90-1 href=#__codelineno-90-1></a><span class=c1># Store secret</span>
</span><span id=__span-90-2><a id=__codelineno-90-2 name=__codelineno-90-2 href=#__codelineno-90-2></a><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=s2>&quot;https://hooks.slack.com/services/...&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-90-3><a id=__codelineno-90-3 name=__codelineno-90-3 href=#__codelineno-90-3></a><span class=w>  </span>gcloud<span class=w> </span>secrets<span class=w> </span>create<span class=w> </span>tfdrift-slack-webhook<span class=w> </span><span class=se>\</span>
</span><span id=__span-90-4><a id=__codelineno-90-4 name=__codelineno-90-4 href=#__codelineno-90-4></a><span class=w>    </span>--data-file<span class=o>=</span>-<span class=w> </span><span class=se>\</span>
</span><span id=__span-90-5><a id=__codelineno-90-5 name=__codelineno-90-5 href=#__codelineno-90-5></a><span class=w>    </span>--replication-policy<span class=o>=</span><span class=s2>&quot;automatic&quot;</span>
</span><span id=__span-90-6><a id=__codelineno-90-6 name=__codelineno-90-6 href=#__codelineno-90-6></a>
</span><span id=__span-90-7><a id=__codelineno-90-7 name=__codelineno-90-7 href=#__codelineno-90-7></a><span class=c1># Retrieve secret at runtime</span>
</span><span id=__span-90-8><a id=__codelineno-90-8 name=__codelineno-90-8 href=#__codelineno-90-8></a><span class=nb>export</span><span class=w> </span><span class=nv>SLACK_WEBHOOK_URL</span><span class=o>=</span><span class=k>$(</span>gcloud<span class=w> </span>secrets<span class=w> </span>versions<span class=w> </span>access<span class=w> </span>latest<span class=w> </span><span class=se>\</span>
</span><span id=__span-90-9><a id=__codelineno-90-9 name=__codelineno-90-9 href=#__codelineno-90-9></a><span class=w>  </span>--secret<span class=o>=</span><span class=s2>&quot;tfdrift-slack-webhook&quot;</span><span class=k>)</span>
</span><span id=__span-90-10><a id=__codelineno-90-10 name=__codelineno-90-10 href=#__codelineno-90-10></a>
</span><span id=__span-90-11><a id=__codelineno-90-11 name=__codelineno-90-11 href=#__codelineno-90-11></a><span class=c1># Run TFDrift</span>
</span><span id=__span-90-12><a id=__codelineno-90-12 name=__codelineno-90-12 href=#__codelineno-90-12></a>tfdrift<span class=w> </span>--config<span class=w> </span>config-prod.yaml
</span></code></pre></div></p> <h4 id=configuration-validation>Configuration Validation<a class=headerlink href=#configuration-validation title="Permanent link">&para;</a></h4> <p><strong>Pre-deployment validation script:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-91-1><a id=__codelineno-91-1 name=__codelineno-91-1 href=#__codelineno-91-1></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-91-2><a id=__codelineno-91-2 name=__codelineno-91-2 href=#__codelineno-91-2></a><span class=c1># validate-config.sh</span>
</span><span id=__span-91-3><a id=__codelineno-91-3 name=__codelineno-91-3 href=#__codelineno-91-3></a>
</span><span id=__span-91-4><a id=__codelineno-91-4 name=__codelineno-91-4 href=#__codelineno-91-4></a><span class=nv>CONFIG_FILE</span><span class=o>=</span><span class=nv>$1</span>
</span><span id=__span-91-5><a id=__codelineno-91-5 name=__codelineno-91-5 href=#__codelineno-91-5></a>
</span><span id=__span-91-6><a id=__codelineno-91-6 name=__codelineno-91-6 href=#__codelineno-91-6></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;==&gt; Validating TFDrift configuration...&quot;</span>
</span><span id=__span-91-7><a id=__codelineno-91-7 name=__codelineno-91-7 href=#__codelineno-91-7></a>
</span><span id=__span-91-8><a id=__codelineno-91-8 name=__codelineno-91-8 href=#__codelineno-91-8></a><span class=c1># 1. Check YAML syntax</span>
</span><span id=__span-91-9><a id=__codelineno-91-9 name=__codelineno-91-9 href=#__codelineno-91-9></a>yamllint<span class=w> </span><span class=s2>&quot;</span><span class=nv>$CONFIG_FILE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
</span><span id=__span-91-10><a id=__codelineno-91-10 name=__codelineno-91-10 href=#__codelineno-91-10></a>
</span><span id=__span-91-11><a id=__codelineno-91-11 name=__codelineno-91-11 href=#__codelineno-91-11></a><span class=c1># 2. Check required fields</span>
</span><span id=__span-91-12><a id=__codelineno-91-12 name=__codelineno-91-12 href=#__codelineno-91-12></a>python3<span class=w> </span><span class=s>&lt;&lt; EOF</span>
</span><span id=__span-91-13><a id=__codelineno-91-13 name=__codelineno-91-13 href=#__codelineno-91-13></a><span class=s>import yaml</span>
</span><span id=__span-91-14><a id=__codelineno-91-14 name=__codelineno-91-14 href=#__codelineno-91-14></a><span class=s>import sys</span>
</span><span id=__span-91-15><a id=__codelineno-91-15 name=__codelineno-91-15 href=#__codelineno-91-15></a>
</span><span id=__span-91-16><a id=__codelineno-91-16 name=__codelineno-91-16 href=#__codelineno-91-16></a><span class=s>with open(&quot;$CONFIG_FILE&quot;) as f:</span>
</span><span id=__span-91-17><a id=__codelineno-91-17 name=__codelineno-91-17 href=#__codelineno-91-17></a><span class=s>    config = yaml.safe_load(f)</span>
</span><span id=__span-91-18><a id=__codelineno-91-18 name=__codelineno-91-18 href=#__codelineno-91-18></a>
</span><span id=__span-91-19><a id=__codelineno-91-19 name=__codelineno-91-19 href=#__codelineno-91-19></a><span class=s># Check providers</span>
</span><span id=__span-91-20><a id=__codelineno-91-20 name=__codelineno-91-20 href=#__codelineno-91-20></a><span class=s>if &#39;providers&#39; not in config or &#39;gcp&#39; not in config[&#39;providers&#39;]:</span>
</span><span id=__span-91-21><a id=__codelineno-91-21 name=__codelineno-91-21 href=#__codelineno-91-21></a><span class=s>    print(&quot;‚ùå Missing providers.gcp configuration&quot;)</span>
</span><span id=__span-91-22><a id=__codelineno-91-22 name=__codelineno-91-22 href=#__codelineno-91-22></a><span class=s>    sys.exit(1)</span>
</span><span id=__span-91-23><a id=__codelineno-91-23 name=__codelineno-91-23 href=#__codelineno-91-23></a>
</span><span id=__span-91-24><a id=__codelineno-91-24 name=__codelineno-91-24 href=#__codelineno-91-24></a><span class=s># Check projects</span>
</span><span id=__span-91-25><a id=__codelineno-91-25 name=__codelineno-91-25 href=#__codelineno-91-25></a><span class=s>if not config[&#39;providers&#39;][&#39;gcp&#39;].get(&#39;projects&#39;):</span>
</span><span id=__span-91-26><a id=__codelineno-91-26 name=__codelineno-91-26 href=#__codelineno-91-26></a><span class=s>    print(&quot;‚ùå No projects specified&quot;)</span>
</span><span id=__span-91-27><a id=__codelineno-91-27 name=__codelineno-91-27 href=#__codelineno-91-27></a><span class=s>    sys.exit(1)</span>
</span><span id=__span-91-28><a id=__codelineno-91-28 name=__codelineno-91-28 href=#__codelineno-91-28></a>
</span><span id=__span-91-29><a id=__codelineno-91-29 name=__codelineno-91-29 href=#__codelineno-91-29></a><span class=s># Check state backend</span>
</span><span id=__span-91-30><a id=__codelineno-91-30 name=__codelineno-91-30 href=#__codelineno-91-30></a><span class=s>if not config[&#39;providers&#39;][&#39;gcp&#39;].get(&#39;state&#39;, {}).get(&#39;backend&#39;):</span>
</span><span id=__span-91-31><a id=__codelineno-91-31 name=__codelineno-91-31 href=#__codelineno-91-31></a><span class=s>    print(&quot;‚ùå No state backend specified&quot;)</span>
</span><span id=__span-91-32><a id=__codelineno-91-32 name=__codelineno-91-32 href=#__codelineno-91-32></a><span class=s>    sys.exit(1)</span>
</span><span id=__span-91-33><a id=__codelineno-91-33 name=__codelineno-91-33 href=#__codelineno-91-33></a>
</span><span id=__span-91-34><a id=__codelineno-91-34 name=__codelineno-91-34 href=#__codelineno-91-34></a><span class=s># Check drift rules</span>
</span><span id=__span-91-35><a id=__codelineno-91-35 name=__codelineno-91-35 href=#__codelineno-91-35></a><span class=s>if not config.get(&#39;drift_rules&#39;):</span>
</span><span id=__span-91-36><a id=__codelineno-91-36 name=__codelineno-91-36 href=#__codelineno-91-36></a><span class=s>    print(&quot;‚ö†Ô∏è  Warning: No drift rules defined&quot;)</span>
</span><span id=__span-91-37><a id=__codelineno-91-37 name=__codelineno-91-37 href=#__codelineno-91-37></a>
</span><span id=__span-91-38><a id=__codelineno-91-38 name=__codelineno-91-38 href=#__codelineno-91-38></a><span class=s>print(&quot;‚úì Configuration is valid&quot;)</span>
</span><span id=__span-91-39><a id=__codelineno-91-39 name=__codelineno-91-39 href=#__codelineno-91-39></a><span class=s>EOF</span>
</span><span id=__span-91-40><a id=__codelineno-91-40 name=__codelineno-91-40 href=#__codelineno-91-40></a>
</span><span id=__span-91-41><a id=__codelineno-91-41 name=__codelineno-91-41 href=#__codelineno-91-41></a><span class=c1># 3. Validate environment variables</span>
</span><span id=__span-91-42><a id=__codelineno-91-42 name=__codelineno-91-42 href=#__codelineno-91-42></a><span class=nv>required_vars</span><span class=o>=(</span><span class=s2>&quot;SLACK_WEBHOOK_URL&quot;</span><span class=w> </span><span class=s2>&quot;GOOGLE_APPLICATION_CREDENTIALS&quot;</span><span class=o>)</span>
</span><span id=__span-91-43><a id=__codelineno-91-43 name=__codelineno-91-43 href=#__codelineno-91-43></a><span class=k>for</span><span class=w> </span>var<span class=w> </span><span class=k>in</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>required_vars</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
</span><span id=__span-91-44><a id=__codelineno-91-44 name=__codelineno-91-44 href=#__codelineno-91-44></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=p>!var</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-91-45><a id=__codelineno-91-45 name=__codelineno-91-45 href=#__codelineno-91-45></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;‚ùå Missing required environment variable: </span><span class=nv>$var</span><span class=s2>&quot;</span>
</span><span id=__span-91-46><a id=__codelineno-91-46 name=__codelineno-91-46 href=#__codelineno-91-46></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
</span><span id=__span-91-47><a id=__codelineno-91-47 name=__codelineno-91-47 href=#__codelineno-91-47></a><span class=w>    </span><span class=k>fi</span>
</span><span id=__span-91-48><a id=__codelineno-91-48 name=__codelineno-91-48 href=#__codelineno-91-48></a><span class=k>done</span>
</span><span id=__span-91-49><a id=__codelineno-91-49 name=__codelineno-91-49 href=#__codelineno-91-49></a>
</span><span id=__span-91-50><a id=__codelineno-91-50 name=__codelineno-91-50 href=#__codelineno-91-50></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;‚úì All validations passed&quot;</span>
</span></code></pre></div></p> <hr> <h3 id=3-monitoring-alerting>3. Monitoring &amp; Alerting<a class=headerlink href=#3-monitoring-alerting title="Permanent link">&para;</a></h3> <h4 id=alert-routing-strategy>Alert Routing Strategy<a class=headerlink href=#alert-routing-strategy title="Permanent link">&para;</a></h4> <p><strong>Severity-based routing:</strong></p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-92-1><a id=__codelineno-92-1 name=__codelineno-92-1 href=#__codelineno-92-1></a><span class=c1># Route alerts based on severity</span>
</span><span id=__span-92-2><a id=__codelineno-92-2 name=__codelineno-92-2 href=#__codelineno-92-2></a><span class=nt>notifications</span><span class=p>:</span>
</span><span id=__span-92-3><a id=__codelineno-92-3 name=__codelineno-92-3 href=#__codelineno-92-3></a><span class=w>  </span><span class=c1># Critical: Page on-call engineer</span>
</span><span id=__span-92-4><a id=__codelineno-92-4 name=__codelineno-92-4 href=#__codelineno-92-4></a><span class=w>  </span><span class=nt>pagerduty</span><span class=p>:</span>
</span><span id=__span-92-5><a id=__codelineno-92-5 name=__codelineno-92-5 href=#__codelineno-92-5></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-92-6><a id=__codelineno-92-6 name=__codelineno-92-6 href=#__codelineno-92-6></a><span class=w>    </span><span class=nt>integration_key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${PAGERDUTY_KEY}&quot;</span>
</span><span id=__span-92-7><a id=__codelineno-92-7 name=__codelineno-92-7 href=#__codelineno-92-7></a><span class=w>    </span><span class=nt>severity_mapping</span><span class=p>:</span>
</span><span id=__span-92-8><a id=__codelineno-92-8 name=__codelineno-92-8 href=#__codelineno-92-8></a><span class=w>      </span><span class=nt>critical</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span><span class=w>  </span><span class=c1># Triggers page</span>
</span><span id=__span-92-9><a id=__codelineno-92-9 name=__codelineno-92-9 href=#__codelineno-92-9></a><span class=w>      </span><span class=nt>high</span><span class=p>:</span><span class=w> </span><span class=s>&quot;error&quot;</span><span class=w>         </span><span class=c1># Creates incident</span>
</span><span id=__span-92-10><a id=__codelineno-92-10 name=__codelineno-92-10 href=#__codelineno-92-10></a><span class=w>      </span><span class=nt>medium</span><span class=p>:</span><span class=w> </span><span class=s>&quot;warning&quot;</span><span class=w>     </span><span class=c1># Creates incident (low priority)</span>
</span><span id=__span-92-11><a id=__codelineno-92-11 name=__codelineno-92-11 href=#__codelineno-92-11></a><span class=w>      </span><span class=nt>low</span><span class=p>:</span><span class=w> </span><span class=s>&quot;info&quot;</span><span class=w>           </span><span class=c1># Notification only</span>
</span><span id=__span-92-12><a id=__codelineno-92-12 name=__codelineno-92-12 href=#__codelineno-92-12></a>
</span><span id=__span-92-13><a id=__codelineno-92-13 name=__codelineno-92-13 href=#__codelineno-92-13></a><span class=w>  </span><span class=c1># High/Critical: Post to Slack immediately</span>
</span><span id=__span-92-14><a id=__codelineno-92-14 name=__codelineno-92-14 href=#__codelineno-92-14></a><span class=w>  </span><span class=nt>slack</span><span class=p>:</span>
</span><span id=__span-92-15><a id=__codelineno-92-15 name=__codelineno-92-15 href=#__codelineno-92-15></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-92-16><a id=__codelineno-92-16 name=__codelineno-92-16 href=#__codelineno-92-16></a><span class=w>    </span><span class=nt>webhook_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${SLACK_WEBHOOK_PROD}&quot;</span>
</span><span id=__span-92-17><a id=__codelineno-92-17 name=__codelineno-92-17 href=#__codelineno-92-17></a><span class=w>    </span><span class=nt>channel</span><span class=p>:</span><span class=w> </span><span class=s>&quot;#prod-alerts&quot;</span>
</span><span id=__span-92-18><a id=__codelineno-92-18 name=__codelineno-92-18 href=#__codelineno-92-18></a><span class=w>    </span><span class=nt>severity_filter</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;critical&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;high&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-92-19><a id=__codelineno-92-19 name=__codelineno-92-19 href=#__codelineno-92-19></a>
</span><span id=__span-92-20><a id=__codelineno-92-20 name=__codelineno-92-20 href=#__codelineno-92-20></a><span class=w>  </span><span class=c1># All events: Send to SIEM</span>
</span><span id=__span-92-21><a id=__codelineno-92-21 name=__codelineno-92-21 href=#__codelineno-92-21></a><span class=w>  </span><span class=nt>webhook</span><span class=p>:</span>
</span><span id=__span-92-22><a id=__codelineno-92-22 name=__codelineno-92-22 href=#__codelineno-92-22></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-92-23><a id=__codelineno-92-23 name=__codelineno-92-23 href=#__codelineno-92-23></a><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://siem.company.com/api/events&quot;</span>
</span><span id=__span-92-24><a id=__codelineno-92-24 name=__codelineno-92-24 href=#__codelineno-92-24></a><span class=w>    </span><span class=nt>severity_filter</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;critical&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;high&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;medium&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;low&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-92-25><a id=__codelineno-92-25 name=__codelineno-92-25 href=#__codelineno-92-25></a>
</span><span id=__span-92-26><a id=__codelineno-92-26 name=__codelineno-92-26 href=#__codelineno-92-26></a><span class=w>  </span><span class=c1># Critical only: Email leadership</span>
</span><span id=__span-92-27><a id=__codelineno-92-27 name=__codelineno-92-27 href=#__codelineno-92-27></a><span class=w>  </span><span class=nt>email</span><span class=p>:</span>
</span><span id=__span-92-28><a id=__codelineno-92-28 name=__codelineno-92-28 href=#__codelineno-92-28></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-92-29><a id=__codelineno-92-29 name=__codelineno-92-29 href=#__codelineno-92-29></a><span class=w>    </span><span class=nt>smtp_server</span><span class=p>:</span><span class=w> </span><span class=s>&quot;smtp.company.com&quot;</span>
</span><span id=__span-92-30><a id=__codelineno-92-30 name=__codelineno-92-30 href=#__codelineno-92-30></a><span class=w>    </span><span class=nt>to</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;oncall@company.com&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;security@company.com&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-92-31><a id=__codelineno-92-31 name=__codelineno-92-31 href=#__codelineno-92-31></a><span class=w>    </span><span class=nt>severity_filter</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;critical&quot;</span><span class="p p-Indicator">]</span>
</span></code></pre></div> <h4 id=severity-level-guidelines>Severity Level Guidelines<a class=headerlink href=#severity-level-guidelines title="Permanent link">&para;</a></h4> <p><strong>Define clear severity criteria:</strong></p> <table> <thead> <tr> <th>Severity</th> <th>When to Use</th> <th>Response Time</th> <th>Examples</th> </tr> </thead> <tbody> <tr> <td><strong>Critical</strong></td> <td>Security-impacting changes, data loss risk</td> <td>Immediate (&lt; 5 min)</td> <td>IAM changes, firewall rules, database deletion protection</td> </tr> <tr> <td><strong>High</strong></td> <td>Service-impacting changes, compliance violations</td> <td>&lt; 30 minutes</td> <td>Instance type changes, network config, encryption settings</td> </tr> <tr> <td><strong>Medium</strong></td> <td>Non-critical config changes, performance impact</td> <td>&lt; 4 hours</td> <td>Labels, tags, non-critical metadata</td> </tr> <tr> <td><strong>Low</strong></td> <td>Informational, tracking purposes</td> <td>Next business day</td> <td>Read-only attribute changes</td> </tr> </tbody> </table> <p><strong>Configure in drift rules:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-93-1><a id=__codelineno-93-1 name=__codelineno-93-1 href=#__codelineno-93-1></a><span class=nt>drift_rules</span><span class=p>:</span>
</span><span id=__span-93-2><a id=__codelineno-93-2 name=__codelineno-93-2 href=#__codelineno-93-2></a><span class=w>  </span><span class=c1># Critical: Zero tolerance</span>
</span><span id=__span-93-3><a id=__codelineno-93-3 name=__codelineno-93-3 href=#__codelineno-93-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;IAM</span><span class=nv> </span><span class=s>Permission</span><span class=nv> </span><span class=s>Changes&quot;</span>
</span><span id=__span-93-4><a id=__codelineno-93-4 name=__codelineno-93-4 href=#__codelineno-93-4></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-93-5><a id=__codelineno-93-5 name=__codelineno-93-5 href=#__codelineno-93-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_project_iam_*&quot;</span>
</span><span id=__span-93-6><a id=__codelineno-93-6 name=__codelineno-93-6 href=#__codelineno-93-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_service_account_iam_*&quot;</span>
</span><span id=__span-93-7><a id=__codelineno-93-7 name=__codelineno-93-7 href=#__codelineno-93-7></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-93-8><a id=__codelineno-93-8 name=__codelineno-93-8 href=#__codelineno-93-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;role&quot;</span>
</span><span id=__span-93-9><a id=__codelineno-93-9 name=__codelineno-93-9 href=#__codelineno-93-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;members&quot;</span>
</span><span id=__span-93-10><a id=__codelineno-93-10 name=__codelineno-93-10 href=#__codelineno-93-10></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span>
</span><span id=__span-93-11><a id=__codelineno-93-11 name=__codelineno-93-11 href=#__codelineno-93-11></a><span class=w>    </span><span class=nt>alert_immediately</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-93-12><a id=__codelineno-93-12 name=__codelineno-93-12 href=#__codelineno-93-12></a>
</span><span id=__span-93-13><a id=__codelineno-93-13 name=__codelineno-93-13 href=#__codelineno-93-13></a><span class=w>  </span><span class=c1># High: Important but not emergency</span>
</span><span id=__span-93-14><a id=__codelineno-93-14 name=__codelineno-93-14 href=#__codelineno-93-14></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Database</span><span class=nv> </span><span class=s>Configuration&quot;</span>
</span><span id=__span-93-15><a id=__codelineno-93-15 name=__codelineno-93-15 href=#__codelineno-93-15></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-93-16><a id=__codelineno-93-16 name=__codelineno-93-16 href=#__codelineno-93-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_sql_database_instance&quot;</span>
</span><span id=__span-93-17><a id=__codelineno-93-17 name=__codelineno-93-17 href=#__codelineno-93-17></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-93-18><a id=__codelineno-93-18 name=__codelineno-93-18 href=#__codelineno-93-18></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;settings&quot;</span>
</span><span id=__span-93-19><a id=__codelineno-93-19 name=__codelineno-93-19 href=#__codelineno-93-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;database_version&quot;</span>
</span><span id=__span-93-20><a id=__codelineno-93-20 name=__codelineno-93-20 href=#__codelineno-93-20></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;high&quot;</span>
</span><span id=__span-93-21><a id=__codelineno-93-21 name=__codelineno-93-21 href=#__codelineno-93-21></a><span class=w>    </span><span class=nt>alert_immediately</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-93-22><a id=__codelineno-93-22 name=__codelineno-93-22 href=#__codelineno-93-22></a>
</span><span id=__span-93-23><a id=__codelineno-93-23 name=__codelineno-93-23 href=#__codelineno-93-23></a><span class=w>  </span><span class=c1># Medium: Track and review</span>
</span><span id=__span-93-24><a id=__codelineno-93-24 name=__codelineno-93-24 href=#__codelineno-93-24></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Instance</span><span class=nv> </span><span class=s>Metadata&quot;</span>
</span><span id=__span-93-25><a id=__codelineno-93-25 name=__codelineno-93-25 href=#__codelineno-93-25></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-93-26><a id=__codelineno-93-26 name=__codelineno-93-26 href=#__codelineno-93-26></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_instance&quot;</span>
</span><span id=__span-93-27><a id=__codelineno-93-27 name=__codelineno-93-27 href=#__codelineno-93-27></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-93-28><a id=__codelineno-93-28 name=__codelineno-93-28 href=#__codelineno-93-28></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;metadata&quot;</span>
</span><span id=__span-93-29><a id=__codelineno-93-29 name=__codelineno-93-29 href=#__codelineno-93-29></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;labels&quot;</span>
</span><span id=__span-93-30><a id=__codelineno-93-30 name=__codelineno-93-30 href=#__codelineno-93-30></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;medium&quot;</span>
</span><span id=__span-93-31><a id=__codelineno-93-31 name=__codelineno-93-31 href=#__codelineno-93-31></a><span class=w>    </span><span class=nt>alert_immediately</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id=__span-93-32><a id=__codelineno-93-32 name=__codelineno-93-32 href=#__codelineno-93-32></a><span class=w>    </span><span class=nt>batch_alerts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-93-33><a id=__codelineno-93-33 name=__codelineno-93-33 href=#__codelineno-93-33></a><span class=w>    </span><span class=nt>batch_interval</span><span class=p>:</span><span class=w> </span><span class=s>&quot;15m&quot;</span>
</span><span id=__span-93-34><a id=__codelineno-93-34 name=__codelineno-93-34 href=#__codelineno-93-34></a>
</span><span id=__span-93-35><a id=__codelineno-93-35 name=__codelineno-93-35 href=#__codelineno-93-35></a><span class=w>  </span><span class=c1># Low: Informational</span>
</span><span id=__span-93-36><a id=__codelineno-93-36 name=__codelineno-93-36 href=#__codelineno-93-36></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Resource</span><span class=nv> </span><span class=s>Tags&quot;</span>
</span><span id=__span-93-37><a id=__codelineno-93-37 name=__codelineno-93-37 href=#__codelineno-93-37></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-93-38><a id=__codelineno-93-38 name=__codelineno-93-38 href=#__codelineno-93-38></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_*&quot;</span>
</span><span id=__span-93-39><a id=__codelineno-93-39 name=__codelineno-93-39 href=#__codelineno-93-39></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-93-40><a id=__codelineno-93-40 name=__codelineno-93-40 href=#__codelineno-93-40></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;tags&quot;</span>
</span><span id=__span-93-41><a id=__codelineno-93-41 name=__codelineno-93-41 href=#__codelineno-93-41></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;low&quot;</span>
</span><span id=__span-93-42><a id=__codelineno-93-42 name=__codelineno-93-42 href=#__codelineno-93-42></a><span class=w>    </span><span class=nt>alert_immediately</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id=__span-93-43><a id=__codelineno-93-43 name=__codelineno-93-43 href=#__codelineno-93-43></a><span class=w>    </span><span class=nt>batch_alerts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-93-44><a id=__codelineno-93-44 name=__codelineno-93-44 href=#__codelineno-93-44></a><span class=w>    </span><span class=nt>batch_interval</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1h&quot;</span>
</span></code></pre></div></p> <h4 id=monitoring-tfdrift-falco-itself>Monitoring TFDrift-Falco Itself<a class=headerlink href=#monitoring-tfdrift-falco-itself title="Permanent link">&para;</a></h4> <p><strong>Health Check Endpoint:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-94-1><a id=__codelineno-94-1 name=__codelineno-94-1 href=#__codelineno-94-1></a><span class=c1># Implement health check</span>
</span><span id=__span-94-2><a id=__codelineno-94-2 name=__codelineno-94-2 href=#__codelineno-94-2></a>curl<span class=w> </span>http://localhost:8080/health
</span><span id=__span-94-3><a id=__codelineno-94-3 name=__codelineno-94-3 href=#__codelineno-94-3></a>
</span><span id=__span-94-4><a id=__codelineno-94-4 name=__codelineno-94-4 href=#__codelineno-94-4></a><span class=c1># Expected response:</span>
</span><span id=__span-94-5><a id=__codelineno-94-5 name=__codelineno-94-5 href=#__codelineno-94-5></a><span class=o>{</span>
</span><span id=__span-94-6><a id=__codelineno-94-6 name=__codelineno-94-6 href=#__codelineno-94-6></a><span class=w>  </span><span class=s2>&quot;status&quot;</span>:<span class=w> </span><span class=s2>&quot;healthy&quot;</span>,
</span><span id=__span-94-7><a id=__codelineno-94-7 name=__codelineno-94-7 href=#__codelineno-94-7></a><span class=w>  </span><span class=s2>&quot;version&quot;</span>:<span class=w> </span><span class=s2>&quot;v0.5.0&quot;</span>,
</span><span id=__span-94-8><a id=__codelineno-94-8 name=__codelineno-94-8 href=#__codelineno-94-8></a><span class=w>  </span><span class=s2>&quot;uptime_seconds&quot;</span>:<span class=w> </span><span class=m>3600</span>,
</span><span id=__span-94-9><a id=__codelineno-94-9 name=__codelineno-94-9 href=#__codelineno-94-9></a><span class=w>  </span><span class=s2>&quot;last_event_received&quot;</span>:<span class=w> </span><span class=s2>&quot;2025-12-17T10:30:45Z&quot;</span>,
</span><span id=__span-94-10><a id=__codelineno-94-10 name=__codelineno-94-10 href=#__codelineno-94-10></a><span class=w>  </span><span class=s2>&quot;falco_connection&quot;</span>:<span class=w> </span><span class=s2>&quot;connected&quot;</span>,
</span><span id=__span-94-11><a id=__codelineno-94-11 name=__codelineno-94-11 href=#__codelineno-94-11></a><span class=w>  </span><span class=s2>&quot;state_backend&quot;</span>:<span class=w> </span><span class=s2>&quot;gcs&quot;</span>,
</span><span id=__span-94-12><a id=__codelineno-94-12 name=__codelineno-94-12 href=#__codelineno-94-12></a><span class=w>  </span><span class=s2>&quot;projects_monitored&quot;</span>:<span class=w> </span><span class=m>2</span>
</span><span id=__span-94-13><a id=__codelineno-94-13 name=__codelineno-94-13 href=#__codelineno-94-13></a><span class=o>}</span>
</span></code></pre></div></p> <p><strong>Monitoring Script:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-95-1><a id=__codelineno-95-1 name=__codelineno-95-1 href=#__codelineno-95-1></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-95-2><a id=__codelineno-95-2 name=__codelineno-95-2 href=#__codelineno-95-2></a><span class=c1># monitor-tfdrift.sh</span>
</span><span id=__span-95-3><a id=__codelineno-95-3 name=__codelineno-95-3 href=#__codelineno-95-3></a>
</span><span id=__span-95-4><a id=__codelineno-95-4 name=__codelineno-95-4 href=#__codelineno-95-4></a><span class=nv>HEALTH_URL</span><span class=o>=</span><span class=s2>&quot;http://localhost:8080/health&quot;</span>
</span><span id=__span-95-5><a id=__codelineno-95-5 name=__codelineno-95-5 href=#__codelineno-95-5></a><span class=nv>ALERT_WEBHOOK</span><span class=o>=</span><span class=s2>&quot;https://monitoring.company.com/alert&quot;</span>
</span><span id=__span-95-6><a id=__codelineno-95-6 name=__codelineno-95-6 href=#__codelineno-95-6></a>
</span><span id=__span-95-7><a id=__codelineno-95-7 name=__codelineno-95-7 href=#__codelineno-95-7></a><span class=k>while</span><span class=w> </span>true<span class=p>;</span><span class=w> </span><span class=k>do</span>
</span><span id=__span-95-8><a id=__codelineno-95-8 name=__codelineno-95-8 href=#__codelineno-95-8></a><span class=w>    </span><span class=nv>RESPONSE</span><span class=o>=</span><span class=k>$(</span>curl<span class=w> </span>-s<span class=w> </span>-o<span class=w> </span>/dev/null<span class=w> </span>-w<span class=w> </span><span class=s2>&quot;%{http_code}&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$HEALTH_URL</span><span class=s2>&quot;</span><span class=k>)</span>
</span><span id=__span-95-9><a id=__codelineno-95-9 name=__codelineno-95-9 href=#__codelineno-95-9></a>
</span><span id=__span-95-10><a id=__codelineno-95-10 name=__codelineno-95-10 href=#__codelineno-95-10></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RESPONSE</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;200&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-95-11><a id=__codelineno-95-11 name=__codelineno-95-11 href=#__codelineno-95-11></a><span class=w>        </span><span class=c1># Alert: TFDrift is down</span>
</span><span id=__span-95-12><a id=__codelineno-95-12 name=__codelineno-95-12 href=#__codelineno-95-12></a><span class=w>        </span>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span><span class=s2>&quot;</span><span class=nv>$ALERT_WEBHOOK</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-95-13><a id=__codelineno-95-13 name=__codelineno-95-13 href=#__codelineno-95-13></a><span class=w>          </span>-H<span class=w> </span><span class=s1>&#39;Content-Type: application/json&#39;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-95-14><a id=__codelineno-95-14 name=__codelineno-95-14 href=#__codelineno-95-14></a><span class=w>          </span>-d<span class=w> </span><span class=s1>&#39;{</span>
</span><span id=__span-95-15><a id=__codelineno-95-15 name=__codelineno-95-15 href=#__codelineno-95-15></a><span class=s1>            &quot;severity&quot;: &quot;critical&quot;,</span>
</span><span id=__span-95-16><a id=__codelineno-95-16 name=__codelineno-95-16 href=#__codelineno-95-16></a><span class=s1>            &quot;service&quot;: &quot;tfdrift-falco&quot;,</span>
</span><span id=__span-95-17><a id=__codelineno-95-17 name=__codelineno-95-17 href=#__codelineno-95-17></a><span class=s1>            &quot;message&quot;: &quot;TFDrift health check failed&quot;,</span>
</span><span id=__span-95-18><a id=__codelineno-95-18 name=__codelineno-95-18 href=#__codelineno-95-18></a><span class=s1>            &quot;status_code&quot;: &quot;&#39;</span><span class=nv>$RESPONSE</span><span class=s1>&#39;&quot;</span>
</span><span id=__span-95-19><a id=__codelineno-95-19 name=__codelineno-95-19 href=#__codelineno-95-19></a><span class=s1>          }&#39;</span>
</span><span id=__span-95-20><a id=__codelineno-95-20 name=__codelineno-95-20 href=#__codelineno-95-20></a><span class=w>    </span><span class=k>fi</span>
</span><span id=__span-95-21><a id=__codelineno-95-21 name=__codelineno-95-21 href=#__codelineno-95-21></a>
</span><span id=__span-95-22><a id=__codelineno-95-22 name=__codelineno-95-22 href=#__codelineno-95-22></a><span class=w>    </span>sleep<span class=w> </span><span class=m>60</span>
</span><span id=__span-95-23><a id=__codelineno-95-23 name=__codelineno-95-23 href=#__codelineno-95-23></a><span class=k>done</span>
</span></code></pre></div></p> <p><strong>Log Monitoring:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-96-1><a id=__codelineno-96-1 name=__codelineno-96-1 href=#__codelineno-96-1></a><span class=c1># Monitor for errors in logs</span>
</span><span id=__span-96-2><a id=__codelineno-96-2 name=__codelineno-96-2 href=#__codelineno-96-2></a>journalctl<span class=w> </span>-u<span class=w> </span>tfdrift-falco<span class=w> </span>-f<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;(ERROR|FATAL)&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=k>while</span><span class=w> </span><span class=nb>read</span><span class=w> </span>line<span class=p>;</span><span class=w> </span><span class=k>do</span>
</span><span id=__span-96-3><a id=__codelineno-96-3 name=__codelineno-96-3 href=#__codelineno-96-3></a><span class=w>    </span><span class=c1># Alert on errors</span>
</span><span id=__span-96-4><a id=__codelineno-96-4 name=__codelineno-96-4 href=#__codelineno-96-4></a><span class=w>    </span>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span><span class=s2>&quot;</span><span class=nv>$ALERT_WEBHOOK</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-96-5><a id=__codelineno-96-5 name=__codelineno-96-5 href=#__codelineno-96-5></a><span class=w>      </span>-d<span class=w> </span><span class=s2>&quot;TFDrift Error: </span><span class=nv>$line</span><span class=s2>&quot;</span>
</span><span id=__span-96-6><a id=__codelineno-96-6 name=__codelineno-96-6 href=#__codelineno-96-6></a><span class=k>done</span>
</span></code></pre></div></p> <hr> <h3 id=4-operational-excellence>4. Operational Excellence<a class=headerlink href=#4-operational-excellence title="Permanent link">&para;</a></h3> <h4 id=change-management>Change Management<a class=headerlink href=#change-management title="Permanent link">&para;</a></h4> <p><strong>Terraform Change Workflow:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-97-1><a id=__codelineno-97-1 name=__codelineno-97-1 href=#__codelineno-97-1></a>1. Developer creates Terraform change
</span><span id=__span-97-2><a id=__codelineno-97-2 name=__codelineno-97-2 href=#__codelineno-97-2></a>   ‚Üì
</span><span id=__span-97-3><a id=__codelineno-97-3 name=__codelineno-97-3 href=#__codelineno-97-3></a>2. CI/CD runs terraform plan
</span><span id=__span-97-4><a id=__codelineno-97-4 name=__codelineno-97-4 href=#__codelineno-97-4></a>   ‚Üì
</span><span id=__span-97-5><a id=__codelineno-97-5 name=__codelineno-97-5 href=#__codelineno-97-5></a>3. Pull request review
</span><span id=__span-97-6><a id=__codelineno-97-6 name=__codelineno-97-6 href=#__codelineno-97-6></a>   ‚Üì
</span><span id=__span-97-7><a id=__codelineno-97-7 name=__codelineno-97-7 href=#__codelineno-97-7></a>4. Approved ‚Üí terraform apply
</span><span id=__span-97-8><a id=__codelineno-97-8 name=__codelineno-97-8 href=#__codelineno-97-8></a>   ‚Üì
</span><span id=__span-97-9><a id=__codelineno-97-9 name=__codelineno-97-9 href=#__codelineno-97-9></a>5. TFDrift-Falco monitors for manual changes
</span><span id=__span-97-10><a id=__codelineno-97-10 name=__codelineno-97-10 href=#__codelineno-97-10></a>   ‚Üì
</span><span id=__span-97-11><a id=__codelineno-97-11 name=__codelineno-97-11 href=#__codelineno-97-11></a>6. Alert if drift detected within 1 hour
</span></code></pre></div></p> <p><strong>Handling Drift Alerts:</strong></p> <ol> <li><strong>Immediate Response (&lt; 5 minutes):</strong></li> <li>Acknowledge alert</li> <li>Check if change was authorized</li> <li> <p>If unauthorized, investigate and remediate</p> </li> <li> <p><strong>Investigation:</strong></p> </li> <li>Who made the change? (check principalEmail)</li> <li>What was changed? (review diff)</li> <li> <p>Why was manual change made? (was it emergency?)</p> </li> <li> <p><strong>Remediation Options:</strong></p> </li> <li> <p><strong>Option A: Revert manual change</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-98-1><a id=__codelineno-98-1 name=__codelineno-98-1 href=#__codelineno-98-1></a><span class=c1># Reapply Terraform to revert</span>
</span><span id=__span-98-2><a id=__codelineno-98-2 name=__codelineno-98-2 href=#__codelineno-98-2></a>terraform<span class=w> </span>apply
</span></code></pre></div></p> </li> <li> <p><strong>Option B: Update Terraform state</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-99-1><a id=__codelineno-99-1 name=__codelineno-99-1 href=#__codelineno-99-1></a><span class=c1># If change is authorized, update Terraform</span>
</span><span id=__span-99-2><a id=__codelineno-99-2 name=__codelineno-99-2 href=#__codelineno-99-2></a><span class=c1># 1. Update .tf files</span>
</span><span id=__span-99-3><a id=__codelineno-99-3 name=__codelineno-99-3 href=#__codelineno-99-3></a><span class=c1># 2. Run terraform plan to verify</span>
</span><span id=__span-99-4><a id=__codelineno-99-4 name=__codelineno-99-4 href=#__codelineno-99-4></a><span class=c1># 3. Apply changes</span>
</span><span id=__span-99-5><a id=__codelineno-99-5 name=__codelineno-99-5 href=#__codelineno-99-5></a>terraform<span class=w> </span>apply
</span></code></pre></div></p> </li> <li> <p><strong>Option C: Accept drift temporarily</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-100-1><a id=__codelineno-100-1 name=__codelineno-100-1 href=#__codelineno-100-1></a><span class=c1># Document in issue tracker</span>
</span><span id=__span-100-2><a id=__codelineno-100-2 name=__codelineno-100-2 href=#__codelineno-100-2></a><span class=c1># Schedule Terraform update</span>
</span></code></pre></div></p> </li> <li> <p><strong>Post-Incident:</strong></p> </li> <li>Document incident</li> <li>Update runbooks</li> <li>Review access controls</li> <li>Consider automation improvements</li> </ol> <p><strong>Incident Response Template:</strong> <div class="language-markdown highlight"><pre><span></span><code><span id=__span-101-1><a id=__codelineno-101-1 name=__codelineno-101-1 href=#__codelineno-101-1></a><span class=gh># Drift Alert Incident Report</span>
</span><span id=__span-101-2><a id=__codelineno-101-2 name=__codelineno-101-2 href=#__codelineno-101-2></a>
</span><span id=__span-101-3><a id=__codelineno-101-3 name=__codelineno-101-3 href=#__codelineno-101-3></a><span class=gs>**Date:**</span> 2025-12-17
</span><span id=__span-101-4><a id=__codelineno-101-4 name=__codelineno-101-4 href=#__codelineno-101-4></a><span class=gs>**Severity:**</span> Critical
</span><span id=__span-101-5><a id=__codelineno-101-5 name=__codelineno-101-5 href=#__codelineno-101-5></a><span class=gs>**Resource:**</span> google_compute_firewall.prod_allow_ssh
</span><span id=__span-101-6><a id=__codelineno-101-6 name=__codelineno-101-6 href=#__codelineno-101-6></a><span class=gs>**Change Detected:**</span> source_ranges modified
</span><span id=__span-101-7><a id=__codelineno-101-7 name=__codelineno-101-7 href=#__codelineno-101-7></a>
</span><span id=__span-101-8><a id=__codelineno-101-8 name=__codelineno-101-8 href=#__codelineno-101-8></a><span class=gu>## Timeline</span>
</span><span id=__span-101-9><a id=__codelineno-101-9 name=__codelineno-101-9 href=#__codelineno-101-9></a><span class=k>-</span><span class=w> </span>10:30:00 - Manual change made via Console
</span><span id=__span-101-10><a id=__codelineno-101-10 name=__codelineno-101-10 href=#__codelineno-101-10></a><span class=k>-</span><span class=w> </span>10:30:45 - TFDrift alert fired
</span><span id=__span-101-11><a id=__codelineno-101-11 name=__codelineno-101-11 href=#__codelineno-101-11></a><span class=k>-</span><span class=w> </span>10:31:00 - On-call engineer acknowledged
</span><span id=__span-101-12><a id=__codelineno-101-12 name=__codelineno-101-12 href=#__codelineno-101-12></a><span class=k>-</span><span class=w> </span>10:35:00 - Change identified as unauthorized
</span><span id=__span-101-13><a id=__codelineno-101-13 name=__codelineno-101-13 href=#__codelineno-101-13></a><span class=k>-</span><span class=w> </span>10:40:00 - Terraform reapplied, change reverted
</span><span id=__span-101-14><a id=__codelineno-101-14 name=__codelineno-101-14 href=#__codelineno-101-14></a><span class=k>-</span><span class=w> </span>10:45:00 - Incident resolved
</span><span id=__span-101-15><a id=__codelineno-101-15 name=__codelineno-101-15 href=#__codelineno-101-15></a>
</span><span id=__span-101-16><a id=__codelineno-101-16 name=__codelineno-101-16 href=#__codelineno-101-16></a><span class=gu>## Root Cause</span>
</span><span id=__span-101-17><a id=__codelineno-101-17 name=__codelineno-101-17 href=#__codelineno-101-17></a>Engineer made emergency change via Console without following change management process.
</span><span id=__span-101-18><a id=__codelineno-101-18 name=__codelineno-101-18 href=#__codelineno-101-18></a>
</span><span id=__span-101-19><a id=__codelineno-101-19 name=__codelineno-101-19 href=#__codelineno-101-19></a><span class=gu>## Resolution</span>
</span><span id=__span-101-20><a id=__codelineno-101-20 name=__codelineno-101-20 href=#__codelineno-101-20></a><span class=k>1.</span> Reverted unauthorized firewall rule change
</span><span id=__span-101-21><a id=__codelineno-101-21 name=__codelineno-101-21 href=#__codelineno-101-21></a><span class=k>2.</span> Reminded team of change management policy
</span><span id=__span-101-22><a id=__codelineno-101-22 name=__codelineno-101-22 href=#__codelineno-101-22></a><span class=k>3.</span> Updated documentation
</span><span id=__span-101-23><a id=__codelineno-101-23 name=__codelineno-101-23 href=#__codelineno-101-23></a>
</span><span id=__span-101-24><a id=__codelineno-101-24 name=__codelineno-101-24 href=#__codelineno-101-24></a><span class=gu>## Action Items</span>
</span><span id=__span-101-25><a id=__codelineno-101-25 name=__codelineno-101-25 href=#__codelineno-101-25></a><span class=k>- [ ]</span> Add pre-commit hook to validate Terraform
</span><span id=__span-101-26><a id=__codelineno-101-26 name=__codelineno-101-26 href=#__codelineno-101-26></a><span class=k>- [ ]</span> Send change management reminder to team
</span><span id=__span-101-27><a id=__codelineno-101-27 name=__codelineno-101-27 href=#__codelineno-101-27></a><span class=k>- [ ]</span> Review firewall rule IAM permissions
</span></code></pre></div></p> <h4 id=documentation-standards>Documentation Standards<a class=headerlink href=#documentation-standards title="Permanent link">&para;</a></h4> <p><strong>Maintain comprehensive documentation:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-102-1><a id=__codelineno-102-1 name=__codelineno-102-1 href=#__codelineno-102-1></a>docs/
</span><span id=__span-102-2><a id=__codelineno-102-2 name=__codelineno-102-2 href=#__codelineno-102-2></a>‚îú‚îÄ‚îÄ runbooks/
</span><span id=__span-102-3><a id=__codelineno-102-3 name=__codelineno-102-3 href=#__codelineno-102-3></a>‚îÇ   ‚îú‚îÄ‚îÄ drift-response.md          # How to respond to drift alerts
</span><span id=__span-102-4><a id=__codelineno-102-4 name=__codelineno-102-4 href=#__codelineno-102-4></a>‚îÇ   ‚îú‚îÄ‚îÄ emergency-procedures.md    # Emergency access procedures
</span><span id=__span-102-5><a id=__codelineno-102-5 name=__codelineno-102-5 href=#__codelineno-102-5></a>‚îÇ   ‚îî‚îÄ‚îÄ escalation.md              # Escalation paths
</span><span id=__span-102-6><a id=__codelineno-102-6 name=__codelineno-102-6 href=#__codelineno-102-6></a>‚îú‚îÄ‚îÄ architecture/
</span><span id=__span-102-7><a id=__codelineno-102-7 name=__codelineno-102-7 href=#__codelineno-102-7></a>‚îÇ   ‚îú‚îÄ‚îÄ infrastructure-overview.md
</span><span id=__span-102-8><a id=__codelineno-102-8 name=__codelineno-102-8 href=#__codelineno-102-8></a>‚îÇ   ‚îú‚îÄ‚îÄ network-topology.md
</span><span id=__span-102-9><a id=__codelineno-102-9 name=__codelineno-102-9 href=#__codelineno-102-9></a>‚îÇ   ‚îî‚îÄ‚îÄ security-controls.md
</span><span id=__span-102-10><a id=__codelineno-102-10 name=__codelineno-102-10 href=#__codelineno-102-10></a>‚îî‚îÄ‚îÄ operations/
</span><span id=__span-102-11><a id=__codelineno-102-11 name=__codelineno-102-11 href=#__codelineno-102-11></a>    ‚îú‚îÄ‚îÄ deployment-process.md
</span><span id=__span-102-12><a id=__codelineno-102-12 name=__codelineno-102-12 href=#__codelineno-102-12></a>    ‚îú‚îÄ‚îÄ monitoring-guide.md
</span><span id=__span-102-13><a id=__codelineno-102-13 name=__codelineno-102-13 href=#__codelineno-102-13></a>    ‚îî‚îÄ‚îÄ troubleshooting.md
</span></code></pre></div> <p><strong>Runbook Example:</strong> <div class="language-markdown highlight"><pre><span></span><code><span id=__span-103-1><a id=__codelineno-103-1 name=__codelineno-103-1 href=#__codelineno-103-1></a><span class=gh># Drift Alert Response Runbook</span>
</span><span id=__span-103-2><a id=__codelineno-103-2 name=__codelineno-103-2 href=#__codelineno-103-2></a>
</span><span id=__span-103-3><a id=__codelineno-103-3 name=__codelineno-103-3 href=#__codelineno-103-3></a><span class=gu>## Critical IAM Change Alert</span>
</span><span id=__span-103-4><a id=__codelineno-103-4 name=__codelineno-103-4 href=#__codelineno-103-4></a>
</span><span id=__span-103-5><a id=__codelineno-103-5 name=__codelineno-103-5 href=#__codelineno-103-5></a><span class=gs>**Alert:**</span> <span class=sb>`google_project_iam_member`</span> drift detected
</span><span id=__span-103-6><a id=__codelineno-103-6 name=__codelineno-103-6 href=#__codelineno-103-6></a>
</span><span id=__span-103-7><a id=__codelineno-103-7 name=__codelineno-103-7 href=#__codelineno-103-7></a><span class=gu>### Step 1: Immediate Assessment (&lt; 2 minutes)</span>
</span><span id=__span-103-8><a id=__codelineno-103-8 name=__codelineno-103-8 href=#__codelineno-103-8></a><span class=k>1.</span> Check alert details:
</span><span id=__span-103-9><a id=__codelineno-103-9 name=__codelineno-103-9 href=#__codelineno-103-9></a><span class=w>   </span><span class=k>-</span><span class=w> </span>Who made the change? (principalEmail)
</span><span id=__span-103-10><a id=__codelineno-103-10 name=__codelineno-103-10 href=#__codelineno-103-10></a><span class=w>   </span><span class=k>-</span><span class=w> </span>What role was granted/revoked?
</span><span id=__span-103-11><a id=__codelineno-103-11 name=__codelineno-103-11 href=#__codelineno-103-11></a><span class=w>   </span><span class=k>-</span><span class=w> </span>Which project?
</span><span id=__span-103-12><a id=__codelineno-103-12 name=__codelineno-103-12 href=#__codelineno-103-12></a>
</span><span id=__span-103-13><a id=__codelineno-103-13 name=__codelineno-103-13 href=#__codelineno-103-13></a><span class=k>2.</span> Verify if authorized:
</span><span id=__span-103-14><a id=__codelineno-103-14 name=__codelineno-103-14 href=#__codelineno-103-14></a><span class=w>   </span><span class=k>-</span><span class=w> </span>Check change management tickets
</span><span id=__span-103-15><a id=__codelineno-103-15 name=__codelineno-103-15 href=#__codelineno-103-15></a><span class=w>   </span><span class=k>-</span><span class=w> </span>Contact user if possible
</span><span id=__span-103-16><a id=__codelineno-103-16 name=__codelineno-103-16 href=#__codelineno-103-16></a><span class=w>   </span><span class=k>-</span><span class=w> </span>Check recent approvals
</span><span id=__span-103-17><a id=__codelineno-103-17 name=__codelineno-103-17 href=#__codelineno-103-17></a>
</span><span id=__span-103-18><a id=__codelineno-103-18 name=__codelineno-103-18 href=#__codelineno-103-18></a><span class=gu>### Step 2: Containment (&lt; 5 minutes)</span>
</span><span id=__span-103-19><a id=__codelineno-103-19 name=__codelineno-103-19 href=#__codelineno-103-19></a>If unauthorized:
</span><span id=__span-103-20><a id=__codelineno-103-20 name=__codelineno-103-20 href=#__codelineno-103-20></a>```bash
</span><span id=__span-103-21><a id=__codelineno-103-21 name=__codelineno-103-21 href=#__codelineno-103-21></a><span class=gh># Revoke unauthorized permission immediately</span>
</span><span id=__span-103-22><a id=__codelineno-103-22 name=__codelineno-103-22 href=#__codelineno-103-22></a>gcloud projects remove-iam-policy-binding PROJECT_ID \
</span><span id=__span-103-23><a id=__codelineno-103-23 name=__codelineno-103-23 href=#__codelineno-103-23></a>  --member=&quot;user:suspicious@example.com&quot; \
</span><span id=__span-103-24><a id=__codelineno-103-24 name=__codelineno-103-24 href=#__codelineno-103-24></a>  --role=&quot;roles/editor&quot;
</span></code></pre></div></p> <h3 id=step-3-investigation-30-minutes>Step 3: Investigation (&lt; 30 minutes)<a class=headerlink href=#step-3-investigation-30-minutes title="Permanent link">&para;</a></h3> <ol> <li>Review GCP Audit Logs</li> <li>Check for related changes</li> <li>Interview user if needed</li> <li>Document findings</li> </ol> <h3 id=step-4-remediation>Step 4: Remediation<a class=headerlink href=#step-4-remediation title="Permanent link">&para;</a></h3> <p>Choose appropriate action: - Revert change via Terraform - Update Terraform to match (if authorized) - Escalate to security team</p> <h3 id=step-5-follow-up>Step 5: Follow-up<a class=headerlink href=#step-5-follow-up title="Permanent link">&para;</a></h3> <ul> <li>Update incident tracker</li> <li>Notify stakeholders</li> <li>Schedule post-mortem if needed <div class="language-text highlight"><pre><span></span><code><span id=__span-104-1><a id=__codelineno-104-1 name=__codelineno-104-1 href=#__codelineno-104-1></a>---
</span><span id=__span-104-2><a id=__codelineno-104-2 name=__codelineno-104-2 href=#__codelineno-104-2></a>
</span><span id=__span-104-3><a id=__codelineno-104-3 name=__codelineno-104-3 href=#__codelineno-104-3></a>### 5. Performance &amp; Scalability
</span><span id=__span-104-4><a id=__codelineno-104-4 name=__codelineno-104-4 href=#__codelineno-104-4></a>
</span><span id=__span-104-5><a id=__codelineno-104-5 name=__codelineno-104-5 href=#__codelineno-104-5></a>#### Event Filtering
</span><span id=__span-104-6><a id=__codelineno-104-6 name=__codelineno-104-6 href=#__codelineno-104-6></a>
</span><span id=__span-104-7><a id=__codelineno-104-7 name=__codelineno-104-7 href=#__codelineno-104-7></a>**Filter events at multiple levels:**
</span><span id=__span-104-8><a id=__codelineno-104-8 name=__codelineno-104-8 href=#__codelineno-104-8></a>
</span><span id=__span-104-9><a id=__codelineno-104-9 name=__codelineno-104-9 href=#__codelineno-104-9></a>**Level 1: GCP Log Sink (earliest, most efficient)**
</span><span id=__span-104-10><a id=__codelineno-104-10 name=__codelineno-104-10 href=#__codelineno-104-10></a>```bash
</span><span id=__span-104-11><a id=__codelineno-104-11 name=__codelineno-104-11 href=#__codelineno-104-11></a># Only forward compute and IAM events
</span><span id=__span-104-12><a id=__codelineno-104-12 name=__codelineno-104-12 href=#__codelineno-104-12></a>gcloud logging sinks update tfdrift-sink \
</span><span id=__span-104-13><a id=__codelineno-104-13 name=__codelineno-104-13 href=#__codelineno-104-13></a>  --log-filter=&#39;
</span><span id=__span-104-14><a id=__codelineno-104-14 name=__codelineno-104-14 href=#__codelineno-104-14></a>    (protoPayload.serviceName=&quot;compute.googleapis.com&quot; OR
</span><span id=__span-104-15><a id=__codelineno-104-15 name=__codelineno-104-15 href=#__codelineno-104-15></a>     protoPayload.serviceName=&quot;iam.googleapis.com&quot;) AND
</span><span id=__span-104-16><a id=__codelineno-104-16 name=__codelineno-104-16 href=#__codelineno-104-16></a>    protoPayload.methodName!~&quot;\.get$|\.list$&quot;
</span><span id=__span-104-17><a id=__codelineno-104-17 name=__codelineno-104-17 href=#__codelineno-104-17></a>  &#39;
</span></code></pre></div></li> </ul> <p><strong>Level 2: Falco Rules (plugin level)</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-105-1><a id=__codelineno-105-1 name=__codelineno-105-1 href=#__codelineno-105-1></a><span class=c1># falco-rules.yaml</span>
</span><span id=__span-105-2><a id=__codelineno-105-2 name=__codelineno-105-2 href=#__codelineno-105-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Relevant GCP Changes</span>
</span><span id=__span-105-3><a id=__codelineno-105-3 name=__codelineno-105-3 href=#__codelineno-105-3></a><span class=w>  </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;</span>
</span><span id=__span-105-4><a id=__codelineno-105-4 name=__codelineno-105-4 href=#__codelineno-105-4></a><span class=w>    </span><span class=no>gcp.serviceName in (compute.googleapis.com, iam.googleapis.com, sqladmin.googleapis.com) and</span>
</span><span id=__span-105-5><a id=__codelineno-105-5 name=__codelineno-105-5 href=#__codelineno-105-5></a><span class=w>    </span><span class=no>gcp.methodName matches &quot;(insert|update|patch|delete|set.*)&quot; and</span>
</span><span id=__span-105-6><a id=__codelineno-105-6 name=__codelineno-105-6 href=#__codelineno-105-6></a><span class=w>    </span><span class=no>not gcp.methodName matches &quot;(list|get|describe)&quot;</span>
</span><span id=__span-105-7><a id=__codelineno-105-7 name=__codelineno-105-7 href=#__codelineno-105-7></a><span class=w>  </span><span class=nt>output</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Relevant GCP change detected</span>
</span><span id=__span-105-8><a id=__codelineno-105-8 name=__codelineno-105-8 href=#__codelineno-105-8></a><span class=w>  </span><span class=nt>priority</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NOTICE</span>
</span></code></pre></div></p> <p><strong>Level 3: TFDrift Configuration (application level)</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-106-1><a id=__codelineno-106-1 name=__codelineno-106-1 href=#__codelineno-106-1></a><span class=c1># config.yaml</span>
</span><span id=__span-106-2><a id=__codelineno-106-2 name=__codelineno-106-2 href=#__codelineno-106-2></a><span class=nt>filtering</span><span class=p>:</span>
</span><span id=__span-106-3><a id=__codelineno-106-3 name=__codelineno-106-3 href=#__codelineno-106-3></a><span class=w>  </span><span class=c1># Ignore read-only operations</span>
</span><span id=__span-106-4><a id=__codelineno-106-4 name=__codelineno-106-4 href=#__codelineno-106-4></a><span class=w>  </span><span class=nt>exclude_events</span><span class=p>:</span>
</span><span id=__span-106-5><a id=__codelineno-106-5 name=__codelineno-106-5 href=#__codelineno-106-5></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*.list&quot;</span>
</span><span id=__span-106-6><a id=__codelineno-106-6 name=__codelineno-106-6 href=#__codelineno-106-6></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*.get&quot;</span>
</span><span id=__span-106-7><a id=__codelineno-106-7 name=__codelineno-106-7 href=#__codelineno-106-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*.describe&quot;</span>
</span><span id=__span-106-8><a id=__codelineno-106-8 name=__codelineno-106-8 href=#__codelineno-106-8></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*.testIamPermissions&quot;</span>
</span><span id=__span-106-9><a id=__codelineno-106-9 name=__codelineno-106-9 href=#__codelineno-106-9></a>
</span><span id=__span-106-10><a id=__codelineno-106-10 name=__codelineno-106-10 href=#__codelineno-106-10></a><span class=w>  </span><span class=c1># Focus on write operations</span>
</span><span id=__span-106-11><a id=__codelineno-106-11 name=__codelineno-106-11 href=#__codelineno-106-11></a><span class=w>  </span><span class=nt>include_methods</span><span class=p>:</span>
</span><span id=__span-106-12><a id=__codelineno-106-12 name=__codelineno-106-12 href=#__codelineno-106-12></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*.insert&quot;</span>
</span><span id=__span-106-13><a id=__codelineno-106-13 name=__codelineno-106-13 href=#__codelineno-106-13></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*.update&quot;</span>
</span><span id=__span-106-14><a id=__codelineno-106-14 name=__codelineno-106-14 href=#__codelineno-106-14></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*.patch&quot;</span>
</span><span id=__span-106-15><a id=__codelineno-106-15 name=__codelineno-106-15 href=#__codelineno-106-15></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*.delete&quot;</span>
</span><span id=__span-106-16><a id=__codelineno-106-16 name=__codelineno-106-16 href=#__codelineno-106-16></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*.set*&quot;</span>
</span><span id=__span-106-17><a id=__codelineno-106-17 name=__codelineno-106-17 href=#__codelineno-106-17></a>
</span><span id=__span-106-18><a id=__codelineno-106-18 name=__codelineno-106-18 href=#__codelineno-106-18></a><span class=w>  </span><span class=c1># Only monitor specific services</span>
</span><span id=__span-106-19><a id=__codelineno-106-19 name=__codelineno-106-19 href=#__codelineno-106-19></a><span class=w>  </span><span class=nt>include_services</span><span class=p>:</span>
</span><span id=__span-106-20><a id=__codelineno-106-20 name=__codelineno-106-20 href=#__codelineno-106-20></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;compute.googleapis.com&quot;</span>
</span><span id=__span-106-21><a id=__codelineno-106-21 name=__codelineno-106-21 href=#__codelineno-106-21></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;container.googleapis.com&quot;</span>
</span><span id=__span-106-22><a id=__codelineno-106-22 name=__codelineno-106-22 href=#__codelineno-106-22></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;sqladmin.googleapis.com&quot;</span>
</span><span id=__span-106-23><a id=__codelineno-106-23 name=__codelineno-106-23 href=#__codelineno-106-23></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;iam.googleapis.com&quot;</span>
</span><span id=__span-106-24><a id=__codelineno-106-24 name=__codelineno-106-24 href=#__codelineno-106-24></a>
</span><span id=__span-106-25><a id=__codelineno-106-25 name=__codelineno-106-25 href=#__codelineno-106-25></a><span class=w>  </span><span class=c1># Ignore automated service accounts</span>
</span><span id=__span-106-26><a id=__codelineno-106-26 name=__codelineno-106-26 href=#__codelineno-106-26></a><span class=w>  </span><span class=nt>exclude_principals</span><span class=p>:</span>
</span><span id=__span-106-27><a id=__codelineno-106-27 name=__codelineno-106-27 href=#__codelineno-106-27></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;serviceAccount:*@cloudbuild.gserviceaccount.com&quot;</span>
</span><span id=__span-106-28><a id=__codelineno-106-28 name=__codelineno-106-28 href=#__codelineno-106-28></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;serviceAccount:*@cloudservices.gserviceaccount.com&quot;</span>
</span></code></pre></div></p> <h4 id=resource-limits>Resource Limits<a class=headerlink href=#resource-limits title="Permanent link">&para;</a></h4> <p><strong>Set appropriate limits:</strong></p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-107-1><a id=__codelineno-107-1 name=__codelineno-107-1 href=#__codelineno-107-1></a><span class=c1># config.yaml</span>
</span><span id=__span-107-2><a id=__codelineno-107-2 name=__codelineno-107-2 href=#__codelineno-107-2></a><span class=nt>performance</span><span class=p>:</span>
</span><span id=__span-107-3><a id=__codelineno-107-3 name=__codelineno-107-3 href=#__codelineno-107-3></a><span class=w>  </span><span class=c1># Maximum events to process per second</span>
</span><span id=__span-107-4><a id=__codelineno-107-4 name=__codelineno-107-4 href=#__codelineno-107-4></a><span class=w>  </span><span class=nt>max_events_per_second</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
</span><span id=__span-107-5><a id=__codelineno-107-5 name=__codelineno-107-5 href=#__codelineno-107-5></a>
</span><span id=__span-107-6><a id=__codelineno-107-6 name=__codelineno-107-6 href=#__codelineno-107-6></a><span class=w>  </span><span class=c1># Maximum concurrent state file loads</span>
</span><span id=__span-107-7><a id=__codelineno-107-7 name=__codelineno-107-7 href=#__codelineno-107-7></a><span class=w>  </span><span class=nt>max_concurrent_state_loads</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id=__span-107-8><a id=__codelineno-107-8 name=__codelineno-107-8 href=#__codelineno-107-8></a>
</span><span id=__span-107-9><a id=__codelineno-107-9 name=__codelineno-107-9 href=#__codelineno-107-9></a><span class=w>  </span><span class=c1># Event queue size</span>
</span><span id=__span-107-10><a id=__codelineno-107-10 name=__codelineno-107-10 href=#__codelineno-107-10></a><span class=w>  </span><span class=nt>event_queue_size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
</span><span id=__span-107-11><a id=__codelineno-107-11 name=__codelineno-107-11 href=#__codelineno-107-11></a>
</span><span id=__span-107-12><a id=__codelineno-107-12 name=__codelineno-107-12 href=#__codelineno-107-12></a><span class=w>  </span><span class=c1># Worker pool size</span>
</span><span id=__span-107-13><a id=__codelineno-107-13 name=__codelineno-107-13 href=#__codelineno-107-13></a><span class=w>  </span><span class=nt>worker_threads</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span><span id=__span-107-14><a id=__codelineno-107-14 name=__codelineno-107-14 href=#__codelineno-107-14></a>
</span><span id=__span-107-15><a id=__codelineno-107-15 name=__codelineno-107-15 href=#__codelineno-107-15></a><span class=w>  </span><span class=c1># Timeout for state backend operations</span>
</span><span id=__span-107-16><a id=__codelineno-107-16 name=__codelineno-107-16 href=#__codelineno-107-16></a><span class=w>  </span><span class=nt>state_backend_timeout</span><span class=p>:</span><span class=w> </span><span class=s>&quot;30s&quot;</span>
</span><span id=__span-107-17><a id=__codelineno-107-17 name=__codelineno-107-17 href=#__codelineno-107-17></a>
</span><span id=__span-107-18><a id=__codelineno-107-18 name=__codelineno-107-18 href=#__codelineno-107-18></a><span class=w>  </span><span class=c1># Memory limits</span>
</span><span id=__span-107-19><a id=__codelineno-107-19 name=__codelineno-107-19 href=#__codelineno-107-19></a><span class=w>  </span><span class=nt>max_memory_mb</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2048</span>
</span></code></pre></div> <p><strong>Docker resource limits:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-108-1><a id=__codelineno-108-1 name=__codelineno-108-1 href=#__codelineno-108-1></a><span class=c1># docker-compose.yml</span>
</span><span id=__span-108-2><a id=__codelineno-108-2 name=__codelineno-108-2 href=#__codelineno-108-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-108-3><a id=__codelineno-108-3 name=__codelineno-108-3 href=#__codelineno-108-3></a><span class=w>  </span><span class=nt>tfdrift-falco</span><span class=p>:</span>
</span><span id=__span-108-4><a id=__codelineno-108-4 name=__codelineno-108-4 href=#__codelineno-108-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/higakikeita/tfdrift-falco:v0.5.0</span>
</span><span id=__span-108-5><a id=__codelineno-108-5 name=__codelineno-108-5 href=#__codelineno-108-5></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-108-6><a id=__codelineno-108-6 name=__codelineno-108-6 href=#__codelineno-108-6></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-108-7><a id=__codelineno-108-7 name=__codelineno-108-7 href=#__codelineno-108-7></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-108-8><a id=__codelineno-108-8 name=__codelineno-108-8 href=#__codelineno-108-8></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;2.0&#39;</span>
</span><span id=__span-108-9><a id=__codelineno-108-9 name=__codelineno-108-9 href=#__codelineno-108-9></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2G</span>
</span><span id=__span-108-10><a id=__codelineno-108-10 name=__codelineno-108-10 href=#__codelineno-108-10></a><span class=w>        </span><span class=nt>reservations</span><span class=p>:</span>
</span><span id=__span-108-11><a id=__codelineno-108-11 name=__codelineno-108-11 href=#__codelineno-108-11></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1.0&#39;</span>
</span><span id=__span-108-12><a id=__codelineno-108-12 name=__codelineno-108-12 href=#__codelineno-108-12></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span></code></pre></div></p> <h4 id=load-balancing>Load Balancing<a class=headerlink href=#load-balancing title="Permanent link">&para;</a></h4> <p><strong>For high-volume environments, run multiple instances:</strong></p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-109-1><a id=__codelineno-109-1 name=__codelineno-109-1 href=#__codelineno-109-1></a><span class=c1># docker-compose.yml</span>
</span><span id=__span-109-2><a id=__codelineno-109-2 name=__codelineno-109-2 href=#__codelineno-109-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-109-3><a id=__codelineno-109-3 name=__codelineno-109-3 href=#__codelineno-109-3></a><span class=w>  </span><span class=nt>tfdrift-falco-1</span><span class=p>:</span>
</span><span id=__span-109-4><a id=__codelineno-109-4 name=__codelineno-109-4 href=#__codelineno-109-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/higakikeita/tfdrift-falco:v0.5.0</span>
</span><span id=__span-109-5><a id=__codelineno-109-5 name=__codelineno-109-5 href=#__codelineno-109-5></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-109-6><a id=__codelineno-109-6 name=__codelineno-109-6 href=#__codelineno-109-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">INSTANCE_ID=1</span>
</span><span id=__span-109-7><a id=__codelineno-109-7 name=__codelineno-109-7 href=#__codelineno-109-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PROJECT_FILTER=project-a,project-b</span>
</span><span id=__span-109-8><a id=__codelineno-109-8 name=__codelineno-109-8 href=#__codelineno-109-8></a><span class=w>    </span><span class=nt>configs</span><span class=p>:</span>
</span><span id=__span-109-9><a id=__codelineno-109-9 name=__codelineno-109-9 href=#__codelineno-109-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">config-instance-1.yaml</span>
</span><span id=__span-109-10><a id=__codelineno-109-10 name=__codelineno-109-10 href=#__codelineno-109-10></a>
</span><span id=__span-109-11><a id=__codelineno-109-11 name=__codelineno-109-11 href=#__codelineno-109-11></a><span class=w>  </span><span class=nt>tfdrift-falco-2</span><span class=p>:</span>
</span><span id=__span-109-12><a id=__codelineno-109-12 name=__codelineno-109-12 href=#__codelineno-109-12></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/higakikeita/tfdrift-falco:v0.5.0</span>
</span><span id=__span-109-13><a id=__codelineno-109-13 name=__codelineno-109-13 href=#__codelineno-109-13></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-109-14><a id=__codelineno-109-14 name=__codelineno-109-14 href=#__codelineno-109-14></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">INSTANCE_ID=2</span>
</span><span id=__span-109-15><a id=__codelineno-109-15 name=__codelineno-109-15 href=#__codelineno-109-15></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PROJECT_FILTER=project-c,project-d</span>
</span><span id=__span-109-16><a id=__codelineno-109-16 name=__codelineno-109-16 href=#__codelineno-109-16></a><span class=w>    </span><span class=nt>configs</span><span class=p>:</span>
</span><span id=__span-109-17><a id=__codelineno-109-17 name=__codelineno-109-17 href=#__codelineno-109-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">config-instance-2.yaml</span>
</span></code></pre></div> <hr> <h3 id=6-security>6. Security<a class=headerlink href=#6-security title="Permanent link">&para;</a></h3> <h4 id=iam-best-practices>IAM Best Practices<a class=headerlink href=#iam-best-practices title="Permanent link">&para;</a></h4> <p><strong>Principle of Least Privilege:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-110-1><a id=__codelineno-110-1 name=__codelineno-110-1 href=#__codelineno-110-1></a><span class=c1># ‚úÖ Good: Minimal permissions</span>
</span><span id=__span-110-2><a id=__codelineno-110-2 name=__codelineno-110-2 href=#__codelineno-110-2></a>gcloud<span class=w> </span>projects<span class=w> </span>add-iam-policy-binding<span class=w> </span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-110-3><a id=__codelineno-110-3 name=__codelineno-110-3 href=#__codelineno-110-3></a><span class=w>  </span>--member<span class=o>=</span><span class=s2>&quot;serviceAccount:tfdrift-falco@</span><span class=nv>$PROJECT_ID</span><span class=s2>.iam.gserviceaccount.com&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-110-4><a id=__codelineno-110-4 name=__codelineno-110-4 href=#__codelineno-110-4></a><span class=w>  </span>--role<span class=o>=</span><span class=s2>&quot;roles/storage.objectViewer&quot;</span><span class=w>  </span><span class=c1># Read-only for state</span>
</span><span id=__span-110-5><a id=__codelineno-110-5 name=__codelineno-110-5 href=#__codelineno-110-5></a>
</span><span id=__span-110-6><a id=__codelineno-110-6 name=__codelineno-110-6 href=#__codelineno-110-6></a>gcloud<span class=w> </span>projects<span class=w> </span>add-iam-policy-binding<span class=w> </span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-110-7><a id=__codelineno-110-7 name=__codelineno-110-7 href=#__codelineno-110-7></a><span class=w>  </span>--member<span class=o>=</span><span class=s2>&quot;serviceAccount:tfdrift-falco@</span><span class=nv>$PROJECT_ID</span><span class=s2>.iam.gserviceaccount.com&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-110-8><a id=__codelineno-110-8 name=__codelineno-110-8 href=#__codelineno-110-8></a><span class=w>  </span>--role<span class=o>=</span><span class=s2>&quot;roles/pubsub.subscriber&quot;</span><span class=w>  </span><span class=c1># Only subscriber, not admin</span>
</span></code></pre></div></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-111-1><a id=__codelineno-111-1 name=__codelineno-111-1 href=#__codelineno-111-1></a><span class=c1># ‚ùå Bad: Overly broad permissions</span>
</span><span id=__span-111-2><a id=__codelineno-111-2 name=__codelineno-111-2 href=#__codelineno-111-2></a>gcloud<span class=w> </span>projects<span class=w> </span>add-iam-policy-binding<span class=w> </span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-111-3><a id=__codelineno-111-3 name=__codelineno-111-3 href=#__codelineno-111-3></a><span class=w>  </span>--member<span class=o>=</span><span class=s2>&quot;serviceAccount:tfdrift-falco@</span><span class=nv>$PROJECT_ID</span><span class=s2>.iam.gserviceaccount.com&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-111-4><a id=__codelineno-111-4 name=__codelineno-111-4 href=#__codelineno-111-4></a><span class=w>  </span>--role<span class=o>=</span><span class=s2>&quot;roles/editor&quot;</span><span class=w>  </span><span class=c1># Too broad!</span>
</span></code></pre></div> <p><strong>Custom Role for TFDrift:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-112-1><a id=__codelineno-112-1 name=__codelineno-112-1 href=#__codelineno-112-1></a><span class=c1># Create custom role with minimal permissions</span>
</span><span id=__span-112-2><a id=__codelineno-112-2 name=__codelineno-112-2 href=#__codelineno-112-2></a>gcloud<span class=w> </span>iam<span class=w> </span>roles<span class=w> </span>create<span class=w> </span>tfdriftFalcoRole<span class=w> </span><span class=se>\</span>
</span><span id=__span-112-3><a id=__codelineno-112-3 name=__codelineno-112-3 href=#__codelineno-112-3></a><span class=w>  </span>--project<span class=o>=</span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-112-4><a id=__codelineno-112-4 name=__codelineno-112-4 href=#__codelineno-112-4></a><span class=w>  </span>--title<span class=o>=</span><span class=s2>&quot;TFDrift Falco Custom Role&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-112-5><a id=__codelineno-112-5 name=__codelineno-112-5 href=#__codelineno-112-5></a><span class=w>  </span>--description<span class=o>=</span><span class=s2>&quot;Minimal permissions for TFDrift-Falco&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-112-6><a id=__codelineno-112-6 name=__codelineno-112-6 href=#__codelineno-112-6></a><span class=w>  </span>--permissions<span class=o>=</span><span class=s2>&quot;\</span>
</span><span id=__span-112-7><a id=__codelineno-112-7 name=__codelineno-112-7 href=#__codelineno-112-7></a><span class=s2>storage.objects.get,\</span>
</span><span id=__span-112-8><a id=__codelineno-112-8 name=__codelineno-112-8 href=#__codelineno-112-8></a><span class=s2>storage.objects.list,\</span>
</span><span id=__span-112-9><a id=__codelineno-112-9 name=__codelineno-112-9 href=#__codelineno-112-9></a><span class=s2>pubsub.subscriptions.consume,\</span>
</span><span id=__span-112-10><a id=__codelineno-112-10 name=__codelineno-112-10 href=#__codelineno-112-10></a><span class=s2>pubsub.subscriptions.get,\</span>
</span><span id=__span-112-11><a id=__codelineno-112-11 name=__codelineno-112-11 href=#__codelineno-112-11></a><span class=s2>logging.logEntries.list&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-112-12><a id=__codelineno-112-12 name=__codelineno-112-12 href=#__codelineno-112-12></a><span class=w>  </span>--stage<span class=o>=</span>GA
</span><span id=__span-112-13><a id=__codelineno-112-13 name=__codelineno-112-13 href=#__codelineno-112-13></a>
</span><span id=__span-112-14><a id=__codelineno-112-14 name=__codelineno-112-14 href=#__codelineno-112-14></a><span class=c1># Assign custom role</span>
</span><span id=__span-112-15><a id=__codelineno-112-15 name=__codelineno-112-15 href=#__codelineno-112-15></a>gcloud<span class=w> </span>projects<span class=w> </span>add-iam-policy-binding<span class=w> </span><span class=nv>$PROJECT_ID</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-112-16><a id=__codelineno-112-16 name=__codelineno-112-16 href=#__codelineno-112-16></a><span class=w>  </span>--member<span class=o>=</span><span class=s2>&quot;serviceAccount:tfdrift-falco@</span><span class=nv>$PROJECT_ID</span><span class=s2>.iam.gserviceaccount.com&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-112-17><a id=__codelineno-112-17 name=__codelineno-112-17 href=#__codelineno-112-17></a><span class=w>  </span>--role<span class=o>=</span><span class=s2>&quot;projects/</span><span class=nv>$PROJECT_ID</span><span class=s2>/roles/tfdriftFalcoRole&quot;</span>
</span></code></pre></div></p> <h4 id=network-security>Network Security<a class=headerlink href=#network-security title="Permanent link">&para;</a></h4> <p><strong>Restrict Falco gRPC access:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-113-1><a id=__codelineno-113-1 name=__codelineno-113-1 href=#__codelineno-113-1></a><span class=c1># Only allow TFDrift host to connect to Falco</span>
</span><span id=__span-113-2><a id=__codelineno-113-2 name=__codelineno-113-2 href=#__codelineno-113-2></a>gcloud<span class=w> </span>compute<span class=w> </span>firewall-rules<span class=w> </span>create<span class=w> </span>allow-tfdrift-to-falco<span class=w> </span><span class=se>\</span>
</span><span id=__span-113-3><a id=__codelineno-113-3 name=__codelineno-113-3 href=#__codelineno-113-3></a><span class=w>  </span>--network<span class=o>=</span>prod-network<span class=w> </span><span class=se>\</span>
</span><span id=__span-113-4><a id=__codelineno-113-4 name=__codelineno-113-4 href=#__codelineno-113-4></a><span class=w>  </span>--allow<span class=o>=</span>tcp:5060<span class=w> </span><span class=se>\</span>
</span><span id=__span-113-5><a id=__codelineno-113-5 name=__codelineno-113-5 href=#__codelineno-113-5></a><span class=w>  </span>--source-ranges<span class=o>=</span><span class=m>10</span>.0.1.10/32<span class=w> </span><span class=se>\ </span><span class=w> </span><span class=c1># TFDrift-Falco IP</span>
</span><span id=__span-113-6><a id=__codelineno-113-6 name=__codelineno-113-6 href=#__codelineno-113-6></a><span class=w>  </span>--target-tags<span class=o>=</span>falco-server<span class=w> </span><span class=se>\</span>
</span><span id=__span-113-7><a id=__codelineno-113-7 name=__codelineno-113-7 href=#__codelineno-113-7></a><span class=w>  </span>--description<span class=o>=</span><span class=s2>&quot;Allow TFDrift to connect to Falco gRPC&quot;</span>
</span></code></pre></div></p> <p><strong>Use TLS for gRPC:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-114-1><a id=__codelineno-114-1 name=__codelineno-114-1 href=#__codelineno-114-1></a><span class=c1># config.yaml</span>
</span><span id=__span-114-2><a id=__codelineno-114-2 name=__codelineno-114-2 href=#__codelineno-114-2></a><span class=nt>falco</span><span class=p>:</span>
</span><span id=__span-114-3><a id=__codelineno-114-3 name=__codelineno-114-3 href=#__codelineno-114-3></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-114-4><a id=__codelineno-114-4 name=__codelineno-114-4 href=#__codelineno-114-4></a><span class=w>  </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=s>&quot;falco.internal.company.com&quot;</span>
</span><span id=__span-114-5><a id=__codelineno-114-5 name=__codelineno-114-5 href=#__codelineno-114-5></a><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5060</span>
</span><span id=__span-114-6><a id=__codelineno-114-6 name=__codelineno-114-6 href=#__codelineno-114-6></a><span class=w>  </span><span class=nt>tls</span><span class=p>:</span>
</span><span id=__span-114-7><a id=__codelineno-114-7 name=__codelineno-114-7 href=#__codelineno-114-7></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-114-8><a id=__codelineno-114-8 name=__codelineno-114-8 href=#__codelineno-114-8></a><span class=w>    </span><span class=nt>ca_cert</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/tfdrift/certs/ca.crt&quot;</span>
</span><span id=__span-114-9><a id=__codelineno-114-9 name=__codelineno-114-9 href=#__codelineno-114-9></a><span class=w>    </span><span class=nt>client_cert</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/tfdrift/certs/client.crt&quot;</span>
</span><span id=__span-114-10><a id=__codelineno-114-10 name=__codelineno-114-10 href=#__codelineno-114-10></a><span class=w>    </span><span class=nt>client_key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/tfdrift/certs/client.key&quot;</span>
</span><span id=__span-114-11><a id=__codelineno-114-11 name=__codelineno-114-11 href=#__codelineno-114-11></a><span class=w>    </span><span class=nt>verify_server</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div></p> <h4 id=audit-logging>Audit Logging<a class=headerlink href=#audit-logging title="Permanent link">&para;</a></h4> <p><strong>Enable audit logs for TFDrift itself:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-115-1><a id=__codelineno-115-1 name=__codelineno-115-1 href=#__codelineno-115-1></a><span class=c1># config.yaml</span>
</span><span id=__span-115-2><a id=__codelineno-115-2 name=__codelineno-115-2 href=#__codelineno-115-2></a><span class=nt>audit</span><span class=p>:</span>
</span><span id=__span-115-3><a id=__codelineno-115-3 name=__codelineno-115-3 href=#__codelineno-115-3></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-115-4><a id=__codelineno-115-4 name=__codelineno-115-4 href=#__codelineno-115-4></a><span class=w>  </span><span class=nt>log_file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/log/tfdrift/audit.log&quot;</span>
</span><span id=__span-115-5><a id=__codelineno-115-5 name=__codelineno-115-5 href=#__codelineno-115-5></a><span class=w>  </span><span class=nt>log_format</span><span class=p>:</span><span class=w> </span><span class=s>&quot;json&quot;</span>
</span><span id=__span-115-6><a id=__codelineno-115-6 name=__codelineno-115-6 href=#__codelineno-115-6></a><span class=w>  </span><span class=nt>log_events</span><span class=p>:</span>
</span><span id=__span-115-7><a id=__codelineno-115-7 name=__codelineno-115-7 href=#__codelineno-115-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;drift_detected&quot;</span>
</span><span id=__span-115-8><a id=__codelineno-115-8 name=__codelineno-115-8 href=#__codelineno-115-8></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;state_loaded&quot;</span>
</span><span id=__span-115-9><a id=__codelineno-115-9 name=__codelineno-115-9 href=#__codelineno-115-9></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;notification_sent&quot;</span>
</span><span id=__span-115-10><a id=__codelineno-115-10 name=__codelineno-115-10 href=#__codelineno-115-10></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;config_changed&quot;</span>
</span><span id=__span-115-11><a id=__codelineno-115-11 name=__codelineno-115-11 href=#__codelineno-115-11></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;startup&quot;</span>
</span><span id=__span-115-12><a id=__codelineno-115-12 name=__codelineno-115-12 href=#__codelineno-115-12></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;shutdown&quot;</span>
</span></code></pre></div></p> <p><strong>Sample audit log entry:</strong> <div class="language-json highlight"><pre><span></span><code><span id=__span-116-1><a id=__codelineno-116-1 name=__codelineno-116-1 href=#__codelineno-116-1></a><span class=p>{</span>
</span><span id=__span-116-2><a id=__codelineno-116-2 name=__codelineno-116-2 href=#__codelineno-116-2></a><span class=w>  </span><span class=nt>&quot;timestamp&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2025-12-17T10:30:45Z&quot;</span><span class=p>,</span>
</span><span id=__span-116-3><a id=__codelineno-116-3 name=__codelineno-116-3 href=#__codelineno-116-3></a><span class=w>  </span><span class=nt>&quot;event_type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;drift_detected&quot;</span><span class=p>,</span>
</span><span id=__span-116-4><a id=__codelineno-116-4 name=__codelineno-116-4 href=#__codelineno-116-4></a><span class=w>  </span><span class=nt>&quot;severity&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;critical&quot;</span><span class=p>,</span>
</span><span id=__span-116-5><a id=__codelineno-116-5 name=__codelineno-116-5 href=#__codelineno-116-5></a><span class=w>  </span><span class=nt>&quot;user&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;user@example.com&quot;</span><span class=p>,</span>
</span><span id=__span-116-6><a id=__codelineno-116-6 name=__codelineno-116-6 href=#__codelineno-116-6></a><span class=w>  </span><span class=nt>&quot;resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;google_compute_firewall.prod_allow_ssh&quot;</span><span class=p>,</span>
</span><span id=__span-116-7><a id=__codelineno-116-7 name=__codelineno-116-7 href=#__codelineno-116-7></a><span class=w>  </span><span class=nt>&quot;project&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;company-prod-123&quot;</span><span class=p>,</span>
</span><span id=__span-116-8><a id=__codelineno-116-8 name=__codelineno-116-8 href=#__codelineno-116-8></a><span class=w>  </span><span class=nt>&quot;changes&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-116-9><a id=__codelineno-116-9 name=__codelineno-116-9 href=#__codelineno-116-9></a><span class=w>    </span><span class=nt>&quot;attribute&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;source_ranges&quot;</span><span class=p>,</span>
</span><span id=__span-116-10><a id=__codelineno-116-10 name=__codelineno-116-10 href=#__codelineno-116-10></a><span class=w>    </span><span class=nt>&quot;old_value&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;10.0.0.0/8&quot;</span><span class=p>],</span>
</span><span id=__span-116-11><a id=__codelineno-116-11 name=__codelineno-116-11 href=#__codelineno-116-11></a><span class=w>    </span><span class=nt>&quot;new_value&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;0.0.0.0/0&quot;</span><span class=p>]</span>
</span><span id=__span-116-12><a id=__codelineno-116-12 name=__codelineno-116-12 href=#__codelineno-116-12></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-116-13><a id=__codelineno-116-13 name=__codelineno-116-13 href=#__codelineno-116-13></a><span class=w>  </span><span class=nt>&quot;action_taken&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;alert_sent&quot;</span><span class=p>,</span>
</span><span id=__span-116-14><a id=__codelineno-116-14 name=__codelineno-116-14 href=#__codelineno-116-14></a><span class=w>  </span><span class=nt>&quot;alert_channels&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;slack&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;pagerduty&quot;</span><span class=p>]</span>
</span><span id=__span-116-15><a id=__codelineno-116-15 name=__codelineno-116-15 href=#__codelineno-116-15></a><span class=p>}</span>
</span></code></pre></div></p> <hr> <h3 id=7-cost-optimization>7. Cost Optimization<a class=headerlink href=#7-cost-optimization title="Permanent link">&para;</a></h3> <h4 id=log-retention-policies>Log Retention Policies<a class=headerlink href=#log-retention-policies title="Permanent link">&para;</a></h4> <p><strong>Set appropriate retention:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-117-1><a id=__codelineno-117-1 name=__codelineno-117-1 href=#__codelineno-117-1></a><span class=c1># Production: 90 days</span>
</span><span id=__span-117-2><a id=__codelineno-117-2 name=__codelineno-117-2 href=#__codelineno-117-2></a>gcloud<span class=w> </span>logging<span class=w> </span>sinks<span class=w> </span>update<span class=w> </span>tfdrift-sink<span class=w> </span><span class=se>\</span>
</span><span id=__span-117-3><a id=__codelineno-117-3 name=__codelineno-117-3 href=#__codelineno-117-3></a><span class=w>  </span>--log-filter<span class=o>=</span><span class=s1>&#39;...&#39;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-117-4><a id=__codelineno-117-4 name=__codelineno-117-4 href=#__codelineno-117-4></a><span class=w>  </span>--retention-days<span class=o>=</span><span class=m>90</span>
</span><span id=__span-117-5><a id=__codelineno-117-5 name=__codelineno-117-5 href=#__codelineno-117-5></a>
</span><span id=__span-117-6><a id=__codelineno-117-6 name=__codelineno-117-6 href=#__codelineno-117-6></a><span class=c1># Development: 7 days</span>
</span><span id=__span-117-7><a id=__codelineno-117-7 name=__codelineno-117-7 href=#__codelineno-117-7></a>gcloud<span class=w> </span>logging<span class=w> </span>sinks<span class=w> </span>update<span class=w> </span>tfdrift-sink-dev<span class=w> </span><span class=se>\</span>
</span><span id=__span-117-8><a id=__codelineno-117-8 name=__codelineno-117-8 href=#__codelineno-117-8></a><span class=w>  </span>--log-filter<span class=o>=</span><span class=s1>&#39;...&#39;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-117-9><a id=__codelineno-117-9 name=__codelineno-117-9 href=#__codelineno-117-9></a><span class=w>  </span>--retention-days<span class=o>=</span><span class=m>7</span>
</span></code></pre></div></p> <p><strong>Cost comparison:</strong> | Retention | Daily Logs (GB) | Monthly Cost (est.) | |-----------|-----------------|---------------------| | 7 days | 10 GB | $5 | | 30 days | 10 GB | $20 | | 90 days | 10 GB | $60 | | 365 days | 10 GB | $240 |</p> <h4 id=storage-optimization>Storage Optimization<a class=headerlink href=#storage-optimization title="Permanent link">&para;</a></h4> <p><strong>Enable lifecycle policies on state bucket:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-118-1><a id=__codelineno-118-1 name=__codelineno-118-1 href=#__codelineno-118-1></a><span class=c1># Delete old state versions after 30 days</span>
</span><span id=__span-118-2><a id=__codelineno-118-2 name=__codelineno-118-2 href=#__codelineno-118-2></a>cat<span class=w> </span>&gt;<span class=w> </span>lifecycle.json<span class=w> </span><span class=s>&lt;&lt;EOF</span>
</span><span id=__span-118-3><a id=__codelineno-118-3 name=__codelineno-118-3 href=#__codelineno-118-3></a><span class=s>{</span>
</span><span id=__span-118-4><a id=__codelineno-118-4 name=__codelineno-118-4 href=#__codelineno-118-4></a><span class=s>  &quot;lifecycle&quot;: {</span>
</span><span id=__span-118-5><a id=__codelineno-118-5 name=__codelineno-118-5 href=#__codelineno-118-5></a><span class=s>    &quot;rule&quot;: [</span>
</span><span id=__span-118-6><a id=__codelineno-118-6 name=__codelineno-118-6 href=#__codelineno-118-6></a><span class=s>      {</span>
</span><span id=__span-118-7><a id=__codelineno-118-7 name=__codelineno-118-7 href=#__codelineno-118-7></a><span class=s>        &quot;action&quot;: {</span>
</span><span id=__span-118-8><a id=__codelineno-118-8 name=__codelineno-118-8 href=#__codelineno-118-8></a><span class=s>          &quot;type&quot;: &quot;Delete&quot;</span>
</span><span id=__span-118-9><a id=__codelineno-118-9 name=__codelineno-118-9 href=#__codelineno-118-9></a><span class=s>        },</span>
</span><span id=__span-118-10><a id=__codelineno-118-10 name=__codelineno-118-10 href=#__codelineno-118-10></a><span class=s>        &quot;condition&quot;: {</span>
</span><span id=__span-118-11><a id=__codelineno-118-11 name=__codelineno-118-11 href=#__codelineno-118-11></a><span class=s>          &quot;age&quot;: 30,</span>
</span><span id=__span-118-12><a id=__codelineno-118-12 name=__codelineno-118-12 href=#__codelineno-118-12></a><span class=s>          &quot;numNewerVersions&quot;: 5</span>
</span><span id=__span-118-13><a id=__codelineno-118-13 name=__codelineno-118-13 href=#__codelineno-118-13></a><span class=s>        }</span>
</span><span id=__span-118-14><a id=__codelineno-118-14 name=__codelineno-118-14 href=#__codelineno-118-14></a><span class=s>      }</span>
</span><span id=__span-118-15><a id=__codelineno-118-15 name=__codelineno-118-15 href=#__codelineno-118-15></a><span class=s>    ]</span>
</span><span id=__span-118-16><a id=__codelineno-118-16 name=__codelineno-118-16 href=#__codelineno-118-16></a><span class=s>  }</span>
</span><span id=__span-118-17><a id=__codelineno-118-17 name=__codelineno-118-17 href=#__codelineno-118-17></a><span class=s>}</span>
</span><span id=__span-118-18><a id=__codelineno-118-18 name=__codelineno-118-18 href=#__codelineno-118-18></a><span class=s>EOF</span>
</span><span id=__span-118-19><a id=__codelineno-118-19 name=__codelineno-118-19 href=#__codelineno-118-19></a>
</span><span id=__span-118-20><a id=__codelineno-118-20 name=__codelineno-118-20 href=#__codelineno-118-20></a>gsutil<span class=w> </span>lifecycle<span class=w> </span><span class=nb>set</span><span class=w> </span>lifecycle.json<span class=w> </span>gs://company-terraform-state
</span></code></pre></div></p> <h4 id=resource-efficiency>Resource Efficiency<a class=headerlink href=#resource-efficiency title="Permanent link">&para;</a></h4> <p><strong>Right-size Falco deployment:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-119-1><a id=__codelineno-119-1 name=__codelineno-119-1 href=#__codelineno-119-1></a><span class=c1># Small environment (&lt; 10 projects, &lt; 1000 events/day)</span>
</span><span id=__span-119-2><a id=__codelineno-119-2 name=__codelineno-119-2 href=#__codelineno-119-2></a><span class=nt>falco</span><span class=p>:</span>
</span><span id=__span-119-3><a id=__codelineno-119-3 name=__codelineno-119-3 href=#__codelineno-119-3></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-119-4><a id=__codelineno-119-4 name=__codelineno-119-4 href=#__codelineno-119-4></a><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;500m&quot;</span>
</span><span id=__span-119-5><a id=__codelineno-119-5 name=__codelineno-119-5 href=#__codelineno-119-5></a><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;512Mi&quot;</span>
</span><span id=__span-119-6><a id=__codelineno-119-6 name=__codelineno-119-6 href=#__codelineno-119-6></a>
</span><span id=__span-119-7><a id=__codelineno-119-7 name=__codelineno-119-7 href=#__codelineno-119-7></a><span class=c1># Medium environment (10-50 projects, 1000-10000 events/day)</span>
</span><span id=__span-119-8><a id=__codelineno-119-8 name=__codelineno-119-8 href=#__codelineno-119-8></a><span class=nt>falco</span><span class=p>:</span>
</span><span id=__span-119-9><a id=__codelineno-119-9 name=__codelineno-119-9 href=#__codelineno-119-9></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-119-10><a id=__codelineno-119-10 name=__codelineno-119-10 href=#__codelineno-119-10></a><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1000m&quot;</span>
</span><span id=__span-119-11><a id=__codelineno-119-11 name=__codelineno-119-11 href=#__codelineno-119-11></a><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1Gi&quot;</span>
</span><span id=__span-119-12><a id=__codelineno-119-12 name=__codelineno-119-12 href=#__codelineno-119-12></a>
</span><span id=__span-119-13><a id=__codelineno-119-13 name=__codelineno-119-13 href=#__codelineno-119-13></a><span class=c1># Large environment (50+ projects, 10000+ events/day)</span>
</span><span id=__span-119-14><a id=__codelineno-119-14 name=__codelineno-119-14 href=#__codelineno-119-14></a><span class=nt>falco</span><span class=p>:</span>
</span><span id=__span-119-15><a id=__codelineno-119-15 name=__codelineno-119-15 href=#__codelineno-119-15></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-119-16><a id=__codelineno-119-16 name=__codelineno-119-16 href=#__codelineno-119-16></a><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2000m&quot;</span>
</span><span id=__span-119-17><a id=__codelineno-119-17 name=__codelineno-119-17 href=#__codelineno-119-17></a><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2Gi&quot;</span>
</span></code></pre></div></p> <hr> <h3 id=8-disaster-recovery>8. Disaster Recovery<a class=headerlink href=#8-disaster-recovery title="Permanent link">&para;</a></h3> <h4 id=backup-strategy>Backup Strategy<a class=headerlink href=#backup-strategy title="Permanent link">&para;</a></h4> <p><strong>Backup TFDrift configuration:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-120-1><a id=__codelineno-120-1 name=__codelineno-120-1 href=#__codelineno-120-1></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-120-2><a id=__codelineno-120-2 name=__codelineno-120-2 href=#__codelineno-120-2></a><span class=c1># backup-tfdrift-config.sh</span>
</span><span id=__span-120-3><a id=__codelineno-120-3 name=__codelineno-120-3 href=#__codelineno-120-3></a>
</span><span id=__span-120-4><a id=__codelineno-120-4 name=__codelineno-120-4 href=#__codelineno-120-4></a><span class=nv>BACKUP_BUCKET</span><span class=o>=</span><span class=s2>&quot;gs://company-backups/tfdrift&quot;</span>
</span><span id=__span-120-5><a id=__codelineno-120-5 name=__codelineno-120-5 href=#__codelineno-120-5></a><span class=nv>TIMESTAMP</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%Y%m%d_%H%M%S<span class=k>)</span>
</span><span id=__span-120-6><a id=__codelineno-120-6 name=__codelineno-120-6 href=#__codelineno-120-6></a>
</span><span id=__span-120-7><a id=__codelineno-120-7 name=__codelineno-120-7 href=#__codelineno-120-7></a><span class=c1># Backup configuration files</span>
</span><span id=__span-120-8><a id=__codelineno-120-8 name=__codelineno-120-8 href=#__codelineno-120-8></a>gsutil<span class=w> </span>cp<span class=w> </span>-r<span class=w> </span>/etc/tfdrift/config.yaml<span class=w> </span><span class=se>\</span>
</span><span id=__span-120-9><a id=__codelineno-120-9 name=__codelineno-120-9 href=#__codelineno-120-9></a><span class=w>  </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BACKUP_BUCKET</span><span class=si>}</span><span class=s2>/config_</span><span class=si>${</span><span class=nv>TIMESTAMP</span><span class=si>}</span><span class=s2>.yaml&quot;</span>
</span><span id=__span-120-10><a id=__codelineno-120-10 name=__codelineno-120-10 href=#__codelineno-120-10></a>
</span><span id=__span-120-11><a id=__codelineno-120-11 name=__codelineno-120-11 href=#__codelineno-120-11></a><span class=c1># Backup service account keys</span>
</span><span id=__span-120-12><a id=__codelineno-120-12 name=__codelineno-120-12 href=#__codelineno-120-12></a>gsutil<span class=w> </span>cp<span class=w> </span>-r<span class=w> </span>/etc/tfdrift/keys/*.json<span class=w> </span><span class=se>\</span>
</span><span id=__span-120-13><a id=__codelineno-120-13 name=__codelineno-120-13 href=#__codelineno-120-13></a><span class=w>  </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BACKUP_BUCKET</span><span class=si>}</span><span class=s2>/keys/</span><span class=si>${</span><span class=nv>TIMESTAMP</span><span class=si>}</span><span class=s2>/&quot;</span>
</span><span id=__span-120-14><a id=__codelineno-120-14 name=__codelineno-120-14 href=#__codelineno-120-14></a>
</span><span id=__span-120-15><a id=__codelineno-120-15 name=__codelineno-120-15 href=#__codelineno-120-15></a><span class=c1># Backup Falco configuration</span>
</span><span id=__span-120-16><a id=__codelineno-120-16 name=__codelineno-120-16 href=#__codelineno-120-16></a>gsutil<span class=w> </span>cp<span class=w> </span>-r<span class=w> </span>/etc/falco/*.yaml<span class=w> </span><span class=se>\</span>
</span><span id=__span-120-17><a id=__codelineno-120-17 name=__codelineno-120-17 href=#__codelineno-120-17></a><span class=w>  </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BACKUP_BUCKET</span><span class=si>}</span><span class=s2>/falco/</span><span class=si>${</span><span class=nv>TIMESTAMP</span><span class=si>}</span><span class=s2>/&quot;</span>
</span><span id=__span-120-18><a id=__codelineno-120-18 name=__codelineno-120-18 href=#__codelineno-120-18></a>
</span><span id=__span-120-19><a id=__codelineno-120-19 name=__codelineno-120-19 href=#__codelineno-120-19></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;‚úì Backup completed: </span><span class=si>${</span><span class=nv>BACKUP_BUCKET</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>TIMESTAMP</span><span class=si>}</span><span class=s2>&quot;</span>
</span></code></pre></div></p> <h4 id=recovery-procedures>Recovery Procedures<a class=headerlink href=#recovery-procedures title="Permanent link">&para;</a></h4> <p><strong>Quick recovery script:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-121-1><a id=__codelineno-121-1 name=__codelineno-121-1 href=#__codelineno-121-1></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-121-2><a id=__codelineno-121-2 name=__codelineno-121-2 href=#__codelineno-121-2></a><span class=c1># recover-tfdrift.sh</span>
</span><span id=__span-121-3><a id=__codelineno-121-3 name=__codelineno-121-3 href=#__codelineno-121-3></a>
</span><span id=__span-121-4><a id=__codelineno-121-4 name=__codelineno-121-4 href=#__codelineno-121-4></a><span class=nv>BACKUP_BUCKET</span><span class=o>=</span><span class=s2>&quot;gs://company-backups/tfdrift&quot;</span>
</span><span id=__span-121-5><a id=__codelineno-121-5 name=__codelineno-121-5 href=#__codelineno-121-5></a><span class=nv>BACKUP_DATE</span><span class=o>=</span><span class=nv>$1</span><span class=w>  </span><span class=c1># Format: 20251217_103000</span>
</span><span id=__span-121-6><a id=__codelineno-121-6 name=__codelineno-121-6 href=#__codelineno-121-6></a>
</span><span id=__span-121-7><a id=__codelineno-121-7 name=__codelineno-121-7 href=#__codelineno-121-7></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;==&gt; Recovering TFDrift from backup: </span><span class=nv>$BACKUP_DATE</span><span class=s2>&quot;</span>
</span><span id=__span-121-8><a id=__codelineno-121-8 name=__codelineno-121-8 href=#__codelineno-121-8></a>
</span><span id=__span-121-9><a id=__codelineno-121-9 name=__codelineno-121-9 href=#__codelineno-121-9></a><span class=c1># Restore configuration</span>
</span><span id=__span-121-10><a id=__codelineno-121-10 name=__codelineno-121-10 href=#__codelineno-121-10></a>gsutil<span class=w> </span>cp<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BACKUP_BUCKET</span><span class=si>}</span><span class=s2>/config_</span><span class=si>${</span><span class=nv>BACKUP_DATE</span><span class=si>}</span><span class=s2>.yaml&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-121-11><a id=__codelineno-121-11 name=__codelineno-121-11 href=#__codelineno-121-11></a><span class=w>  </span>/etc/tfdrift/config.yaml
</span><span id=__span-121-12><a id=__codelineno-121-12 name=__codelineno-121-12 href=#__codelineno-121-12></a>
</span><span id=__span-121-13><a id=__codelineno-121-13 name=__codelineno-121-13 href=#__codelineno-121-13></a><span class=c1># Restore keys</span>
</span><span id=__span-121-14><a id=__codelineno-121-14 name=__codelineno-121-14 href=#__codelineno-121-14></a>gsutil<span class=w> </span>cp<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BACKUP_BUCKET</span><span class=si>}</span><span class=s2>/keys/</span><span class=si>${</span><span class=nv>BACKUP_DATE</span><span class=si>}</span><span class=s2>/*&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-121-15><a id=__codelineno-121-15 name=__codelineno-121-15 href=#__codelineno-121-15></a><span class=w>  </span>/etc/tfdrift/keys/
</span><span id=__span-121-16><a id=__codelineno-121-16 name=__codelineno-121-16 href=#__codelineno-121-16></a>
</span><span id=__span-121-17><a id=__codelineno-121-17 name=__codelineno-121-17 href=#__codelineno-121-17></a><span class=c1># Restore Falco config</span>
</span><span id=__span-121-18><a id=__codelineno-121-18 name=__codelineno-121-18 href=#__codelineno-121-18></a>gsutil<span class=w> </span>cp<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BACKUP_BUCKET</span><span class=si>}</span><span class=s2>/falco/</span><span class=si>${</span><span class=nv>BACKUP_DATE</span><span class=si>}</span><span class=s2>/*&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-121-19><a id=__codelineno-121-19 name=__codelineno-121-19 href=#__codelineno-121-19></a><span class=w>  </span>/etc/falco/
</span><span id=__span-121-20><a id=__codelineno-121-20 name=__codelineno-121-20 href=#__codelineno-121-20></a>
</span><span id=__span-121-21><a id=__codelineno-121-21 name=__codelineno-121-21 href=#__codelineno-121-21></a><span class=c1># Restart services</span>
</span><span id=__span-121-22><a id=__codelineno-121-22 name=__codelineno-121-22 href=#__codelineno-121-22></a>docker-compose<span class=w> </span>restart<span class=w> </span>falco
</span><span id=__span-121-23><a id=__codelineno-121-23 name=__codelineno-121-23 href=#__codelineno-121-23></a>docker-compose<span class=w> </span>restart<span class=w> </span>tfdrift-falco
</span><span id=__span-121-24><a id=__codelineno-121-24 name=__codelineno-121-24 href=#__codelineno-121-24></a>
</span><span id=__span-121-25><a id=__codelineno-121-25 name=__codelineno-121-25 href=#__codelineno-121-25></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;‚úì Recovery completed&quot;</span>
</span></code></pre></div></p> <hr> <h2 id=performance-tuning>Performance Tuning<a class=headerlink href=#performance-tuning title="Permanent link">&para;</a></h2> <h3 id=falco-configuration>Falco Configuration<a class=headerlink href=#falco-configuration title="Permanent link">&para;</a></h3> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-122-1><a id=__codelineno-122-1 name=__codelineno-122-1 href=#__codelineno-122-1></a><span class=c1># falco.yaml</span>
</span><span id=__span-122-2><a id=__codelineno-122-2 name=__codelineno-122-2 href=#__codelineno-122-2></a><span class=nt>grpc</span><span class=p>:</span>
</span><span id=__span-122-3><a id=__codelineno-122-3 name=__codelineno-122-3 href=#__codelineno-122-3></a><span class=w>  </span><span class=nt>threadiness</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">16</span><span class=w>  </span><span class=c1># Increase for high volume</span>
</span><span id=__span-122-4><a id=__codelineno-122-4 name=__codelineno-122-4 href=#__codelineno-122-4></a>
</span><span id=__span-122-5><a id=__codelineno-122-5 name=__codelineno-122-5 href=#__codelineno-122-5></a><span class=nt>plugins</span><span class=p>:</span>
</span><span id=__span-122-6><a id=__codelineno-122-6 name=__codelineno-122-6 href=#__codelineno-122-6></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gcpaudit</span>
</span><span id=__span-122-7><a id=__codelineno-122-7 name=__codelineno-122-7 href=#__codelineno-122-7></a><span class=w>    </span><span class=nt>init_config</span><span class=p>:</span>
</span><span id=__span-122-8><a id=__codelineno-122-8 name=__codelineno-122-8 href=#__codelineno-122-8></a><span class=w>      </span><span class=c1># Batch size for Pub/Sub pulls</span>
</span><span id=__span-122-9><a id=__codelineno-122-9 name=__codelineno-122-9 href=#__codelineno-122-9></a><span class=w>      </span><span class=nt>max_messages</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
</span><span id=__span-122-10><a id=__codelineno-122-10 name=__codelineno-122-10 href=#__codelineno-122-10></a><span class=w>      </span><span class=c1># Subscription timeout</span>
</span><span id=__span-122-11><a id=__codelineno-122-11 name=__codelineno-122-11 href=#__codelineno-122-11></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">60s</span>
</span></code></pre></div> <h3 id=tfdrift-falco-configuration>TFDrift-Falco Configuration<a class=headerlink href=#tfdrift-falco-configuration title="Permanent link">&para;</a></h3> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-123-1><a id=__codelineno-123-1 name=__codelineno-123-1 href=#__codelineno-123-1></a><span class=c1># Filter irrelevant events at TFDrift level</span>
</span><span id=__span-123-2><a id=__codelineno-123-2 name=__codelineno-123-2 href=#__codelineno-123-2></a><span class=nt>drift_rules</span><span class=p>:</span>
</span><span id=__span-123-3><a id=__codelineno-123-3 name=__codelineno-123-3 href=#__codelineno-123-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;High</span><span class=nv> </span><span class=s>Priority</span><span class=nv> </span><span class=s>Only&quot;</span>
</span><span id=__span-123-4><a id=__codelineno-123-4 name=__codelineno-123-4 href=#__codelineno-123-4></a><span class=w>    </span><span class=nt>resource_types</span><span class=p>:</span>
</span><span id=__span-123-5><a id=__codelineno-123-5 name=__codelineno-123-5 href=#__codelineno-123-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_compute_firewall&quot;</span>
</span><span id=__span-123-6><a id=__codelineno-123-6 name=__codelineno-123-6 href=#__codelineno-123-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;google_project_iam_binding&quot;</span>
</span><span id=__span-123-7><a id=__codelineno-123-7 name=__codelineno-123-7 href=#__codelineno-123-7></a><span class=w>    </span><span class=nt>watched_attributes</span><span class=p>:</span>
</span><span id=__span-123-8><a id=__codelineno-123-8 name=__codelineno-123-8 href=#__codelineno-123-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*&quot;</span>
</span><span id=__span-123-9><a id=__codelineno-123-9 name=__codelineno-123-9 href=#__codelineno-123-9></a><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;critical&quot;</span>
</span></code></pre></div> <hr> <h2 id=security-best-practices>Security Best Practices<a class=headerlink href=#security-best-practices title="Permanent link">&para;</a></h2> <ol> <li><strong>Least Privilege</strong>: Grant minimal IAM roles</li> <li><strong>Service Account Keys</strong>: Rotate regularly (every 90 days)</li> <li><strong>Network Security</strong>: Restrict Falco gRPC access</li> <li><strong>Audit Logs Retention</strong>: Configure log retention policies</li> <li><strong>Encryption</strong>: Enable encryption at rest for GCS state bucket</li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id=__span-124-1><a id=__codelineno-124-1 name=__codelineno-124-1 href=#__codelineno-124-1></a><span class=c1># Enable customer-managed encryption</span>
</span><span id=__span-124-2><a id=__codelineno-124-2 name=__codelineno-124-2 href=#__codelineno-124-2></a>gsutil<span class=w> </span>encryption<span class=w> </span><span class=nb>set</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-124-3><a id=__codelineno-124-3 name=__codelineno-124-3 href=#__codelineno-124-3></a><span class=w>  </span>-k<span class=w> </span>projects/<span class=nv>$PROJECT_ID</span>/locations/global/keyRings/tfdrift/cryptoKeys/state<span class=w> </span><span class=se>\</span>
</span><span id=__span-124-4><a id=__codelineno-124-4 name=__codelineno-124-4 href=#__codelineno-124-4></a><span class=w>  </span>gs://tfdrift-terraform-state
</span></code></pre></div> <hr> <h2 id=next-steps>Next Steps<a class=headerlink href=#next-steps title="Permanent link">&para;</a></h2> <ul> <li><a href=../README.md>Back to Main Documentation</a></li> <li><a href=../deployment/ >Deployment Guide</a></li> <li><a href=../falco-setup/ >AWS Setup Guide</a></li> <li><a href=./troubleshooting.md>Troubleshooting Guide</a></li> </ul> <hr> <h2 id=support>Support<a class=headerlink href=#support title="Permanent link">&para;</a></h2> <ul> <li><strong>Issues</strong>: <a href=https://github.com/higakikeita/tfdrift-falco/issues>https://github.com/higakikeita/tfdrift-falco/issues</a></li> <li><strong>Discussions</strong>: <a href=https://github.com/higakikeita/tfdrift-falco/discussions>https://github.com/higakikeita/tfdrift-falco/discussions</a></li> <li><strong>Documentation</strong>: <a href=https://tfdrift-falco.readthedocs.io>https://tfdrift-falco.readthedocs.io</a></li> </ul> <hr> <p><strong>Last Updated</strong>: 2025-12-17 <strong>TFDrift-Falco Version</strong>: v0.5.0+</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 Keita Higaki </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/higakikeita/tfdrift-falco target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://twitter.com/higakikeita target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share", "toc.follow", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script> <script src=../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>